---
title: "Asynchronní návratové typy (C#)"
ms.custom: 
ms.date: 05/29/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: devlang-csharp
ms.topic: article
ms.assetid: ddb2539c-c898-48c1-ad92-245e4a996df8
caps.latest.revision: "3"
author: BillWagner
ms.author: wiwagn
ms.openlocfilehash: 7aee1ebdf24a2ac564268e1f36d3aac707dea463
ms.sourcegitcommit: 7e99f66ef09d2903e22c789c67ff5a10aa953b2f
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 11/18/2017
---
# <a name="async-return-types-c"></a><span data-ttu-id="c724d-102">Asynchronní návratové typy (C#)</span><span class="sxs-lookup"><span data-stu-id="c724d-102">Async Return Types (C#)</span></span>
<span data-ttu-id="c724d-103">Asynchronní metody může mít následující návratové typy:</span><span class="sxs-lookup"><span data-stu-id="c724d-103">Async methods can have the following return types:</span></span>

- <span data-ttu-id="c724d-104"><xref:System.Threading.Tasks.Task%601>, pro asynchronní metody, která vrátí hodnotu.</span><span class="sxs-lookup"><span data-stu-id="c724d-104"><xref:System.Threading.Tasks.Task%601>, for an async method that returns a value.</span></span> 
 
-  <span data-ttu-id="c724d-105"><xref:System.Threading.Tasks.Task>, pro asynchronní metodu, která provádí operaci, ale nevrací žádnou hodnotu.</span><span class="sxs-lookup"><span data-stu-id="c724d-105"><xref:System.Threading.Tasks.Task>, for an async method that performs an operation but returns no value.</span></span>

- <span data-ttu-id="c724d-106">`void`, pro obslužnou rutinu události.</span><span class="sxs-lookup"><span data-stu-id="c724d-106">`void`, for an event handler.</span></span> 

- <span data-ttu-id="c724d-107">Od verze jazyka C# 7, žádný typ, který má přístupné `GetAwaiter` metoda.</span><span class="sxs-lookup"><span data-stu-id="c724d-107">Starting with C# 7, any type that has an accessible `GetAwaiter` method.</span></span> <span data-ttu-id="c724d-108">Objekt vrácený `GetAwaiter` metoda musí implementovat <xref:System.Runtime.CompilerServices.ICriticalNotifyCompletion?displayProperty=nameWithType> rozhraní.</span><span class="sxs-lookup"><span data-stu-id="c724d-108">The object returned by the `GetAwaiter` method must implement the <xref:System.Runtime.CompilerServices.ICriticalNotifyCompletion?displayProperty=nameWithType> interface.</span></span>
  
<span data-ttu-id="c724d-109">Další informace o asynchronní metody najdete v tématu [asynchronní programování pomocí modifikátoru async a operátoru await (C#)](../../../../csharp/programming-guide/concepts/async/index.md).</span><span class="sxs-lookup"><span data-stu-id="c724d-109">For more information about async methods, see [Asynchronous Programming with async and await (C#)](../../../../csharp/programming-guide/concepts/async/index.md).</span></span>  
  
<span data-ttu-id="c724d-110">V jednom z těchto částí je zkontrolován každý návratový typ a najdete úplný příklad, který používá všechny tři typy na konci tohoto tématu.</span><span class="sxs-lookup"><span data-stu-id="c724d-110">Each return type is examined in one of the following sections, and you can find a full example that uses all three types at the end of the topic.</span></span>  
  
##  <a name="BKMK_TaskTReturnType"></a><span data-ttu-id="c724d-111">Návratový typ Task(T)</span><span class="sxs-lookup"><span data-stu-id="c724d-111">Task(T) Return Type</span></span>  
<span data-ttu-id="c724d-112"><xref:System.Threading.Tasks.Task%601> Vrátí typ se používá pro asynchronní metody, která obsahuje [vrátit](../../../../csharp/language-reference/keywords/return.md) (C#) příkaz, ve kterém má operand typu `TResult`.</span><span class="sxs-lookup"><span data-stu-id="c724d-112">The <xref:System.Threading.Tasks.Task%601> return type is used for an async method that contains a [return](../../../../csharp/language-reference/keywords/return.md) (C#) statement in which the operand has type `TResult`.</span></span>  
  
<span data-ttu-id="c724d-113">V následujícím příkladu `GetLeisureHours` obsahuje asynchronní metody `return` příkaz, který vrátí celé číslo.</span><span class="sxs-lookup"><span data-stu-id="c724d-113">In the following example, the `GetLeisureHours` async method contains a `return` statement that returns an integer.</span></span> <span data-ttu-id="c724d-114">Proto deklarace metody musíte zadat návratový typ `Task<int>`.</span><span class="sxs-lookup"><span data-stu-id="c724d-114">Therefore, the method declaration must specify a return type of `Task<int>`.</span></span>  <span data-ttu-id="c724d-115"><xref:System.Threading.Tasks.Task.FromResult%2A> Asynchronní metody je zástupný symbol pro operace, která vrací řetězec.</span><span class="sxs-lookup"><span data-stu-id="c724d-115">The <xref:System.Threading.Tasks.Task.FromResult%2A> async method is a placeholder for an operation that returns a string.</span></span>
  
[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns1.cs)]

<span data-ttu-id="c724d-116">Při `GetLeisureHours` je volána v rámci výrazu await v `ShowTodaysInfo` metoda, výraz await načte celočíselnou hodnotu (hodnota `leisureHours`) který je uložený v úloze vrácený `GetLeisureHours` metoda.</span><span class="sxs-lookup"><span data-stu-id="c724d-116">When `GetLeisureHours` is called from within an await expression in the `ShowTodaysInfo` method, the await expression retrieves the integer value (the value of `leisureHours`) that's stored in the task returned by the `GetLeisureHours` method.</span></span> <span data-ttu-id="c724d-117">Další informace o await výrazy najdete v tématu [await](../../../../csharp/language-reference/keywords/await.md).</span><span class="sxs-lookup"><span data-stu-id="c724d-117">For more information about await expressions, see [await](../../../../csharp/language-reference/keywords/await.md).</span></span>  
  
<span data-ttu-id="c724d-118">Můžete lépe pochopit, jak tomu oddělením volání `GetLeisureHours` z používání `await`, jak ukazuje následující kód.</span><span class="sxs-lookup"><span data-stu-id="c724d-118">You can better understand how this happens by separating the call to `GetLeisureHours` from the application of `await`, as the following code shows.</span></span> <span data-ttu-id="c724d-119">Volání metody `TaskOfT_MethodAsync` , není okamžitě očekávaná vrátí `Task<int>`, jak očekáváte od deklaraci metody.</span><span class="sxs-lookup"><span data-stu-id="c724d-119">A call to method `TaskOfT_MethodAsync` that isn't immediately awaited returns a `Task<int>`, as you would expect from the declaration of the method.</span></span> <span data-ttu-id="c724d-120">Úloha je přiřazená `integerTask` proměnné v příkladu.</span><span class="sxs-lookup"><span data-stu-id="c724d-120">The task is assigned to the `integerTask` variable in the example.</span></span> <span data-ttu-id="c724d-121">Protože `integerTask` je <xref:System.Threading.Tasks.Task%601>, obsahuje <xref:System.Threading.Tasks.Task%601.Result> vlastnost typu `TResult`.</span><span class="sxs-lookup"><span data-stu-id="c724d-121">Because `integerTask` is a <xref:System.Threading.Tasks.Task%601>, it contains a <xref:System.Threading.Tasks.Task%601.Result> property of type `TResult`.</span></span> <span data-ttu-id="c724d-122">V takovém případě TResult představuje celočíselného typu.</span><span class="sxs-lookup"><span data-stu-id="c724d-122">In this case, TResult represents an integer type.</span></span> <span data-ttu-id="c724d-123">Když `await` se použije pro `integerTask`, await vyhodnocen jako obsah <xref:System.Threading.Tasks.Task%601.Result%2A> vlastnost `integerTask`.</span><span class="sxs-lookup"><span data-stu-id="c724d-123">When `await` is applied to `integerTask`, the await expression evaluates to the contents of the <xref:System.Threading.Tasks.Task%601.Result%2A> property of `integerTask`.</span></span> <span data-ttu-id="c724d-124">Hodnota je přiřazena k `result2` proměnné.</span><span class="sxs-lookup"><span data-stu-id="c724d-124">The value is assigned to the `result2` variable.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="c724d-125"><xref:System.Threading.Tasks.Task%601.Result%2A> Je blokování vlastnost.</span><span class="sxs-lookup"><span data-stu-id="c724d-125">The <xref:System.Threading.Tasks.Task%601.Result%2A> property is a blocking property.</span></span> <span data-ttu-id="c724d-126">Pokud se pokusíte k němu přístup před dokončení úkolu, vláken, který je aktuálně aktivní je blokován, dokud úloha dokončí, a hodnota je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="c724d-126">If you try to access it before its task is finished, the thread that's currently active is blocked until the task completes and the value is available.</span></span> <span data-ttu-id="c724d-127">Ve většině případů byste měli hodnota přistupovat pomocí `await` místo přístupu k vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="c724d-127">In most cases, you should access the value by using `await` instead of accessing the property directly.</span></span> <br/> <span data-ttu-id="c724d-128">Předchozí příklad načíst hodnotu <xref:System.Threading.Tasks.Task%601.Result%2A> vlastnost blokování hlavního vlákna tak, aby `ShowTodaysInfo` metoda může dokončí provádění, než aplikace skončila.</span><span class="sxs-lookup"><span data-stu-id="c724d-128">The previous example retrieved the value of the <xref:System.Threading.Tasks.Task%601.Result%2A> property to block the main thread so that the `ShowTodaysInfo` method could finish execution before the application ended.</span></span>  

[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns1a.cs#1)]
  
##  <a name="BKMK_TaskReturnType"></a><span data-ttu-id="c724d-129">Návratový typ úlohy</span><span class="sxs-lookup"><span data-stu-id="c724d-129">Task Return Type</span></span>  
<span data-ttu-id="c724d-130">Asynchronní metody, které neobsahují žádný `return` prohlášení nebo které obsahovat `return` příkaz, který nevrací operand obvykle mají návratový typ <xref:System.Threading.Tasks.Task>.</span><span class="sxs-lookup"><span data-stu-id="c724d-130">Async methods that don't contain a `return` statement or that contain a `return` statement that doesn't return an operand usually have a return type of <xref:System.Threading.Tasks.Task>.</span></span> <span data-ttu-id="c724d-131">Tyto metody vrací `void` Pokud spouští synchronně.</span><span class="sxs-lookup"><span data-stu-id="c724d-131">Such methods return `void` if they run synchronously.</span></span> <span data-ttu-id="c724d-132">Pokud používáte <xref:System.Threading.Tasks.Task> návratový typ pro asynchronní metody, můžete použít volání metody `await` operátor volajícího dokončení pozastavit, dokud volané asynchronní metody dokončení.</span><span class="sxs-lookup"><span data-stu-id="c724d-132">If you use a <xref:System.Threading.Tasks.Task> return type for an async method, a calling method can use an `await` operator to suspend the caller's completion until the called async method has finished.</span></span>  
  
<span data-ttu-id="c724d-133">V následujícím příkladu `WaitAndApologize` neobsahuje asynchronní metody `return` prohlášení, vrátí metoda <xref:System.Threading.Tasks.Task> objektu.</span><span class="sxs-lookup"><span data-stu-id="c724d-133">In the following example, the `WaitAndApologize` async method doesn't contain a `return` statement, so the method returns a <xref:System.Threading.Tasks.Task> object.</span></span> <span data-ttu-id="c724d-134">To umožňuje `WaitAndApologize` k být očekáváno.</span><span class="sxs-lookup"><span data-stu-id="c724d-134">This enables `WaitAndApologize` to be awaited.</span></span> <span data-ttu-id="c724d-135">Všimněte si, že <xref:System.Threading.Tasks.Task> neobsahuje typ `Result` vlastnost protože nemá žádnou návratovou hodnotu.</span><span class="sxs-lookup"><span data-stu-id="c724d-135">Note that the <xref:System.Threading.Tasks.Task> type doesn't include a `Result` property because it has no return value.</span></span>  

[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns2.cs)]  
  
<span data-ttu-id="c724d-136">`WaitAndApologize`je očekáváno pomocí příkazu await místo výrazu await, podobně jako příkaz volání pro metodu synchronní vrácení void.</span><span class="sxs-lookup"><span data-stu-id="c724d-136">`WaitAndApologize` is awaited by using an await statement instead of an await expression, similar to the calling statement for a synchronous void-returning method.</span></span> <span data-ttu-id="c724d-137">Aplikace operátoru await v tomto případě neobsahuje hodnotu.</span><span class="sxs-lookup"><span data-stu-id="c724d-137">The application of an await operator in this case doesn't produce a value.</span></span>  
  
<span data-ttu-id="c724d-138">Stejně jako v předchozí <xref:System.Threading.Tasks.Task%601> příkladu můžete oddělit volání `Task_MethodAsync` z aplikace operátoru await, jako následující kód ukazuje.</span><span class="sxs-lookup"><span data-stu-id="c724d-138">As in the previous <xref:System.Threading.Tasks.Task%601> example, you can separate the call to `Task_MethodAsync` from the application of an await operator, as the following code shows.</span></span> <span data-ttu-id="c724d-139">Nezapomeňte však, že `Task` nemá `Result` vlastnost a že při použití operátoru await vytváří žádná hodnota `Task`.</span><span class="sxs-lookup"><span data-stu-id="c724d-139">However, remember that a `Task` doesn't have a `Result` property, and that no value is produced when an await operator is applied to a `Task`.</span></span>  
  
<span data-ttu-id="c724d-140">Následující kód odděluje volání `WaitAndApologize` metoda z čeká na úlohu, která vrátí metoda.</span><span class="sxs-lookup"><span data-stu-id="c724d-140">The following code separates calling the `WaitAndApologize` method from awaiting the task that the method returns.</span></span>  
 
[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns2a.cs#1)]  
 
##  <a name="BKMK_VoidReturnType"></a><span data-ttu-id="c724d-141">Typ vrácené hodnoty void</span><span class="sxs-lookup"><span data-stu-id="c724d-141">Void return type</span></span>  
<span data-ttu-id="c724d-142">Můžete použít `void` návratový typ v obslužné rutiny asynchronní událostí, které vyžadují `void` návratovým typem.</span><span class="sxs-lookup"><span data-stu-id="c724d-142">You use the `void` return type in asynchronous event handlers, which require a `void` return type.</span></span> <span data-ttu-id="c724d-143">Pro jiných metod než událost obslužné rutiny nevrací hodnotu, měli byste se vrátit <xref:System.Threading.Tasks.Task> místo, protože asynchronní metody, která vrací `void` nelze očekáváno.</span><span class="sxs-lookup"><span data-stu-id="c724d-143">For methods other than event handlers don't return a value, you should return a <xref:System.Threading.Tasks.Task> instead, because an async method that returns `void` can't be awaited.</span></span> <span data-ttu-id="c724d-144">Všechny volající tato metoda musí být schopen dál dokončení bez čekání na volané asynchronní metody dokončení a volající musí být nezávislé na všechny hodnoty nebo které generuje asynchronní metody.</span><span class="sxs-lookup"><span data-stu-id="c724d-144">Any caller of such a method must be able to continue to completion without waiting for the called async method to finish, and the caller must be independent of any values or exceptions that the async method generates.</span></span>  
  
<span data-ttu-id="c724d-145">Volající asynchronní metody vrácení void nelze catch výjimky, které jsou vyvolány z metody a může způsobit selhání aplikace jsou takové neošetřené výjimky.</span><span class="sxs-lookup"><span data-stu-id="c724d-145">The caller of a void-returning async method can't catch exceptions that are thrown from the method, and such unhandled exceptions are likely to cause your application to fail.</span></span> <span data-ttu-id="c724d-146">Pokud dojde k výjimce v asynchronní metody, která vrací <xref:System.Threading.Tasks.Task> nebo <xref:System.Threading.Tasks.Task%601>, výjimka je uložený v vrácený úkolů a je znovu vyvolány, když je očekáváno úlohu.</span><span class="sxs-lookup"><span data-stu-id="c724d-146">If an exception occurs in an async method that returns a <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601>, the exception is stored in the returned task and is rethrown when the task is awaited.</span></span> <span data-ttu-id="c724d-147">Proto se ujistěte, že asynchronní metody, která může vytvořit výjimku má návratový typ <xref:System.Threading.Tasks.Task> nebo <xref:System.Threading.Tasks.Task%601> a že jsou očekáváno volání metody.</span><span class="sxs-lookup"><span data-stu-id="c724d-147">Therefore, make sure that any async method that can produce an exception has a return type of <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> and that calls to the method are awaited.</span></span>  
  
<span data-ttu-id="c724d-148">Další informace o tom, jak zachycení výjimek v asynchronní metody najdete v tématu [try-catch –](../../../../csharp/language-reference/keywords/try-catch.md) .</span><span class="sxs-lookup"><span data-stu-id="c724d-148">For more information about how to catch exceptions in async methods, see [try-catch](../../../../csharp/language-reference/keywords/try-catch.md) .</span></span>  
  
<span data-ttu-id="c724d-149">Následující eample definuje obslužnou rutinu události asynchronní.</span><span class="sxs-lookup"><span data-stu-id="c724d-149">The following eample defines an async event handler.</span></span>  
 
[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns3.cs)]  
 
## <a name="generalized-async-return-types-and-valuetaskt"></a><span data-ttu-id="c724d-150">Zobecněný asynchronní návratové typy a ValueTask<T></span><span class="sxs-lookup"><span data-stu-id="c724d-150">Generalized async return types and ValueTask<T></span></span>

<span data-ttu-id="c724d-151">Počínaje C# 7, může použití asynchronní metody vrátit žádný typ, který má přístupné `GetAwaiter` metoda.</span><span class="sxs-lookup"><span data-stu-id="c724d-151">Starting with C# 7, an async method can return any type that has an accessible `GetAwaiter` method.</span></span>
 
<span data-ttu-id="c724d-152">Protože <xref:System.Threading.Tasks.Task> a <xref:System.Threading.Tasks.Task%601> jsou odkazové typy přidělení paměti v výkon kritických cest, zejména v případě, že v úzkou smyčky, dojde k přidělení může nepříznivě ovlivnit výkon.</span><span class="sxs-lookup"><span data-stu-id="c724d-152">Because <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> are reference types, memory allocation in performance-critical paths, particularly when allocations occur in tight loops, can adversely affect performance.</span></span> <span data-ttu-id="c724d-153">Podpora pro zobecněný návratové typy znamená, že se můžete vrátit typu lightweight hodnoty místo typu odkazu. aby se zabránilo přidělení další paměť.</span><span class="sxs-lookup"><span data-stu-id="c724d-153">Support for generalized return types means that you can return a lightweight value type instead of a reference type to avoid additional memory allocations.</span></span> 

<span data-ttu-id="c724d-154">Poskytuje rozhraní .NET <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType> struktura jako šedé – implementace zobecněný úloh vrácení hodnoty.</span><span class="sxs-lookup"><span data-stu-id="c724d-154">.NET provides the <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType> structure as a light-weight implementation of a generalized task-returning value.</span></span> <span data-ttu-id="c724d-155">Použít <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType> typu, je nutné přidat `System.Threading.Tasks.Extensions` balíček NuGet do projektu.</span><span class="sxs-lookup"><span data-stu-id="c724d-155">To use the <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType> type, you must add the `System.Threading.Tasks.Extensions` NuGet package to your project.</span></span> <span data-ttu-id="c724d-156">Následující příklad používá <xref:System.Threading.Tasks.ValueTask%601> se vrátí k načtení hodnoty dvou rozčlenění strukturu.</span><span class="sxs-lookup"><span data-stu-id="c724d-156">The following example uses the <xref:System.Threading.Tasks.ValueTask%601> structure to retrieve the value of two dice rolls.</span></span> 
  
[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-valuetask.cs)]

## <a name="see-also"></a><span data-ttu-id="c724d-157">Viz také</span><span class="sxs-lookup"><span data-stu-id="c724d-157">See also</span></span>  
<span data-ttu-id="c724d-158"><xref:System.Threading.Tasks.Task.FromResult%2A></span><span class="sxs-lookup"><span data-stu-id="c724d-158"><xref:System.Threading.Tasks.Task.FromResult%2A></span></span>   
<span data-ttu-id="c724d-159">[Návod: Přístup k webu pomocí modifikátoru async a operátoru await (C#)](../../../../csharp/programming-guide/concepts/async/walkthrough-accessing-the-web-by-using-async-and-await.md) </span><span class="sxs-lookup"><span data-stu-id="c724d-159">[Walkthrough: Accessing the Web by Using async and await (C#)](../../../../csharp/programming-guide/concepts/async/walkthrough-accessing-the-web-by-using-async-and-await.md) </span></span>  
<span data-ttu-id="c724d-160">[Řízení toku v asynchronních programech (C#)](../../../../csharp/programming-guide/concepts/async/control-flow-in-async-programs.md) </span><span class="sxs-lookup"><span data-stu-id="c724d-160">[Control Flow in Async Programs (C#)](../../../../csharp/programming-guide/concepts/async/control-flow-in-async-programs.md) </span></span>  
<span data-ttu-id="c724d-161">[asynchronní](../../../../csharp/language-reference/keywords/async.md) </span><span class="sxs-lookup"><span data-stu-id="c724d-161">[async](../../../../csharp/language-reference/keywords/async.md) </span></span>  
[<span data-ttu-id="c724d-162">await</span><span class="sxs-lookup"><span data-stu-id="c724d-162">await</span></span>](../../../../csharp/language-reference/keywords/await.md)
