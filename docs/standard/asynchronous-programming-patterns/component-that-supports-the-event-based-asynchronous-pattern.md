---
title: 'Návod: Implementace komponenty, která podporuje asynchronní vzor založený na událostech'
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Event-based Asynchronous Pattern
- ProgressChangedEventArgs class
- BackgroundWorker component
- events [.NET Framework], asynchronous
- Asynchronous Pattern
- AsyncOperationManager class
- threading [.NET Framework], asynchronous features
- components [.NET Framework], asynchronous
- AsyncOperation class
- threading [Windows Forms], asynchronous features
- AsyncCompletedEventArgs class
ms.assetid: 61f676b5-936f-40f6-83ce-f22805ec9c2f
ms.openlocfilehash: 9156a538e306fb8657855a840dd8185cef8794b2
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 05/04/2018
ms.locfileid: "33579259"
---
# <a name="walkthrough-implementing-a-component-that-supports-the-event-based-asynchronous-pattern"></a><span data-ttu-id="8c0d0-102">Návod: Implementace komponenty, která podporuje asynchronní vzor založený na událostech</span><span class="sxs-lookup"><span data-stu-id="8c0d0-102">Walkthrough: Implementing a Component That Supports the Event-based Asynchronous Pattern</span></span>
<span data-ttu-id="8c0d0-103">Pokud píšete třídu s některé operace, které může vést k významnému zpoždění, zvažte, udělíte tím, že implementujete asynchronní funkce [na základě událostí přehled asynchronních vzorů](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span><span class="sxs-lookup"><span data-stu-id="8c0d0-103">If you are writing a class with some operations that may incur noticeable delays, consider giving it asynchronous functionality by implementing the [Event-based Asynchronous Pattern Overview](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span></span>  
  
 <span data-ttu-id="8c0d0-104">Tento návod ukazuje, jak vytvořit komponenty, která implementuje asynchronní vzor založený na událostech.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-104">This walkthrough illustrates how to create a component that implements the Event-based Asynchronous Pattern.</span></span> <span data-ttu-id="8c0d0-105">Je implementována pomocí pomocné třídy z <xref:System.ComponentModel?displayProperty=nameWithType> obor názvů, které zajišťuje, že součást funguje správně v rámci modelu všechny aplikace, včetně [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)], konzoly a aplikace Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-105">It is implemented using helper classes from the <xref:System.ComponentModel?displayProperty=nameWithType> namespace, which ensures that the component works correctly under any application model, including [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)], Console applications and Windows Forms applications.</span></span> <span data-ttu-id="8c0d0-106">Tato součást je také navrhovatelé s <xref:System.Windows.Forms.PropertyGrid> řízení a vlastní vlastní Designer.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-106">This component is also designable with a <xref:System.Windows.Forms.PropertyGrid> control and your own custom designers.</span></span>  
  
 <span data-ttu-id="8c0d0-107">Pokud jste prostřednictvím, budete mít aplikaci, která vypočítá prvočísel asynchronně.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-107">When you are through, you will have an application that computes prime numbers asynchronously.</span></span> <span data-ttu-id="8c0d0-108">Vaše aplikace bude mít vlákno hlavní uživatelské rozhraní (UI) a vlákno pro každý prime číslo výpočtu.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-108">Your application will have a main user interface (UI) thread and a thread for each prime number calculation.</span></span> <span data-ttu-id="8c0d0-109">I když testování, zda je velký počet prime může trvat určitou dobu, hlavního vlákna uživatelského rozhraní nesmějí být přerušeny toto zpoždění a formulář bude přizpůsobivý během výpočty.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-109">Although testing whether a large number is prime can take a noticeable amount of time, the main UI thread will not be interrupted by this delay, and the form will be responsive during the calculations.</span></span> <span data-ttu-id="8c0d0-110">Bude moct spustit, protože mnoho výpočty podle potřeby souběžně a selektivně zrušit probíhající výpočty.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-110">You will be able to run as many calculations as you like concurrently and selectively cancel pending calculations.</span></span>  
  
 <span data-ttu-id="8c0d0-111">Úkoly v tomto návodu zahrnují:</span><span class="sxs-lookup"><span data-stu-id="8c0d0-111">Tasks illustrated in this walkthrough include:</span></span>  
  
-   <span data-ttu-id="8c0d0-112">Vytváření komponenty</span><span class="sxs-lookup"><span data-stu-id="8c0d0-112">Creating the Component</span></span>  
  
-   <span data-ttu-id="8c0d0-113">Definování veřejné asynchronní události a delegáti</span><span class="sxs-lookup"><span data-stu-id="8c0d0-113">Defining Public Asynchronous Events and Delegates</span></span>  
  
-   <span data-ttu-id="8c0d0-114">Definování privátního delegáti</span><span class="sxs-lookup"><span data-stu-id="8c0d0-114">Defining Private Delegates</span></span>  
  
-   <span data-ttu-id="8c0d0-115">Implementace veřejné události</span><span class="sxs-lookup"><span data-stu-id="8c0d0-115">Implementing Public Events</span></span>  
  
-   <span data-ttu-id="8c0d0-116">Implementace metody dokončení</span><span class="sxs-lookup"><span data-stu-id="8c0d0-116">Implementing the Completion Method</span></span>  
  
-   <span data-ttu-id="8c0d0-117">Implementace metody pracovního procesu</span><span class="sxs-lookup"><span data-stu-id="8c0d0-117">Implementing the Worker Methods</span></span>  
  
-   <span data-ttu-id="8c0d0-118">Implementace Start a zrušit metody</span><span class="sxs-lookup"><span data-stu-id="8c0d0-118">Implementing Start and Cancel Methods</span></span>  
  
 <span data-ttu-id="8c0d0-119">Zkopírujte kód v tomto tématu v jednom seznamu, najdete v části [postupy: implementace klienta asynchronního vzoru založeného na událostech](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="8c0d0-119">To copy the code in this topic as a single listing, see [How to: Implement a Client of the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="creating-the-component"></a><span data-ttu-id="8c0d0-120">Vytváření komponenty</span><span class="sxs-lookup"><span data-stu-id="8c0d0-120">Creating the Component</span></span>  
 <span data-ttu-id="8c0d0-121">Prvním krokem je vytvoření komponentou bude implementovat asynchronní vzor založený na událostech.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-121">The first step is to create the component that will implement the Event-based Asynchronous Pattern.</span></span>  
  
#### <a name="to-create-the-component"></a><span data-ttu-id="8c0d0-122">Chcete-li vytvořit komponentu</span><span class="sxs-lookup"><span data-stu-id="8c0d0-122">To create the component</span></span>  
  
-   <span data-ttu-id="8c0d0-123">Vytvoření třídy s názvem `PrimeNumberCalculator` který dědí z <xref:System.ComponentModel.Component>.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-123">Create a class called `PrimeNumberCalculator` that inherits from <xref:System.ComponentModel.Component>.</span></span>  
  
## <a name="defining-public-asynchronous-events-and-delegates"></a><span data-ttu-id="8c0d0-124">Definování veřejné asynchronní události a delegáti</span><span class="sxs-lookup"><span data-stu-id="8c0d0-124">Defining Public Asynchronous Events and Delegates</span></span>  
 <span data-ttu-id="8c0d0-125">Příslušné součásti komunikuje s klienty, kteří používají události.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-125">Your component communicates to clients using events.</span></span> <span data-ttu-id="8c0d0-126">*MethodName *** dokončeno** upozornění na událost zahození klientům dokončení asynchronní úlohu a *MethodName *** ProgressChanged** událostí informuje klienti průběh asynchronní úlohu.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-126">The *MethodName***Completed** event alerts clients to the completion of an asynchronous task, and the *MethodName***ProgressChanged** event informs clients of the progress of an asynchronous task.</span></span>  
  
#### <a name="to-define-asynchronous-events-for-clients-of-your-component"></a><span data-ttu-id="8c0d0-127">Chcete-li definovat asynchronní události pro klienty příslušné součásti:</span><span class="sxs-lookup"><span data-stu-id="8c0d0-127">To define asynchronous events for clients of your component:</span></span>  
  
1.  <span data-ttu-id="8c0d0-128">Import <xref:System.Threading?displayProperty=nameWithType> a <xref:System.Collections.Specialized?displayProperty=nameWithType> obory názvů v horní části souboru.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-128">Import the <xref:System.Threading?displayProperty=nameWithType> and <xref:System.Collections.Specialized?displayProperty=nameWithType> namespaces at the top of your file.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#11](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#11)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#11](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#11)]  
  
2.  <span data-ttu-id="8c0d0-129">Před `PrimeNumberCalculator` třídy definice deklarovat delegátů pro události, průběh a dokončení.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-129">Before the `PrimeNumberCalculator` class definition, declare delegates for progress and completion events.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#7](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#7)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#7](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#7)]  
  
3.  <span data-ttu-id="8c0d0-130">V `PrimeNumberCalculator` definici třídy, deklarování událostí pro generování sestav průběh a dokončení klientům.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-130">In the `PrimeNumberCalculator` class definition, declare events for reporting progress and completion to clients.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#8](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#8)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#8](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#8)]  
  
4.  <span data-ttu-id="8c0d0-131">Po `PrimeNumberCalculator` definici třídy, které jsou odvozeny `CalculatePrimeCompletedEventArgs` třídy pro výsledek každé výpočtu k obslužné rutině událostí klienta pro vytváření sestav `CalculatePrimeCompleted`.event.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-131">After the `PrimeNumberCalculator` class definition, derive the `CalculatePrimeCompletedEventArgs` class for reporting the outcome of each calculation to the client's event handler for the `CalculatePrimeCompleted`.event.</span></span> <span data-ttu-id="8c0d0-132">Kromě `AsyncCompletedEventArgs` vlastnosti, tato třída umožňuje určit, jaké číslo byla testována, jestli je primární a co první dělitel je, pokud není prvotní klientovi.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-132">In addition to the `AsyncCompletedEventArgs` properties, this class enables the client to determine what number was tested, whether it is prime, and what the first divisor is if it is not prime.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#6](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#6)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#6](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#6)]  
  
## <a name="checkpoint"></a><span data-ttu-id="8c0d0-133">Kontrolní bod</span><span class="sxs-lookup"><span data-stu-id="8c0d0-133">Checkpoint</span></span>  
 <span data-ttu-id="8c0d0-134">V tomto okamžiku můžete vytvořit komponentu.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-134">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="8c0d0-135">K testování příslušné součásti</span><span class="sxs-lookup"><span data-stu-id="8c0d0-135">To test your component</span></span>  
  
-   <span data-ttu-id="8c0d0-136">Zkompilujte komponentu.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-136">Compile the component.</span></span>  
  
     <span data-ttu-id="8c0d0-137">Zobrazí dvě upozornění kompilátoru:</span><span class="sxs-lookup"><span data-stu-id="8c0d0-137">You will receive two compiler warnings:</span></span>  
  
    ```  
    warning CS0067: The event 'AsynchronousPatternExample.PrimeNumberCalculator.ProgressChanged' is never used  
    warning CS0067: The event 'AsynchronousPatternExample.PrimeNumberCalculator.CalculatePrimeCompleted' is never used  
    ```  
  
     <span data-ttu-id="8c0d0-138">Vymaže se tato upozornění v další části.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-138">These warnings will be cleared in the next section.</span></span>  
  
## <a name="defining-private-delegates"></a><span data-ttu-id="8c0d0-139">Definování privátního delegáti</span><span class="sxs-lookup"><span data-stu-id="8c0d0-139">Defining Private Delegates</span></span>  
 <span data-ttu-id="8c0d0-140">Asynchronní aspektů `PrimeNumberCalculator` součásti jsou implementované interně se označuje jako speciální delegátem <xref:System.Threading.SendOrPostCallback>.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-140">The asynchronous aspects of the `PrimeNumberCalculator` component are implemented internally with a special delegate known as a <xref:System.Threading.SendOrPostCallback>.</span></span> <span data-ttu-id="8c0d0-141">A <xref:System.Threading.SendOrPostCallback> představuje metody zpětného volání, které provádí na <xref:System.Threading.ThreadPool> přístup z více vláken.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-141">A <xref:System.Threading.SendOrPostCallback> represents a callback method that executes on a <xref:System.Threading.ThreadPool> thread.</span></span> <span data-ttu-id="8c0d0-142">Metoda zpětného volání musí mít podpis, která přijímá jeden parametr typu <xref:System.Object>, což znamená, že bude nutné předat stavu mezi Delegáti v obálkovou třídu.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-142">The callback method must have a signature that takes a single parameter of type <xref:System.Object>, which means you will need to pass state among delegates in a wrapper class.</span></span> <span data-ttu-id="8c0d0-143">Další informace naleznete v tématu <xref:System.Threading.SendOrPostCallback>.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-143">For more information, see <xref:System.Threading.SendOrPostCallback>.</span></span>  
  
#### <a name="to-implement-your-components-internal-asynchronous-behavior"></a><span data-ttu-id="8c0d0-144">K implementaci příslušné součásti interní asynchronní chování:</span><span class="sxs-lookup"><span data-stu-id="8c0d0-144">To implement your component's internal asynchronous behavior:</span></span>  
  
1.  <span data-ttu-id="8c0d0-145">Deklarace a vytvořit <xref:System.Threading.SendOrPostCallback> deleguje v `PrimeNumberCalculator` třídy.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-145">Declare and create the <xref:System.Threading.SendOrPostCallback> delegates in the `PrimeNumberCalculator` class.</span></span> <span data-ttu-id="8c0d0-146">Vytvořte <xref:System.Threading.SendOrPostCallback> objekty v nástroj metoda volána `InitializeDelegates`.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-146">Create the <xref:System.Threading.SendOrPostCallback> objects in a utility method called `InitializeDelegates`.</span></span>  
  
     <span data-ttu-id="8c0d0-147">Budete potřebovat dva delegáti: jeden pro vytvoření sestavy průběhu klientovi a jeden pro vytváření sestav dokončení klientovi.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-147">You will need two delegates: one for reporting progress to the client, and one for reporting completion to the client.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#9](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#9)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#9](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#9)]  
    [!code-csharp[System.ComponentModel.AsyncOperationManager#20](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#20)]
    [!code-vb[System.ComponentModel.AsyncOperationManager#20](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#20)]  
  
2.  <span data-ttu-id="8c0d0-148">Volání `InitializeDelegates` metoda v konstruktoru příslušné součásti.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-148">Call the `InitializeDelegates` method in your component's constructor.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#21](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#21)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#21](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#21)]  
  
3.  <span data-ttu-id="8c0d0-149">Delegáta v deklarovat `PrimeNumberCalculator` třída, která zpracovává samotnou práci provést asynchronně.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-149">Declare a delegate in the `PrimeNumberCalculator` class that handles the actual work to be done asynchronously.</span></span> <span data-ttu-id="8c0d0-150">Tento delegát zabalí metodu pracovního procesu, který kontroluje, zda je číslo prime.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-150">This delegate wraps the worker method that tests whether a number is prime.</span></span> <span data-ttu-id="8c0d0-151">Delegát používá <xref:System.ComponentModel.AsyncOperation> parametr, který se použije ke sledování životnost asynchronní operaci.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-151">The delegate takes an <xref:System.ComponentModel.AsyncOperation> parameter, which will be used to track the lifetime of the asynchronous operation.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#22](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#22)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#22](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#22)]  
  
4.  <span data-ttu-id="8c0d0-152">Vytvoření kolekce pro správu životnosti z čekajících asynchronních operací.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-152">Create a collection for managing lifetimes of pending asynchronous operations.</span></span> <span data-ttu-id="8c0d0-153">Klient musí způsob, jak sledovat operace, jak se spustí a dokončení, a toto sledování probíhá tím, že klient předat jedinečný token nebo ID úkolu, pokud klient provede volání asynchronní metody.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-153">The client needs a way to track operations as they are executed and completed, and this tracking is done by requiring the client to pass a unique token, or task ID, when the client makes the call to the asynchronous method.</span></span> <span data-ttu-id="8c0d0-154">`PrimeNumberCalculator` Součásti musí udržovat přehled o jednotlivých volání tím, že přidružíte ID úkolu pomocí jeho odpovídající volání.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-154">The `PrimeNumberCalculator` component must keep track of each call by associating the task ID with its corresponding invocation.</span></span> <span data-ttu-id="8c0d0-155">Pokud klient předá ID úkolu, který není jedinečné, `PrimeNumberCalculator` součásti musí vyvolat výjimku.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-155">If the client passes a task ID that is not unique, the `PrimeNumberCalculator` component must raise an exception.</span></span>  
  
     <span data-ttu-id="8c0d0-156">`PrimeNumberCalculator` Součást uchovává informace o ID úlohy pomocí speciální kolekce třídu s názvem <xref:System.Collections.Specialized.HybridDictionary>.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-156">The `PrimeNumberCalculator` component keeps track of task ID by using a special collection class called a <xref:System.Collections.Specialized.HybridDictionary>.</span></span> <span data-ttu-id="8c0d0-157">V definici třídy, vytvořte <xref:System.Collections.Specialized.HybridDictionary> názvem `userTokenToLifetime`.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-157">In the class definition, create a <xref:System.Collections.Specialized.HybridDictionary> called `userTokenToLifetime`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#23](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#23)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#23](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#23)]  
  
## <a name="implementing-public-events"></a><span data-ttu-id="8c0d0-158">Implementace veřejné události</span><span class="sxs-lookup"><span data-stu-id="8c0d0-158">Implementing Public Events</span></span>  
 <span data-ttu-id="8c0d0-159">Součásti, které implementovat asynchronní vzor založený na událostech komunikaci s klienty, kteří používají události.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-159">Components that implement the Event-based Asynchronous Pattern communicate to clients using events.</span></span> <span data-ttu-id="8c0d0-160">Tyto události jsou vyvolány na správné vlákno pomocí <xref:System.ComponentModel.AsyncOperation> třídy.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-160">These events are invoked on the proper thread with the help of the <xref:System.ComponentModel.AsyncOperation> class.</span></span>  
  
#### <a name="to-raise-events-to-your-components-clients"></a><span data-ttu-id="8c0d0-161">Umožňuje aktivovat události klientům příslušné součásti:</span><span class="sxs-lookup"><span data-stu-id="8c0d0-161">To raise events to your component's clients:</span></span>  
  
1.  <span data-ttu-id="8c0d0-162">Implementujte veřejné události vytváření sestav pro klienty.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-162">Implement public events for reporting to clients.</span></span> <span data-ttu-id="8c0d0-163">Budete potřebovat událost pro vytváření sestav průběh a jeden pro generování sestav dokončení.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-163">You will need an event for reporting progress and one for reporting completion.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#24](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#24)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#24](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#24)]  
  
## <a name="implementing-the-completion-method"></a><span data-ttu-id="8c0d0-164">Implementace metody dokončení</span><span class="sxs-lookup"><span data-stu-id="8c0d0-164">Implementing the Completion Method</span></span>  
 <span data-ttu-id="8c0d0-165">Delegát dokončení je metoda, která základní, podprocesy asynchronní chování vyvolá při ukončení asynchronní operaci úspěšné dokončení, chyby nebo zrušení.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-165">The completion delegate is the method that the underlying, free-threaded asynchronous behavior will invoke when the asynchronous operation ends by successful completion, error, or cancellation.</span></span> <span data-ttu-id="8c0d0-166">Toto volání se odehrává na libovolný vlákno.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-166">This invocation happens on an arbitrary thread.</span></span>  
  
 <span data-ttu-id="8c0d0-167">Tato metoda je, kde je ID úkolu klienta z interní kolekce tokenů jedinečných klientských odebrat.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-167">This method is where the client's task ID is removed from the internal collection of unique client tokens.</span></span> <span data-ttu-id="8c0d0-168">Tato metoda také končí životnost konkrétní asynchronní operaci voláním <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> metoda na odpovídajícím <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-168">This method also ends the lifetime of a particular asynchronous operation by calling the <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> method on the corresponding <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="8c0d0-169">Toto volání vyvolává událost dokončení na vlákno, které jsou vhodné pro model aplikace.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-169">This call raises the completion event on the thread that is appropriate for the application model.</span></span> <span data-ttu-id="8c0d0-170">Po <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> metoda je volána, tuto instanci <xref:System.ComponentModel.AsyncOperation> již být použít, a všechny následné pokusy o použít vyvolá výjimku.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-170">After the <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> method is called, this instance of <xref:System.ComponentModel.AsyncOperation> can no longer be used, and any subsequent attempts to use it will throw an exception.</span></span>  
  
 <span data-ttu-id="8c0d0-171">`CompletionMethod` Podpis musí obsahovat všechny stavy potřebné k popisu výsledek asynchronní operace.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-171">The `CompletionMethod` signature must hold all state necessary to describe the outcome of the asynchronous operation.</span></span> <span data-ttu-id="8c0d0-172">Zda je číslo prime a hodnotu jeho první dělitel Pokud není číslo prime drží stav pro číslo, které se testoval tato konkrétní asynchronní operace.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-172">It holds state for the number that was tested by this particular asynchronous operation, whether the number is prime, and the value of its first divisor if it is not a prime number.</span></span> <span data-ttu-id="8c0d0-173">Také drží stavu popisující žádné výjimka, ke které došlo k chybě, a <xref:System.ComponentModel.AsyncOperation> odpovídající tuto konkrétní úlohu.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-173">It also holds state describing any exception that occurred, and the <xref:System.ComponentModel.AsyncOperation> corresponding to this particular task.</span></span>  
  
#### <a name="to-complete-an-asynchronous-operation"></a><span data-ttu-id="8c0d0-174">K dokončení asynchronní operace:</span><span class="sxs-lookup"><span data-stu-id="8c0d0-174">To complete an asynchronous operation:</span></span>  
  
-   <span data-ttu-id="8c0d0-175">Implementace metody dokončení.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-175">Implement the completion method.</span></span> <span data-ttu-id="8c0d0-176">Jak dlouho trvá šest parametry, které používá k naplnění `CalculatePrimeCompletedEventArgs` , je vrácen do klienta prostřednictvím klienta `CalculatePrimeCompletedEventHandler`.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-176">It takes six parameters, which it uses to populate a `CalculatePrimeCompletedEventArgs` that is returned to the client through the client's `CalculatePrimeCompletedEventHandler`.</span></span> <span data-ttu-id="8c0d0-177">Odebere token ID úloh klienta z interní kolekce a ho ukončí asynchronní operace životního cyklu pomocí volání <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A>.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-177">It removes the client's task ID token from the internal collection, and it ends the asynchronous operation's lifetime with a call to <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A>.</span></span> <span data-ttu-id="8c0d0-178"><xref:System.ComponentModel.AsyncOperation> Zařazuje volání vlákno nebo kontext, který je vhodný pro aplikačního modelu.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-178">The <xref:System.ComponentModel.AsyncOperation> marshals the call to the thread or context that is appropriate for the application model.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#26](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#26)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#26](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#26)]  
  
## <a name="checkpoint"></a><span data-ttu-id="8c0d0-179">Kontrolní bod</span><span class="sxs-lookup"><span data-stu-id="8c0d0-179">Checkpoint</span></span>  
 <span data-ttu-id="8c0d0-180">V tomto okamžiku můžete vytvořit komponentu.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-180">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="8c0d0-181">K testování příslušné součásti</span><span class="sxs-lookup"><span data-stu-id="8c0d0-181">To test your component</span></span>  
  
-   <span data-ttu-id="8c0d0-182">Zkompilujte komponentu.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-182">Compile the component.</span></span>  
  
     <span data-ttu-id="8c0d0-183">Zobrazí jednu upozornění kompilátoru:</span><span class="sxs-lookup"><span data-stu-id="8c0d0-183">You will receive one compiler warning:</span></span>  
  
    ```  
    warning CS0169: The private field 'AsynchronousPatternExample.PrimeNumberCalculator.workerDelegate' is never used  
    ```  
  
     <span data-ttu-id="8c0d0-184">Toto upozornění se vyřeší v další části.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-184">This warning will be resolved in the next section.</span></span>  
  
## <a name="implementing-the-worker-methods"></a><span data-ttu-id="8c0d0-185">Implementace metody pracovního procesu</span><span class="sxs-lookup"><span data-stu-id="8c0d0-185">Implementing the Worker Methods</span></span>  
 <span data-ttu-id="8c0d0-186">Pokud jste implementovali podporující asynchronní kód `PrimeNumberCalculator` součásti.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-186">So far, you have implemented the supporting asynchronous code for the `PrimeNumberCalculator` component.</span></span> <span data-ttu-id="8c0d0-187">Nyní můžete implementovat kód, který ve skutečnosti provádí zpracování.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-187">Now you can implement the code that does the actual work.</span></span> <span data-ttu-id="8c0d0-188">Budete implementovat tři metody: `CalculateWorker`, `BuildPrimeNumberList`, a `IsPrime`.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-188">You will implement three methods: `CalculateWorker`, `BuildPrimeNumberList`, and `IsPrime`.</span></span> <span data-ttu-id="8c0d0-189">Společně `BuildPrimeNumberList` a `IsPrime` tvoří dobře známé algoritmus volat ze sít Eratosthenes, která určuje, zda je číslo prime tak, že najdete všechny prvočísel až druhou odmocninu čísla test.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-189">Together, `BuildPrimeNumberList` and `IsPrime` comprise a well-known algorithm called the Sieve of Eratosthenes, which determines if a number is prime by finding all the prime numbers up to the square root of the test number.</span></span> <span data-ttu-id="8c0d0-190">Pokud žádné divisors pomocí tohoto bodu, je číslo testovací prime.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-190">If no divisors are found by that point, the test number is prime.</span></span>  
  
 <span data-ttu-id="8c0d0-191">Pokud tuto komponentu byly napsány pro maximální efektivity, by nezapomeňte všechny prvočísel zjištěných různé volání pro jiný testovací čísla.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-191">If this component were written for maximum efficiency, it would remember all the prime numbers discovered by various invocations for different test numbers.</span></span> <span data-ttu-id="8c0d0-192">By také vyhledat trivial divisors jako 2, 3 nebo 5.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-192">It would also check for trivial divisors like 2, 3, and 5.</span></span> <span data-ttu-id="8c0d0-193">Tohoto příkladu je cílem ukazují, jak časově náročná operace mohou být provedeny asynchronně, ale tak tyto optimalizace jsou ponechané jako cvičení za vás.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-193">The intent of this example is to demonstrate how time-consuming operations can be executed asynchronously, however, so these optimizations are left as an exercise for you.</span></span>  
  
 <span data-ttu-id="8c0d0-194">`CalculateWorker` Metoda je uzavřen do delegáta a je vyvoláno asynchronně s volání `BeginInvoke`.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-194">The `CalculateWorker` method is wrapped in a delegate and is invoked asynchronously with a call to `BeginInvoke`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="8c0d0-195">Průběh vytváření sestav je implementována ve `BuildPrimeNumberList` metoda.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-195">Progress reporting is implemented in the `BuildPrimeNumberList` method.</span></span> <span data-ttu-id="8c0d0-196">V rychlé počítačích `ProgressChanged` události mohou být vyvolány rychle za sebou.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-196">On fast computers, `ProgressChanged` events can be raised in rapid succession.</span></span> <span data-ttu-id="8c0d0-197">Vlákno klienta, na kterém tyto události jsou vyvolány, musí být schopen zpracování této situace.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-197">The client thread, on which these events are raised, must be able to handle this situation.</span></span> <span data-ttu-id="8c0d0-198">Uživatelského rozhraní kódu může být přenášeny pomocí zpráv a nelze zpracovat, což vede k hanging chování.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-198">User interface code may be flooded with messages and unable to keep up, resulting in hanging behavior.</span></span> <span data-ttu-id="8c0d0-199">Uživatelské rozhraní příklad, který zpracovává této situaci, najdete v části [postupy: implementace klienta asynchronního vzoru založeného na událostech](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="8c0d0-199">For an example user interface that handles this situation, see [How to: Implement a Client of the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
#### <a name="to-execute-the-prime-number-calculation-asynchronously"></a><span data-ttu-id="8c0d0-200">Provést asynchronně výpočtu prime číslo:</span><span class="sxs-lookup"><span data-stu-id="8c0d0-200">To execute the prime number calculation asynchronously:</span></span>  
  
1.  <span data-ttu-id="8c0d0-201">Implementace `TaskCanceled` metody nástrojů.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-201">Implement the `TaskCanceled` utility method.</span></span> <span data-ttu-id="8c0d0-202">To ověří kolekci úloh doba platnosti pro danou úlohu ID a vrátí `true` Pokud není nalezena ID úkolu.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-202">This checks the task lifetime collection for the given task ID, and returns `true` if the task ID is not found.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#32](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#32)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#32](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#32)]  
  
2.  <span data-ttu-id="8c0d0-203">Implementace `CalculateWorker` metoda.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-203">Implement the `CalculateWorker` method.</span></span> <span data-ttu-id="8c0d0-204">Jak dlouho trvá dva parametry: číslo otestovat a <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-204">It takes two parameters: a number to test, and an <xref:System.ComponentModel.AsyncOperation>.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#27](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#27)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#27](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#27)]  
  
3.  <span data-ttu-id="8c0d0-205">Implementace `BuildPrimeNumberList`.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-205">Implement `BuildPrimeNumberList`.</span></span> <span data-ttu-id="8c0d0-206">Jak dlouho trvá dva parametry: číslo chcete otestovat a <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-206">It takes two parameters: the number to test, and an <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="8c0d0-207">Použije <xref:System.ComponentModel.AsyncOperation> sestavy průběhu a přírůstkové výsledky.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-207">It uses the <xref:System.ComponentModel.AsyncOperation> to report progress and incremental results.</span></span> <span data-ttu-id="8c0d0-208">To zaručuje, že obslužné rutiny událostí klienta se nazývají na správné vlákno nebo kontext pro aplikačního modelu.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-208">This assures that the client's event handlers are called on the proper thread or context for the application model.</span></span> <span data-ttu-id="8c0d0-209">Když `BuildPrimeNumberList` najde-li číslo prime, oznámí toto jako výsledek přírůstkové do klienta obslužné rutiny události pro `ProgressChanged` událostí.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-209">When `BuildPrimeNumberList` finds a prime number, it reports this as an incremental result to the client's event handler for the `ProgressChanged` event.</span></span> <span data-ttu-id="8c0d0-210">To vyžaduje třídy odvozené od <xref:System.ComponentModel.ProgressChangedEventArgs>, volané `CalculatePrimeProgressChangedEventArgs`, který má jeden přidat vlastnost s názvem `LatestPrimeNumber`.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-210">This requires a class derived from <xref:System.ComponentModel.ProgressChangedEventArgs>, called `CalculatePrimeProgressChangedEventArgs`, which has one added property called `LatestPrimeNumber`.</span></span>  
  
     <span data-ttu-id="8c0d0-211">`BuildPrimeNumberList` Metoda také pravidelně volá `TaskCanceled` metoda a ukončí, pokud metoda vrátí `true`.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-211">The `BuildPrimeNumberList` method also periodically calls the `TaskCanceled` method and exits if the method returns `true`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#5](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#5)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#5](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#5)]  
  
4.  <span data-ttu-id="8c0d0-212">Implementace `IsPrime`.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-212">Implement `IsPrime`.</span></span> <span data-ttu-id="8c0d0-213">Jak dlouho trvá tři parametry: seznam prvočísel známé, číslo pro testování a výstupní parametr pro první dělitel nalezen.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-213">It takes three parameters: a list of known prime numbers, the number to test, and an output parameter for the first divisor found.</span></span> <span data-ttu-id="8c0d0-214">Zadaný seznam prvočísel, se určuje, zda číslo testovací prime.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-214">Given the list of prime numbers, it determines if the test number is prime.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#28](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#28)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#28](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#28)]  
  
5.  <span data-ttu-id="8c0d0-215">Odvození `CalculatePrimeProgressChangedEventArgs` z <xref:System.ComponentModel.ProgressChangedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-215">Derive `CalculatePrimeProgressChangedEventArgs` from <xref:System.ComponentModel.ProgressChangedEventArgs>.</span></span> <span data-ttu-id="8c0d0-216">Tato třída je nezbytné pro vytváření sestav přírůstkové výsledky do klienta obslužné rutiny události pro `ProgressChanged` událostí.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-216">This class is necessary for reporting incremental results to the client's event handler for the `ProgressChanged` event.</span></span> <span data-ttu-id="8c0d0-217">Má jeden přidané vlastnost s názvem `LatestPrimeNumber`.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-217">It has one added property called `LatestPrimeNumber`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#29](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#29)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#29](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#29)]  
  
## <a name="checkpoint"></a><span data-ttu-id="8c0d0-218">Kontrolní bod</span><span class="sxs-lookup"><span data-stu-id="8c0d0-218">Checkpoint</span></span>  
 <span data-ttu-id="8c0d0-219">V tomto okamžiku můžete vytvořit komponentu.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-219">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="8c0d0-220">K testování příslušné součásti</span><span class="sxs-lookup"><span data-stu-id="8c0d0-220">To test your component</span></span>  
  
-   <span data-ttu-id="8c0d0-221">Zkompilujte komponentu.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-221">Compile the component.</span></span>  
  
     <span data-ttu-id="8c0d0-222">Všechno, co jsou zůstane k zapsání metody pro spuštění a zrušení asynchronních operací `CalculatePrimeAsync` a `CancelAsync`.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-222">All that remains to be written are the methods to start and cancel asynchronous operations, `CalculatePrimeAsync` and `CancelAsync`.</span></span>  
  
## <a name="implementing-the-start-and-cancel-methods"></a><span data-ttu-id="8c0d0-223">Implementace Start a zrušit metody</span><span class="sxs-lookup"><span data-stu-id="8c0d0-223">Implementing the Start and Cancel Methods</span></span>  
 <span data-ttu-id="8c0d0-224">Spuštění metody pracovního procesu ve vlastním vlákně voláním `BeginInvoke` na delegáta, který z nich.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-224">You start the worker method on its own thread by calling `BeginInvoke` on the delegate that wraps it.</span></span> <span data-ttu-id="8c0d0-225">Chcete-li spravovat dobu životnosti konkrétní asynchronní operaci, zavolejte <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> metodu <xref:System.ComponentModel.AsyncOperationManager> pomocná třída.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-225">To manage the lifetime of a particular asynchronous operation, you call the <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> method on the <xref:System.ComponentModel.AsyncOperationManager> helper class.</span></span> <span data-ttu-id="8c0d0-226">Vrátí <xref:System.ComponentModel.AsyncOperation>, který zařazuje volání obslužných rutin událostí klienta správné vlákno nebo kontextu.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-226">This returns an <xref:System.ComponentModel.AsyncOperation>, which marshals calls on the client's event handlers to the proper thread or context.</span></span>  
  
 <span data-ttu-id="8c0d0-227">Zrušit konkrétní nevyřízenou operaci voláním <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> na jeho odpovídající <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-227">You cancel a particular pending operation by calling <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> on its corresponding <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="8c0d0-228">Tím končí tuto operaci a následných volání jeho <xref:System.ComponentModel.AsyncOperation> vyvolá výjimku.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-228">This ends that operation, and any subsequent calls to its <xref:System.ComponentModel.AsyncOperation> will throw an exception.</span></span>  
  
#### <a name="to-implement-start-and-cancel-functionality"></a><span data-ttu-id="8c0d0-229">K implementaci úvodní a zrušit funkce:</span><span class="sxs-lookup"><span data-stu-id="8c0d0-229">To implement Start and Cancel functionality:</span></span>  
  
1.  <span data-ttu-id="8c0d0-230">Implementace `CalculatePrimeAsync` metoda.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-230">Implement the `CalculatePrimeAsync` method.</span></span> <span data-ttu-id="8c0d0-231">Ujistěte se, že token zadaný klienta (ID úlohy) je jedinečný s ohledem na všechny tokeny představující aktuálně úkolů čekajících na zpracování.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-231">Make sure the client-supplied token (task ID) is unique with respect to all the tokens representing currently pending tasks.</span></span> <span data-ttu-id="8c0d0-232">Pokud klient předá do jedinečný tokenu, `CalculatePrimeAsync` vyvolá výjimku.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-232">If the client passes in a non-unique token, `CalculatePrimeAsync` raises an exception.</span></span> <span data-ttu-id="8c0d0-233">Token, jinak se přidá do kolekce ID úloh.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-233">Otherwise, the token is added to the task ID collection.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#3](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#3)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#3](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#3)]  
  
2.  <span data-ttu-id="8c0d0-234">Implementace `CancelAsync` metoda.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-234">Implement the `CancelAsync` method.</span></span> <span data-ttu-id="8c0d0-235">Pokud `taskId` v tokenu kolekci parametrů existuje, bude odebrán.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-235">If the `taskId` parameter exists in the token collection, it is removed.</span></span> <span data-ttu-id="8c0d0-236">Tím se zabrání zrušené úlohy, které nebyly spuštěné z spuštěná.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-236">This prevents canceled tasks that have not started from running.</span></span> <span data-ttu-id="8c0d0-237">Pokud je spuštěn úkol, `BuildPrimeNumberList` metoda ukončí, když zjistí, ID úlohy byl odebrán z kolekce životního cyklu.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-237">If the task is running, the `BuildPrimeNumberList` method exits when it detects that the task ID has been removed from the lifetime collection.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#4](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#4)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#4](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#4)]  
  
## <a name="checkpoint"></a><span data-ttu-id="8c0d0-238">Kontrolní bod</span><span class="sxs-lookup"><span data-stu-id="8c0d0-238">Checkpoint</span></span>  
 <span data-ttu-id="8c0d0-239">V tomto okamžiku můžete vytvořit komponentu.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-239">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="8c0d0-240">K testování příslušné součásti</span><span class="sxs-lookup"><span data-stu-id="8c0d0-240">To test your component</span></span>  
  
-   <span data-ttu-id="8c0d0-241">Zkompilujte komponentu.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-241">Compile the component.</span></span>  
  
 <span data-ttu-id="8c0d0-242">`PrimeNumberCalculator` Je nyní úplný a připravené k použití.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-242">The `PrimeNumberCalculator` component is now complete and ready to use.</span></span>  
  
 <span data-ttu-id="8c0d0-243">Pro příklad klienta, který používá `PrimeNumberCalculator` součást, najdete v části [postupy: implementace klienta asynchronního vzoru založeného na událostech](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="8c0d0-243">For an example client that uses the `PrimeNumberCalculator` component, see [How to: Implement a Client of the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="8c0d0-244">Další kroky</span><span class="sxs-lookup"><span data-stu-id="8c0d0-244">Next Steps</span></span>  
 <span data-ttu-id="8c0d0-245">V tomto příkladu můžete vyplnit napsáním `CalculatePrime`, synchronní ekvivalent `CalculatePrimeAsync` metoda.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-245">You can fill out this example by writing `CalculatePrime`, the synchronous equivalent of `CalculatePrimeAsync` method.</span></span> <span data-ttu-id="8c0d0-246">Bude `PrimeNumberCalculator` součást plně kompatibilní s asynchronní vzor založený na událostech.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-246">This will make the `PrimeNumberCalculator` component fully compliant with the Event-based Asynchronous Pattern.</span></span>  
  
 <span data-ttu-id="8c0d0-247">V tomto příkladu může zvýšit zachováním seznam všech prvočísel zjištěných různé volání pro jiný testovací čísla.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-247">You can improve this example by retaining the list of all the prime numbers discovered by various invocations for different test numbers.</span></span> <span data-ttu-id="8c0d0-248">Použití tohoto přístupu, bude každý úkol těžit z práci předchozí úlohy.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-248">Using this approach, each task will benefit from the work done by previous tasks.</span></span> <span data-ttu-id="8c0d0-249">Pečlivě Chraňte tento seznam s `lock` oblastech, tak přístup k seznamu podle různých vláknech serializován.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-249">Be careful to protect this list with `lock` regions, so access to the list by different threads is serialized.</span></span>  
  
 <span data-ttu-id="8c0d0-250">V tomto příkladu lze zvýšit rovněž testování pro trivial divisors, jako je 2, 3 nebo 5.</span><span class="sxs-lookup"><span data-stu-id="8c0d0-250">You can also improve this example by testing for trivial divisors, like 2, 3, and 5.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8c0d0-251">Viz také</span><span class="sxs-lookup"><span data-stu-id="8c0d0-251">See Also</span></span>  
 [<span data-ttu-id="8c0d0-252">Postupy: Spuštění operace na pozadí</span><span class="sxs-lookup"><span data-stu-id="8c0d0-252">How to: Run an Operation in the Background</span></span>](../../../docs/framework/winforms/controls/how-to-run-an-operation-in-the-background.md)  
 [<span data-ttu-id="8c0d0-253">Přehled asynchronních vzorů založených na událostech</span><span class="sxs-lookup"><span data-stu-id="8c0d0-253">Event-based Asynchronous Pattern Overview</span></span>](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md)  
 [<span data-ttu-id="8c0d0-254">NENÍ v sestavení: Více vláken v jazyce Visual Basic</span><span class="sxs-lookup"><span data-stu-id="8c0d0-254">NOT IN BUILD: Multithreading in Visual Basic</span></span>](https://msdn.microsoft.com/library/c731a50c-09c1-4468-9646-54c86b75d269)  
 [<span data-ttu-id="8c0d0-255">Postupy: Implementace komponenty, která podporuje asynchronní vzor založený na událostech</span><span class="sxs-lookup"><span data-stu-id="8c0d0-255">How to: Implement a Component That Supports the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md)  
 [<span data-ttu-id="8c0d0-256">Vícevláknové programování s asynchronním vzorem založeným na událostech</span><span class="sxs-lookup"><span data-stu-id="8c0d0-256">Multithreaded Programming with the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/multithreaded-programming-with-the-event-based-asynchronous-pattern.md)
