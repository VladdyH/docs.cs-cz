---
title: Testování jádro ASP.NET MVC aplikace
description: Architektury moderních webových aplikací pomocí ASP.NET Core a Azure | Testování jádro ASP.NET MVC aplikace
author: ardalis
ms.author: wiwagn
ms.date: 10/08/2017
ms.openlocfilehash: b22e0e109144b4abd04cd4199cfdec244d8fa7af
ms.sourcegitcommit: 979597cd8055534b63d2c6ee8322938a27d0c87b
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 06/29/2018
ms.locfileid: "37106499"
---
# <a name="test-aspnet-core-mvc-apps"></a><span data-ttu-id="12adb-103">Testování jádro ASP.NET MVC aplikace</span><span class="sxs-lookup"><span data-stu-id="12adb-103">Test ASP.NET Core MVC Apps</span></span>

> <span data-ttu-id="12adb-104">_"Pokud chcete svůj produkt testování částí, s největší pravděpodobností vašim zákazníkům nebude rádi otestovat ji, buď." _ 
>  _- Anonymní -_</span><span class="sxs-lookup"><span data-stu-id="12adb-104">_"If you don't like unit testing your product, most likely your customers won't like to test it, either."_
 _- Anonymous-_</span></span>

## <a name="summary"></a><span data-ttu-id="12adb-105">Souhrn</span><span class="sxs-lookup"><span data-stu-id="12adb-105">Summary</span></span>

<span data-ttu-id="12adb-106">Software jakékoli složitosti může selhat v reakci na změny neočekávaným způsobem.</span><span class="sxs-lookup"><span data-stu-id="12adb-106">Software of any complexity can fail in unexpected ways in response to changes.</span></span> <span data-ttu-id="12adb-107">Proto testování po provedení změn je vyžadována pro všechny, ale většina trivial (nebo nejméně důležité) aplikace.</span><span class="sxs-lookup"><span data-stu-id="12adb-107">Thus, testing after making changes is required for all but the most trivial (or least critical) applications.</span></span> <span data-ttu-id="12adb-108">Manuální testování je nejpomalejší, nejméně spolehlivé a nejnákladnější způsob, jak otestovat softwaru.</span><span class="sxs-lookup"><span data-stu-id="12adb-108">Manual testing is the slowest, least reliable, most expensive way to test software.</span></span> <span data-ttu-id="12adb-109">Bohužel Pokud nejsou určeny jako možností intenzivního testování, může být jediným způsobem, který je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="12adb-109">Unfortunately, if applications are not designed to be testable, it can be the only means available.</span></span> <span data-ttu-id="12adb-110">Aplikace napsané následující architektury Principy nastíněny v kapitole X musí být jednotka možností intenzivního testování a ASP.NET Core aplikace podporují automatické integraci a také funkční testování.</span><span class="sxs-lookup"><span data-stu-id="12adb-110">Applications written following the architectural principles laid out in chapter X should be unit testable, and ASP.NET Core applications support automated integration and functional testing as well.</span></span>

## <a name="kinds-of-automated-tests"></a><span data-ttu-id="12adb-111">Druhy automatizované testy</span><span class="sxs-lookup"><span data-stu-id="12adb-111">Kinds of Automated Tests</span></span>

<span data-ttu-id="12adb-112">Existují různé druhy automatizovaných testů pro softwarové aplikace.</span><span class="sxs-lookup"><span data-stu-id="12adb-112">There are many kinds of automated tests for software applications.</span></span> <span data-ttu-id="12adb-113">Nejjednodušším, nejnižší úrovni testu je testování částí.</span><span class="sxs-lookup"><span data-stu-id="12adb-113">The simplest, lowest level test is the unit test.</span></span> <span data-ttu-id="12adb-114">Mírně vyšší úrovně jsou integrace testy a funkčních testů.</span><span class="sxs-lookup"><span data-stu-id="12adb-114">At a slightly higher level there are integration tests and functional tests.</span></span> <span data-ttu-id="12adb-115">Ostatní typy testů, jako například testy uživatelského rozhraní, zátěžových testů, zátěžových testů a kouře testy, jsou nad rámec tohoto dokumentu.</span><span class="sxs-lookup"><span data-stu-id="12adb-115">Other kinds of tests, like UI tests, load tests, stress tests, and smoke tests, are beyond the scope of this document.</span></span>

### <a name="unit-tests"></a><span data-ttu-id="12adb-116">Testy jednotek</span><span class="sxs-lookup"><span data-stu-id="12adb-116">Unit Tests</span></span>

<span data-ttu-id="12adb-117">Testování částí testů jedné součásti vaší aplikace logiky.</span><span class="sxs-lookup"><span data-stu-id="12adb-117">A unit test tests a single part of your application's logic.</span></span> <span data-ttu-id="12adb-118">Jeden ho další popisují tak, že uvedete několik kroků, které není.</span><span class="sxs-lookup"><span data-stu-id="12adb-118">One can further describe it by listing some of the things that it isn't.</span></span> <span data-ttu-id="12adb-119">Testování částí není testovat, jak se váš kód funguje s závislosti nebo infrastruktury – co integrace testy pro.</span><span class="sxs-lookup"><span data-stu-id="12adb-119">A unit test doesn't test how your code works with dependencies or infrastructure – that's what integration tests are for.</span></span> <span data-ttu-id="12adb-120">Testování částí nepodporuje testování rozhraní framework kódu se zapisují na – byste měli počítat ho pracuje nebo, pokud pro vás není, založení záznamu o chybě a code alternativní řešení.</span><span class="sxs-lookup"><span data-stu-id="12adb-120">A unit test doesn't test the framework your code is written on – you should assume it works or, if you find it doesn't, file a bug and code a workaround.</span></span> <span data-ttu-id="12adb-121">Testování částí spouští zcela v paměti a v procesu.</span><span class="sxs-lookup"><span data-stu-id="12adb-121">A unit test runs completely in memory and in process.</span></span> <span data-ttu-id="12adb-122">Nepodporuje se komunikace se serverem systému souborů, v síti nebo v databázi.</span><span class="sxs-lookup"><span data-stu-id="12adb-122">It doesn't communicate with the file system, the network, or a database.</span></span> <span data-ttu-id="12adb-123">Testování částí by měla pouze Otestujte svůj kód.</span><span class="sxs-lookup"><span data-stu-id="12adb-123">Unit tests should only test your code.</span></span>

<span data-ttu-id="12adb-124">Testy jednotek, na základě skutečnosti, že testují pouze jedné jednotky kódu, nemá žádné externí závislosti, musí provést velmi rychle.</span><span class="sxs-lookup"><span data-stu-id="12adb-124">Unit tests, by virtue of the fact that they test only a single unit of your code, with no external dependencies, should execute extremely quickly.</span></span> <span data-ttu-id="12adb-125">Proto byste měli mít testovacích sad stovky testování částí spustit za několik sekund.</span><span class="sxs-lookup"><span data-stu-id="12adb-125">Thus, you should be able to run test suites of hundreds of unit tests in a few seconds.</span></span> <span data-ttu-id="12adb-126">Je často spouštíte, ideálně před každou nabízené do ovládacího prvku úložiště sdíleného zdroje a jistě s každou automatizované sestavení na vašem serveru sestavení.</span><span class="sxs-lookup"><span data-stu-id="12adb-126">Run them frequently, ideally before every push to a shared source control repository, and certainly with every automated build on your build server.</span></span>

### <a name="integration-tests"></a><span data-ttu-id="12adb-127">Integrace testů</span><span class="sxs-lookup"><span data-stu-id="12adb-127">Integration Tests</span></span>

<span data-ttu-id="12adb-128">Přestože je vhodné pro zapouzdření váš kód, který komunikuje s infrastrukturou, jako jsou databáze a systémy souborů, budete mít stále některé tento kód a budete pravděpodobně chtít otestovat.</span><span class="sxs-lookup"><span data-stu-id="12adb-128">Although it's a good idea to encapsulate your code that interacts with infrastructure like databases and file systems, you will still have some of that code, and you will probably want to test it.</span></span> <span data-ttu-id="12adb-129">Kromě toho je třeba ověřit, že váš kód vrstvy pracovat jako můžete očekávat, když aplikace závislosti jsou plně vyřešený.</span><span class="sxs-lookup"><span data-stu-id="12adb-129">Additionally, you should verify that your code's layers interact as you expect when your application's dependencies are fully resolved.</span></span> <span data-ttu-id="12adb-130">To má na starosti integrace testy.</span><span class="sxs-lookup"><span data-stu-id="12adb-130">This is the responsibility of integration tests.</span></span> <span data-ttu-id="12adb-131">Integrace testů jsou často pomalejší a obtížnější nastavení než testy jednotek, protože často závisí na externí závislosti a infrastrukturu.</span><span class="sxs-lookup"><span data-stu-id="12adb-131">Integration tests tend to be slower and more difficult to set up than unit tests, because they often depend on external dependencies and infrastructure.</span></span> <span data-ttu-id="12adb-132">Proto byste neměli testování věcí, které by mohly být testů pomocí jednotkových testů v testech integrace.</span><span class="sxs-lookup"><span data-stu-id="12adb-132">Thus, you should avoid testing things that could be tests with unit tests in integration tests.</span></span> <span data-ttu-id="12adb-133">Pokud v daném scénáři můžete otestovat s testů jednotek, byste měli otestovat s testování částí.</span><span class="sxs-lookup"><span data-stu-id="12adb-133">If you can test a given scenario with a unit test, you should test it with a unit test.</span></span> <span data-ttu-id="12adb-134">Pokud není, pak zvažte použití test integrace.</span><span class="sxs-lookup"><span data-stu-id="12adb-134">If you can't, then consider using an integration test.</span></span>

<span data-ttu-id="12adb-135">Integrace testy bude mít často složitější nastavení a postupy rušením než testování částí.</span><span class="sxs-lookup"><span data-stu-id="12adb-135">Integration tests will often have more complex setup and teardown procedures than unit tests.</span></span> <span data-ttu-id="12adb-136">Například test integrace, který prochází skutečné databázi potřebovat způsob, jak databázi do známého stavu před každým testem spustit.</span><span class="sxs-lookup"><span data-stu-id="12adb-136">For example, an integration test that goes against an actual database will need a way to return the database to a known state before each test run.</span></span> <span data-ttu-id="12adb-137">Se přidávají nové testy a schématu databáze produkční zpracovaní tyto testovací skripty se zpravidla Čím velikost a složitost.</span><span class="sxs-lookup"><span data-stu-id="12adb-137">As new tests are added and the production database schema evolves, these test scripts will tend to grow in size and complexity.</span></span> <span data-ttu-id="12adb-138">V mnoha velkých systémů je nepraktické spustit úplné sady testů integrace na pracovních stanicích vývojáře před vrácením se změnami změny sdíleného zdrojového kódu.</span><span class="sxs-lookup"><span data-stu-id="12adb-138">In many large systems, it is impractical to run full suites of integration tests on developer workstations before checking in changes to shared source control.</span></span> <span data-ttu-id="12adb-139">V těchto případech může být spuštěno integrace testy na serveru sestavení.</span><span class="sxs-lookup"><span data-stu-id="12adb-139">In these cases, integration tests may be run on a build server.</span></span>

<span data-ttu-id="12adb-140">Třída implementace LocalFileImageService implementuje logiku pro načítání a vrátí počet bajtů souboru bitové kopie z určité složce zadané id:</span><span class="sxs-lookup"><span data-stu-id="12adb-140">The LocalFileImageService implementation class implements the logic for fetching and returning the bytes of an image file from a particular folder given an id:</span></span>

```csharp
public class LocalFileImageService : IImageService
{
    private readonly IHostingEnvironment _env;
    public LocalFileImageService(IHostingEnvironment env)
    {
        _env = env;
    }
    public byte[] GetImageBytesById(int id)
    {
        try
        {
            var contentRoot = _env.ContentRootPath + "//Pics";
            var path = Path.Combine(contentRoot, id + ".png");
            return File.ReadAllBytes(path);
        }
        catch (FileNotFoundException ex)
        {
            throw new CatalogImageMissingException(ex);
        }
    }
}
```

### <a name="functional-tests"></a><span data-ttu-id="12adb-141">Funkčních testů</span><span class="sxs-lookup"><span data-stu-id="12adb-141">Functional Tests</span></span>

<span data-ttu-id="12adb-142">Integrace testy se zapisují z pohledu vývojáře, chcete-li ověřit správné fungování společně některé součásti systému.</span><span class="sxs-lookup"><span data-stu-id="12adb-142">Integration tests are written from the perspective of the developer, to verify that some components of the system work correctly together.</span></span> <span data-ttu-id="12adb-143">Funkční testy se zapisují z pohledu uživatele a ověřte správnost systému na požadavky na jeho základě.</span><span class="sxs-lookup"><span data-stu-id="12adb-143">Functional tests are written from the perspective of the user, and verify the correctness of the system based on its requirements.</span></span> <span data-ttu-id="12adb-144">Následující výňatek nabízí užitečné analogie postup myslíte o funkčních testů, ve srovnání s testování částí:</span><span class="sxs-lookup"><span data-stu-id="12adb-144">The following excerpt offers a useful analogy for how to think about functional tests, compared to unit tests:</span></span>

> <span data-ttu-id="12adb-145">"K vytvoření úklidové je připodobnit mnohokrát vývoj systému.</span><span class="sxs-lookup"><span data-stu-id="12adb-145">"Many times the development of a system is likened to the building of a house.</span></span> <span data-ttu-id="12adb-146">Když tato analogie není poměrně správný, jsme ji rozšířit pro účely vysvětlení rozdílu mezi jednotky a funkčních testů.</span><span class="sxs-lookup"><span data-stu-id="12adb-146">While this analogy isn't quite correct, we can extend it for the purposes of understanding the difference between unit and functional tests.</span></span> <span data-ttu-id="12adb-147">Testování částí je podobná vytváření inspector, zobrazení úklidové vytváření webu.</span><span class="sxs-lookup"><span data-stu-id="12adb-147">Unit testing is analogous to a building inspector visiting a house's construction site.</span></span> <span data-ttu-id="12adb-148">Zadá se zaměřuje na různých interní systémy úklidové, foundation, vypracování elektrický, domovních instalací a tak dále.</span><span class="sxs-lookup"><span data-stu-id="12adb-148">He is focused on the various internal systems of the house, the foundation, framing, electrical, plumbing, and so on.</span></span> <span data-ttu-id="12adb-149">Mu zajišťuje (testy), bude fungovat správně a bezpečně, který je splňovat kód vytváření části budovy.</span><span class="sxs-lookup"><span data-stu-id="12adb-149">He ensures (tests) that the parts of the house will work correctly and safely, that is, meet the building code.</span></span> <span data-ttu-id="12adb-150">Funkčních testů v tomto scénáři jsou obdobou majitele domu návštěvě tohoto webu byly stejné konstrukce.</span><span class="sxs-lookup"><span data-stu-id="12adb-150">Functional tests in this scenario are analogous to the homeowner visiting this same construction site.</span></span> <span data-ttu-id="12adb-151">Zadá se předpokládá, že interní systémy budou chovat správně, že vytváření inspector provádí jeho úloh.</span><span class="sxs-lookup"><span data-stu-id="12adb-151">He assumes that the internal systems will behave appropriately, that the building inspector is performing his task.</span></span> <span data-ttu-id="12adb-152">Majitele domu se zaměřuje na co bude třeba za provozu v této úklidové.</span><span class="sxs-lookup"><span data-stu-id="12adb-152">The homeowner is focused on what it will be like to live in this house.</span></span> <span data-ttu-id="12adb-153">Jak vypadá úklidové problémem, jsou různé místnostmi možnost velikost, nemá úklidové podle potřeb dané rodině, jsou windows ve funkčním místo k zachycení sun ráno.</span><span class="sxs-lookup"><span data-stu-id="12adb-153">He is concerned with how the house looks, are the various rooms a comfortable size, does the house fit the family's needs, are the windows in a good spot to catch the morning sun.</span></span> <span data-ttu-id="12adb-154">Majitele domu provádí funkčních testů na budovy.</span><span class="sxs-lookup"><span data-stu-id="12adb-154">The homeowner is performing functional tests on the house.</span></span> <span data-ttu-id="12adb-155">Má pohledu uživatele.</span><span class="sxs-lookup"><span data-stu-id="12adb-155">He has the user's perspective.</span></span> <span data-ttu-id="12adb-156">Vytváření inspector provádí testování částí v domácnosti.</span><span class="sxs-lookup"><span data-stu-id="12adb-156">The building inspector is performing unit tests on the house.</span></span> <span data-ttu-id="12adb-157">Má Tvůrce perspektivy."</span><span class="sxs-lookup"><span data-stu-id="12adb-157">He has the builder's perspective."</span></span>

<span data-ttu-id="12adb-158">Zdroj: [testování a funkčních testů jednotek](http://www.softwaretestingtricks.com/2007/01/unit-testing-versus-functional-tests.html)</span><span class="sxs-lookup"><span data-stu-id="12adb-158">Source: [Unit Testing versus Functional Tests](http://www.softwaretestingtricks.com/2007/01/unit-testing-versus-functional-tests.html)</span></span>

<span data-ttu-id="12adb-159">Jsem rádi o tom, že "jako vývojáři, nám nepovedlo dvěma způsoby: využijeme věc nesprávný, nebo využijeme špatného."</span><span class="sxs-lookup"><span data-stu-id="12adb-159">I'm fond of saying "As developers, we fail in two ways: we build the thing wrong, or we build the wrong thing."</span></span> <span data-ttu-id="12adb-160">Testování částí Ujistěte se, že vytváříte právo věc; funkčních testů Ujistěte se, že vytváříte správné věci.</span><span class="sxs-lookup"><span data-stu-id="12adb-160">Unit tests ensure you are building the thing right; functional tests ensure you are building the right thing.</span></span>

<span data-ttu-id="12adb-161">Vzhledem k tomu, že funkčních testů fungovat na úrovni systému, mohou požadovat určitý stupeň automatizace uživatelského rozhraní.</span><span class="sxs-lookup"><span data-stu-id="12adb-161">Since functional tests operate at the system level, they may require some degree of UI automation.</span></span> <span data-ttu-id="12adb-162">Jako integrace testy obvykle pracují s nějaký druh infrastruktury testovací také.</span><span class="sxs-lookup"><span data-stu-id="12adb-162">Like integration tests, they usually work with some kind of test infrastructure as well.</span></span> <span data-ttu-id="12adb-163">Díky tomu je pomalejší a více křehká než testy částí a integrace.</span><span class="sxs-lookup"><span data-stu-id="12adb-163">This makes them slower and more brittle than unit and integration tests.</span></span> <span data-ttu-id="12adb-164">Měli byste mít jenom tolik funkčních testů, jak je budete muset být jistý, systém se chovají jako uživatelé očekávají, že.</span><span class="sxs-lookup"><span data-stu-id="12adb-164">You should have only as many functional tests as you need to be confident the system is behaving as users expect.</span></span>

### <a name="testing-pyramid"></a><span data-ttu-id="12adb-165">Testování pyramidy</span><span class="sxs-lookup"><span data-stu-id="12adb-165">Testing Pyramid</span></span>

<span data-ttu-id="12adb-166">Martin Fowler napsali o testování pyramidy, je příkladem se zobrazí v obrázek 9-1.</span><span class="sxs-lookup"><span data-stu-id="12adb-166">Martin Fowler wrote about the testing pyramid, an example of which is shown in Figure 9-1.</span></span>

![](./media/image9-1.png)

<span data-ttu-id="12adb-167">Obrázek 9-1 testování pyramidy</span><span class="sxs-lookup"><span data-stu-id="12adb-167">Figure 9-1 Testing Pyramid</span></span>

<span data-ttu-id="12adb-168">Různých úrovní pyramidy a jejich relativní velikosti, představují různé druhy testy a kolik byste měli zapsat pro vaši aplikaci.</span><span class="sxs-lookup"><span data-stu-id="12adb-168">The different layers of the pyramid, and their relative sizes, represent different kinds of tests and how many you should write for your application.</span></span> <span data-ttu-id="12adb-169">Jak vidíte, doporučuje se mít velký základ testování částí nepodporuje menší vrstvu integrace testy, i menší vrstva funkční testů.</span><span class="sxs-lookup"><span data-stu-id="12adb-169">As you can see, the recommendation is to have a large base of unit tests, supported by a smaller layer of integration tests, with an even smaller layer of functional tests.</span></span> <span data-ttu-id="12adb-170">Jednotlivé úrovně by v ideálním případě mít pouze testy v něm, který nelze nyní provést, adekvátní nižší vrstvě.</span><span class="sxs-lookup"><span data-stu-id="12adb-170">Each layer should ideally only have tests in it that cannot be performed adequately at a lower layer.</span></span> <span data-ttu-id="12adb-171">Testování pyramidy mít na paměti, když se pokoušíte rozhodnout, jaký druh test, je nutné pro konkrétní scénář.</span><span class="sxs-lookup"><span data-stu-id="12adb-171">Keep the testing pyramid in mind when you are trying to decide which kind of test you need for a particular scenario.</span></span>

### <a name="what-to-test"></a><span data-ttu-id="12adb-172">Co do testu</span><span class="sxs-lookup"><span data-stu-id="12adb-172">What to Test</span></span>

<span data-ttu-id="12adb-173">Častých problémů pro vývojáře, kteří jsou používáním s vytváření automatizovaných testů na blížící se s co chcete otestovat.</span><span class="sxs-lookup"><span data-stu-id="12adb-173">A common problem for developers who are inexperienced with writing automated tests is coming up with what to test.</span></span> <span data-ttu-id="12adb-174">Je to dobrý výchozí bod k testování podmíněnou logiku.</span><span class="sxs-lookup"><span data-stu-id="12adb-174">A good starting point is to test conditional logic.</span></span> <span data-ttu-id="12adb-175">Kdekoli máte metodu s chování, které změny podle podmíněného příkazu (if-else, přepínače, apod), byste měli mít spolu alespoň několik testů, které potvrďte správné chování pro určité podmínky.</span><span class="sxs-lookup"><span data-stu-id="12adb-175">Anywhere you have a method with behavior that changes based on a conditional statement (if-else, switch, etc.), you should be able to come up at least a couple of tests that confirm the correct behavior for certain conditions.</span></span> <span data-ttu-id="12adb-176">Pokud má váš kód chybové stavy a je vhodný k zápisu alespoň jeden test pro "radostí cestu" prostřednictvím kód (s žádné chyby) a alespoň jeden test pro "sad cesta" (s chybami nebo netypických výsledky) a ověřte, zda že chování vaší aplikace podle očekávání při krátkodobém chyby.</span><span class="sxs-lookup"><span data-stu-id="12adb-176">If your code has error conditions, it's good to write at least one test for the "happy path" through the code (with no errors), and at least one test for the "sad path" (with errors or atypical results) to confirm your application behaves as expected in the face of errors.</span></span> <span data-ttu-id="12adb-177">Nakonec pokuste se zaměřit na testování věcí, které může selhat, nikoli zaměřené na metriky jako pokrytí kódu.</span><span class="sxs-lookup"><span data-stu-id="12adb-177">Finally, try to focus on testing things that can fail, rather than focusing on metrics like code coverage.</span></span> <span data-ttu-id="12adb-178">Obecně je lepší, než je menší, další pokrytí kódu.</span><span class="sxs-lookup"><span data-stu-id="12adb-178">More code coverage is better than less, generally.</span></span> <span data-ttu-id="12adb-179">Zápis několik testů další metody velmi složité a důležitých je však obvykle lepší využití doby, než zápis testů vlastností automaticky právě ke zlepšení testovací metriky pokrytí kódu.</span><span class="sxs-lookup"><span data-stu-id="12adb-179">However, writing a few more tests of a very complex and business-critical method is usually a better use of time than writing tests for auto-properties just to improve test code coverage metrics.</span></span>

## <a name="organizing-test-projects"></a><span data-ttu-id="12adb-180">Uspořádání projektů testů</span><span class="sxs-lookup"><span data-stu-id="12adb-180">Organizing Test Projects</span></span>

<span data-ttu-id="12adb-181">Projektů testů můžete uspořádat, ale funguje osvědčené za vás.</span><span class="sxs-lookup"><span data-stu-id="12adb-181">Test projects can be organized however works best for you.</span></span> <span data-ttu-id="12adb-182">Je vhodné oddělení testy podle typu (testování částí, integrace testovací) a co se testování (podle projektu podle oboru názvů).</span><span class="sxs-lookup"><span data-stu-id="12adb-182">It's a good idea to separate tests by type (unit test, integration test) and by what they are testing (by project, by namespace).</span></span> <span data-ttu-id="12adb-183">Jestli toto rozdělení se skládá ze složek v rámci jednoho testovacího projektu nebo více projektů testování, je rozhodnutí o návrhu.</span><span class="sxs-lookup"><span data-stu-id="12adb-183">Whether this separation consists of folders within a single test project, or multiple test projects, is a design decision.</span></span> <span data-ttu-id="12adb-184">Nejjednodušší je jeden projektu, ale pro rozsáhlých projektů s mnoha testy nebo aby bylo možné snadněji spustit různé sady testů, můžete chtít mít několik různých testovací projekty.</span><span class="sxs-lookup"><span data-stu-id="12adb-184">One project is simplest, but for large projects with many tests, or in order to more easily run different sets of tests, you might want to have several different test projects.</span></span> <span data-ttu-id="12adb-185">Mnoha týmy uspořádat projektů testů založené na projekt, který testování, což pro aplikace s víc než několik projekty může vést k velký počet projektů testování, zejména v případě, že jste stále rozdělení tyto podle druh testů jsou v každém projektu.</span><span class="sxs-lookup"><span data-stu-id="12adb-185">Many teams organize test projects based on the project they are testing, which for applications with more than a few projects can result in a large number of test projects, especially if you still break these down according to what kind of tests are in each project.</span></span> <span data-ttu-id="12adb-186">Přístup ohrožení je tak, aby měl jeden projekt na typ testu na aplikaci, se složkami uvnitř projektů testování označíte projektu (a třída) během testování.</span><span class="sxs-lookup"><span data-stu-id="12adb-186">A compromise approach is to have one project per kind of test, per application, with folders inside the test projects to indicate the project (and class) being tested.</span></span>

<span data-ttu-id="12adb-187">Běžně je k uspořádání projekty aplikací ve složce 'src' a projektů testování aplikace paralelní 'testy' složce.</span><span class="sxs-lookup"><span data-stu-id="12adb-187">A common approach is to organize the application projects under a ‘src' folder, and the application's test projects under a parallel ‘tests' folder.</span></span> <span data-ttu-id="12adb-188">Porovnávání složek řešení můžete vytvořit v sadě Visual Studio, pokud vás užitečné této organizace.</span><span class="sxs-lookup"><span data-stu-id="12adb-188">You can create matching solution folders in Visual Studio, if you find this organization useful.</span></span>

![](./media/image9-2.png)

<span data-ttu-id="12adb-189">Obrázek 9-2 testovací organizaci ve vašem řešení</span><span class="sxs-lookup"><span data-stu-id="12adb-189">Figure 9-2 Test organization in your solution</span></span>

<span data-ttu-id="12adb-190">Můžete použít vámi preferované rozhraní test.</span><span class="sxs-lookup"><span data-stu-id="12adb-190">You can use whichever test framework you prefer.</span></span> <span data-ttu-id="12adb-191">Rozhraní framework xUnit funguje dobře a co se všemi testy ASP.NET Core a základní EF jsou zapsány v.</span><span class="sxs-lookup"><span data-stu-id="12adb-191">The xUnit framework works well and is what all of the ASP.NET Core and EF Core tests are written in.</span></span> <span data-ttu-id="12adb-192">Můžete přidat xUnit testovacího projektu v sadě Visual Studio pomocí šablony zobrazí obrázek 9-3, nebo z příkazového řádku pomocí nové xunit dotnet.</span><span class="sxs-lookup"><span data-stu-id="12adb-192">You can add an xUnit test project in Visual Studio using the template shown in Figure 9-3, or from the CLI using dotnet new xunit.</span></span>

![](./media/image9-3.png)

<span data-ttu-id="12adb-193">Obrázek 9-3 přidat xUnit testovacího projektu v sadě Visual Studio</span><span class="sxs-lookup"><span data-stu-id="12adb-193">Figure 9-3 Add an xUnit Test Project in Visual Studio</span></span>

### <a name="test-naming"></a><span data-ttu-id="12adb-194">Test pojmenování</span><span class="sxs-lookup"><span data-stu-id="12adb-194">Test Naming</span></span>

<span data-ttu-id="12adb-195">Testy konzistentní způsobem, by měl název s názvy, které označují, jaké jsou všechny testy.</span><span class="sxs-lookup"><span data-stu-id="12adb-195">You should name your tests in a consistent fashion, with names that indicate what each test does.</span></span> <span data-ttu-id="12adb-196">Jeden z přístupů, které došlo skvělé úspěšné dokončení je název třídy testovací podle třídy a metody, kterou budou testování.</span><span class="sxs-lookup"><span data-stu-id="12adb-196">One approach I've had great success with is to name test classes according to the class and method they are testing.</span></span> <span data-ttu-id="12adb-197">Výsledkem je mnoho tříd malý test, ale umožňuje velmi vymazat, co je zodpovědná za každý test.</span><span class="sxs-lookup"><span data-stu-id="12adb-197">This results in many small test classes, but it makes it extremely clear what each test is responsible for.</span></span> <span data-ttu-id="12adb-198">Pomocí názvu třídy testovací nastavit tak, aby určovat třídu a metoda má být testována název metody testovací slouží k určení chování testuje.</span><span class="sxs-lookup"><span data-stu-id="12adb-198">With the test class name set up to identify the class and method to be tested, the test method name can be used to specify the behavior being tested.</span></span> <span data-ttu-id="12adb-199">To by mělo zahrnovat očekávané chování a všechny vstupy nebo předpoklady, které by měl yield toto chování.</span><span class="sxs-lookup"><span data-stu-id="12adb-199">This should include the expected behavior and any inputs or assumptions that should yield this behavior.</span></span> <span data-ttu-id="12adb-200">Některé názvy testovací příklad:</span><span class="sxs-lookup"><span data-stu-id="12adb-200">Some example test names:</span></span>

- <span data-ttu-id="12adb-201">CatalogControllerGetImage.CallsImageServiceWithId</span><span class="sxs-lookup"><span data-stu-id="12adb-201">CatalogControllerGetImage.CallsImageServiceWithId</span></span>

- <span data-ttu-id="12adb-202">CatalogControllerGetImage.LogsWarningGivenImageMissingException</span><span class="sxs-lookup"><span data-stu-id="12adb-202">CatalogControllerGetImage.LogsWarningGivenImageMissingException</span></span>

- <span data-ttu-id="12adb-203">CatalogControllerGetImage.ReturnsFileResultWithBytesGivenSuccess</span><span class="sxs-lookup"><span data-stu-id="12adb-203">CatalogControllerGetImage.ReturnsFileResultWithBytesGivenSuccess</span></span>

- <span data-ttu-id="12adb-204">CatalogControllerGetImage.ReturnsNotFoundResultGivenImageMissingException</span><span class="sxs-lookup"><span data-stu-id="12adb-204">CatalogControllerGetImage.ReturnsNotFoundResultGivenImageMissingException</span></span>

<span data-ttu-id="12adb-205">Varianta tohoto přístupu končí každý název třídy test s "By" a mírně změní slovesného času:</span><span class="sxs-lookup"><span data-stu-id="12adb-205">A variation of this approach ends each test class name with "Should" and modifies the tense slightly:</span></span>

- <span data-ttu-id="12adb-206">CatalogControllerGetImage**by**. **Volání**ImageServiceWithId</span><span class="sxs-lookup"><span data-stu-id="12adb-206">CatalogControllerGetImage**Should**.**Call**ImageServiceWithId</span></span>

- <span data-ttu-id="12adb-207">CatalogControllerGetImage**by**. **Protokol**WarningGivenImageMissingException</span><span class="sxs-lookup"><span data-stu-id="12adb-207">CatalogControllerGetImage**Should**.**Log**WarningGivenImageMissingException</span></span>

<span data-ttu-id="12adb-208">Některé týmy najít druhý pojmenování přístup jasnější, ale něco víc verbose.</span><span class="sxs-lookup"><span data-stu-id="12adb-208">Some teams find the second naming approach clearer, though slightly more verbose.</span></span> <span data-ttu-id="12adb-209">V každém případě zkuste použít zásady vytváření názvů, který poskytuje vhled do testovací chování, takže pokud jeden nebo více testů nezdaří, je zřejmé z jejich názvy, jaké případech se nezdařilo.</span><span class="sxs-lookup"><span data-stu-id="12adb-209">In any case, try to use a naming convention that provides insight into test behavior, so that when one or more tests fail, it's obvious from their names what cases have failed.</span></span> <span data-ttu-id="12adb-210">Nepojmenovávejte můžete testy představu o možných, jako je například ControllerTests.Test1, jak tyto nabízet žádnou hodnotu, při jejich zobrazí ve výsledcích testu.</span><span class="sxs-lookup"><span data-stu-id="12adb-210">Avoid naming you tests vaguely, such as ControllerTests.Test1, as these offer no value when you see them in test results.</span></span>

<span data-ttu-id="12adb-211">Pokud budete postupovat podle zásady vytváření názvů jako jeden vyšší vytvoří mnoho tříd malý test, je vhodné dalšího uspořádání testů pomocí složky a oborů názvů.</span><span class="sxs-lookup"><span data-stu-id="12adb-211">If you follow a naming convention like the one above that produces many small test classes, it's a good idea to further organize your tests using folders and namespaces.</span></span> <span data-ttu-id="12adb-212">Obrázek 9 – 4 ukazuje jeden ze způsobů, uspořádání testů ve složce v rámci několika projektů testů.</span><span class="sxs-lookup"><span data-stu-id="12adb-212">Figure 9-4 shows one approach to organizing tests by folder within several test projects.</span></span>

![](./media/image9-4.png)

<span data-ttu-id="12adb-213">**Obrázek 9 – 4.**</span><span class="sxs-lookup"><span data-stu-id="12adb-213">**Figure 9-4.**</span></span> <span data-ttu-id="12adb-214">Uspořádání testovací třídy ve složce založeno na třídě testuje.</span><span class="sxs-lookup"><span data-stu-id="12adb-214">Organizing test classes by folder based on class being tested.</span></span>

<span data-ttu-id="12adb-215">Samozřejmě pokud třída určitá aplikace má mnoho způsobů testuje (a tedy mnoho testování třídy), může mít smysl umístit tyto ve složce odpovídající třídy aplikace.</span><span class="sxs-lookup"><span data-stu-id="12adb-215">Of course, if a particular application class has many methods being tested (and thus many test classes), it may make sense to place these in a folder corresponding to the application class.</span></span> <span data-ttu-id="12adb-216">Tato organizace je nejsou jiné než jak může soubory uspořádat do složek jinde.</span><span class="sxs-lookup"><span data-stu-id="12adb-216">This organization is no different than how you might organize files into folders elsewhere.</span></span> <span data-ttu-id="12adb-217">Pokud máte více než tři nebo čtyři související soubory ve složce obsahující mnoho souborů, je často užitečné přesuňte je do svých vlastních podsložky.</span><span class="sxs-lookup"><span data-stu-id="12adb-217">If you have more than three or four related files in a folder containing many other files, it's often helpful to move them into their own subfolder.</span></span>

## <a name="unit-testing-aspnet-core-apps"></a><span data-ttu-id="12adb-218">Aplikace ASP.NET Core testování částí</span><span class="sxs-lookup"><span data-stu-id="12adb-218">Unit Testing ASP.NET Core Apps</span></span>

<span data-ttu-id="12adb-219">V dobře navrženou aplikaci ASP.NET Core bude se zapouzdřené většina složitost a obchodní logiku v obchodní entity a různých služeb.</span><span class="sxs-lookup"><span data-stu-id="12adb-219">In a well-designed ASP.NET Core application, most of the complexity and business logic will be encapsulated in business entities and a variety of services.</span></span> <span data-ttu-id="12adb-220">Aplikace ASP.NET MVC jádra, s řadiči, filtry, viewmodels a zobrazení, měli vyžadovat jen několik testů jednotek.</span><span class="sxs-lookup"><span data-stu-id="12adb-220">The ASP.NET Core MVC app itself, with its controllers, filters, viewmodels, and views, should require very few unit tests.</span></span> <span data-ttu-id="12adb-221">Mnoho funkcí danou akci leží mimo samotné metody akce.</span><span class="sxs-lookup"><span data-stu-id="12adb-221">Much of the functionality of a given action lies outside the action method itself.</span></span> <span data-ttu-id="12adb-222">Zjišťuje, zda je směrování funguje správně, nebo globální při zpracování chyb nelze provést efektivně pomocí testování částí.</span><span class="sxs-lookup"><span data-stu-id="12adb-222">Testing whether routing works correctly, or global error handling, cannot be done effectively with a unit test.</span></span> <span data-ttu-id="12adb-223">Podobně všechny filtry, včetně ověření modelu a ověřování a autorizace filtry, nelze testování jednotky.</span><span class="sxs-lookup"><span data-stu-id="12adb-223">Likewise, any filters, including model validation and authentication and authorization filters, cannot be unit tested.</span></span> <span data-ttu-id="12adb-224">Bez těchto zdrojů chování musí být trivially malé, delegování hromadným práci na služby, které může být testována nezávislé na řadič, který používá, je většina metody akce.</span><span class="sxs-lookup"><span data-stu-id="12adb-224">Without these sources of behavior, most action methods should be trivially small, delegating the bulk of their work to services that can be tested independent of the controller that uses them.</span></span>

<span data-ttu-id="12adb-225">V některých případech budete muset refactor kódu v pořadí pro testování částí.</span><span class="sxs-lookup"><span data-stu-id="12adb-225">Sometimes you'll need to refactor your code in order to unit test it.</span></span> <span data-ttu-id="12adb-226">Často to zahrnuje identifikace abstrakce a využitím vkládání závislostí pro přístup k odběru v kód, který chcete otestovat, nikoli kódování přímo na infrastrukturu.</span><span class="sxs-lookup"><span data-stu-id="12adb-226">Frequently this involves identifying abstractions and using dependency injection to access the abstraction in the code you'd like to test, rather than coding directly against infrastructure.</span></span> <span data-ttu-id="12adb-227">Představte si třeba tato metoda jednoduché akce pro zobrazení obrázků:</span><span class="sxs-lookup"><span data-stu-id="12adb-227">For example, consider this simple action method for displaying images:</span></span>

```csharp
[HttpGet("[controller]/pic/{id}")]
public IActionResult GetImage(int id)
{
    var contentRoot = _env.ContentRootPath + "//Pics";
    var path = Path.Combine(contentRoot, id + ".png");
    Byte[] b = System.IO.File.ReadAllBytes(path);
    return File(b, "image/png");
}
```

<span data-ttu-id="12adb-228">Tato metoda testování částí je provedené obtížné je přímé závislá na System.IO.File, který se používá ke čtení systému souborů.</span><span class="sxs-lookup"><span data-stu-id="12adb-228">Unit testing this method is made difficult by its direct dependency on System.IO.File, which it uses to read from the file system.</span></span> <span data-ttu-id="12adb-229">Toto chování zajistit funguje podle očekávání, ale to se skutečné soubory se test integrace můžete otestovat.</span><span class="sxs-lookup"><span data-stu-id="12adb-229">You can test this behavior to ensure it works as expected, but doing so with real files is an integration test.</span></span> <span data-ttu-id="12adb-230">Je vhodné poznamenat trasy tato metoda nemůže otestovat – uvidíte, jak to provést pomocí testu funkční za chvíli.</span><span class="sxs-lookup"><span data-stu-id="12adb-230">It's worth noting you can't test this method's route – you'll see how to do this with a functional test shortly.</span></span>

<span data-ttu-id="12adb-231">Pokud nemůžete přímo testování částí chování systému souborů, a nemůže otestovat trasy, co je došlo k testování?</span><span class="sxs-lookup"><span data-stu-id="12adb-231">If you can't unit test the file system behavior directly, and you can't test the route, what is there to test?</span></span> <span data-ttu-id="12adb-232">Po refaktoring k umožnění testování částí, je dobře, může zjistit některé testovací případy a chybějící chování, jako je například zpracování chyb.</span><span class="sxs-lookup"><span data-stu-id="12adb-232">Well, after refactoring to make unit testing possible, you may discover some test cases and missing behavior, such as error handling.</span></span> <span data-ttu-id="12adb-233">Jakým způsobem metodu? Pokud soubor nebyl nalezen.</span><span class="sxs-lookup"><span data-stu-id="12adb-233">What does the method do when a file isn't found?</span></span> <span data-ttu-id="12adb-234">Co je dělat?</span><span class="sxs-lookup"><span data-stu-id="12adb-234">What should it do?</span></span> <span data-ttu-id="12adb-235">V tomto příkladu metoda refactored vypadat třeba takto:</span><span class="sxs-lookup"><span data-stu-id="12adb-235">In this example, the refactored method looks like this:</span></span>

```csharp
[HttpGet("[controller]/pic/{id}")\]
public IActionResult GetImage(int id)
{
    byte[] imageBytes;
    try
    {
        imageBytes = _imageService.GetImageBytesById(id);
    }
    catch (CatalogImageMissingException ex)
    {
        _logger.LogWarning($"No image found for id: {id}");
        return NotFound();
    }
    return File(imageBytes, "image/png");
}
```

<span data-ttu-id="12adb-236">\_Protokolovacího nástroje a \_imageService jsou obě vložit jako závislosti.</span><span class="sxs-lookup"><span data-stu-id="12adb-236">The \_logger and \_imageService are both injected as dependencies.</span></span> <span data-ttu-id="12adb-237">Nyní můžete otestovat předaný stejným id, který je předán do metody akce \_imageService, a že výsledné bajtů jsou vraceny jako součást FileResult.</span><span class="sxs-lookup"><span data-stu-id="12adb-237">Now you can test that the same id that is passed to the action method is passed to the \_imageService, and that the resulting bytes are returned as part of the FileResult.</span></span> <span data-ttu-id="12adb-238">Můžete také otestovat že protokolování chyb probíhá podle očekávání a že NotFound výsledek je vrácena v případě, že chybí bitovou kopii, za předpokladu, že to je důležité aplikace chování (to znamená, právě dočasné kód vývojáře přidat do diagnostikovat problém).</span><span class="sxs-lookup"><span data-stu-id="12adb-238">You can also test that error logging is happening as expected, and that a NotFound result is returned if the image is missing, assuming this is important application behavior (that is, not just temporary code the developer added to diagnose an issue).</span></span> <span data-ttu-id="12adb-239">Logika skutečný soubor přesunul do samostatné implementace služby a rozšíření, vrátí výjimku specifické pro aplikaci pro případ souboru chybí.</span><span class="sxs-lookup"><span data-stu-id="12adb-239">The actual file logic has moved into a separate implementation service, and has been augmented to return an application-specific exception for the case of a missing file.</span></span> <span data-ttu-id="12adb-240">Tato implementace můžete otestovat nezávisle, pomocí test integrace.</span><span class="sxs-lookup"><span data-stu-id="12adb-240">You can test this implementation independently, using an integration test.</span></span>

## <a name="integration-testing-aspnet-core-apps"></a><span data-ttu-id="12adb-241">Integrace aplikace ASP.NET Core testování</span><span class="sxs-lookup"><span data-stu-id="12adb-241">Integration Testing ASP.NET Core Apps</span></span>

<span data-ttu-id="12adb-242">Tato služba používá IHostingEnvironment, stejně jako CatalogController kódu se předtím, než je teď vyčleněný do samostatné služby.</span><span class="sxs-lookup"><span data-stu-id="12adb-242">This service uses the IHostingEnvironment, just as the CatalogController code did before it was refactored into a separate service.</span></span> <span data-ttu-id="12adb-243">Protože se jedná pouze kód v kontroleru, který používá IHostingEnvironment, že závislostí je odebraný z na CatalogController konstruktor.</span><span class="sxs-lookup"><span data-stu-id="12adb-243">Since this was the only code in the controller that used IHostingEnvironment, that dependency was removed from CatalogController's constructor.</span></span>

<span data-ttu-id="12adb-244">Pokud chcete otestovat, že tato služba funguje správně, musíte vytvořit soubor image známé test a ověřte, zda služba vrací je zadána specifický vstup.</span><span class="sxs-lookup"><span data-stu-id="12adb-244">To test that this service works correctly, you need to create a known test image file and verify that the service returns it given a specific input.</span></span> <span data-ttu-id="12adb-245">Měli postará nepoužívat mock objektů na chování, které chcete ve skutečnosti testovat (v tomto případě čtení ze systému souborů).</span><span class="sxs-lookup"><span data-stu-id="12adb-245">You should take care not to use mock objects on the behavior you actually want to test (in this case, reading from the file system).</span></span> <span data-ttu-id="12adb-246">Však mock objektů může být stále užitečná k nastavení integrace testy.</span><span class="sxs-lookup"><span data-stu-id="12adb-246">However, mock objects may still be useful to set up integration tests.</span></span> <span data-ttu-id="12adb-247">V takovém případě můžete model IHostingEnvironment, tak, aby jeho ContentRootPath ukazuje na složku, kterou se chystáte použít pro vaše testovací bitovou kopii.</span><span class="sxs-lookup"><span data-stu-id="12adb-247">In this case, you can mock IHostingEnvironment so that its ContentRootPath points to the folder you're going to use for your test image.</span></span> <span data-ttu-id="12adb-248">Dokončení třídy testovací integrace pracovní je znázorněno zde:</span><span class="sxs-lookup"><span data-stu-id="12adb-248">The complete working integration test class is shown here:</span></span>

```csharp
public class LocalFileImageServiceGetImageBytesById
{
    private byte[] _testBytes = new byte[] { 0x01, 0x02, 0x03 };
    private readonly Mock<IHostingEnvironment> _mockEnvironment = new Mock<IHostingEnvironment>();
    private int _testImageId = 123;
    private string _testFileName = "123.png";
    public LocalFileImageServiceGetImageBytesById()
    {
        // create folder if necessary
        Directory.CreateDirectory(Path.Combine(GetFileDirectory(), "Pics"));
        string filePath = GetFilePath(_testFileName);
        System.IO.File.WriteAllBytes(filePath, _testBytes);
        _mockEnvironment.SetupGet<string>(m => m.ContentRootPath).Returns(GetFileDirectory());
    }
    private string GetFilePath(string fileName)
    {
        return Path.Combine(GetFileDirectory(), "Pics", fileName);
        }
            private string GetFileDirectory()
        {
            var location = System.Reflection.Assembly.GetEntryAssembly().Location;
            return Path.GetDirectoryName(location);
        }

        [Fact]
        public void ReturnsFileContentResultGivenValidId()
        {
            var fileService = new LocalFileImageService(_mockEnvironment.Object);
            var result = fileService.GetImageBytesById(_testImageId);
            Assert.Equal(_testBytes, result);
        }
    }
```

> [!NOTE]
> <span data-ttu-id="12adb-249">že sama je velmi jednoduchý – hromadné kódu je nutné konfigurovat systém a vytvářet testování infrastrukturu (v tomto případě skutečný soubor čtení z disku).</span><span class="sxs-lookup"><span data-stu-id="12adb-249">that the test itself is very simple – the bulk of the code is necessary to configure the system and create the testing infrastructure (in this case, an actual file to be read from disk).</span></span> <span data-ttu-id="12adb-250">Toto je typické pro integraci testy, které často vyžadují složitější nastavení než testování částí.</span><span class="sxs-lookup"><span data-stu-id="12adb-250">This is typical for integration tests, which often require more complex setup work than unit tests.</span></span>

## <a name="functional-testing-aspnet-core-apps"></a><span data-ttu-id="12adb-251">Funkční testování aplikací ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="12adb-251">Functional Testing ASP.NET Core Apps</span></span>

<span data-ttu-id="12adb-252">Pro aplikace ASP.NET Core třídě TestServer usnadňuje funkčních testů poměrně k zápisu.</span><span class="sxs-lookup"><span data-stu-id="12adb-252">For ASP.NET Core applications, the TestServer class makes functional tests fairly easy to write.</span></span> <span data-ttu-id="12adb-253">Nakonfigurujete TestServer, použití WebHostBuilder stejným způsobem jako za normálních okolností pro vaši aplikaci.</span><span class="sxs-lookup"><span data-stu-id="12adb-253">You configure a TestServer using a WebHostBuilder, just as you normally do for your application.</span></span> <span data-ttu-id="12adb-254">Tato WebHostBuilder by měl být nakonfigurovaný stejně jako skutečné hostitele vaší aplikace, ale můžete upravit všechny jeho aspektů, které testování usnadnit.</span><span class="sxs-lookup"><span data-stu-id="12adb-254">This WebHostBuilder should be configured just like your application's real host, but you can modify any aspects of it that make testing easier.</span></span> <span data-ttu-id="12adb-255">Ve většině případů, stejný objekt TestServer pro mnoho testovacích případů budete opakovaně, tak ho může zapouzdřit v opakovaně použitelné metodu (možná v základní třídě):</span><span class="sxs-lookup"><span data-stu-id="12adb-255">Most of the time, you'll reuse the same TestServer for many test cases, so you can encapsulate it in a reusable method (perhaps in a base class):</span></span>

```csharp
public abstract class BaseWebTest
{
    protected readonly HttpClient _client;
    protected string _contentRoot;

    public BaseWebTest()
    {
        _client = GetClient();
    }

    protected HttpClient GetClient()
    {
        var startupAssembly = typeof(Startup).GetTypeInfo().Assembly;
        _contentRoot = GetProjectPath("src", startupAssembly);
        var builder = new WebHostBuilder()
        .UseContentRoot(_contentRoot)
        .UseStartup<Startup>();
        var server = new TestServer(builder);
        var client = server.CreateClient();
        return client;
    }
}
```

<span data-ttu-id="12adb-256">GetProjectPath – metoda jednoduše vrátí fyzickou cestu k webovému projektu (stažení ukázkové řešení).</span><span class="sxs-lookup"><span data-stu-id="12adb-256">The GetProjectPath method simply returns the physical path to the web project (download sample solution).</span></span> <span data-ttu-id="12adb-257">WebHostBuilder v tomto případě jednoduše Určuje, kde je kořenu obsahu pro webovou aplikaci a odkazuje na stejný třída při spuštění, které skutečné webová aplikace používá.</span><span class="sxs-lookup"><span data-stu-id="12adb-257">The WebHostBuilder in this case simply specifies where the content root for the web application is, and references the same Startup class the real web application uses.</span></span> <span data-ttu-id="12adb-258">Pro práci s TestServer, používat standardní typ System.Net.HttpClient provádět požadavky na ni.</span><span class="sxs-lookup"><span data-stu-id="12adb-258">To work with the TestServer, you use the standard System.Net.HttpClient type to make requests to it.</span></span> <span data-ttu-id="12adb-259">Objekt TestServer zpřístupní užitečné CreateClient metodu, která obsahuje předem nakonfigurovaná klienta, který je připraven k provedení požadavků v aplikaci objekt TestServer a systémem.</span><span class="sxs-lookup"><span data-stu-id="12adb-259">TestServer exposes a helpful CreateClient method that provides a pre-configured client that is ready to make requests to the application running on the TestServer.</span></span> <span data-ttu-id="12adb-260">Pomocí tohoto klienta (nastavit do chráněného \_člen klienta na základní test výše) při zápisu funkčních testů pro aplikace ASP.NET Core:</span><span class="sxs-lookup"><span data-stu-id="12adb-260">You use this client (set to the protected \_client member on the base test above) when writing functional tests for your ASP.NET Core application:</span></span>

```csharp
public class CatalogControllerGetImage : BaseWebTest
{
    [Fact]
    public async Task ReturnsFileContentResultGivenValidId()
    {
        var testFilePath = Path.Combine(_contentRoot, "pics//1.png");
        var expectedFileBytes = File.ReadAllBytes(testFilePath);
        var response = await _client.GetAsync("/catalog/pic/1");
        response.EnsureSuccessStatusCode();
        var streamResponse = await response.Content.ReadAsStreamAsync();
        byte[] byteResult;
        using (var ms = new MemoryStream())
        {
            streamResponse.CopyTo(ms);
            byteResult = ms.ToArray();
        }
        Assert.Equal(expectedFileBytes, byteResult);
    }
}
```

<span data-ttu-id="12adb-261">Tento test funkční vykonává úplné zásobník aplikací ASP.NET MVC jádra, včetně všech middleware, filtry, vazače, atd., které může být na místě.</span><span class="sxs-lookup"><span data-stu-id="12adb-261">This functional test exercises the full ASP.NET Core MVC application stack, including all middleware, filters, binders, etc. that may be in place.</span></span> <span data-ttu-id="12adb-262">Ověřuje, že danou trasu ("/ katalogu/pic/1) vrátí očekávané bajtové pole pro soubor do vhodného umístění.</span><span class="sxs-lookup"><span data-stu-id="12adb-262">It verifies that a given route ("/catalog/pic/1") returns the expected byte array for a file in a known location.</span></span> <span data-ttu-id="12adb-263">Nebude tak bez nastavování skutečné webový server a proto zabraňuje většinu brittleness, který používá skutečné webového serveru pro testování můžete zaznamenat (například problémy s nastavením brány firewall).</span><span class="sxs-lookup"><span data-stu-id="12adb-263">It does so without setting up a real web server, and so avoids much of the brittleness that using a real web server for testing can experience (for example, problems with firewall settings).</span></span> <span data-ttu-id="12adb-264">Funkčních testů, které spouštění TestServer jsou obvykle nižší než integrace a testování částí, ale je mnohem rychlejší než testy, které by spustit v síti k serveru webového testu.</span><span class="sxs-lookup"><span data-stu-id="12adb-264">Functional tests that run against TestServer are usually slower than integration and unit tests, but are much faster than tests that would run over the network to a test web server.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="12adb-265">[Předchozí](work-with-data-in-asp-net-core-apps.md)
[další](development-process-for-azure.md)</span><span class="sxs-lookup"><span data-stu-id="12adb-265">[Previous](work-with-data-in-asp-net-core-apps.md)
[Next](development-process-for-azure.md)</span></span>
