---
title: "Použití zjednodušené CQRS a DDD vzorců mikroslužbu"
description: "Architektura Mikroslužeb .NET pro aplikace .NET Kontejnerizované | Použití zjednodušené CQRS a DDD vzorců mikroslužbu"
keywords: "Docker, Mikroslužeb, ASP.NET, kontejneru"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: 5369ff73a0614170b220177f1e5d388483ca19f8
ms.sourcegitcommit: e7f04439d78909229506b56935a1105a4149ff3d
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 12/23/2017
---
# <a name="applying-simplified-cqrs-and-ddd-patterns-in-a-microservice"></a><span data-ttu-id="6707e-104">Použití zjednodušené CQRS a DDD vzorců mikroslužbu</span><span class="sxs-lookup"><span data-stu-id="6707e-104">Applying simplified CQRS and DDD patterns in a microservice</span></span>

<span data-ttu-id="6707e-105">CQRS je architekturní vzor, který odděluje modely pro čtení a zápis dat.</span><span class="sxs-lookup"><span data-stu-id="6707e-105">CQRS is an architectural pattern that separates the models for reading and writing data.</span></span> <span data-ttu-id="6707e-106">Související termín [příkaz dotazu oddělení (CQS)](https://martinfowler.com/bliki/CommandQuerySeparation.html) byl původně definované Bertrand Meyer v jeho kniha *konstrukce softwaru zaměřené na konkrétní objekt*.</span><span class="sxs-lookup"><span data-stu-id="6707e-106">The related term [Command Query Separation (CQS)](https://martinfowler.com/bliki/CommandQuerySeparation.html) was originally defined by Bertrand Meyer in his book *Object Oriented Software Construction*.</span></span> <span data-ttu-id="6707e-107">Základní myšlenkou je operace systému do dvou kategorií prudce oddělených rozdělte:</span><span class="sxs-lookup"><span data-stu-id="6707e-107">The basic idea is that you can divide a system’s operations into two sharply separated categories:</span></span>

-   <span data-ttu-id="6707e-108">Dotazy.</span><span class="sxs-lookup"><span data-stu-id="6707e-108">Queries.</span></span> <span data-ttu-id="6707e-109">Tyto vrácení výsledku a stav systému nemění a byly bez vedlejší účinky.</span><span class="sxs-lookup"><span data-stu-id="6707e-109">These return a result and do not change the state of the system, and they are free of side effects.</span></span>

-   <span data-ttu-id="6707e-110">Příkazy.</span><span class="sxs-lookup"><span data-stu-id="6707e-110">Commands.</span></span> <span data-ttu-id="6707e-111">Tyto změny stavu systému.</span><span class="sxs-lookup"><span data-stu-id="6707e-111">These change the state of a system.</span></span>

<span data-ttu-id="6707e-112">CQS je jednoduchý koncept – jde o metod v rámci stejného objektu dotazy nebo příkazy.</span><span class="sxs-lookup"><span data-stu-id="6707e-112">CQS is a simple concept—it is about methods within the same object being either queries or commands.</span></span> <span data-ttu-id="6707e-113">Každá metoda vrátí stav nebo mění stavu, ale ne obojí.</span><span class="sxs-lookup"><span data-stu-id="6707e-113">Each method either returns state or mutates state, but not both.</span></span> <span data-ttu-id="6707e-114">I objekt vzor jednoho úložiště můžete v souladu se CQS.</span><span class="sxs-lookup"><span data-stu-id="6707e-114">Even a single repository pattern object can comply with CQS.</span></span> <span data-ttu-id="6707e-115">CQS lze považovat za základní princip pro CQRS.</span><span class="sxs-lookup"><span data-stu-id="6707e-115">CQS can be considered a foundational principle for CQRS.</span></span>

<span data-ttu-id="6707e-116">[Příkaz a dotaz odpovědnost oddělení (CQRS)](https://martinfowler.com/bliki/CQRS.html) byl zaváděné Gregu Young a důrazně povýší Udi Dahan a jinými uživateli.</span><span class="sxs-lookup"><span data-stu-id="6707e-116">[Command and Query Responsibility Segregation (CQRS)](https://martinfowler.com/bliki/CQRS.html) was introduced by Greg Young and strongly promoted by Udi Dahan and others.</span></span> <span data-ttu-id="6707e-117">I když je více podrobné je založena na principu CQS.</span><span class="sxs-lookup"><span data-stu-id="6707e-117">It is based on the CQS principle, although it is more detailed.</span></span> <span data-ttu-id="6707e-118">Lze ji považovat vzor na základě na příkazy a události a volitelně na asynchronní zprávy.</span><span class="sxs-lookup"><span data-stu-id="6707e-118">It can be considered a pattern based on commands and events plus optionally on asynchronous messages.</span></span> <span data-ttu-id="6707e-119">V mnoha případech se týká CQRS pokročilejší scénáře, jako má jiné fyzické databázi pro čtení (dotazy) než pro zápis (aktualizace).</span><span class="sxs-lookup"><span data-stu-id="6707e-119">In many cases, CQRS is related to more advanced scenarios, like having a different physical database for reads (queries) than for writes (updates).</span></span> <span data-ttu-id="6707e-120">Kromě toho může implementovat více evolved systému CQRS [událostí-Sourcing (ES)](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/) pro vaši databázi aktualizace, proto byste měli jenom ukládat události v modelu domény místo ukládání dat v aktuálním stavu.</span><span class="sxs-lookup"><span data-stu-id="6707e-120">Moreover, a more evolved CQRS system might implement [Event-Sourcing (ES)](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/) for your updates database, so you would only store events in the domain model instead of storing the current-state data.</span></span> <span data-ttu-id="6707e-121">Je to ale není přístup používané v tomto průvodci; Používáme nejjednodušší CQRS přístup, který se skládá z právě oddělení dotazy z příkazů.</span><span class="sxs-lookup"><span data-stu-id="6707e-121">However, this is not the approach used in this guide; we are using the simplest CQRS approach, which consists of just separating the queries from the commands.</span></span>

<span data-ttu-id="6707e-122">Oddělení aspektů CQRS je dosaženo tím, že operace dotazů v jedné vrstvy a příkazy v jiné vrstvě.</span><span class="sxs-lookup"><span data-stu-id="6707e-122">The separation aspect of CQRS is achieved by grouping query operations in one layer and commands in another layer.</span></span> <span data-ttu-id="6707e-123">Jednotlivé úrovně má svou vlastní datový model (Všimněte si, že říkáme modelu, nemusí nutně jít do jiné databáze) a je sestaven pomocí vlastní kombinace vzory a technologie.</span><span class="sxs-lookup"><span data-stu-id="6707e-123">Each layer has its own data model (note that we say model, not necessarily a different database) and is built using its own combination of patterns and technologies.</span></span> <span data-ttu-id="6707e-124">Je důležité dvě vrstvy, které může být v rámci stejné úrovně nebo mikroslužbu, jako v příkladu (řazení mikroslužbu) používá pro tento průvodce.</span><span class="sxs-lookup"><span data-stu-id="6707e-124">More importantly, the two layers can be within the same tier or microservice, as in the example (ordering microservice) used for this guide.</span></span> <span data-ttu-id="6707e-125">Nebo na jinou mikroslužeb nebo procesy jejich možná implementace v tak můžou být optimalizované a škálovat na více systémů samostatně bez ovlivnění jednu na druhou.</span><span class="sxs-lookup"><span data-stu-id="6707e-125">Or they could be implemented on different microservices or processes so they can be optimized and scaled out separately without affecting one another.</span></span>

<span data-ttu-id="6707e-126">CQRS znamená s dva objekty pro operace čtení/zápis, kde v jiných kontextech existuje.</span><span class="sxs-lookup"><span data-stu-id="6707e-126">CQRS means having two objects for a read/write operation where in other contexts there is one.</span></span> <span data-ttu-id="6707e-127">Existuje několik důvodů nenormalizované čtení databáze, které se dozvíte v dokumentaci pokročilejší CQRS.</span><span class="sxs-lookup"><span data-stu-id="6707e-127">There are reasons to have a denormalized reads database, which you can learn about in more advanced CQRS literature.</span></span> <span data-ttu-id="6707e-128">Ale nejsou používáme tohoto přístupu v tomto poli, kde cílem je získat větší flexibilitu v dotazech místo omezení dotazů s omezeními od DDD jako agregace.</span><span class="sxs-lookup"><span data-stu-id="6707e-128">But we are not using that approach here, where the goal is to have more flexibility in the queries instead of limiting the queries with constraints from DDD patterns like aggregates.</span></span>

<span data-ttu-id="6707e-129">Příkladem tento druh služby je řazení mikroslužbu z eShopOnContainers odkaz na aplikaci.</span><span class="sxs-lookup"><span data-stu-id="6707e-129">An example of this kind of service is the ordering microservice from the eShopOnContainers reference application.</span></span> <span data-ttu-id="6707e-130">Tato služba se implementuje mikroslužbu založen na zjednodušené CQRS přístup.</span><span class="sxs-lookup"><span data-stu-id="6707e-130">This service implements a microservice based on a simplified CQRS approach.</span></span> <span data-ttu-id="6707e-131">Používá jeden zdroj dat nebo databáze, ale dva logické modely plus DDD vzory pro transakční doménu, jak je znázorněno na obrázku 9-2.</span><span class="sxs-lookup"><span data-stu-id="6707e-131">It uses a single data source or database, but two logical models plus DDD patterns for the transactional domain, as shown in Figure 9-2.</span></span>

![](./media/image2.png)

<span data-ttu-id="6707e-132">**Obrázek 9-2**.</span><span class="sxs-lookup"><span data-stu-id="6707e-132">**Figure 9-2**.</span></span> <span data-ttu-id="6707e-133">Zjednodušená na základě CQRS a DDD mikroslužbu</span><span class="sxs-lookup"><span data-stu-id="6707e-133">Simplified CQRS- and DDD-based microservice</span></span>

<span data-ttu-id="6707e-134">Aplikační vrstvu lze webového rozhraní API sám sebe.</span><span class="sxs-lookup"><span data-stu-id="6707e-134">The application layer can be the Web API itself.</span></span> <span data-ttu-id="6707e-135">Daný důležité návrhu aspekt je, že mikroslužbu se rozdělila dotazy a ViewModels (hlavně pro klientské aplikace vytvořit modely dat) z příkazy, modelu domény a následující vzoru CQRS transakce.</span><span class="sxs-lookup"><span data-stu-id="6707e-135">The important design aspect here is that the microservice has split the queries and ViewModels (data models especially created for the client applications) from the commands, domain model, and transactions following the CQRS pattern.</span></span> <span data-ttu-id="6707e-136">Tento přístup zajišťuje dotazy nezávislé na omezení a omezení pocházejících z DDD vzorů, které smysl jenom pro transakce a aktualizace, jak je popsáno v dalších oddílech.</span><span class="sxs-lookup"><span data-stu-id="6707e-136">This approach keeps the queries independent from restrictions and constraints coming from DDD patterns that only make sense for transactions and updates, as explained in later sections.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="6707e-137">[Předchozí] (index.md) [Další] (eshoponcontainers-cqrs-ddd-microservice.md)</span><span class="sxs-lookup"><span data-stu-id="6707e-137">[Previous] (index.md) [Next] (eshoponcontainers-cqrs-ddd-microservice.md)</span></span>
