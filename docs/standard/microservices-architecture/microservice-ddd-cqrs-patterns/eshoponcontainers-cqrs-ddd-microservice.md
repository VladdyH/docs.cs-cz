---
title: "Použití CQRS a CQS přístupů DDD mikroslužbu v eShopOnContainers"
description: "Architektura Mikroslužeb .NET pro aplikace .NET Kontejnerizované | Použití CQRS a CQS přístupů DDD mikroslužbu v eShopOnContainers"
keywords: "Docker, Mikroslužeb, ASP.NET, kontejneru"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: 63e61a93aa2a162d7b48e0d423dab99dcea9d020
ms.sourcegitcommit: e7f04439d78909229506b56935a1105a4149ff3d
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 12/23/2017
---
# <a name="applying-cqrs-and-cqs-approaches-in-a-ddd-microservice-in-eshoponcontainers"></a><span data-ttu-id="cf22c-104">Použití CQRS a CQS přístupů DDD mikroslužbu v eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="cf22c-104">Applying CQRS and CQS approaches in a DDD microservice in eShopOnContainers</span></span>

<span data-ttu-id="cf22c-105">Návrh řazení mikroslužbu v eShopOnContainers referenční aplikace je založena na CQRS zásady.</span><span class="sxs-lookup"><span data-stu-id="cf22c-105">The design of the ordering microservice at the eShopOnContainers reference application is based on CQRS principles.</span></span> <span data-ttu-id="cf22c-106">Ale používá nejjednodušší přístup, který je právě oddělení dotazy z příkazů a pomocí stejné databáze pro obě akce.</span><span class="sxs-lookup"><span data-stu-id="cf22c-106">However, it uses the simplest approach, which is just separating the queries from the commands and using the same database for both actions.</span></span>

<span data-ttu-id="cf22c-107">Podstatu tyto vzorce a zde bodem důležité je, že dotazy jsou idempotent: bez ohledu na to, kolikrát dotaz systém, stavu systému, že nedojde ke změně můžete i použít datový model různých "čtení" než logice transakcí "zápisy" model domény, i když řazení mikroslužeb používá stejnou databázi.</span><span class="sxs-lookup"><span data-stu-id="cf22c-107">The essence of those patterns, and the important point here, is that queries are idempotent: no matter how many times you query a system, the state of that system will not change You could even use a different “reads” data model than the transactional logic “writes” domain model, although the ordering microservices is using the same database.</span></span> <span data-ttu-id="cf22c-108">Toto je proto jednodušší přístup CQRS.</span><span class="sxs-lookup"><span data-stu-id="cf22c-108">Hence this is a simplified CQRS approach.</span></span>

<span data-ttu-id="cf22c-109">Na druhé straně příkazy, které aktivují transakce a aktualizace dat, změňte stav v systému.</span><span class="sxs-lookup"><span data-stu-id="cf22c-109">On the other hand, commands, which trigger transactions and data updates, change state in the system.</span></span> <span data-ttu-id="cf22c-110">Pomocí příkazů, budete muset pečlivě, kdy se zabývají složitost a proměnlivých obchodní pravidla.</span><span class="sxs-lookup"><span data-stu-id="cf22c-110">With commands, you need to be careful when dealing with complexity and ever-changing business rules.</span></span> <span data-ttu-id="cf22c-111">To je případě, kdy chcete použít techniky DDD tak, aby měl lépe Modelovaný systému.</span><span class="sxs-lookup"><span data-stu-id="cf22c-111">This is the where you want to apply DDD techniques to have a better modeled system.</span></span>

<span data-ttu-id="cf22c-112">Vzory DDD uvádíme v této příručce by neměl být všeobecně aplikuje.</span><span class="sxs-lookup"><span data-stu-id="cf22c-112">The DDD patterns presented in this guide should not be applied universally.</span></span> <span data-ttu-id="cf22c-113">Ale vést k omezení návrhu.</span><span class="sxs-lookup"><span data-stu-id="cf22c-113">They introduce constraints on your design.</span></span> <span data-ttu-id="cf22c-114">Tato omezení zadejte výhod, třeba vyšší kvality v čase, zejména v příkazy a jiný kód, který upravuje stav systému.</span><span class="sxs-lookup"><span data-stu-id="cf22c-114">Those constraints provide benefits such as higher quality over time, especially in commands and other code that modifies system state.</span></span> <span data-ttu-id="cf22c-115">Ale tyto omezení přidání složitosti s méně výhody pro čtení a dotazování na data.</span><span class="sxs-lookup"><span data-stu-id="cf22c-115">However, those constraints add complexity with fewer benefits for reading and querying data.</span></span>

<span data-ttu-id="cf22c-116">Jeden takový vzor je agregační vzor, který nám prozkoumat více v pozdějších částech.</span><span class="sxs-lookup"><span data-stu-id="cf22c-116">One such pattern is the Aggregate pattern, which we examine more in later sections.</span></span> <span data-ttu-id="cf22c-117">Stručně řečeno v agregační vzoru je považovat za mnoho objektů domény na jednu jednotku v důsledku jejich vztahu v doméně.</span><span class="sxs-lookup"><span data-stu-id="cf22c-117">Briefly, in the Aggregate pattern, you treat many domain objects as a single unit as a result of their relationship in the domain.</span></span> <span data-ttu-id="cf22c-118">Nemusí vždy získat výhody z tohoto vzoru v dotazech; ho může zvýšit složitosti logiku dotazu.</span><span class="sxs-lookup"><span data-stu-id="cf22c-118">You might not always gain advantages from this pattern in queries; it can increase the complexity of query logic.</span></span> <span data-ttu-id="cf22c-119">Pro dotazy na jen pro čtení není získat výhody práce více objektů jako jeden agregace.</span><span class="sxs-lookup"><span data-stu-id="cf22c-119">For read-only queries, you do not get the advantages of treating multiple objects as a single Aggregate.</span></span> <span data-ttu-id="cf22c-120">Zobrazí pouze na složitost.</span><span class="sxs-lookup"><span data-stu-id="cf22c-120">You only get the complexity.</span></span>

<span data-ttu-id="cf22c-121">Jak je znázorněno na obrázku 9-2, tento průvodce navrhuje pomocí vzorce DDD pouze v oblasti transakční/aktualizace vašeho mikroslužbu (jak aktivovány příkazy).</span><span class="sxs-lookup"><span data-stu-id="cf22c-121">As shown in Figure 9-2, this guide suggests using DDD patterns only in the transactional/updates area of your microservice (that is, as triggered by commands).</span></span> <span data-ttu-id="cf22c-122">Dotazy můžete postupovat podle jednodušší a musí být oddělené příkazy pro následující CQRS přístup.</span><span class="sxs-lookup"><span data-stu-id="cf22c-122">Queries can follow a simpler approach and should be separated from commands, following a CQRS approach.</span></span>

<span data-ttu-id="cf22c-123">Pro implementaci "dotazy straně", můžete zvolit řada přístupů, z vaší plnohodnotném ORM jako základní EF, AutoMapper projekce, uložené procedury, zobrazení, Vyhodnocená zobrazení nebo malých ORM.</span><span class="sxs-lookup"><span data-stu-id="cf22c-123">For implementing the “queries side”, you can choose between many approaches, from your full-blown ORM like EF Core, AutoMapper projections, stored procedures, views, materialized views or a micro ORM.</span></span>

<span data-ttu-id="cf22c-124">V této příručce a eShopOnContainers (konkrétně řazení mikroslužbu) jsme zvolili k implementaci přímých dotazů pomocí micro ORM jako [Dapper](https://github.com/StackExchange/dapper-dot-net).</span><span class="sxs-lookup"><span data-stu-id="cf22c-124">In this guide and in eShopOnContainers (specifically the ordering microservice) we chose to implement straight queries using a micro ORM like [Dapper](https://github.com/StackExchange/dapper-dot-net).</span></span> <span data-ttu-id="cf22c-125">Díky tomu můžete implementovat jakýkoli dotaz na příkazy SQL pro získání nejlepší výkon, díky světla rozhraní s minimální režií na základě.</span><span class="sxs-lookup"><span data-stu-id="cf22c-125">This lets you implement any query based on SQL statements to get the best performance, thanks to a light framework with very little overhead.</span></span>

<span data-ttu-id="cf22c-126">Všimněte si, že pokud použijete tuto metodu, aktualizace modelu, s dopadem na tom, jak jsou trvalé entity k databázi SQL také vyžadují samostatné aktualizace dotazy SQL, které jsou používány Dapper nebo jakékoli jiné samostatné (bez EF) přístupy k dotazování.</span><span class="sxs-lookup"><span data-stu-id="cf22c-126">Note that when you use this approach, any updates to your model that impact how entities are persisted to a SQL database also need separate updates to SQL queries used by Dapper or any other separate (non-EF) approaches to querying.</span></span>

## <a name="cqrs-and-ddd-patterns-are-not-top-level-architectures"></a><span data-ttu-id="cf22c-127">CQRS a DDD vzory nejsou nejvyšší úrovně architektury</span><span class="sxs-lookup"><span data-stu-id="cf22c-127">CQRS and DDD patterns are not top-level architectures</span></span>

<span data-ttu-id="cf22c-128">Je důležité si uvědomit, že CQRS a většina DDD vzory (například vrstvy DDD nebo modelu domény s agregace) nejsou architektury styly, ale pouze architektura vzory.</span><span class="sxs-lookup"><span data-stu-id="cf22c-128">It important to understand that CQRS and most DDD patterns (like DDD layers or a domain model with aggregates) are not architectural styles, but only architecture patterns.</span></span> <span data-ttu-id="cf22c-129">Mikroslužeb, SOA a architektura založeného na událostech (Automatizace elektronického designu) jsou příklady architektury stylů.</span><span class="sxs-lookup"><span data-stu-id="cf22c-129">Microservices, SOA, and event-driven architecture (EDA) are examples of architectural styles.</span></span> <span data-ttu-id="cf22c-130">Popisují systému celá řada komponent, jako je například mnoho mikroslužeb.</span><span class="sxs-lookup"><span data-stu-id="cf22c-130">They describe a system of many components, such as many microservices.</span></span> <span data-ttu-id="cf22c-131">Vzory CQRS a DDD popisují něco v jednom systému nebo komponenty; v tomto případě něco uvnitř mikroslužby.</span><span class="sxs-lookup"><span data-stu-id="cf22c-131">CQRS and DDD patterns describe something inside a single system or component; in this case, something inside a microservice.</span></span>

<span data-ttu-id="cf22c-132">Různých kontextů ohraničenou (BCs) se využívají různé vzorce.</span><span class="sxs-lookup"><span data-stu-id="cf22c-132">Different Bounded Contexts (BCs) will employ different patterns.</span></span> <span data-ttu-id="cf22c-133">Mají různé odpovědnosti a který vede k jiné řešení.</span><span class="sxs-lookup"><span data-stu-id="cf22c-133">They have different responsibilities, and that leads to different solutions.</span></span> <span data-ttu-id="cf22c-134">Je vhodné zdůraznění, vynucení stejný vzor, který everywhere dojde k selhání.</span><span class="sxs-lookup"><span data-stu-id="cf22c-134">It is worth emphasizing that forcing the same pattern everywhere leads to failure.</span></span> <span data-ttu-id="cf22c-135">Všude, kde nepoužívejte CQRS a DDD vzory.</span><span class="sxs-lookup"><span data-stu-id="cf22c-135">Do not use CQRS and DDD patterns everywhere.</span></span> <span data-ttu-id="cf22c-136">Mnoho subsystémy, BCs nebo mikroslužeb jsou jednodušší a může být implementováno snadněji pomocí jednoduché CRUD služby nebo pomocí další přístup.</span><span class="sxs-lookup"><span data-stu-id="cf22c-136">Many subsystems, BCs, or microservices are simpler and can be implemented more easily using simple CRUD services or using another approach.</span></span>

<span data-ttu-id="cf22c-137">Existuje jenom jedna aplikace architektura: architektura systému nebo začátku do konce aplikace navrhujete (například architektuře mikroslužeb).</span><span class="sxs-lookup"><span data-stu-id="cf22c-137">There is only one application architecture: the architecture of the system or end-to-end application you are designing (for example, the microservices architecture).</span></span> <span data-ttu-id="cf22c-138">V návrhu každé ohraničenou kontext nebo mikroslužbu v rámci této aplikace však odráží vlastní kompromisy a rozhodnutí o návrhu interní úrovni vzory architektura.</span><span class="sxs-lookup"><span data-stu-id="cf22c-138">However, the design of each Bounded Context or microservice within that application reflects its own tradeoffs and internal design decisions at an architecture patterns level.</span></span> <span data-ttu-id="cf22c-139">Nepokoušejte se použít stejné architektury vzory jako CQRS nebo DDD everywhere.</span><span class="sxs-lookup"><span data-stu-id="cf22c-139">Do not try to apply the same architectural patterns like CQRS or DDD everywhere.</span></span>

####  <a name="additional-resources"></a><span data-ttu-id="cf22c-140">Další zdroje</span><span class="sxs-lookup"><span data-stu-id="cf22c-140">Additional resources</span></span>

-   <span data-ttu-id="cf22c-141">**Martin Fowler. CQRS**
    [*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span><span class="sxs-lookup"><span data-stu-id="cf22c-141">**Martin Fowler. CQRS**
[*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span></span>

-   <span data-ttu-id="cf22c-142">**Gregu Young. CQS vs. CQRS**
    [*http://codebetter.com/gregyoung/2009/08/13/command-query-separation/*](http://codebetter.com/gregyoung/2009/08/13/command-query-separation/)</span><span class="sxs-lookup"><span data-stu-id="cf22c-142">**Greg Young. CQS vs. CQRS**
[*http://codebetter.com/gregyoung/2009/08/13/command-query-separation/*](http://codebetter.com/gregyoung/2009/08/13/command-query-separation/)</span></span>

-   <span data-ttu-id="cf22c-143">**Gregu Young. Dokumenty CQRS**
    [*https://cqrs.files.wordpress.com/2010/11/cqrs\_documents.pdf*](https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf)</span><span class="sxs-lookup"><span data-stu-id="cf22c-143">**Greg Young. CQRS Documents**
[*https://cqrs.files.wordpress.com/2010/11/cqrs\_documents.pdf*](https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf)</span></span>

-   <span data-ttu-id="cf22c-144">**Gregu Young. CQRS, úloha na bázi uživatelská rozhraní a událostí Sourcing**
    [*http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/*](http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/)</span><span class="sxs-lookup"><span data-stu-id="cf22c-144">**Greg Young. CQRS, Task Based UIs and Event Sourcing**
[*http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/*](http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/)</span></span>

-   <span data-ttu-id="cf22c-145">**UDI Dahan. Vyjasněno, CQRS**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span><span class="sxs-lookup"><span data-stu-id="cf22c-145">**Udi Dahan. Clarified CQRS**
[*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span></span>

-   <span data-ttu-id="cf22c-146">**CQRS**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span><span class="sxs-lookup"><span data-stu-id="cf22c-146">**CQRS**
[*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span></span>

-   <span data-ttu-id="cf22c-147">**Událost Sourcing (ES)**
    [*http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/*](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/)</span><span class="sxs-lookup"><span data-stu-id="cf22c-147">**Event-Sourcing (ES)**
[*http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/*](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="cf22c-148">[Předchozí] (apply-simplified-microservice-cqrs-ddd-patterns.md) [Další] (cqrs reads.md mikroslužbu)</span><span class="sxs-lookup"><span data-stu-id="cf22c-148">[Previous] (apply-simplified-microservice-cqrs-ddd-patterns.md) [Next] (cqrs-microservice-reads.md)</span></span>
