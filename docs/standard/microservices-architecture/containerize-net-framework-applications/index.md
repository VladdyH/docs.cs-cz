---
title: "Migrace aplikací starší monolitický .NET Framework do kontejneru systému Windows"
description: "Architektura Mikroslužeb .NET pro aplikace .NET Kontejnerizované | Migrace aplikací starší monolitický .NET Framework do kontejneru systému Windows"
keywords: "Docker, Mikroslužeb, ASP.NET, kontejneru"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: 3bce714d517615bdd56473a8c74acde424d2d5a7
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/18/2017
---
# <a name="migrating-legacy-monolithic-net-framework-applications-to-windows-containers"></a><span data-ttu-id="73685-104">Migrace aplikací starší monolitický .NET Framework do kontejneru systému Windows</span><span class="sxs-lookup"><span data-stu-id="73685-104">Migrating Legacy Monolithic .NET Framework Applications to Windows Containers</span></span>

<span data-ttu-id="73685-105">*Kontejnery Windows lze použít jako způsob pro zlepšení vývoj a testování prostředích a k nasazení aplikací, které jsou založeny na starší verzi rozhraní .NET Framework technologie, jako je Web* *formulářů. Použití kontejnerů pro starší verze aplikace tímto způsobem se označuje jako "navýšení a shift" scénáře.*</span><span class="sxs-lookup"><span data-stu-id="73685-105">*Windows Containers can be used as a way to improve development and test environments, and to deploy applications that are based on legacy .NET Framework technologies like Web* *Forms. Using containers for legacy applications in this way is referred to as a “lift and shift” scenario.*</span></span>

<span data-ttu-id="73685-106">Předchozích částech tohoto průvodce máte prosazovaná mikroslužeb architektura, kde obchodních aplikací rozděleny mezi různé kontejnery, každý službou malé, cílených.</span><span class="sxs-lookup"><span data-stu-id="73685-106">Earlier sections of this guide have championed a microservices architecture where business applications are distributed among different containers, each running a small, focused service.</span></span> <span data-ttu-id="73685-107">Tento cíl má mnoho výhod.</span><span class="sxs-lookup"><span data-stu-id="73685-107">That goal has many benefits.</span></span> <span data-ttu-id="73685-108">Při vývoji nových aplikací důrazně doporučujeme tento přístup.</span><span class="sxs-lookup"><span data-stu-id="73685-108">In new development, that approach is strongly recommended.</span></span> <span data-ttu-id="73685-109">Klíčové podnikové aplikace také těžit dost pro potřeby náklady na rearchitecture a opětovná implementace.</span><span class="sxs-lookup"><span data-stu-id="73685-109">Enterprise-critical applications will also benefit enough to justify the cost of a rearchitecture and reimplementation.</span></span>

<span data-ttu-id="73685-110">Ale ne každá aplikace bude mít prospěch dost pro potřeby náklady.</span><span class="sxs-lookup"><span data-stu-id="73685-110">But not every application will benefit enough to justify the cost.</span></span> <span data-ttu-id="73685-111">To neznamená, že tyto aplikace nelze použít ve scénářích kontejneru.</span><span class="sxs-lookup"><span data-stu-id="73685-111">That does not mean that those applications cannot be used in container scenarios.</span></span>

<span data-ttu-id="73685-112">V této části se podíváme na aplikaci pro eShopOnContainers, zobrazí obrázek 7-1.</span><span class="sxs-lookup"><span data-stu-id="73685-112">In this section, we will explore an application for eShopOnContainers, shown in Figure 7-1.</span></span> <span data-ttu-id="73685-113">Tato aplikace se použije členové týmu enterprise eShopOnContainers k zobrazení a úpravě katalogu produktů.</span><span class="sxs-lookup"><span data-stu-id="73685-113">This application would be used by members of the eShopOnContainers enterprise team to view and edit the product catalog.</span></span>

![](./media/image1.png)

<span data-ttu-id="73685-114">**Obrázek 7-1**.</span><span class="sxs-lookup"><span data-stu-id="73685-114">**Figure 7-1**.</span></span> <span data-ttu-id="73685-115">Aplikace webových formulářů ASP.NET (starší verze technologie) do kontejneru systému Windows</span><span class="sxs-lookup"><span data-stu-id="73685-115">ASP.NET Web Forms application (legacy technology) on a Windows Container</span></span>

<span data-ttu-id="73685-116">Toto je aplikace webových formulářů, která se používá k procházení a upravit položky katalogu.</span><span class="sxs-lookup"><span data-stu-id="73685-116">This is a Web Forms application that is used to browse and modify the catalog entries.</span></span> <span data-ttu-id="73685-117">Webové formuláře závislost znamená, že tato aplikace se nespustí na .NET Core ledaže je přepsaná bez webových formulářů a místo toho používá ASP.NET MVC jádra.</span><span class="sxs-lookup"><span data-stu-id="73685-117">The Web Forms dependency means this application will not run on .NET Core unless it is rewritten without Web Forms and instead uses ASP.NET Core MVC.</span></span> <span data-ttu-id="73685-118">Zobrazí se, jak spouštět aplikace, jako je to v kontejnerech beze změn.</span><span class="sxs-lookup"><span data-stu-id="73685-118">You will see how you can run applications like these in containers without changes.</span></span> <span data-ttu-id="73685-119">Zobrazí se taky, jak provést minimální změny pro práci v hybridní režim, kde některé funkce se přesunula do samostatné mikroslužbu, ale většina funkcí zůstane v monolitický aplikace.</span><span class="sxs-lookup"><span data-stu-id="73685-119">You will also see how you can make minimal changes to work in a hybrid mode where some functionality has been moved into a separate microservice, but most functionality remains in the monolithic application.</span></span>

## <a name="benefits-of-containerizing-a-monolithic-application"></a><span data-ttu-id="73685-120">Výhody containerizing monolitický aplikace</span><span class="sxs-lookup"><span data-stu-id="73685-120">Benefits of containerizing a monolithic application</span></span>

<span data-ttu-id="73685-121">Catalog.WebForms aplikace je k dispozici v úložišti GitHub eShopOnContainers (<https://github.com/dotnet/eShopOnContainers>).</span><span class="sxs-lookup"><span data-stu-id="73685-121">The Catalog.WebForms application is available in the eShopOnContainers GitHub repository (<https://github.com/dotnet/eShopOnContainers>).</span></span> <span data-ttu-id="73685-122">Tato aplikace je samostatná aplikace, webový přístup k úložišti dat vysoké dostupnosti.</span><span class="sxs-lookup"><span data-stu-id="73685-122">This application is a standalone web application accessing a high-availability data store.</span></span> <span data-ttu-id="73685-123">Existují i tak výhody, na kterém je aplikace spuštěná v kontejneru.</span><span class="sxs-lookup"><span data-stu-id="73685-123">Even so, there are advantages to running the application in a container.</span></span> <span data-ttu-id="73685-124">Vytvoření bitové kopie pro aplikaci.</span><span class="sxs-lookup"><span data-stu-id="73685-124">You create an image for the application.</span></span> <span data-ttu-id="73685-125">Od tohoto okamžiku každé nasazení běží ve stejném prostředí.</span><span class="sxs-lookup"><span data-stu-id="73685-125">From that point forward, every deployment runs in the same environment.</span></span> <span data-ttu-id="73685-126">Každý kontejner používá stejnou verzi operačního systému, má stejnou verzi závislostí nainstalována, používá stejné rozhraní a je sestaven pomocí stejného procesu.</span><span class="sxs-lookup"><span data-stu-id="73685-126">Every container uses the same OS version, has the same version of dependencies installed, uses the same framework, and is built using the same process.</span></span> <span data-ttu-id="73685-127">Zobrazí se aplikace načíst ve Visual Studio 2017 v obrázku 7-2.</span><span class="sxs-lookup"><span data-stu-id="73685-127">You can see the application loaded in Visual Studio 2017 in Figure 7-2.</span></span>

![](./media/image2.png)

<span data-ttu-id="73685-128">**Obrázek 7-2**.</span><span class="sxs-lookup"><span data-stu-id="73685-128">**Figure 7-2**.</span></span> <span data-ttu-id="73685-129">Správa aplikací webových formulářů v aplikaci Visual Studio 2017 katalogů</span><span class="sxs-lookup"><span data-stu-id="73685-129">Catalog management Web Forms application in Visual Studio 2017</span></span>

<span data-ttu-id="73685-130">Kromě toho vývojáři všechny aplikaci můžete spustit v tomto prostředí konzistentní.</span><span class="sxs-lookup"><span data-stu-id="73685-130">In addition, developers can all run the application in this consistent environment.</span></span> <span data-ttu-id="73685-131">Problémy, které se zobrazují pouze u některých verzí se zobrazí okamžitě pro vývojáře, nikoli zpřístupnění v pracovním nebo produkčním prostředí.</span><span class="sxs-lookup"><span data-stu-id="73685-131">Issues that only appear with certain versions will appear immediately for developers rather than surfacing in a staging or production environment.</span></span> <span data-ttu-id="73685-132">Rozdíly mezi vývojových prostředí mezi vývojovým týmem podstatné menší po spuštění aplikace v kontejnerech.</span><span class="sxs-lookup"><span data-stu-id="73685-132">Differences between the development environments among the development team matter less once applications run in containers.</span></span>

<span data-ttu-id="73685-133">Nakonec kontejnerizované aplikací mít plošší křivky Škálováním na více systémů.</span><span class="sxs-lookup"><span data-stu-id="73685-133">Finally, containerized applications have a flatter scale-out curve.</span></span> <span data-ttu-id="73685-134">Je nutné učit jak kontejnerizované aplikací povolit více kontejnerů ve virtuálním počítači nebo více kontejnerů ve fyzickém počítači.</span><span class="sxs-lookup"><span data-stu-id="73685-134">You have learned how containerized apps enable more containers in a VM or more containers in a physical machine.</span></span> <span data-ttu-id="73685-135">Výsledkem je vyšší hustotu a méně požadované prostředky.</span><span class="sxs-lookup"><span data-stu-id="73685-135">This translates to higher density and fewer required resources.</span></span>

<span data-ttu-id="73685-136">Z těchto důvodů zvažte spuštění starší verze aplikace monolitický v kontejner Docker pomocí operace "navýšení a shift".</span><span class="sxs-lookup"><span data-stu-id="73685-136">For all these reasons, consider running legacy monolithic apps in a Docker container using a “lift-and-shift” operation.</span></span> <span data-ttu-id="73685-137">Frázi "navýšení a posunutí" popisuje oboru této úlohy: můžete *navýšení* z fyzický nebo virtuální počítač, bude celá aplikace a *shift* ho do kontejneru.</span><span class="sxs-lookup"><span data-stu-id="73685-137">The phrase “lift and shift” describes the scope of the task: you *lift* the entire application from a physical or virtual machine, and *shift* it into a container.</span></span> <span data-ttu-id="73685-138">V situacích, ideální není potřeba žádné změny kódu aplikace spouštět v kontejneru.</span><span class="sxs-lookup"><span data-stu-id="73685-138">In ideal situations, you do not need to make any changes to the application code to run it in a container.</span></span>

## <a name="possible-migration-paths"></a><span data-ttu-id="73685-139">Cesty možné migrace</span><span class="sxs-lookup"><span data-stu-id="73685-139">Possible migration paths</span></span>

<span data-ttu-id="73685-140">Jako monolitický aplikace je aplikace Catalog.Webforms jednu webovou aplikaci obsahující všechny kód, včetně knihovny přístup data.</span><span class="sxs-lookup"><span data-stu-id="73685-140">As a monolithic application, the Catalog.Webforms application is one web application containing all the code, including the data access libraries.</span></span> <span data-ttu-id="73685-141">Databáze se spustí na samostatný počítač vysokou dostupnost.</span><span class="sxs-lookup"><span data-stu-id="73685-141">The database runs on a separate high-availability machine.</span></span> <span data-ttu-id="73685-142">Tato konfigurace se simuluje v ukázkovém kódu pomocí mock katalogu služeb: Catalog.WebForms aplikaci můžete spustit u falešných dat k simulaci Čistý scénář navýšení a shift.</span><span class="sxs-lookup"><span data-stu-id="73685-142">That configuration is simulated in the sample code by using a mock catalog service: you can run the Catalog.WebForms application against that fake data to simulate a pure lift-and-shift scenario.</span></span> <span data-ttu-id="73685-143">Tento příklad ukazuje ta nejjednodušší cesta migrace, kde přesouváte existující prostředky se mají spustit v kontejneru beze změn kódu.</span><span class="sxs-lookup"><span data-stu-id="73685-143">This demonstrates the simplest migration path, where you move existing assets to run in a container without any code changes at all.</span></span> <span data-ttu-id="73685-144">Tato cesta je vhodný pro aplikace, které jsou dokončení a které mají minimálním interakci s funkcí, které přesouváte do mikroslužeb.</span><span class="sxs-lookup"><span data-stu-id="73685-144">This path is appropriate for applications that are complete and that have minimal interaction with functionality that you are moving to microservices.</span></span>

<span data-ttu-id="73685-145">Ale eShopOnContainers webu je již přístupu k ukládání dat pomocí mikroslužeb pro různé scénáře.</span><span class="sxs-lookup"><span data-stu-id="73685-145">However, the eShopOnContainers website is already accessing the data storage using microservices for different scenarios.</span></span> <span data-ttu-id="73685-146">Editor katalogu lze využít katalog mikroslužbu místo přístup k úložišti dat katalogu přímo malé další změny.</span><span class="sxs-lookup"><span data-stu-id="73685-146">Some small additional changes can be made to the catalog editor to leverage the catalog microservice instead of accessing the catalog data storage directly.</span></span>

<span data-ttu-id="73685-147">Tyto změny ukazují poměrně pro vaše vlastní aplikace.</span><span class="sxs-lookup"><span data-stu-id="73685-147">These changes demonstrate the continuum for your own applications.</span></span> <span data-ttu-id="73685-148">Můžete provést nic z přesunutí stávající aplikace bez změn do kontejnerů k provádění změn malá, které umožňují stávající aplikace pro přístup k některým nové mikroslužeb, na úplně přepisování plně podílet na novou aplikaci Architektura založená na mikroslužby.</span><span class="sxs-lookup"><span data-stu-id="73685-148">You can do anything from moving an existing application without change into containers, to making small changes that enable existing applications to access some of the new microservices, to completely rewriting an application to fully participate in a new microservice-based architecture.</span></span> <span data-ttu-id="73685-149">Správné cestě závisí na náklady migrace a výhody z žádné migrace.</span><span class="sxs-lookup"><span data-stu-id="73685-149">The right path depends on both the cost of the migration and the benefits from any migration.</span></span>

## <a name="application-tour"></a><span data-ttu-id="73685-150">Prohlídka aplikace</span><span class="sxs-lookup"><span data-stu-id="73685-150">Application tour</span></span>

<span data-ttu-id="73685-151">Můžete načíst Catalog.WebForms řešení a spuštění aplikace jako samostatné aplikace.</span><span class="sxs-lookup"><span data-stu-id="73685-151">You can load the Catalog.WebForms solution and run the application as a standalone application.</span></span> <span data-ttu-id="73685-152">V této konfiguraci místo trvalého úložiště databáze, aplikace používá falešných služby vrátit data.</span><span class="sxs-lookup"><span data-stu-id="73685-152">In this configuration, instead of a persistent storage database, the application uses a fake service to return data.</span></span> <span data-ttu-id="73685-153">Aplikace používá Autofac (<https://autofac.org/>) jako inverzi kontejneru ovládacích prvků (IOC).</span><span class="sxs-lookup"><span data-stu-id="73685-153">The application uses Autofac (<https://autofac.org/>) as an inversion of control (IOC) container.</span></span> <span data-ttu-id="73685-154">Pomocí vkládání závislostí (DI), můžete nakonfigurovat aplikaci, aby používala falešných dat nebo dat služby za provozu katalogu.</span><span class="sxs-lookup"><span data-stu-id="73685-154">Using Dependency Injection (DI), you can configure the application to use the fake data or the live catalog data service.</span></span> <span data-ttu-id="73685-155">(Vysvětlíme více o DI krátce.) Kód spuštění načte nastavení useFake ze souborů web.config a nakonfiguruje kontejneru Autofac vložení služba falešných dat nebo služba katalogu za provozu.</span><span class="sxs-lookup"><span data-stu-id="73685-155">(We will explain more about DI shortly.) The startup code reads a useFake setting from the web.config files, and configures the Autofac container to inject either the fake data service or the live catalog service.</span></span> <span data-ttu-id="73685-156">Pokud spouštíte aplikaci pomocí useFake nastavena na hodnotu false v souboru web.config, najdete v zobrazení katalogu dat aplikace webových formulářů.</span><span class="sxs-lookup"><span data-stu-id="73685-156">If you run the application with useFake set to false in the web.config file, you see the Web Forms application displaying the catalog data.</span></span>

<span data-ttu-id="73685-157">Většina postupy používané v této aplikaci by měla být velmi dobře každému uživateli, který byl použit webových formulářů.</span><span class="sxs-lookup"><span data-stu-id="73685-157">Most of the techniques used in this application should be very familiar to anyone who has used Web Forms.</span></span> <span data-ttu-id="73685-158">Ale mikroslužbu katalogu zavádí dvě techniky, které mohou být obeznámeni: závislost vkládání (DI), které již bylo zmíněno dříve, a práci s úložišti asynchronní dat webových formulářů.</span><span class="sxs-lookup"><span data-stu-id="73685-158">However, the catalog microservice introduces two techniques that might be unfamiliar: Dependency Injection (DI), which was mentioned earlier, and working with asynchronous data stores in Web Forms.</span></span>

<span data-ttu-id="73685-159">DI Invertuje výběr typické objektově orientované strategie zápisu třídy, které přidělují všechny potřebné prostředky.</span><span class="sxs-lookup"><span data-stu-id="73685-159">DI inverts the typical object-oriented strategy of writing classes that allocate all needed resources.</span></span> <span data-ttu-id="73685-160">Místo toho třídy žádosti závislé z kontejneru služby.</span><span class="sxs-lookup"><span data-stu-id="73685-160">Instead, classes request their dependencies from a service container.</span></span> <span data-ttu-id="73685-161">Výhodou DI je, že můžete nahradit externích služeb s fakes (mocks) pro podporu testování nebo jiných prostředích.</span><span class="sxs-lookup"><span data-stu-id="73685-161">The advantage of DI is that you can replace external services with fakes (mocks) to support testing or other environments.</span></span>

<span data-ttu-id="73685-162">Kontejner DI používá konfiguraci appSettings web.config řídit, jestli se má používat data falešných katalogu nebo dynamická data z spuštěné služby.</span><span class="sxs-lookup"><span data-stu-id="73685-162">The DI container uses the web.config appSettings configuration to control whether to use the fake catalog data or the live data from the running service.</span></span> <span data-ttu-id="73685-163">Aplikace registruje objekt modulu HTTP, který vytvoří kontejner a zaregistruje předběžné žádost o obslužnou rutinu vložení závislosti.</span><span class="sxs-lookup"><span data-stu-id="73685-163">The application registers an HttpModule object that builds the container and registers a pre-request handler to inject dependencies.</span></span> <span data-ttu-id="73685-164">Zobrazí se tento kód v souboru Modules/AutoFacHttpModule.cs, který vypadá jako v následujícím příkladu:</span><span class="sxs-lookup"><span data-stu-id="73685-164">You can see that code in the Modules/AutoFacHttpModule.cs file, which looks like the following example:</span></span>

```cs
private static IContainer CreateContainer()
{
  // Configure AutoFac:
  // Register Containers:

  var settings = WebConfigurationManager.AppSettings;
  var useFake = settings["usefake"];
  bool fake = useFake == "true";
  var builder = new ContainerBuilder();

  if (fake)
  {
    builder.RegisterType<CatalogMockService>()
    .As<ICatalogService>();
  }
  else
  {
    builder.RegisterType<CatalogService>()
    .As<ICatalogService>();
    builder.RegisterType<RequestProvider>()
    .As<IRequestProvider>();
  }

  var container = builder.Build();
  return container;
}

private void InjectDependencies()
{
  if (HttpContext.Current.CurrentHandler is Page page)
  {
    // Get the code-behind class that we may have written
    var pageType = page.GetType().BaseType;

    // Determine if there is a constructor to inject, and grab it
    var ctor = (from c in pageType.GetConstructors()
                where c.GetParameters().Length > 0
                select c).FirstOrDefault();

    if (ctor != null)
    {
      // Resolve the parameters for the constructor
      var args = (from parm in ctor.GetParameters()
                  select Container.Resolve(parm.ParameterType))
                  .ToArray();

      // Execute the constructor method with the arguments resolved
      ctor.Invoke(page, args);
    }

    // Use the Autofac method to inject any
    // properties that can be filled by Autofac
    Container.InjectProperties(page);
  }
}
```

<span data-ttu-id="73685-165">Stránky aplikace (Default.aspx.cs a EditPage.aspx.cs) definovat konstruktory, které provést tyto závislosti.</span><span class="sxs-lookup"><span data-stu-id="73685-165">The application’s pages (Default.aspx.cs and EditPage.aspx.cs) define constructors that take these dependencies.</span></span> <span data-ttu-id="73685-166">Všimněte si, že výchozí konstruktor je stále přítomen a přístupný.</span><span class="sxs-lookup"><span data-stu-id="73685-166">Note that the default constructor is still present and accessible.</span></span> <span data-ttu-id="73685-167">Infrastruktury musí následující kód.</span><span class="sxs-lookup"><span data-stu-id="73685-167">The infrastructure needs the following code.</span></span>

```cs
protected _Default() { }

public _Default(ICatalogService catalog) => this.catalog = catalog;
```

<span data-ttu-id="73685-168">Rozhraní API katalogu jsou všechny asynchronní metody.</span><span class="sxs-lookup"><span data-stu-id="73685-168">The catalog APIs are all asynchronous methods.</span></span> <span data-ttu-id="73685-169">Webové formuláře teď podporuje tyto pro všechny ovládací prvky data.</span><span class="sxs-lookup"><span data-stu-id="73685-169">Web Forms now supports these for all data controls.</span></span> <span data-ttu-id="73685-170">Aplikace Catalog.WebForms používá vazby modelu pro seznam a upravovat stránky; ovládací prvky na stránkách definovat metody SelectMethod, metoda UpdateMethod, metodu InsertMethod a metoda DeleteMethod vlastnosti, které určují vrácení úloh asynchronní operace.</span><span class="sxs-lookup"><span data-stu-id="73685-170">The Catalog.WebForms application uses model binding for the list and edit pages; controls on the pages define SelectMethod, UpdateMethod, InsertMethod, and DeleteMethod properties that specify Task-returning asynchronous operations.</span></span> <span data-ttu-id="73685-171">Web Forms – ovládací prvky pochopit, pokud se metody svázán s ovládacím asynchronní.</span><span class="sxs-lookup"><span data-stu-id="73685-171">Web Forms controls understand when the methods bound to a control are asynchronous.</span></span> <span data-ttu-id="73685-172">Pouze omezení dojde při použití asynchronních metod vyberte je, že nemůže podporovat stránkování.</span><span class="sxs-lookup"><span data-stu-id="73685-172">The only restriction you encounter when using asynchronous select methods is that you cannot support paging.</span></span> <span data-ttu-id="73685-173">Podpis stránkování vyžaduje parametr typu out a asynchronních metod nemůže mít výstupní parametry.</span><span class="sxs-lookup"><span data-stu-id="73685-173">The paging signature requires an out parameter, and asynchronous methods cannot have out parameters.</span></span> <span data-ttu-id="73685-174">Tento stejný postup se používá na jiných stránkách, které vyžadují dat ze služby katalogu.</span><span class="sxs-lookup"><span data-stu-id="73685-174">This same technique is used on other pages that require data from the catalog service.</span></span>

<span data-ttu-id="73685-175">Výchozí konfiguraci pro katalog aplikací webových formulářů využívá catalog.api služby imitovanou implementaci.</span><span class="sxs-lookup"><span data-stu-id="73685-175">The default configuration for the catalog Web Forms application uses a mock implementation of the catalog.api service.</span></span> <span data-ttu-id="73685-176">Tento model používá pevně zakódovaný datovou sadu pro svá data, která zjednodušuje některé úlohy odebráním závislosti na službu catalog.api ve vývojovém prostředí.</span><span class="sxs-lookup"><span data-stu-id="73685-176">This mock uses a hard-coded dataset for its data, which simplifies some tasks by removing the dependency on the catalog.api service in development environments.</span></span>

## <a name="lifting-and-shifting"></a><span data-ttu-id="73685-177">Zrušení a s posunem</span><span class="sxs-lookup"><span data-stu-id="73685-177">Lifting and shifting</span></span>

<span data-ttu-id="73685-178">Visual Studio poskytuje podpory pro containerizing aplikace.</span><span class="sxs-lookup"><span data-stu-id="73685-178">Visual Studio provides great support for containerizing an application.</span></span> <span data-ttu-id="73685-179">Klikněte pravým tlačítkem na uzel projektu a potom vyberte **přidat** a **Docker podporu**.</span><span class="sxs-lookup"><span data-stu-id="73685-179">You right-click the project node and then select **Add** and **Docker Support**.</span></span> <span data-ttu-id="73685-180">Šablona projektu Docker přidá nový projekt do řešení názvem **docker-tvoří**.</span><span class="sxs-lookup"><span data-stu-id="73685-180">The Docker project template adds a new project to the solution called **docker-compose**.</span></span> <span data-ttu-id="73685-181">Projekt obsahuje Docker prostředky, které tvoří (nebo sestavení) bitové kopie je třeba a spuštění nezbytné kontejnery, jak je znázorněno v obrázek 7-3.</span><span class="sxs-lookup"><span data-stu-id="73685-181">The project contains the Docker assets that compose (or build) the images you need, and starts running the necessary containers, as shown in Figure 7-3.</span></span>

<span data-ttu-id="73685-182">V nejjednodušší navýšení a shift scénářích aplikace bude jedné služby, který používáte pro aplikace webových formulářů.</span><span class="sxs-lookup"><span data-stu-id="73685-182">In the simplest lift-and-shift scenarios, the application will be the single service that you use for the Web Forms application.</span></span> <span data-ttu-id="73685-183">Šablona také změní spuštění projektu tak, aby odkazoval **docker compose** projektu.</span><span class="sxs-lookup"><span data-stu-id="73685-183">The template also changes your startup project to point to the **docker-compose** project.</span></span> <span data-ttu-id="73685-184">Kombinace kláves Ctrl + F5 nebo F5 nyní vytvoří bitovou kopii Docker a spustí kontejner Docker.</span><span class="sxs-lookup"><span data-stu-id="73685-184">Pressing Ctrl+F5 or F5 now creates the Docker image and launches the Docker container.</span></span>

![](./media/image3.png)

<span data-ttu-id="73685-185">**Obrázek 7-3**.</span><span class="sxs-lookup"><span data-stu-id="73685-185">**Figure 7-3**.</span></span> <span data-ttu-id="73685-186">**Docker compose** projekt v řešení webové formuláře</span><span class="sxs-lookup"><span data-stu-id="73685-186">The **docker-compose** project in the Web Forms solution</span></span>

<span data-ttu-id="73685-187">Než spustíte řešení, musí se ujistěte, nakonfigurovat Docker k použití Windows kontejnerů.</span><span class="sxs-lookup"><span data-stu-id="73685-187">Before you run the solution, you must make sure that you configure Docker to use Windows Containers.</span></span> <span data-ttu-id="73685-188">K tomu, kliknete pravým tlačítkem na hlavním panelu ikonu Docker v systému Windows a vyberte **přepnout do kontejnerů Windows**, jak je znázorněno na obrázku 7 – 4.</span><span class="sxs-lookup"><span data-stu-id="73685-188">To do that, you right-click the Docker taskbar icon in Windows and select **Switch to Windows Containers**, as shown in Figure 7-4.</span></span>

![](./media/image4.png)

<span data-ttu-id="73685-189">**Obrázek 7-4**.</span><span class="sxs-lookup"><span data-stu-id="73685-189">**Figure 7-4**.</span></span> <span data-ttu-id="73685-190">Přepnutí do kontejneru systému Windows z na hlavním panelu ikonu Docker v systému Windows</span><span class="sxs-lookup"><span data-stu-id="73685-190">Switching to Windows Containers from the Docker taskbar icon in Windows</span></span>

<span data-ttu-id="73685-191">Pokud je zobrazeno položky nabídky **přepnout do kontejnerů Linux**, již používáte Docker s kontejnery Windows.</span><span class="sxs-lookup"><span data-stu-id="73685-191">If the menu item says **Switch to Linux containers**, you are already running Docker with Windows Containers.</span></span>

<span data-ttu-id="73685-192">Spuštění řešení restartuje Docker hostitele.</span><span class="sxs-lookup"><span data-stu-id="73685-192">Running the solution restarts the Docker host.</span></span> <span data-ttu-id="73685-193">Když vytvoříte, vytvoříte aplikaci a bitovou kopii Docker pro projekt webové formuláře.</span><span class="sxs-lookup"><span data-stu-id="73685-193">When you build, you build the application and the Docker image for the Web Forms project.</span></span> <span data-ttu-id="73685-194">Při prvním to trvá mnoho času.</span><span class="sxs-lookup"><span data-stu-id="73685-194">The first time you do this, it takes considerable time.</span></span> <span data-ttu-id="73685-195">To je proto procesu sestavení vrátí základní bitovou kopii systému Windows Server a další bitovou kopii pro technologii ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="73685-195">This is because the build process pulls down the base Windows Server image and the additional image for ASP.NET.</span></span> <span data-ttu-id="73685-196">Následující sestavení a spuštění cykly bude mnohem rychlejší.</span><span class="sxs-lookup"><span data-stu-id="73685-196">Subsequent build and run cycles will be much faster.</span></span>

<span data-ttu-id="73685-197">Podívejme se hlubší na soubory přidal Docker v šabloně projektů.</span><span class="sxs-lookup"><span data-stu-id="73685-197">Let’s take a deeper look at the files added by the Docker project template.</span></span> <span data-ttu-id="73685-198">Můžete ho vytvořit několik souborů.</span><span class="sxs-lookup"><span data-stu-id="73685-198">It created several files for you.</span></span> <span data-ttu-id="73685-199">Visual Studio použije tyto soubory vytvořit bitovou kopii Docker a spusťte kontejner.</span><span class="sxs-lookup"><span data-stu-id="73685-199">Visual Studio uses these files to create the Docker image and launch a container.</span></span> <span data-ttu-id="73685-200">Stejné soubory, které z rozhraní příkazového řádku můžete použít ke spuštění příkazů Docker ručně.</span><span class="sxs-lookup"><span data-stu-id="73685-200">You can use the same files from the CLI to run Docker commands manually.</span></span>

<span data-ttu-id="73685-201">Následující příklad soubor Docker ukazuje základní nastavení pro vytváření obrazem Docker na základě bitové kopie Windows ASP.NET, který spouští stránku ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="73685-201">The following Dockerfile example shows the basic settings for building a Docker image based on the Windows ASP.NET image that runs an ASP.NET site.</span></span>

```
FROM microsoft/aspnet

ARG source

WORKDIR /inetpub/wwwroot

COPY ${source:-obj/Docker/publish} .
```

<span data-ttu-id="73685-202">Tento soubor Docker bude vypadat velmi podobné těm, které jsou vytvořené pro spouštění aplikací ASP.NET Core v kontejnerech Linux.</span><span class="sxs-lookup"><span data-stu-id="73685-202">This Dockerfile will look very similar to those created for running an ASP.NET Core application in Linux containers.</span></span> <span data-ttu-id="73685-203">Existují však několik důležitých rozdílů.</span><span class="sxs-lookup"><span data-stu-id="73685-203">However, there are a few important differences.</span></span> <span data-ttu-id="73685-204">Nejdůležitější rozdíl je, že základní bitová kopie je společnosti microsoft nebo aspnet, který je aktuální image systému Windows Server, který zahrnuje rozhraní .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="73685-204">The most important difference is that the base image is microsoft/aspnet, which is the current Windows Server image that includes the .NET Framework.</span></span> <span data-ttu-id="73685-205">Další rozdíly jsou, že adresáře zkopírovali ze zdrojového adresáře se liší.</span><span class="sxs-lookup"><span data-stu-id="73685-205">Other differences are that the directories copied from your source directory are different.</span></span>

<span data-ttu-id="73685-206">Další soubory v **docker-tvoří** projektu jsou Docker prostředky potřebné k vytváření a konfigurace kontejnerů.</span><span class="sxs-lookup"><span data-stu-id="73685-206">The other files in the **docker-compose** project are the Docker assets needed to build and configure the containers.</span></span> <span data-ttu-id="73685-207">Visual Studio umísťuje různé soubory docker-compose.yml v rámci jednoho uzlu, abyste měli na očích, jak se používají.</span><span class="sxs-lookup"><span data-stu-id="73685-207">Visual Studio puts the various docker-compose.yml files under one node to highlight how they are used.</span></span> <span data-ttu-id="73685-208">Základní docker-compose soubor obsahuje direktivy, které jsou společné pro všechny konfigurace.</span><span class="sxs-lookup"><span data-stu-id="73685-208">The base docker-compose file contains the directives that are common to all configurations.</span></span> <span data-ttu-id="73685-209">Soubor docker-compose.override.yml obsahuje proměnné prostředí a související přepsání pro vývojáře konfigurace.</span><span class="sxs-lookup"><span data-stu-id="73685-209">The docker-compose.override.yml file contains environment variables and related overrides for a developer configuration.</span></span> <span data-ttu-id="73685-210">Variant s. vs.debug a. vs.release zadejte nastavení prostředí, které chcete přiřadit a spravovat kontejneru spuštěné Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="73685-210">The variants with .vs.debug and .vs.release provide environment settings that enable Visual Studio to attach to and manage the running container.</span></span>

<span data-ttu-id="73685-211">Integrace sady Visual Studio je součást přidání podpory Docker do vašeho řešení, můžete také sestavit a spustit z příkazového řádku pomocí docker-tvoří až příkaz, protože jste viděli v předchozích částech.</span><span class="sxs-lookup"><span data-stu-id="73685-211">While Visual Studio integration is part of adding Docker support to your solution, you can also build and run from the command line, using the docker-compose up command, as you saw in previous sections.</span></span>

## <a name="getting-data-from-the-existing-catalog-net-core-microservice"></a><span data-ttu-id="73685-212">Získání dat z existující mikroslužbu .NET Core katalogu</span><span class="sxs-lookup"><span data-stu-id="73685-212">Getting data from the existing catalog .NET Core microservice</span></span>

<span data-ttu-id="73685-213">Webové formuláře aplikace pro používání mikroslužbu katalogu eShopOnContainers k získání dat místo použití falešných dat můžete nakonfigurovat.</span><span class="sxs-lookup"><span data-stu-id="73685-213">You can configure the Web Forms application to use the eShopOnContainers catalog microservice to get data instead of using fake data.</span></span> <span data-ttu-id="73685-214">K tomu, upravte soubor web.config a nastavte hodnotu klíče useFake na hodnotu false.</span><span class="sxs-lookup"><span data-stu-id="73685-214">To do this, you edit the web.config file and set the value of the useFake key to false.</span></span> <span data-ttu-id="73685-215">Kontejner DI použije třídu, která přistupuje k provozu katalogu mikroslužbu místo třídu, která vrátí data o pevně.</span><span class="sxs-lookup"><span data-stu-id="73685-215">The DI container will use the class that accesses the live catalog microservice instead of the class that returns the hard-coded data.</span></span> <span data-ttu-id="73685-216">Je potřeba žádné další změny kódu.</span><span class="sxs-lookup"><span data-stu-id="73685-216">No other code changes are needed.</span></span>

<span data-ttu-id="73685-217">Přístup k službě za provozu katalogu znamená musíte aktualizovat **docker compose** projektu sestavení obrázek katalogu služby a spusťte kontejner služby katalogu.</span><span class="sxs-lookup"><span data-stu-id="73685-217">Accessing the live catalog service does mean you need to update the **docker-compose** project to build the catalog service image and launch the catalog service container.</span></span> <span data-ttu-id="73685-218">Docker CE pro Windows podporuje kontejnery Linux a Windows kontejnery, ale není ve stejnou dobu.</span><span class="sxs-lookup"><span data-stu-id="73685-218">Docker CE for Windows supports both Linux containers and Windows Containers, but not at the same time.</span></span> <span data-ttu-id="73685-219">Pokud chcete spustit mikroslužbu katalogu, budete muset vytvořit bitovou kopii používající mikroslužbu katalogu na vrcholku kontejneru se systémem Windows.</span><span class="sxs-lookup"><span data-stu-id="73685-219">To run the catalog microservice, you need to build an image that runs the catalog microservice on top of a Windows-based container.</span></span> <span data-ttu-id="73685-220">Tento přístup vyžaduje jiný soubor Docker mikroslužeb projektu, než jste viděli v předchozích částech.</span><span class="sxs-lookup"><span data-stu-id="73685-220">This approach requires a different Dockerfile for the microservices project than you have seen in earlier sections.</span></span> <span data-ttu-id="73685-221">Soubor Dockerfile.windows obsahuje konfigurační nastavení k vytvoření bitové kopie kontejneru katalogu rozhraní API, tak, aby běžel v kontejneru systému Windows – například použít bitovou kopii systému Windows Nano Docker.</span><span class="sxs-lookup"><span data-stu-id="73685-221">The Dockerfile.windows file contains the configuration settings to build the catalog API container image so that it runs on a Windows container—for example, to use a Windows Nano Docker image.</span></span>

<span data-ttu-id="73685-222">Mikroslužbu katalogu spoléhá na databázi systému SQL Server.</span><span class="sxs-lookup"><span data-stu-id="73685-222">The catalog microservice relies on the SQL Server database.</span></span> <span data-ttu-id="73685-223">Proto musíte použít také bitovou kopii systému Windows Docker SQL Server.</span><span class="sxs-lookup"><span data-stu-id="73685-223">Therefore, you need to use a Windows-based SQL Server Docker image as well.</span></span>

<span data-ttu-id="73685-224">Po provedení těchto změn projektu docker-compose nepodporuje více a spusťte aplikaci.</span><span class="sxs-lookup"><span data-stu-id="73685-224">After these changes, the docker-compose project does more to start the application.</span></span> <span data-ttu-id="73685-225">Projekt spustí serveru SQL pomocí bitové kopie založené na systému SQL Server systému Windows.</span><span class="sxs-lookup"><span data-stu-id="73685-225">The project now starts the SQL Server using the Windows based SQL Server image.</span></span> <span data-ttu-id="73685-226">Spustí mikroslužbu katalogu v kontejneru systému Windows.</span><span class="sxs-lookup"><span data-stu-id="73685-226">It starts the catalog microservice in a Windows container.</span></span> <span data-ttu-id="73685-227">A začne kontejneru editor katalogu webových formulářů také v kontejneru systému Windows.</span><span class="sxs-lookup"><span data-stu-id="73685-227">And it starts the Web Forms catalog editor container, also in a Windows container.</span></span> <span data-ttu-id="73685-228">Pokud žádné z bitové kopie potřebovat sestavení, jsou nejprve vytvoření bitové kopie.</span><span class="sxs-lookup"><span data-stu-id="73685-228">If any of the images need building, the images are created first.</span></span>

## <a name="development-and-production-environments"></a><span data-ttu-id="73685-229">Vývoj a produkční prostředí</span><span class="sxs-lookup"><span data-stu-id="73685-229">Development and production environments</span></span>

<span data-ttu-id="73685-230">Existuje několik rozdílů mezi vývoj konfigurace a konfiguraci výroby.</span><span class="sxs-lookup"><span data-stu-id="73685-230">There are a couple of differences between the development configuration and a production configuration.</span></span> <span data-ttu-id="73685-231">Ve vývojovém prostředí spusťte aplikace webových formulářů, mikroslužbu katalogu a SQL Server v systému Windows kontejnery v rámci stejného hostitele Docker.</span><span class="sxs-lookup"><span data-stu-id="73685-231">In the development environment, you run the Web Forms application, the catalog microservice, and SQL Server in Windows Containers, as part of the same Docker host.</span></span> <span data-ttu-id="73685-232">V předchozích částech jsme uvedených nasazené bitové kopie systému SQL Server na stejném hostiteli Docker jako jiných služeb založených na .NET Core hostiteli Docker systémem Linux.</span><span class="sxs-lookup"><span data-stu-id="73685-232">In earlier sections, we mentioned SQL Server images deployed in the same Docker host as the other .NET Core-based services on a Linux-based Docker host.</span></span> <span data-ttu-id="73685-233">Výhodou spuštění více mikroslužeb ve stejném hostiteli Docker (nebo v clusteru) je menší síťovou komunikaci a komunikace mezi kontejnery má nižší latenci.</span><span class="sxs-lookup"><span data-stu-id="73685-233">The advantage of running the multiple microservices in the same Docker host (or cluster) is that there is less network communication and the communication between containers has lower latency.</span></span>

<span data-ttu-id="73685-234">Ve vývojovém prostředí je nutné spustit všechny kontejnery v stejné operačního systému.</span><span class="sxs-lookup"><span data-stu-id="73685-234">In the development environment, you must run all the containers in the same OS.</span></span> <span data-ttu-id="73685-235">CE docker pro systém Windows nepodporuje spuštěných kontejnerů systémem Windows a Linux ve stejnou dobu.</span><span class="sxs-lookup"><span data-stu-id="73685-235">Docker CE for Windows does not support running Windows- and Linux-based containers at the same time.</span></span> <span data-ttu-id="73685-236">V produkčním prostředí můžete rozhodnout, pokud chcete spustit mikroslužbu katalogu v kontejneru systému Windows v jednom Docker hostiteli (nebo clusteru), nebo můžete nechat webových formulářů, aplikace komunikovat s instancí mikroslužbu katalogu spuštěnému v kontejneru Linux na jiné Docker hostitele.</span><span class="sxs-lookup"><span data-stu-id="73685-236">In production, you can decide if you want to run the catalog microservice in a Windows container in a single Docker host (or cluster), or have the Web Forms application communicate with an instance of the catalog microservice running in a Linux container on a different Docker host.</span></span> <span data-ttu-id="73685-237">To závisí na tom, jak chcete optimalizovat pro latenci sítě.</span><span class="sxs-lookup"><span data-stu-id="73685-237">It depends on how you want to optimize for network latency.</span></span> <span data-ttu-id="73685-238">Ve většině případů budete chtít mikroslužeb, které vaše aplikace závisí na spouštění v stejného Docker hostitele (nebo swarm) pro snadné nasazení a menší latence komunikace.</span><span class="sxs-lookup"><span data-stu-id="73685-238">In most cases, you want the microservices that your applications depend on running in the same Docker host (or swarm) for ease of deployment and lower communication latency.</span></span> <span data-ttu-id="73685-239">V těchto konfiguracích je pouze nákladná komunikace mezi instancemi mikroslužbu a vysokou dostupnost serverů pro trvalé úložiště.</span><span class="sxs-lookup"><span data-stu-id="73685-239">In those configurations, the only costly communications is between the microservice instances and the high-availability servers for the persistent data storage.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="73685-240">[Předchozí] (.. / net-core-single-containers-linux-windows-server-hosts/index.md) [Další] (.. /Multi-Container-microservice-NET-Applications/index.MD)</span><span class="sxs-lookup"><span data-stu-id="73685-240">[Previous] (../net-core-single-containers-linux-windows-server-hosts/index.md) [Next] (../multi-container-microservice-net-applications/index.md)</span></span>
