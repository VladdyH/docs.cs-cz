---
title: Úvod do PLINQ
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- PLINQ queries, introduction to
ms.assetid: eaa720d8-8999-4eb7-8df5-3c19ca61cad0
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 173efcf485d5eb019b22a329a9d96b5cbe6a2f3e
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 05/04/2018
ms.locfileid: "33592298"
---
# <a name="introduction-to-plinq"></a><span data-ttu-id="342c2-102">Úvod do PLINQ</span><span class="sxs-lookup"><span data-stu-id="342c2-102">Introduction to PLINQ</span></span>
## <a name="what-is-a-parallel-query"></a><span data-ttu-id="342c2-103">Co je paralelní dotaz?</span><span class="sxs-lookup"><span data-stu-id="342c2-103">What is a Parallel Query?</span></span>  
 <span data-ttu-id="342c2-104">Language-Integrated Query (LINQ) byla zavedená v [!INCLUDE[net_v35_long](../../../includes/net-v35-long-md.md)].</span><span class="sxs-lookup"><span data-stu-id="342c2-104">Language-Integrated Query (LINQ) was introduced in the [!INCLUDE[net_v35_long](../../../includes/net-v35-long-md.md)].</span></span>  <span data-ttu-id="342c2-105">Jeho součástí jsou jednotný model pro dotazování žádné <xref:System.Collections.IEnumerable?displayProperty=nameWithType> nebo <xref:System.Collections.Generic.IEnumerable%601?displayProperty=nameWithType> zdroj dat způsobem bezpečnost typů.</span><span class="sxs-lookup"><span data-stu-id="342c2-105">It features a unified model for querying any <xref:System.Collections.IEnumerable?displayProperty=nameWithType> or <xref:System.Collections.Generic.IEnumerable%601?displayProperty=nameWithType> data source in a type-safe manner.</span></span> <span data-ttu-id="342c2-106">LINQ na objekty je název pro LINQ dotazů, které jsou spouštěny proti kolekci v paměti, jako například <xref:System.Collections.Generic.List%601> a pole.</span><span class="sxs-lookup"><span data-stu-id="342c2-106">LINQ to Objects is the name for LINQ queries that are run against in-memory collections such as <xref:System.Collections.Generic.List%601> and arrays.</span></span> <span data-ttu-id="342c2-107">Tento článek předpokládá, že máte základní znalosti o LINQ.</span><span class="sxs-lookup"><span data-stu-id="342c2-107">This article assumes that you have a basic understanding of LINQ.</span></span> <span data-ttu-id="342c2-108">Další informace najdete v tématu [LINQ (Language-Integrated Query)](https://msdn.microsoft.com/library/a73c4aec-5d15-4e98-b962-1274021ea93d).</span><span class="sxs-lookup"><span data-stu-id="342c2-108">For more information, see [LINQ (Language-Integrated Query)](https://msdn.microsoft.com/library/a73c4aec-5d15-4e98-b962-1274021ea93d).</span></span>  
  
 <span data-ttu-id="342c2-109">Paralelní LINQ (PLINQ) je paralelní provádění vzoru LINQ.</span><span class="sxs-lookup"><span data-stu-id="342c2-109">Parallel LINQ (PLINQ) is a parallel implementation of the LINQ pattern.</span></span> <span data-ttu-id="342c2-110">PLINQ dotazu v mnoha směrech se podobá nejsou rovnoběžné dotazu LINQ to objekty.</span><span class="sxs-lookup"><span data-stu-id="342c2-110">A PLINQ query in many ways resembles a non-parallel LINQ to Objects query.</span></span> <span data-ttu-id="342c2-111">Dotazy PLINQ, stejně jako sekvenční [!INCLUDE[vbteclinq](../../../includes/vbteclinq-md.md)] dotazy, pracují na všech paměťových <xref:System.Collections.IEnumerable> nebo <xref:System.Collections.Generic.IEnumerable%601> datového zdroje a mají odložené spouštění, což znamená, se nespustí dříve než dotaz zpracován.</span><span class="sxs-lookup"><span data-stu-id="342c2-111">PLINQ queries, just like sequential [!INCLUDE[vbteclinq](../../../includes/vbteclinq-md.md)] queries, operate on any in-memory <xref:System.Collections.IEnumerable> or <xref:System.Collections.Generic.IEnumerable%601> data source, and have deferred execution, which means they do not begin executing until the query is enumerated.</span></span> <span data-ttu-id="342c2-112">Základní rozdíl je, že PLINQ pokusí plně využívat všechny procesory systému.</span><span class="sxs-lookup"><span data-stu-id="342c2-112">The primary difference is that PLINQ attempts to make full use of all the processors on the system.</span></span> <span data-ttu-id="342c2-113">Dělá to pomocí vytváření oddílů zdroje dat do segmentů a spouštění dotazu v každém segmentu na samostatné pracovních vláken paralelně na více procesorů.</span><span class="sxs-lookup"><span data-stu-id="342c2-113">It does this by partitioning the data source into segments, and then executing the query on each segment on separate worker threads in parallel on multiple processors.</span></span> <span data-ttu-id="342c2-114">V mnoha případech paralelní provádění znamená, že spuštění dotazu výrazně rychlejší.</span><span class="sxs-lookup"><span data-stu-id="342c2-114">In many cases, parallel execution means that the query runs significantly faster.</span></span>  
  
 <span data-ttu-id="342c2-115">Prostřednictvím paralelní provádění PLINQ může dosáhnout výrazné vylepšení výkonu než starší kód pro určité typy dotazů, často pouze přidáním <xref:System.Linq.ParallelEnumerable.AsParallel%2A> operace ke zdroji dat dotazů.</span><span class="sxs-lookup"><span data-stu-id="342c2-115">Through parallel execution, PLINQ can achieve significant performance improvements over legacy code for certain kinds of queries, often just by adding the <xref:System.Linq.ParallelEnumerable.AsParallel%2A> query operation to the data source.</span></span> <span data-ttu-id="342c2-116">Ale paralelismus můžete zavádět vlastní složitosti a ne všechny operace dotazů běží rychleji v PLINQ.</span><span class="sxs-lookup"><span data-stu-id="342c2-116">However, parallelism can introduce its own complexities, and not all query operations run faster in PLINQ.</span></span> <span data-ttu-id="342c2-117">Ve skutečnosti paralelizace může zpomalit některé dotazy.</span><span class="sxs-lookup"><span data-stu-id="342c2-117">In fact, parallelization actually slows down certain queries.</span></span> <span data-ttu-id="342c2-118">Proto byste měli porozumět, jak například třídění ovlivní paralelní dotazy.</span><span class="sxs-lookup"><span data-stu-id="342c2-118">Therefore, you should understand how issues such as ordering affect parallel queries.</span></span> <span data-ttu-id="342c2-119">Další informace najdete v tématu [porozumění zrychlení v PLINQ](../../../docs/standard/parallel-programming/understanding-speedup-in-plinq.md).</span><span class="sxs-lookup"><span data-stu-id="342c2-119">For more information, see [Understanding Speedup in PLINQ](../../../docs/standard/parallel-programming/understanding-speedup-in-plinq.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="342c2-120">Tato dokumentace používá k definování delegátů v PLINQ výrazy lambda.</span><span class="sxs-lookup"><span data-stu-id="342c2-120">This documentation uses lambda expressions to define delegates in PLINQ.</span></span> <span data-ttu-id="342c2-121">Pokud nejste obeznámeni s výrazy lambda v jazyce C# nebo Visual Basic, přečtěte si téma [výrazy Lambda v PLINQ a TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md).</span><span class="sxs-lookup"><span data-stu-id="342c2-121">If you are not familiar with lambda expressions in C# or Visual Basic, see [Lambda Expressions in PLINQ and TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md).</span></span>  
  
 <span data-ttu-id="342c2-122">Zbývající část tohoto článku bude stručně charakterizovat hlavní třídy PLINQ a popisuje, jak vytvořit dotazy PLINQ.</span><span class="sxs-lookup"><span data-stu-id="342c2-122">The remainder of this article gives an overview of the main PLINQ classes, and discusses how to create PLINQ queries.</span></span> <span data-ttu-id="342c2-123">Každá část obsahuje odkazy na podrobnější informace a ukázky kódu.</span><span class="sxs-lookup"><span data-stu-id="342c2-123">Each section contains links to more detailed information and code examples.</span></span>  
  
## <a name="the-parallelenumerable-class"></a><span data-ttu-id="342c2-124">Třída ParallelEnumerable</span><span class="sxs-lookup"><span data-stu-id="342c2-124">The ParallelEnumerable Class</span></span>  
 <span data-ttu-id="342c2-125"><xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType> Třída zpřístupňuje téměř všechny funkce PLINQ.</span><span class="sxs-lookup"><span data-stu-id="342c2-125">The <xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType> class exposes almost all of PLINQ's functionality.</span></span>  <span data-ttu-id="342c2-126">To a zbytek <xref:System.Linq?displayProperty=nameWithType> obor názvů je kompilovány do sestavení System.Core.dll.</span><span class="sxs-lookup"><span data-stu-id="342c2-126">It and the rest of the <xref:System.Linq?displayProperty=nameWithType> namespace types are compiled into the System.Core.dll assembly.</span></span> <span data-ttu-id="342c2-127">Výchozí projektů C# a Visual Basic v sadě Visual Studio referenční sestavení a importovat obor názvů.</span><span class="sxs-lookup"><span data-stu-id="342c2-127">The default C# and Visual Basic projects in Visual Studio both reference the assembly and import the namespace.</span></span>  
  
 <span data-ttu-id="342c2-128"><xref:System.Linq.ParallelEnumerable> zahrnuje implementace všechny operátory standardní dotazu, které podporuje LINQ na objekty, i když se nepokusí učinit paralelní každé z nich.</span><span class="sxs-lookup"><span data-stu-id="342c2-128"><xref:System.Linq.ParallelEnumerable> includes implementations of all the standard query operators that LINQ to Objects supports, although it does not attempt to parallelize each one.</span></span> <span data-ttu-id="342c2-129">Pokud nejste obeznámeni s [!INCLUDE[vbteclinq](../../../includes/vbteclinq-md.md)], najdete v části [Úvod do LINQ](https://msdn.microsoft.com/library/24dddf19-12a0-4707-a4bc-eba4fa7f219e).</span><span class="sxs-lookup"><span data-stu-id="342c2-129">If you are not familiar with [!INCLUDE[vbteclinq](../../../includes/vbteclinq-md.md)], see [Introduction to LINQ](https://msdn.microsoft.com/library/24dddf19-12a0-4707-a4bc-eba4fa7f219e).</span></span>  
  
 <span data-ttu-id="342c2-130">Kromě standardní operátory dotazu <xref:System.Linq.ParallelEnumerable> třída obsahuje sadu metody, které umožňují specifické chování pro paralelní zpracování.</span><span class="sxs-lookup"><span data-stu-id="342c2-130">In addition to the standard query operators, the <xref:System.Linq.ParallelEnumerable> class contains a set of methods that enable behaviors specific to parallel execution.</span></span> <span data-ttu-id="342c2-131">Tyto metody specifické pro PLINQ jsou uvedeny v následující tabulce.</span><span class="sxs-lookup"><span data-stu-id="342c2-131">These PLINQ-specific methods are listed in the following table.</span></span>  
  
|<span data-ttu-id="342c2-132">Operátor ParallelEnumerable</span><span class="sxs-lookup"><span data-stu-id="342c2-132">ParallelEnumerable Operator</span></span>|<span data-ttu-id="342c2-133">Popis</span><span class="sxs-lookup"><span data-stu-id="342c2-133">Description</span></span>|  
|---------------------------------|-----------------|  
|<xref:System.Linq.ParallelEnumerable.AsParallel%2A>|<span data-ttu-id="342c2-134">Vstupní bod pro PLINQ.</span><span class="sxs-lookup"><span data-stu-id="342c2-134">The entry point for PLINQ.</span></span> <span data-ttu-id="342c2-135">Určuje, že by měl být paralelizovaná několika málo zbytkem dotazu, pokud je to možné.</span><span class="sxs-lookup"><span data-stu-id="342c2-135">Specifies that the rest of the query should be parallelized, if it is possible.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.AsSequential%2A>|<span data-ttu-id="342c2-136">Určuje, že zbývajícím částem dotazu by měl být spuštěn postupně, jako jiný paralelní dotaz LINQ.</span><span class="sxs-lookup"><span data-stu-id="342c2-136">Specifies that the rest of the query should be run sequentially, as a non-parallel LINQ query.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.AsOrdered%2A>|<span data-ttu-id="342c2-137">Určuje, že by měl PLINQ zachování pořadí zdrojové sekvence pro zbývající dotazu, nebo dokud řazení se nezmění, například pomocí klauzule orderby (Order by Vlsual Basic).</span><span class="sxs-lookup"><span data-stu-id="342c2-137">Specifies that PLINQ should preserve the ordering of the source sequence for the rest of the query, or until the ordering is changed, for example by the use of an orderby (Order By in Vlsual Basic) clause.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.AsUnordered%2A>|<span data-ttu-id="342c2-138">Určuje, že PLINQ pro zbytek dotaz není potřeba zachovat řazení zdrojové sekvence.</span><span class="sxs-lookup"><span data-stu-id="342c2-138">Specifies that PLINQ for the rest of the query is not required to preserve the ordering of the source sequence.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.WithCancellation%2A>|<span data-ttu-id="342c2-139">Určuje, že by měl PLINQ pravidelně sledovat stav token poskytnutý zrušení a zrušit provádění, pokud se vyžaduje.</span><span class="sxs-lookup"><span data-stu-id="342c2-139">Specifies that PLINQ should periodically monitor the state of the provided cancellation token and cancel execution if it is requested.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.WithDegreeOfParallelism%2A>|<span data-ttu-id="342c2-140">Určuje maximální počet procesorů, které by měl PLINQ používat učinit paralelní dotaz.</span><span class="sxs-lookup"><span data-stu-id="342c2-140">Specifies the maximum number of processors that PLINQ should use to parallelize the query.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.WithMergeOptions%2A>|<span data-ttu-id="342c2-141">Poskytuje informace o tom, jak by měl PLINQ, pokud je to možné, sloučit paralelní výsledky do jediné sekvence spotřebitelské vlákno.</span><span class="sxs-lookup"><span data-stu-id="342c2-141">Provides a hint about how PLINQ should, if it is possible, merge parallel results back into just one sequence on the consuming thread.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.WithExecutionMode%2A>|<span data-ttu-id="342c2-142">Určuje, zda by měl PLINQ paralelní dotaz i v případě, že by mohla být výchozí chování spouští sekvenčně.</span><span class="sxs-lookup"><span data-stu-id="342c2-142">Specifies whether PLINQ should parallelize the query even when the default behavior would be to run it sequentially.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.ForAll%2A>|<span data-ttu-id="342c2-143">Vícevláknové výčtu metoda umožňující, na rozdíl od iterování přes výsledky dotazu, výsledky mají být zpracovány současně bez předchozího sloučení zpět k příjemce vlákno.</span><span class="sxs-lookup"><span data-stu-id="342c2-143">A multithreaded enumeration method that, unlike iterating over the results of the query, enables results to be processed in parallel without first merging back to the consumer thread.</span></span>|  
|<span data-ttu-id="342c2-144"><xref:System.Linq.ParallelEnumerable.Aggregate%2A> Přetížení</span><span class="sxs-lookup"><span data-stu-id="342c2-144"><xref:System.Linq.ParallelEnumerable.Aggregate%2A> overload</span></span>|<span data-ttu-id="342c2-145">Přetížení, které jsou jedinečné pro PLINQ a umožňuje přechodnou agregaci přes místní oddíly plus finální agregační funkce, která se kombinují výsledky všech oddílů.</span><span class="sxs-lookup"><span data-stu-id="342c2-145">An overload that is unique to PLINQ and enables intermediate aggregation over thread-local partitions, plus a final aggregation function to combine the results of all partitions.</span></span>|  
  
## <a name="the-opt-in-model"></a><span data-ttu-id="342c2-146">Model přidání</span><span class="sxs-lookup"><span data-stu-id="342c2-146">The Opt-in Model</span></span>  
 <span data-ttu-id="342c2-147">Při psaní dotazu vyjádřit výslovný souhlas pro PLINQ vyvoláním <xref:System.Linq.ParallelEnumerable.AsParallel%2A?displayProperty=nameWithType> rozšiřující metody na zdroji dat, jak je znázorněno v následujícím příkladu.</span><span class="sxs-lookup"><span data-stu-id="342c2-147">When you write a query, opt in to PLINQ by invoking the <xref:System.Linq.ParallelEnumerable.AsParallel%2A?displayProperty=nameWithType> extension method on the data source, as shown in the following example.</span></span>  
  
 [!code-csharp[PLINQ#1](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinq2_cs.cs#1)]
 [!code-vb[PLINQ#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinq2_vb.vb#1)]  
  
 <span data-ttu-id="342c2-148"><xref:System.Linq.ParallelEnumerable.AsParallel%2A> Metoda rozšíření váže operátory pro následné dotazování, v takovém případě `where` a `select`do <xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType> implementace.</span><span class="sxs-lookup"><span data-stu-id="342c2-148">The <xref:System.Linq.ParallelEnumerable.AsParallel%2A> extension method binds the subsequent query operators, in this case, `where` and `select`, to the <xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType> implementations.</span></span>  
  
## <a name="execution-modes"></a><span data-ttu-id="342c2-149">Režim spuštění</span><span class="sxs-lookup"><span data-stu-id="342c2-149">Execution Modes</span></span>  
 <span data-ttu-id="342c2-150">Ve výchozím nastavení je PLINQ konzervativní.</span><span class="sxs-lookup"><span data-stu-id="342c2-150">By default, PLINQ is conservative.</span></span> <span data-ttu-id="342c2-151">V době běhu PLINQ infrastruktura analyzuje celková struktura dotazu.</span><span class="sxs-lookup"><span data-stu-id="342c2-151">At run time, the PLINQ infrastructure analyzes the overall structure of the query.</span></span> <span data-ttu-id="342c2-152">Pokud je dotaz pravděpodobně paralelizací podle paralelizace, oddíly PLINQ zdrojové sekvence do úlohy, které můžou běžet souběžně.</span><span class="sxs-lookup"><span data-stu-id="342c2-152">If the query is likely to yield speedups by parallelization, PLINQ partitions the source sequence into tasks that can be run concurrently.</span></span> <span data-ttu-id="342c2-153">Pokud není bezpečné učinit paralelní dotaz, PLINQ právě spouští dotaz postupně.</span><span class="sxs-lookup"><span data-stu-id="342c2-153">If it is not safe to parallelize a query, PLINQ just runs the query sequentially.</span></span> <span data-ttu-id="342c2-154">Pokud PLINQ volba mezi potenciálně nákladné paralelní algoritmus nebo nenákladné sekvenční algoritmus, zvolí sekvenční algoritmus ve výchozím nastavení.</span><span class="sxs-lookup"><span data-stu-id="342c2-154">If PLINQ has a choice between a potentially expensive parallel algorithm or an inexpensive sequential algorithm, it chooses the sequential algorithm by default.</span></span> <span data-ttu-id="342c2-155">Můžete použít <xref:System.Linq.ParallelEnumerable.WithExecutionMode%2A> metoda a <xref:System.Linq.ParallelExecutionMode?displayProperty=nameWithType> výčet k vynucení PLINQ paralelního algoritmu.</span><span class="sxs-lookup"><span data-stu-id="342c2-155">You can use the <xref:System.Linq.ParallelEnumerable.WithExecutionMode%2A> method and the <xref:System.Linq.ParallelExecutionMode?displayProperty=nameWithType> enumeration to instruct PLINQ to select the parallel algorithm.</span></span> <span data-ttu-id="342c2-156">To je užitečné, když víte, testování a měření, která konkrétní dotaz rychleji spustí paralelně.</span><span class="sxs-lookup"><span data-stu-id="342c2-156">This is useful when you know by testing and measurement that a particular query executes faster in parallel.</span></span> <span data-ttu-id="342c2-157">Další informace najdete v tématu [postupy: určení režimu spouštění v PLINQ](../../../docs/standard/parallel-programming/how-to-specify-the-execution-mode-in-plinq.md).</span><span class="sxs-lookup"><span data-stu-id="342c2-157">For more information, see [How to: Specify the Execution Mode in PLINQ](../../../docs/standard/parallel-programming/how-to-specify-the-execution-mode-in-plinq.md).</span></span>  
  
## <a name="degree-of-parallelism"></a><span data-ttu-id="342c2-158">Stupně paralelního zpracování</span><span class="sxs-lookup"><span data-stu-id="342c2-158">Degree of Parallelism</span></span>  
 <span data-ttu-id="342c2-159">Ve výchozím nastavení PLINQ používá všech procesorů v hostitelském počítači.</span><span class="sxs-lookup"><span data-stu-id="342c2-159">By default, PLINQ uses all of the processors on the host computer.</span></span> <span data-ttu-id="342c2-160">Můžete určit, aby PLINQ používat více než zadaný počet procesorů pomocí <xref:System.Linq.ParallelEnumerable.WithDegreeOfParallelism%2A> metoda.</span><span class="sxs-lookup"><span data-stu-id="342c2-160">You can instruct PLINQ to use no more than a specified number of processors by using the <xref:System.Linq.ParallelEnumerable.WithDegreeOfParallelism%2A> method.</span></span> <span data-ttu-id="342c2-161">To je užitečné, pokud chcete zajistit, aby ostatní procesy spuštěné v počítači přijímat množství času procesoru.</span><span class="sxs-lookup"><span data-stu-id="342c2-161">This is useful when you want to make sure that other processes running on the computer receive a certain amount of CPU time.</span></span> <span data-ttu-id="342c2-162">Následující fragment kódu omezuje dotaz k použití maximálně dva procesory.</span><span class="sxs-lookup"><span data-stu-id="342c2-162">The following snippet limits the query to utilizing a maximum of two processors.</span></span>  
  
 [!code-csharp[PLINQ#5](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinqsamples.cs#5)]
 [!code-vb[PLINQ#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinq2_vb.vb#5)]  
  
 <span data-ttu-id="342c2-163">V případech, kde dotaz provádí významné množství výpočetních hranice pracovní například soubor vstupně-výstupních operací může být užitečné k určení stupně paralelního zpracování větší než počet jader na počítači.</span><span class="sxs-lookup"><span data-stu-id="342c2-163">In cases where a query is performing a significant amount of non-compute-bound work such as File I/O, it might be beneficial to specify a degree of parallelism greater than the number of cores on the machine.</span></span>  
  
## <a name="ordered-versus-unordered-parallel-queries"></a><span data-ttu-id="342c2-164">Seřazené a neuspořádané paralelní dotazy</span><span class="sxs-lookup"><span data-stu-id="342c2-164">Ordered Versus Unordered Parallel Queries</span></span>  
 <span data-ttu-id="342c2-165">U některých dotazů musí operátor dotazu nepřineslo výsledky, které zachovat řazení zdrojové sekvence.</span><span class="sxs-lookup"><span data-stu-id="342c2-165">In some queries, a query operator must produce results that preserve the ordering of the source sequence.</span></span> <span data-ttu-id="342c2-166">Poskytuje PLINQ <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> operátor pro tento účel.</span><span class="sxs-lookup"><span data-stu-id="342c2-166">PLINQ provides the <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> operator for this purpose.</span></span> <span data-ttu-id="342c2-167"><xref:System.Linq.ParallelEnumerable.AsOrdered%2A> se liší od <xref:System.Linq.ParallelEnumerable.AsSequential%2A>.</span><span class="sxs-lookup"><span data-stu-id="342c2-167"><xref:System.Linq.ParallelEnumerable.AsOrdered%2A> is distinct from <xref:System.Linq.ParallelEnumerable.AsSequential%2A>.</span></span> <span data-ttu-id="342c2-168"><xref:System.Linq.ParallelEnumerable.AsOrdered%2A> Pořadí je stále zpracovávají paralelně, ale jeho výsledky jsou uložená do vyrovnávací paměti a seřazeny.</span><span class="sxs-lookup"><span data-stu-id="342c2-168">An <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> sequence is still processed in parallel, but its results are buffered and sorted.</span></span> <span data-ttu-id="342c2-169">Protože zachování pořadí obvykle zahrnuje další práci <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> pořadí může být zpracována pomaleji než výchozí <xref:System.Linq.ParallelEnumerable.AsUnordered%2A> pořadí.</span><span class="sxs-lookup"><span data-stu-id="342c2-169">Because order preservation typically involves extra work, an <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> sequence might be processed more slowly than the default <xref:System.Linq.ParallelEnumerable.AsUnordered%2A> sequence.</span></span> <span data-ttu-id="342c2-170">Zda speciální paralelní operace řazení je rychlejší než verze sekvenční operace závisí na mnoha faktorech.</span><span class="sxs-lookup"><span data-stu-id="342c2-170">Whether a particular ordered parallel operation is faster than a sequential version of the operation depends on many factors.</span></span>  
  
 <span data-ttu-id="342c2-171">Následující příklad kódu ukazuje, jak se vyjádřit výslovný souhlas pro zachování pořadí.</span><span class="sxs-lookup"><span data-stu-id="342c2-171">The following code example shows how to opt in to order preservation.</span></span>  
  
 [!code-csharp[PLINQ#3](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinq2_cs.cs#3)]
 [!code-vb[PLINQ#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinq2_vb.vb#3)]  
  
 <span data-ttu-id="342c2-172">Další informace najdete v tématu [zachování pořadí v PLINQ](../../../docs/standard/parallel-programming/order-preservation-in-plinq.md).</span><span class="sxs-lookup"><span data-stu-id="342c2-172">For more information, see [Order Preservation in PLINQ](../../../docs/standard/parallel-programming/order-preservation-in-plinq.md).</span></span>  
  
## <a name="parallel-vs-sequential-queries"></a><span data-ttu-id="342c2-173">Paralelní vs. Sekvenční dotazy</span><span class="sxs-lookup"><span data-stu-id="342c2-173">Parallel vs. Sequential Queries</span></span>  
 <span data-ttu-id="342c2-174">Některé operace vyžadují doručení zdrojová data sekvenční způsobem.</span><span class="sxs-lookup"><span data-stu-id="342c2-174">Some operations require that the source data be delivered in a sequential manner.</span></span> <span data-ttu-id="342c2-175"><xref:System.Linq.ParallelEnumerable> Dotazu operátory vrátí do sekvenčního režimu automaticky pokud je to požadováno.</span><span class="sxs-lookup"><span data-stu-id="342c2-175">The <xref:System.Linq.ParallelEnumerable> query operators revert to sequential mode automatically when it is required.</span></span> <span data-ttu-id="342c2-176">Pro dotaz uživatelem definované operátory a delegáti uživatele, které vyžadují sekvenční provádění, poskytuje PLINQ <xref:System.Linq.ParallelEnumerable.AsSequential%2A> metoda.</span><span class="sxs-lookup"><span data-stu-id="342c2-176">For user-defined query operators and user delegates that require sequential execution, PLINQ provides the <xref:System.Linq.ParallelEnumerable.AsSequential%2A> method.</span></span> <span data-ttu-id="342c2-177">Při použití <xref:System.Linq.ParallelEnumerable.AsSequential%2A>, všechny následné operátory v dotazu se postupně, dokud <xref:System.Linq.ParallelEnumerable.AsParallel%2A> nebude volán znovu.</span><span class="sxs-lookup"><span data-stu-id="342c2-177">When you use <xref:System.Linq.ParallelEnumerable.AsSequential%2A>, all subsequent operators in the query are executed sequentially until <xref:System.Linq.ParallelEnumerable.AsParallel%2A> is called again.</span></span> <span data-ttu-id="342c2-178">Další informace najdete v tématu [postupy: Kombinování paralelních a sekvenčních LINQ dotazů](../../../docs/standard/parallel-programming/how-to-combine-parallel-and-sequential-linq-queries.md).</span><span class="sxs-lookup"><span data-stu-id="342c2-178">For more information, see [How to: Combine Parallel and Sequential LINQ Queries](../../../docs/standard/parallel-programming/how-to-combine-parallel-and-sequential-linq-queries.md).</span></span>  
  
## <a name="options-for-merging-query-results"></a><span data-ttu-id="342c2-179">Možnosti sloučení výsledky dotazu</span><span class="sxs-lookup"><span data-stu-id="342c2-179">Options for Merging Query Results</span></span>  
 <span data-ttu-id="342c2-180">Když PLINQ dotazu se provede paralelně, je potřeba sloučit své výsledky z každé pracovní vlákno zpět do hlavní vlákno pro spotřeba `foreach` smyčky (`For Each` v jazyce Visual Basic), nebo pro vložení do seznamu nebo pole.</span><span class="sxs-lookup"><span data-stu-id="342c2-180">When a PLINQ query executes in parallel, its results from each worker thread must be merged back onto the main thread for consumption by a `foreach` loop (`For Each` in Visual Basic), or insertion into a list or array.</span></span> <span data-ttu-id="342c2-181">V některých případech může být výhodné, zadejte konkrétní typ operace sloučení, například, při zahájení výroby výsledku rychleji.</span><span class="sxs-lookup"><span data-stu-id="342c2-181">In some cases, it might be beneficial to specify a particular kind of merge operation, for example, to begin producing results more quickly.</span></span> <span data-ttu-id="342c2-182">Pro tento účel PLINQ podporuje <xref:System.Linq.ParallelEnumerable.WithMergeOptions%2A> metody a <xref:System.Linq.ParallelMergeOptions> výčtu.</span><span class="sxs-lookup"><span data-stu-id="342c2-182">For this purpose, PLINQ supports the <xref:System.Linq.ParallelEnumerable.WithMergeOptions%2A> method, and the <xref:System.Linq.ParallelMergeOptions> enumeration.</span></span> <span data-ttu-id="342c2-183">Další informace najdete v tématu [možnosti sloučení v PLINQ](../../../docs/standard/parallel-programming/merge-options-in-plinq.md).</span><span class="sxs-lookup"><span data-stu-id="342c2-183">For more information, see [Merge Options in PLINQ](../../../docs/standard/parallel-programming/merge-options-in-plinq.md).</span></span>  
  
## <a name="the-forall-operator"></a><span data-ttu-id="342c2-184">Operátor ForAll</span><span class="sxs-lookup"><span data-stu-id="342c2-184">The ForAll Operator</span></span>  
 <span data-ttu-id="342c2-185">V sekvenčních [!INCLUDE[vbteclinq](../../../includes/vbteclinq-md.md)] dotazy, spuštění je odložení, dokud není dotaz zpracován buď v `foreach` (`For Each` v jazyce Visual Basic) cykly nebo podle vyvoláním metody <xref:System.Linq.ParallelEnumerable.ToList%2A> , <xref:System.Linq.ParallelEnumerable.ToArray%2A> , nebo <xref:System.Linq.ParallelEnumerable.ToDictionary%2A>.</span><span class="sxs-lookup"><span data-stu-id="342c2-185">In sequential [!INCLUDE[vbteclinq](../../../includes/vbteclinq-md.md)] queries, execution is deferred until the query is enumerated either in a `foreach` (`For Each` in Visual Basic) loop or by invoking a method such as <xref:System.Linq.ParallelEnumerable.ToList%2A> , <xref:System.Linq.ParallelEnumerable.ToArray%2A> , or <xref:System.Linq.ParallelEnumerable.ToDictionary%2A>.</span></span> <span data-ttu-id="342c2-186">V PLINQ, můžete také použít `foreach` iteraci v rámci výsledky a provést dotaz.</span><span class="sxs-lookup"><span data-stu-id="342c2-186">In PLINQ, you can also use `foreach` to execute the query and iterate through the results.</span></span> <span data-ttu-id="342c2-187">Ale `foreach` samotné nespustí paralelně, a proto vyžaduje, aby výstup z paralelní úlohy slučované zpět do vlákna, na kterém je spuštěn smyčky.</span><span class="sxs-lookup"><span data-stu-id="342c2-187">However, `foreach` itself does not run in parallel, and therefore, it requires that the output from all parallel tasks be merged back into the thread on which the loop is running.</span></span> <span data-ttu-id="342c2-188">V PLINQ, můžete použít `foreach` při musí zachovat konečné řazení výsledků dotazu, a také vždy, když zpracováváte výsledky sériovým způsobem, například když voláte `Console.WriteLine` pro jednotlivé elementy.</span><span class="sxs-lookup"><span data-stu-id="342c2-188">In PLINQ, you can use `foreach` when you must preserve the final ordering of the query results, and also whenever you are processing the results in a serial manner, for example when you are calling `Console.WriteLine` for each element.</span></span> <span data-ttu-id="342c2-189">Pro rychlejší provádění dotazu není zachováváno pořadí a při zpracování výsledků, které může být paralelizováno, použijte <xref:System.Linq.ParallelEnumerable.ForAll%2A> metodu za účelem provedení PLINQ dotazu.</span><span class="sxs-lookup"><span data-stu-id="342c2-189">For faster query execution when order preservation is not required and when the processing of the results can itself be parallelized, use the <xref:System.Linq.ParallelEnumerable.ForAll%2A> method to execute a PLINQ query.</span></span> <span data-ttu-id="342c2-190"><xref:System.Linq.ParallelEnumerable.ForAll%2A> neprovede krok finálního sloučení.</span><span class="sxs-lookup"><span data-stu-id="342c2-190"><xref:System.Linq.ParallelEnumerable.ForAll%2A> does not perform this final merge step.</span></span> <span data-ttu-id="342c2-191">Následující příklad kódu ukazuje, jak používat <xref:System.Linq.ParallelEnumerable.ForAll%2A> metoda.</span><span class="sxs-lookup"><span data-stu-id="342c2-191">The following code example shows how to use the <xref:System.Linq.ParallelEnumerable.ForAll%2A> method.</span></span> <span data-ttu-id="342c2-192"><xref:System.Collections.Concurrent.ConcurrentBag%601?displayProperty=nameWithType> je zde použít, protože je optimalizovaný pro více vláken současně přidání bez pokusu o odebrání všech položek.</span><span class="sxs-lookup"><span data-stu-id="342c2-192"><xref:System.Collections.Concurrent.ConcurrentBag%601?displayProperty=nameWithType> is used here because it is optimized for multiple threads adding concurrently without attempting to remove any items.</span></span>  
  
 [!code-csharp[PLINQ#4](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinq2_cs.cs#4)]
 [!code-vb[PLINQ#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinq2_vb.vb#4)]  
  
 <span data-ttu-id="342c2-193">Následující obrázek ukazuje rozdíl mezi `foreach` a <xref:System.Linq.ParallelEnumerable.ForAll%2A> s ohledem na spuštění dotazu.</span><span class="sxs-lookup"><span data-stu-id="342c2-193">The following illustration shows the difference between `foreach` and <xref:System.Linq.ParallelEnumerable.ForAll%2A> with regard to query execution.</span></span>  
  
 <span data-ttu-id="342c2-194">![ForAll vs. ForEach](../../../docs/standard/parallel-programming/media/vs-isvnt-allvseach.png "VS_ISVNT_ALLvsEACH")</span><span class="sxs-lookup"><span data-stu-id="342c2-194">![ForAll vs. ForEach](../../../docs/standard/parallel-programming/media/vs-isvnt-allvseach.png "VS_ISVNT_ALLvsEACH")</span></span>  
  
## <a name="cancellation"></a><span data-ttu-id="342c2-195">Zrušení</span><span class="sxs-lookup"><span data-stu-id="342c2-195">Cancellation</span></span>  
 <span data-ttu-id="342c2-196">PLINQ je integrována s typy zrušení v [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)].</span><span class="sxs-lookup"><span data-stu-id="342c2-196">PLINQ is integrated with the cancellation types in [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)].</span></span> <span data-ttu-id="342c2-197">(Další informace najdete v tématu [zrušení ve spravovaných vláknech](../../../docs/standard/threading/cancellation-in-managed-threads.md).) Proto na rozdíl od sekvenčních LINQ na objekty dotazy, dotazy PLINQ můžete zrušit.</span><span class="sxs-lookup"><span data-stu-id="342c2-197">(For more information, see [Cancellation in Managed Threads](../../../docs/standard/threading/cancellation-in-managed-threads.md).) Therefore, unlike sequential LINQ to Objects queries, PLINQ queries can be canceled.</span></span> <span data-ttu-id="342c2-198">Pokud chcete vytvořit PLINQ dotaz, použít <xref:System.Linq.ParallelEnumerable.WithCancellation%2A> operátor na dotaz a zadejte <xref:System.Threading.CancellationToken> instance jako argument.</span><span class="sxs-lookup"><span data-stu-id="342c2-198">To create a cancelable PLINQ query, use the <xref:System.Linq.ParallelEnumerable.WithCancellation%2A> operator on the query and provide a <xref:System.Threading.CancellationToken> instance as the argument.</span></span> <span data-ttu-id="342c2-199">Když <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> na tokenu je nastavena na hodnotu true, PLINQ Všimněte si ho, zastaví zpracování na všechna vlákna a throw <xref:System.OperationCanceledException>.</span><span class="sxs-lookup"><span data-stu-id="342c2-199">When the <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> property on the token is set to true, PLINQ will notice it, stop processing on all threads, and throw an <xref:System.OperationCanceledException>.</span></span>  
  
 <span data-ttu-id="342c2-200">Je možné, že dotazu PLINQ může pokračovat ve zpracování některých prvků po nastavení tokenu zrušení.</span><span class="sxs-lookup"><span data-stu-id="342c2-200">It is possible that a PLINQ query might continue to process some elements after the cancellation token is set.</span></span>  
  
 <span data-ttu-id="342c2-201">Pro větší rychlost reakce můžete také reagovat na požadavky zrušení v delegátech dlouho běžící uživatele.</span><span class="sxs-lookup"><span data-stu-id="342c2-201">For greater responsiveness, you can also respond to cancellation requests in long-running user delegates.</span></span> <span data-ttu-id="342c2-202">Další informace najdete v tématu [postupy: zrušení dotazu PLINQ](../../../docs/standard/parallel-programming/how-to-cancel-a-plinq-query.md).</span><span class="sxs-lookup"><span data-stu-id="342c2-202">For more information, see [How to: Cancel a PLINQ Query](../../../docs/standard/parallel-programming/how-to-cancel-a-plinq-query.md).</span></span>  
  
## <a name="exceptions"></a><span data-ttu-id="342c2-203">Výjimky</span><span class="sxs-lookup"><span data-stu-id="342c2-203">Exceptions</span></span>  
 <span data-ttu-id="342c2-204">Když PLINQ dotazu se provede, může být více výjimky vyvolány z různých vláknech současně.</span><span class="sxs-lookup"><span data-stu-id="342c2-204">When a PLINQ query executes, multiple exceptions might be thrown from different threads simultaneously.</span></span> <span data-ttu-id="342c2-205">Kód pro zpracování výjimky může být v jiném podprocesu než kód, který způsobil výjimku.</span><span class="sxs-lookup"><span data-stu-id="342c2-205">Also, the code to handle the exception might be on a different thread than the code that threw the exception.</span></span> <span data-ttu-id="342c2-206">PLINQ používá <xref:System.AggregateException> typ zapouzdření všechny výjimky, které byly vyvolány v dotazu a zařazení těchto výjimek zpět volající vlákno.</span><span class="sxs-lookup"><span data-stu-id="342c2-206">PLINQ uses the <xref:System.AggregateException> type to encapsulate all the exceptions that were thrown by a query, and marshal those exceptions back to the calling thread.</span></span> <span data-ttu-id="342c2-207">Volající vlákno je vyžadována pouze jeden blok try-catch.</span><span class="sxs-lookup"><span data-stu-id="342c2-207">On the calling thread, only one try-catch block is required.</span></span> <span data-ttu-id="342c2-208">Však můžete iterovat všechny výjimky, které jsou zapouzdřené v <xref:System.AggregateException> a všechny, které můžete bezpečně zotavit catch.</span><span class="sxs-lookup"><span data-stu-id="342c2-208">However, you can iterate through all of the exceptions that are encapsulated in the <xref:System.AggregateException> and catch any that you can safely recover from.</span></span> <span data-ttu-id="342c2-209">Ve výjimečných případech některé výjimky může vyvolat, které nejsou zabalené v <xref:System.AggregateException>, a <xref:System.Threading.ThreadAbortException>s také není zabalena.</span><span class="sxs-lookup"><span data-stu-id="342c2-209">In rare cases, some exceptions may be thrown that are not wrapped in an <xref:System.AggregateException>, and <xref:System.Threading.ThreadAbortException>s  are also not wrapped.</span></span>  
  
 <span data-ttu-id="342c2-210">Pokud je výjimky umožněno vyvolat zpět do spojovacího vlákna, je možné, že dotaz může pokračovat ve zpracování některé položky po je vyvolána výjimka.</span><span class="sxs-lookup"><span data-stu-id="342c2-210">When exceptions are allowed to bubble up back to the joining thread, then it is possible that a query may continue to process some items after the exception is raised.</span></span>  
  
 <span data-ttu-id="342c2-211">Další informace najdete v tématu [postupy: zpracování výjimek v PLINQ dotazu](../../../docs/standard/parallel-programming/how-to-handle-exceptions-in-a-plinq-query.md).</span><span class="sxs-lookup"><span data-stu-id="342c2-211">For more information, see [How to: Handle Exceptions in a PLINQ Query](../../../docs/standard/parallel-programming/how-to-handle-exceptions-in-a-plinq-query.md).</span></span>  
  
## <a name="custom-partitioners"></a><span data-ttu-id="342c2-212">Vlastní dělicí metody</span><span class="sxs-lookup"><span data-stu-id="342c2-212">Custom Partitioners</span></span>  
 <span data-ttu-id="342c2-213">V některých případech může zlepšit výkon dotazu napsáním vlastní dělicí metody, který využívá některé typické vlastnosti zdrojová data.</span><span class="sxs-lookup"><span data-stu-id="342c2-213">In some cases, you can improve query performance by writing a custom partitioner that takes advantage of some characteristic of the source data.</span></span> <span data-ttu-id="342c2-214">V dotazu je vlastní rozdělovač sám vyčíslitelný objekt, který je dotazován.</span><span class="sxs-lookup"><span data-stu-id="342c2-214">In the query, the custom partitioner itself is the enumerable object that is queried.</span></span>  
  
 [!code-csharp[PLINQ#2](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinq2_cs.cs#2)]
 [!code-vb[PLINQ#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinq3.vb#2)]  
  
 <span data-ttu-id="342c2-215">PLINQ podporuje pevný počet oddílů (i když se data mohou být dynamicky přeřazena do těchto oddílů při běhu pro vyrovnávání zatížení.).</span><span class="sxs-lookup"><span data-stu-id="342c2-215">PLINQ supports a fixed number of partitions (although data may be dynamically reassigned to those partitions during run time for load balancing.).</span></span> <span data-ttu-id="342c2-216"><xref:System.Threading.Tasks.Parallel.For%2A> a <xref:System.Threading.Tasks.Parallel.ForEach%2A> podporují pouze dynamické rozdělení, to znamená, že počet oddílů se mění v době běhu.</span><span class="sxs-lookup"><span data-stu-id="342c2-216"><xref:System.Threading.Tasks.Parallel.For%2A> and <xref:System.Threading.Tasks.Parallel.ForEach%2A> support only dynamic partitioning, which means that the number of partitions changes at run time.</span></span> <span data-ttu-id="342c2-217">Další informace najdete v tématu [vlastní dělicí metody pro PLINQ a TPL](../../../docs/standard/parallel-programming/custom-partitioners-for-plinq-and-tpl.md).</span><span class="sxs-lookup"><span data-stu-id="342c2-217">For more information, see [Custom Partitioners for PLINQ and TPL](../../../docs/standard/parallel-programming/custom-partitioners-for-plinq-and-tpl.md).</span></span>  
  
## <a name="measuring-plinq-performance"></a><span data-ttu-id="342c2-218">Měření výkonu PLINQ</span><span class="sxs-lookup"><span data-stu-id="342c2-218">Measuring PLINQ Performance</span></span>  
 <span data-ttu-id="342c2-219">V mnoha případech může být paralelizovaná málo dotazu, ale režie nastavení paralelního dotazu převáží získané výhody výkonu.</span><span class="sxs-lookup"><span data-stu-id="342c2-219">In many cases, a query can be parallelized, but the overhead of setting up the parallel query outweighs the performance benefit gained.</span></span> <span data-ttu-id="342c2-220">Pokud dotaz neprovádí mnoho výpočtu nebo zdroj dat je malý, může být pomalejší než sekvenčních LINQ na objekty dotazu PLINQ dotazu.</span><span class="sxs-lookup"><span data-stu-id="342c2-220">If a query does not perform much computation or if the data source is small, a PLINQ query may be slower than a sequential LINQ to Objects query.</span></span> <span data-ttu-id="342c2-221">Paralelní Analyzátor výkonu v sadě Visual Studio Team Server můžete použít k porovnání výkonu různé dotazy, zjistit kritická místa zpracování a k určení, zda dotaz běží paralelně nebo postupně.</span><span class="sxs-lookup"><span data-stu-id="342c2-221">You can use the Parallel Performance Analyzer in Visual Studio Team Server to compare the performance of various queries, to locate processing bottlenecks, and to determine whether your query is running in parallel or sequentially.</span></span> <span data-ttu-id="342c2-222">Další informace najdete v tématu [vizualizér souběžnosti](/visualstudio/profiling/concurrency-visualizer) a [postupy: měření výkonu dotazu PLINQ](../../../docs/standard/parallel-programming/how-to-measure-plinq-query-performance.md).</span><span class="sxs-lookup"><span data-stu-id="342c2-222">For more information, see [Concurrency Visualizer](/visualstudio/profiling/concurrency-visualizer) and [How to: Measure PLINQ Query Performance](../../../docs/standard/parallel-programming/how-to-measure-plinq-query-performance.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="342c2-223">Viz také</span><span class="sxs-lookup"><span data-stu-id="342c2-223">See Also</span></span>  
 [<span data-ttu-id="342c2-224">Paralelní LINQ (PLINQ)</span><span class="sxs-lookup"><span data-stu-id="342c2-224">Parallel LINQ (PLINQ)</span></span>](../../../docs/standard/parallel-programming/parallel-linq-plinq.md)  
 [<span data-ttu-id="342c2-225">Principy zrychlení v PLINQ</span><span class="sxs-lookup"><span data-stu-id="342c2-225">Understanding Speedup in PLINQ</span></span>](../../../docs/standard/parallel-programming/understanding-speedup-in-plinq.md)
