---
title: "Instance uzamčení výjimka akce"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 164a5419-315c-4987-ad72-54cbdb88d402
caps.latest.revision: "8"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: 6a5a0d805d5c8cbae67b97afa220ad769179e198
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/18/2017
---
# <a name="instance-locked-exception-action"></a><span data-ttu-id="a368b-102">Instance uzamčení výjimka akce</span><span class="sxs-lookup"><span data-stu-id="a368b-102">Instance Locked Exception Action</span></span>
<span data-ttu-id="a368b-103"><xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> Vlastnost úložiště Instance pracovního postupu SQL umožňuje určit, jakou akci zprostředkovatele SQL trvalost má provést, pokud obdrží <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span><span class="sxs-lookup"><span data-stu-id="a368b-103">The <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> property of the SQL Workflow Instance Store lets you specify what action the SQL persistence provider should take when it receives an <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span></span> <span data-ttu-id="a368b-104">Zprostředkovatel trvalost obdrží tuto výjimku při pokusu o uzamčení instance služby pracovního postupu, který je aktuálně uzamčen jiného hostitele služby.</span><span class="sxs-lookup"><span data-stu-id="a368b-104">The persistence provider receives this exception when it tries to lock a workflow service instance that is currently locked by another service host.</span></span> <span data-ttu-id="a368b-105">Hodnoty pro tuto vlastnost jsou <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>, <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry>, a <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>.</span><span class="sxs-lookup"><span data-stu-id="a368b-105">The values for this property are <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>, <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry>, and <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>.</span></span> <span data-ttu-id="a368b-106">Výchozí hodnota je <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span><span class="sxs-lookup"><span data-stu-id="a368b-106">The default value is <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span></span> <span data-ttu-id="a368b-107">Následující seznam popisuje tři možnosti:</span><span class="sxs-lookup"><span data-stu-id="a368b-107">The following list describes the three options:</span></span>  
  
-   <span data-ttu-id="a368b-108"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span><span class="sxs-lookup"><span data-stu-id="a368b-108"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span></span> <span data-ttu-id="a368b-109">Hostitel služby nebude pokoušet o uzamčení instance služby pracovního postupu a předává <xref:System.Runtime.DurableInstancing.InstanceLockedException> volajícímu.</span><span class="sxs-lookup"><span data-stu-id="a368b-109">The service host does not attempt to lock the workflow service instance and passes the <xref:System.Runtime.DurableInstancing.InstanceLockedException> to the caller.</span></span>  <span data-ttu-id="a368b-110">Pokud pracovní postup zůstává v paměti na dobu delší než 60 sekund, použijte <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry> jako opakovaném.</span><span class="sxs-lookup"><span data-stu-id="a368b-110">If your workflow stays in memory for a period exceeding 60 seconds, use <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry> as the retry.</span></span> <span data-ttu-id="a368b-111">Výchozí hodnota je <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span><span class="sxs-lookup"><span data-stu-id="a368b-111">The default value is <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span></span>  
  
-   <span data-ttu-id="a368b-112"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry>.</span><span class="sxs-lookup"><span data-stu-id="a368b-112"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry>.</span></span> <span data-ttu-id="a368b-113">Hostitel služby reattempts k uzamčení k instanci pracovního postupu služby s lineární intervalem opakování pokusů a předává <xref:System.Runtime.DurableInstancing.InstanceLockedException> volajícího na konci pořadí.</span><span class="sxs-lookup"><span data-stu-id="a368b-113">The service host reattempts to lock the workflow service instance with a linear interval between retry attempts and passes the <xref:System.Runtime.DurableInstancing.InstanceLockedException> to the caller at the end of the sequence.</span></span> <span data-ttu-id="a368b-114">Pokud je pracovní postup zůstává v paměti přibližně mezi 5 – 60 sekund a doručování zpráv: v dávkách, kde je pravděpodobnější zprávy odesílané do stejné instance na stejném hostiteli zpracovat všechny zprávy před uvolnění pracovního postupu, použijte <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> na dosažení nejlepší latence bez plýtvání prostředky.</span><span class="sxs-lookup"><span data-stu-id="a368b-114">If you workflow stays in memory approximately between 5-60 seconds, and messages arrive in batches where it is more likely for messages being sent to the same instance on the same host to process all messages before unloading the workflow, use <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> to achieve the best latency without wasting resources.</span></span>  
  
-   <span data-ttu-id="a368b-115"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>.</span><span class="sxs-lookup"><span data-stu-id="a368b-115"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>.</span></span> <span data-ttu-id="a368b-116">Hostitel služby reattempts k uzamčení instance služby pracovního postupu se v intervalu mezi pokusy o opakování exponenciálního omezení rychlosti a předá výjimku volajícího na konci pořadí.</span><span class="sxs-lookup"><span data-stu-id="a368b-116">The service host reattempts to lock the workflow service instance with an exponential backoff interval between retry attempts, and passes the exception to the caller at the end of the sequence.</span></span> <span data-ttu-id="a368b-117">Je-li pracovní postup v paměti pro velmi krátké době (méně než 5 sekund) nebo webové farmy je velký a riziko další zprávu doručován na stejného hostitele není velmi vysoké, použijte <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry> k dosažení nejlepší latence.</span><span class="sxs-lookup"><span data-stu-id="a368b-117">If your workflow stays in memory for a very short time (less than 5 seconds), or a Web farm is large and the chance of another message being delivered to the same host is not very high, use <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry> to achieve the best latency.</span></span>  
  
 <span data-ttu-id="a368b-118">Funkce Instance uzamčení výjimka akce podporuje následující scénáře.</span><span class="sxs-lookup"><span data-stu-id="a368b-118">The Instance Locked Exception Action feature supports the following scenarios.</span></span> <span data-ttu-id="a368b-119">Ve všech scénářích, pokud vlastnost instanceLockedExceptionAction SqlWorkflowInstanceStore nastavena na <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> nebo <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>, hostitel se transparentně pokusí získat zámek na instancích pravidelně.</span><span class="sxs-lookup"><span data-stu-id="a368b-119">In all scenarios, if the instanceLockedExceptionAction property of the SqlWorkflowInstanceStore is set to <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> or <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>, the host transparently retries to acquire the lock on instances periodically.</span></span>  
  
1.  <span data-ttu-id="a368b-120">**Povolení řádné vypnutí a překryté recyklace aplikační domény.**</span><span class="sxs-lookup"><span data-stu-id="a368b-120">**Enabling graceful shutdown and overlapped recycling of application domains.**</span></span> <span data-ttu-id="a368b-121">Předpokládejme, že **AppDomain** s hostitele služby pracovního postupu spuštění instance služby se recykluje a nové **AppDomain** zapínají zpracovat nové žádosti o paralelně při starý  **Doména AppDomain** je snížila řádně.</span><span class="sxs-lookup"><span data-stu-id="a368b-121">Suppose an **AppDomain** with a service host running workflow service instances is being recycled and a new **AppDomain** is brought up to handle new requests in parallel while the old **AppDomain** is brought down gracefully.</span></span> <span data-ttu-id="a368b-122">Ukončení, dokud není instancí služby pracovních postupů jsou v nečinnosti a pak potrvají a uvolní instance.</span><span class="sxs-lookup"><span data-stu-id="a368b-122">The shutdown waits until workflow service instances are idle, and then persists and unloads the instances.</span></span> <span data-ttu-id="a368b-123">Všechny pokusy o hostitelů v novém **AppDomain** k uzamčení instance způsobí, že <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span><span class="sxs-lookup"><span data-stu-id="a368b-123">Any attempts by hosts in the new **AppDomain** to lock an instance will cause an <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span></span>  
  
2.  <span data-ttu-id="a368b-124">**Trvanlivý pracovních vodorovně škálování mezi homogenní farmy serverů.**</span><span class="sxs-lookup"><span data-stu-id="a368b-124">**Horizontally scaling durable workflows across a homogeneous farm of servers.**</span></span> <span data-ttu-id="a368b-125">Předpokládejme, že uzel serverové farmy, na kterém běží instance pracovního postupu dojde k chybě a hostitele pracovního postupu nelze odebrat zámky, na kterém je spuštěná instance.</span><span class="sxs-lookup"><span data-stu-id="a368b-125">Suppose a node of a server farm on which a workflow instance is running crashes and the workflow host cannot remove locks on the instance it is running.</span></span> <span data-ttu-id="a368b-126">Když služba hostitele se systémem v jiném uzlu farmy přijme zprávu o u dané instance pracovního postupu, pokusí se získat zámek na těchto instancích se zobrazí <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span><span class="sxs-lookup"><span data-stu-id="a368b-126">When a service host running on another node of the farm receives a message for that workflow instance, it tries to acquire locks on these instances it will receive the <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span></span> <span data-ttu-id="a368b-127">Zámky vyprší po určité době, protože už existuje hostitele, který se má obnovit zámek.</span><span class="sxs-lookup"><span data-stu-id="a368b-127">The locks will expire after some time because the host that was supposed to renew the lock no longer exists.</span></span>  
  
     <span data-ttu-id="a368b-128">**Trvanlivý pracovních vodorovně škálování mezi homogenní farmy serverů.**</span><span class="sxs-lookup"><span data-stu-id="a368b-128">**Horizontally scaling durable workflows across a homogeneous farm of servers.**</span></span>  <span data-ttu-id="a368b-129">Předpokládejme, že chcete vodorovně škálování trvanlivý pracovní postup pomocí několika hostitelích za vyrovnávání zatížení sítě (Vyrovnávání zatížení sítě), hostitele pracovního postupu, který je spuštěn v jednom uzlu farmy načte instanci pracovního postupu a zpracovává zprávu a další zprávy k instanci se směruje na hostitele, který běží na jiném uzlu, protože Vyrovnávání zatížení sítě nemá směrování algoritmus pro doručování zpráv na hostitele, který je již spuštěna instance.</span><span class="sxs-lookup"><span data-stu-id="a368b-129">Suppose you want to horizontally scale a durable workflow using multiple hosts behind a NLB (Network Load Balancer), the workflow host running on one node of the farm loads a workflow instance and is processing a message, and the next message to the instance is routed to the host that is running on another node because the NLB does not have routing algorithm to deliver messages to the host that is already running the instance.</span></span> <span data-ttu-id="a368b-130">Po přijetí zprávy, druhý hostitele, pokusí se načíst instanci pracovního postupu a přijímá <xref:System.Runtime.DurableInstancing.InstanceLockedException> protože prvního hostitele má zámek na instanci.</span><span class="sxs-lookup"><span data-stu-id="a368b-130">Upon receiving the message, the second host attempts to load the workflow instance and receives the <xref:System.Runtime.DurableInstancing.InstanceLockedException> because the first host has a lock on the instance.</span></span> <span data-ttu-id="a368b-131">Prvního hostitele odemkne instance po jeho dokončení se zpracováním první zprávu a druhý hostitele získá zámek při příštím opakování, načte instanci a o druhou zprávu zpracuje.</span><span class="sxs-lookup"><span data-stu-id="a368b-131">The first host unlocks the instance when it is finished with processing the first message and the second host acquires the lock when it retries the next time, loads the instance, and processes the second message.</span></span>
