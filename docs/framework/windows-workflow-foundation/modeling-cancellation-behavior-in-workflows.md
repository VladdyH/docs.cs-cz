---
title: "Chování zrušení modelování v pracovních postupech"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: d48f6cf3-cdde-4dd3-8265-a665acf32a03
caps.latest.revision: "11"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: 6092db3ffd5d282fbb67b9d84cea8e88e1af7206
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 11/21/2017
---
# <a name="modeling-cancellation-behavior-in-workflows"></a><span data-ttu-id="f93e3-102">Chování zrušení modelování v pracovních postupech</span><span class="sxs-lookup"><span data-stu-id="f93e3-102">Modeling Cancellation Behavior in Workflows</span></span>
<span data-ttu-id="f93e3-103">Aktivity může být zrušen uvnitř pracovního postupu, například při <xref:System.Activities.Statements.Parallel> aktivity zrušení neúplné větví při jeho <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> vyhodnotí jako `true`, nebo z mimo pracovní postup, pokud hostitel volá <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span><span class="sxs-lookup"><span data-stu-id="f93e3-103">Activities can be canceled inside a workflow, for example by a <xref:System.Activities.Statements.Parallel> activity canceling incomplete branches when its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> evaluates to `true`, or from outside the workflow, if the host calls <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span></span> <span data-ttu-id="f93e3-104">Zajistit zpracování zrušení, můžete použít autoři pracovního postupu <xref:System.Activities.Statements.CancellationScope> aktivitu <xref:System.Activities.Statements.CompensableActivity> aktivity, nebo vytvořit vlastní aktivity, které poskytují logiku zrušení.</span><span class="sxs-lookup"><span data-stu-id="f93e3-104">To provide cancellation handling, workflow authors can use the <xref:System.Activities.Statements.CancellationScope> activity, the <xref:System.Activities.Statements.CompensableActivity> activity, or create custom activities that provide cancellation logic.</span></span> <span data-ttu-id="f93e3-105">Toto téma poskytuje přehled o zrušení v pracovních postupech.</span><span class="sxs-lookup"><span data-stu-id="f93e3-105">This topic provides an overview of cancellation in workflows.</span></span>  
  
## <a name="cancellation-compensation-and-transactions"></a><span data-ttu-id="f93e3-106">Zrušení, kompenzace a transakce</span><span class="sxs-lookup"><span data-stu-id="f93e3-106">Cancellation, Compensation, and Transactions</span></span>  
 <span data-ttu-id="f93e3-107">Transakce poskytují aplikace možnost přerušit všechny změny provést v rámci transakce, pokud všechny chyby, ke kterým došlo během libovolná součást procesu transakce (vrátit zpět změny).</span><span class="sxs-lookup"><span data-stu-id="f93e3-107">Transactions give your application the ability to abort (roll back) all changes executed within the transaction if any errors occur during any part of the transaction process.</span></span> <span data-ttu-id="f93e3-108">Ne všechny práci, kterou může třeba zrušena nebo odvolat je však vhodné pro transakce, jako je například dlouho běžící nebo práce, který nezahrnuje transakční prostředky.</span><span class="sxs-lookup"><span data-stu-id="f93e3-108">However, not all work that may need to be canceled or undone is appropriate for transactions, such as long-running work or work that does not involve transactional resources.</span></span> <span data-ttu-id="f93e3-109">Kompenzace poskytuje model pro rušení dříve dokončená netransakční práce, pokud dojde k následující chybě v pracovním postupu.</span><span class="sxs-lookup"><span data-stu-id="f93e3-109">Compensation provides a model for undoing previously completed non-transactional work if there is a subsequent failure in the workflow.</span></span> <span data-ttu-id="f93e3-110">Zrušení poskytuje model pro pracovní postup a aktivity autorům zpracování netransakční fungovat, která nebyla dokončena.</span><span class="sxs-lookup"><span data-stu-id="f93e3-110">Cancellation provides a model for workflow and activity authors to handle non-transactional work that was not completed.</span></span> <span data-ttu-id="f93e3-111">Pokud aktivita nebyl dokončen jeho spuštění a je zrušená, bude vyvolána svou logikou zrušení, pokud je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="f93e3-111">If an activity has not completed its execution and it is canceled, its cancellation logic will be invoked if it is available.</span></span>  
  
> [!NOTE]
>  [!INCLUDE[crabout](../../../includes/crabout-md.md)]<span data-ttu-id="f93e3-112">transakce a kompenzace, najdete v části [transakce](../../../docs/framework/windows-workflow-foundation/workflow-transactions.md) a [kompenzace](../../../docs/framework/windows-workflow-foundation/compensation.md).</span><span class="sxs-lookup"><span data-stu-id="f93e3-112"> transactions and compensation, see [Transactions](../../../docs/framework/windows-workflow-foundation/workflow-transactions.md) and [Compensation](../../../docs/framework/windows-workflow-foundation/compensation.md).</span></span>  
  
## <a name="using-cancellationscope"></a><span data-ttu-id="f93e3-113">Pomocí CancellationScope</span><span class="sxs-lookup"><span data-stu-id="f93e3-113">Using CancellationScope</span></span>  
 <span data-ttu-id="f93e3-114"><xref:System.Activities.Statements.CancellationScope> Aktivita má dvě části, které mohou obsahovat podřízené aktivity: <xref:System.Activities.Statements.CancellationScope.Body%2A> a <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>.</span><span class="sxs-lookup"><span data-stu-id="f93e3-114">The <xref:System.Activities.Statements.CancellationScope> activity has two sections that can contain child activities: <xref:System.Activities.Statements.CancellationScope.Body%2A> and <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>.</span></span> <span data-ttu-id="f93e3-115"><xref:System.Activities.Statements.CancellationScope.Body%2A> Je, kde jsou umístěny aktivity, které tvoří logiku aktivity a <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> je, kde jsou umístěny aktivity, které poskytují logiku zrušení aktivity.</span><span class="sxs-lookup"><span data-stu-id="f93e3-115">The <xref:System.Activities.Statements.CancellationScope.Body%2A> is where the activities that make up the logic of the activity are placed, and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> is where the activities that provide cancellation logic for the activity are placed.</span></span> <span data-ttu-id="f93e3-116">Aktivita zrušit lze pouze v případě, že nebyla dokončena.</span><span class="sxs-lookup"><span data-stu-id="f93e3-116">An activity can be canceled only if it has not completed.</span></span> <span data-ttu-id="f93e3-117">U <xref:System.Activities.Statements.CancellationScope> dokončení aktivity, odkazuje na dokončení aktivity v <xref:System.Activities.Statements.CancellationScope.Body%2A>.</span><span class="sxs-lookup"><span data-stu-id="f93e3-117">In the case of the <xref:System.Activities.Statements.CancellationScope> activity, completion refers to the completion of the activities in the <xref:System.Activities.Statements.CancellationScope.Body%2A>.</span></span> <span data-ttu-id="f93e3-118">Pokud je naplánováno na žádost o zrušení a aktivity v <xref:System.Activities.Statements.CancellationScope.Body%2A> dosud nebyly dokončeny, pak se <xref:System.Activities.Statements.CancellationScope> budou označeny jako <xref:System.Activities.ActivityInstanceState.Canceled> a <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> aktivity bude proveden.</span><span class="sxs-lookup"><span data-stu-id="f93e3-118">If a cancellation request is scheduled and the activities in the <xref:System.Activities.Statements.CancellationScope.Body%2A> have not completed, then the <xref:System.Activities.Statements.CancellationScope> will be marked as <xref:System.Activities.ActivityInstanceState.Canceled> and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> activities will be executed.</span></span>  
  
### <a name="canceling-a-workflow-from-the-host"></a><span data-ttu-id="f93e3-119">Zrušení pracovního postupu z hostitele</span><span class="sxs-lookup"><span data-stu-id="f93e3-119">Canceling a Workflow from the Host</span></span>  
 <span data-ttu-id="f93e3-120">Hostitel, můžete zrušit pracovní postup volání <xref:System.Activities.WorkflowApplication.Cancel%2A> metodu <xref:System.Activities.WorkflowApplication> instance, který je hostitelem pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="f93e3-120">A host can cancel a workflow by calling the <xref:System.Activities.WorkflowApplication.Cancel%2A> method of the <xref:System.Activities.WorkflowApplication> instance that is hosting the workflow.</span></span> <span data-ttu-id="f93e3-121">V následujícím příkladu se vytvoří pracovní postup, který má <xref:System.Activities.Statements.CancellationScope>.</span><span class="sxs-lookup"><span data-stu-id="f93e3-121">In the following example a workflow is created that has a <xref:System.Activities.Statements.CancellationScope>.</span></span> <span data-ttu-id="f93e3-122">Pracovní postup je voláno, a pak hostitele zavolá <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span><span class="sxs-lookup"><span data-stu-id="f93e3-122">The workflow is invoked, and then the host makes a call to <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span></span> <span data-ttu-id="f93e3-123">Hlavní spuštění pracovního postupu je zastavena, <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> z <xref:System.Activities.Statements.CancellationScope> je vyvolána, a pak dokončení pracovního postupu se stavem <xref:System.Activities.ActivityInstanceState.Canceled>.</span><span class="sxs-lookup"><span data-stu-id="f93e3-123">The main execution of the workflow is stopped, the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of the <xref:System.Activities.Statements.CancellationScope> is invoked, and then the workflow completes with a status of <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#35](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#35)]  
  
 <span data-ttu-id="f93e3-124">Po vyvolání tento pracovní postup se zobrazí následující výstup do konzoly.</span><span class="sxs-lookup"><span data-stu-id="f93e3-124">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="f93e3-125">**Spouštění pracovního postupu.**</span><span class="sxs-lookup"><span data-stu-id="f93e3-125">**Starting the workflow.**</span></span>  
<span data-ttu-id="f93e3-126">**CancellationHandler vyvolat.** </span><span class="sxs-lookup"><span data-stu-id="f93e3-126">**CancellationHandler invoked.** </span></span>  
<span data-ttu-id="f93e3-127">**Pracovní postup b30ebb30-df46-4d90-a211-e31c38d8db3c zrušena.**</span><span class="sxs-lookup"><span data-stu-id="f93e3-127">**Workflow b30ebb30-df46-4d90-a211-e31c38d8db3c Canceled.**</span></span>    
> [!NOTE]
>  <span data-ttu-id="f93e3-128">Když <xref:System.Activities.Statements.CancellationScope> aktivity se zruší a <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> vyvolána, má na starosti Autor pracovního postupu k určení průběh, aby bylo možné poskytnout příslušné zrušení logiku byla zrušena zrušené aktivity provedené před ním.</span><span class="sxs-lookup"><span data-stu-id="f93e3-128">When a <xref:System.Activities.Statements.CancellationScope> activity is canceled and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> invoked, it is the responsibility of the workflow author to determine the progress that the canceled activity made before it was canceled in order to provide the appropriate cancellation logic.</span></span> <span data-ttu-id="f93e3-129"><xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> Neposkytuje žádné informace o průběhu zrušené aktivity.</span><span class="sxs-lookup"><span data-stu-id="f93e3-129">The <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> does not provide any information about the progress of the canceled activity.</span></span>  
  
 <span data-ttu-id="f93e3-130">Pracovní postup lze také zrušit z hostitele k neošetřené výjimce bubliny až po kořenu pracovního postupu a <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> obslužná rutina vrátí <xref:System.Activities.UnhandledExceptionAction.Cancel>.</span><span class="sxs-lookup"><span data-stu-id="f93e3-130">A workflow can also be canceled from the host if an unhandled exception bubbles up past the root of the workflow and the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler returns <xref:System.Activities.UnhandledExceptionAction.Cancel>.</span></span> <span data-ttu-id="f93e3-131">V tomto příkladu spustí pracovní postup a potom vyvolá <xref:System.ApplicationException>.</span><span class="sxs-lookup"><span data-stu-id="f93e3-131">In this example the workflow starts and then throws an <xref:System.ApplicationException>.</span></span> <span data-ttu-id="f93e3-132">Tato výjimka se neošetřená v tomto pracovním postupu a proto <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> je volána obslužná rutina.</span><span class="sxs-lookup"><span data-stu-id="f93e3-132">This exception is unhandled by the workflow and so the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler is invoked.</span></span> <span data-ttu-id="f93e3-133">Obslužná rutina dá pokyn modulu runtime pracovního postupu, zrušit a <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> z aktuálně spuštěných <xref:System.Activities.Statements.CancellationScope> aktivity vyvolání.</span><span class="sxs-lookup"><span data-stu-id="f93e3-133">The handler instructs the runtime to cancel the workflow, and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of the currently executing <xref:System.Activities.Statements.CancellationScope> activity is invoked.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#36](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#36)]  
  
 <span data-ttu-id="f93e3-134">Po vyvolání tento pracovní postup se zobrazí následující výstup do konzoly.</span><span class="sxs-lookup"><span data-stu-id="f93e3-134">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="f93e3-135">**Spouštění pracovního postupu.**</span><span class="sxs-lookup"><span data-stu-id="f93e3-135">**Starting the workflow.**</span></span>  
<span data-ttu-id="f93e3-136">**OnUnhandledException v 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9 pracovního postupu** </span><span class="sxs-lookup"><span data-stu-id="f93e3-136">**OnUnhandledException in Workflow 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9** </span></span>  
<span data-ttu-id="f93e3-137">**ApplicationException – byla vyvolána.** </span><span class="sxs-lookup"><span data-stu-id="f93e3-137">**An ApplicationException was thrown.** </span></span>  
<span data-ttu-id="f93e3-138">**CancellationHandler vyvolat.** </span><span class="sxs-lookup"><span data-stu-id="f93e3-138">**CancellationHandler invoked.** </span></span>  
<span data-ttu-id="f93e3-139">**Pracovní postup 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9 zrušena.**</span><span class="sxs-lookup"><span data-stu-id="f93e3-139">**Workflow 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9 Canceled.**</span></span>    
### <a name="canceling-an-activity-from-inside-a-workflow"></a><span data-ttu-id="f93e3-140">Probíhá zrušení aktivity z uvnitř pracovního postupu</span><span class="sxs-lookup"><span data-stu-id="f93e3-140">Canceling an Activity from Inside a Workflow</span></span>  
 <span data-ttu-id="f93e3-141">Aktivitu můžete také zrušeno jeho nadřazený objekt.</span><span class="sxs-lookup"><span data-stu-id="f93e3-141">An activity can also be canceled by its parent.</span></span> <span data-ttu-id="f93e3-142">Například pokud <xref:System.Activities.Statements.Parallel> aktivita má více větví provádění a jeho <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> vyhodnocuje `true` a jeho nedokončené větve, budou zrušeny.</span><span class="sxs-lookup"><span data-stu-id="f93e3-142">For example, if a <xref:System.Activities.Statements.Parallel> activity has multiple executing branches and its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> evaluates to `true` then its incomplete branches will be canceled.</span></span> <span data-ttu-id="f93e3-143">V tomto příkladu <xref:System.Activities.Statements.Parallel> je vytvořena aktivita, která má dvě pobočky.</span><span class="sxs-lookup"><span data-stu-id="f93e3-143">In this example a <xref:System.Activities.Statements.Parallel> activity is created that has two branches.</span></span> <span data-ttu-id="f93e3-144">Jeho <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> je nastaven na `true` proto <xref:System.Activities.Statements.Parallel> dokončí při dokončení některého z jeho větve.</span><span class="sxs-lookup"><span data-stu-id="f93e3-144">Its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> is set to `true` so the <xref:System.Activities.Statements.Parallel> completes as soon as any one of its branches is completed.</span></span> <span data-ttu-id="f93e3-145">V tomto příkladu větve 2 dokončí, a proto zrušena větve 1.</span><span class="sxs-lookup"><span data-stu-id="f93e3-145">In this example branch 2 completes, and so branch 1 is canceled.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#37](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#37)]  
  
 <span data-ttu-id="f93e3-146">Po vyvolání tento pracovní postup se zobrazí následující výstup do konzoly.</span><span class="sxs-lookup"><span data-stu-id="f93e3-146">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="f93e3-147">**Větev, od 1.**</span><span class="sxs-lookup"><span data-stu-id="f93e3-147">**Branch 1 starting.**</span></span>  
<span data-ttu-id="f93e3-148">**Větev 2 dokončení.** </span><span class="sxs-lookup"><span data-stu-id="f93e3-148">**Branch 2 complete.** </span></span>  
<span data-ttu-id="f93e3-149">**Větev 1 zrušena.** </span><span class="sxs-lookup"><span data-stu-id="f93e3-149">**Branch 1 canceled.** </span></span>  
<span data-ttu-id="f93e3-150">**Pracovní postup e0685e24-18ef-4a47-acf3-5c638732f3be byla dokončena.**</span><span class="sxs-lookup"><span data-stu-id="f93e3-150">**Workflow e0685e24-18ef-4a47-acf3-5c638732f3be Completed.**</span></span>  <span data-ttu-id="f93e3-151">Aktivity jsou také zruší, pokud se výjimka bubliny až po kořenu aktivity, ale je zpracováván na vyšší úrovni v pracovním postupu.</span><span class="sxs-lookup"><span data-stu-id="f93e3-151">Activities are also canceled if an exception bubbles up past the root of the activity but is handled at a higher level in the workflow.</span></span> <span data-ttu-id="f93e3-152">V tomto příkladu Hlavní logika pracovního postupu se skládá z <xref:System.Activities.Statements.Sequence> aktivity.</span><span class="sxs-lookup"><span data-stu-id="f93e3-152">In this example, the main logic of the workflow consists of a <xref:System.Activities.Statements.Sequence> activity.</span></span> <span data-ttu-id="f93e3-153"><xref:System.Activities.Statements.Sequence> Je zadán jako <xref:System.Activities.Statements.CancellationScope.Body%2A> z <xref:System.Activities.Statements.CancellationScope> aktivity, který je obsažený v <xref:System.Activities.Statements.TryCatch> aktivity.</span><span class="sxs-lookup"><span data-stu-id="f93e3-153">The <xref:System.Activities.Statements.Sequence> is specified as the <xref:System.Activities.Statements.CancellationScope.Body%2A> of a <xref:System.Activities.Statements.CancellationScope> activity which is contained by a <xref:System.Activities.Statements.TryCatch> activity.</span></span> <span data-ttu-id="f93e3-154">Z textu je vyvolána výjimka <xref:System.Activities.Statements.Sequence>, zpracovává nadřízený objekt <xref:System.Activities.Statements.TryCatch> aktivitu a <xref:System.Activities.Statements.Sequence> je zrušená.</span><span class="sxs-lookup"><span data-stu-id="f93e3-154">An exception is thrown from the body of the <xref:System.Activities.Statements.Sequence>, is handled by the parent <xref:System.Activities.Statements.TryCatch> activity, and the <xref:System.Activities.Statements.Sequence> is canceled.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#39](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#39)]  
  
 <span data-ttu-id="f93e3-155">Po vyvolání tento pracovní postup se zobrazí následující výstup do konzoly.</span><span class="sxs-lookup"><span data-stu-id="f93e3-155">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="f93e3-156">**Pořadí spouštění.**</span><span class="sxs-lookup"><span data-stu-id="f93e3-156">**Sequence starting.**</span></span>  
<span data-ttu-id="f93e3-157">**Pořadí zrušena.** </span><span class="sxs-lookup"><span data-stu-id="f93e3-157">**Sequence canceled.** </span></span>  
<span data-ttu-id="f93e3-158">**Byla zjištěna výjimka.** </span><span class="sxs-lookup"><span data-stu-id="f93e3-158">**Exception caught.** </span></span>  
<span data-ttu-id="f93e3-159">**Pracovní postup e3c18939-121e-4c43-af1c-ba1ce977ce55 byla dokončena.**</span><span class="sxs-lookup"><span data-stu-id="f93e3-159">**Workflow e3c18939-121e-4c43-af1c-ba1ce977ce55 Completed.**</span></span>   
### <a name="throwing-exceptions-from-a-cancellationhandler"></a><span data-ttu-id="f93e3-160">Vyvolání výjimek z CancellationHandler</span><span class="sxs-lookup"><span data-stu-id="f93e3-160">Throwing Exceptions from a CancellationHandler</span></span>  
 <span data-ttu-id="f93e3-161">Jakékoli výjimky vyvolány z <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> z <xref:System.Activities.Statements.CancellationScope> jsou závažné do pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="f93e3-161">Any exceptions thrown from the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of a <xref:System.Activities.Statements.CancellationScope> are fatal to the workflow.</span></span> <span data-ttu-id="f93e3-162">Pokud je možné, výjimek uvozovací znaky z <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>, používat <xref:System.Activities.Statements.TryCatch> v <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> zachytit a zpracování těchto výjimek.</span><span class="sxs-lookup"><span data-stu-id="f93e3-162">If there is a possibility of exceptions escaping from a <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>, use a <xref:System.Activities.Statements.TryCatch> in the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> to catch and handle these exceptions.</span></span>  
  
### <a name="cancellation-using-compensableactivity"></a><span data-ttu-id="f93e3-163">Zrušení pomocí CompensableActivity</span><span class="sxs-lookup"><span data-stu-id="f93e3-163">Cancellation using CompensableActivity</span></span>  
 <span data-ttu-id="f93e3-164">Podobně jako <xref:System.Activities.Statements.CancellationScope> aktivity, <xref:System.Activities.Statements.CompensableActivity> má <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A>.</span><span class="sxs-lookup"><span data-stu-id="f93e3-164">Like the <xref:System.Activities.Statements.CancellationScope> activity, the <xref:System.Activities.Statements.CompensableActivity> has a <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A>.</span></span> <span data-ttu-id="f93e3-165">Pokud <xref:System.Activities.Statements.CompensableActivity> zrušení žádné aktivity v jeho <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> jsou vyvolány.</span><span class="sxs-lookup"><span data-stu-id="f93e3-165">If a <xref:System.Activities.Statements.CompensableActivity> is canceled, any activities in its <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> are invoked.</span></span> <span data-ttu-id="f93e3-166">To může být užitečné pro rušení částečně dokončená compensable práce.</span><span class="sxs-lookup"><span data-stu-id="f93e3-166">This can be useful for undoing partially completed compensable work.</span></span> <span data-ttu-id="f93e3-167">Informace o tom, jak používat <xref:System.Activities.Statements.CompensableActivity> kompenzace a zrušení najdete v tématu [kompenzace](../../../docs/framework/windows-workflow-foundation/compensation.md).</span><span class="sxs-lookup"><span data-stu-id="f93e3-167">For information about how to use <xref:System.Activities.Statements.CompensableActivity> for compensation and cancellation, see [Compensation](../../../docs/framework/windows-workflow-foundation/compensation.md).</span></span>  
  
## <a name="cancellation-using-custom-activities"></a><span data-ttu-id="f93e3-168">Zrušení pomocí vlastních aktivit</span><span class="sxs-lookup"><span data-stu-id="f93e3-168">Cancellation using Custom Activities</span></span>  
 <span data-ttu-id="f93e3-169">Autoři vlastní aktivitu můžete implementovat logiku zrušení do svých vlastních aktivit v několika různými způsoby.</span><span class="sxs-lookup"><span data-stu-id="f93e3-169">Custom activity authors can implement cancellation logic into their custom activities in several different ways.</span></span> <span data-ttu-id="f93e3-170">Vlastní aktivity, které jsou odvozeny od <xref:System.Activities.Activity> můžete implementovat logiku zrušení umístěním <xref:System.Activities.Statements.CancellationScope> nebo další vlastní aktivita, která obsahuje logiku zrušení v těle aktivity.</span><span class="sxs-lookup"><span data-stu-id="f93e3-170">Custom activities that derive from <xref:System.Activities.Activity> can implement cancellation logic by placing a <xref:System.Activities.Statements.CancellationScope> or other custom activity that contains cancellation logic in the body of the activity.</span></span> <span data-ttu-id="f93e3-171"><xref:System.Activities.AsyncCodeActivity>a <xref:System.Activities.NativeActivity> odvozené aktivit můžete přepsat jejich odpovídajících <xref:System.Activities.NativeActivity.Cancel%2A> metoda a poskytují logiku zrušení existuje.</span><span class="sxs-lookup"><span data-stu-id="f93e3-171"><xref:System.Activities.AsyncCodeActivity> and <xref:System.Activities.NativeActivity> derived activities can override their respective <xref:System.Activities.NativeActivity.Cancel%2A> method and provide cancellation logic there.</span></span> <span data-ttu-id="f93e3-172"><xref:System.Activities.CodeActivity>odvozené aktivity neposkytují žádné zřídit pro zrušení, protože všechny práci se provádí v jednom shluku provádění při volání modulu runtime <xref:System.Activities.CodeActivity.Execute%2A> metoda.</span><span class="sxs-lookup"><span data-stu-id="f93e3-172"><xref:System.Activities.CodeActivity> derived activities do not provide any provision for cancellation because all their work is performed in a single burst of execution when the runtime calls the <xref:System.Activities.CodeActivity.Execute%2A> method.</span></span> <span data-ttu-id="f93e3-173">Pokud ještě nebyla byla volána metoda execute a <xref:System.Activities.CodeActivity> na základě aktivity se zruší, zavře aktivitu se stavem <xref:System.Activities.ActivityInstanceState.Canceled> a <xref:System.Activities.CodeActivity.Execute%2A> metoda není volána.</span><span class="sxs-lookup"><span data-stu-id="f93e3-173">If the execute method has not yet been called and a <xref:System.Activities.CodeActivity> based activity is canceled, the activity closes with a status of <xref:System.Activities.ActivityInstanceState.Canceled> and the <xref:System.Activities.CodeActivity.Execute%2A> method is not called.</span></span>  
  
### <a name="cancellation-using-nativeactivity"></a><span data-ttu-id="f93e3-174">Zrušení pomocí NativeActivity</span><span class="sxs-lookup"><span data-stu-id="f93e3-174">Cancellation using NativeActivity</span></span>  
 <span data-ttu-id="f93e3-175"><xref:System.Activities.NativeActivity>odvozené aktivit můžete přepsat <xref:System.Activities.NativeActivity.Cancel%2A> metody můžete zajistit vlastní zrušení logiku.</span><span class="sxs-lookup"><span data-stu-id="f93e3-175"><xref:System.Activities.NativeActivity> derived activities can override the <xref:System.Activities.NativeActivity.Cancel%2A> method to provide custom cancellation logic.</span></span> <span data-ttu-id="f93e3-176">Pokud není tato metoda potlačena, je použita výchozí logiku zrušení pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="f93e3-176">If this method is not overridden, then the default workflow cancellation logic is applied.</span></span> <span data-ttu-id="f93e3-177">Zrušení výchozí je proces, který dochází <xref:System.Activities.NativeActivity> , nemůže přepsat <xref:System.Activities.NativeActivity.Cancel%2A> metoda nebo jehož <xref:System.Activities.NativeActivity.Cancel%2A> metoda volá základní <xref:System.Activities.NativeActivity> <xref:System.Activities.NativeActivity.Cancel%2A> metoda.</span><span class="sxs-lookup"><span data-stu-id="f93e3-177">Default cancellation is the process that occurs for a <xref:System.Activities.NativeActivity> that does not override the <xref:System.Activities.NativeActivity.Cancel%2A> method or whose <xref:System.Activities.NativeActivity.Cancel%2A> method calls the base <xref:System.Activities.NativeActivity> <xref:System.Activities.NativeActivity.Cancel%2A> method.</span></span> <span data-ttu-id="f93e3-178">Při zrušení aktivitu modul runtime flags aktivity pro zrušení a automaticky zpracovává určité čištění.</span><span class="sxs-lookup"><span data-stu-id="f93e3-178">When an activity is canceled, the runtime flags the activity for cancellation and automatically handles certain cleanup.</span></span> <span data-ttu-id="f93e3-179">Pokud aktivita má jenom zbývající záložky, záložky se odeberou a aktivity budou označeny jako <xref:System.Activities.ActivityInstanceState.Canceled>.</span><span class="sxs-lookup"><span data-stu-id="f93e3-179">If the activity only has outstanding bookmarks, the bookmarks will be removed and the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="f93e3-180">Žádné nevyřízené podřízené aktivity zrušené aktivity budou naopak zrušeny.</span><span class="sxs-lookup"><span data-stu-id="f93e3-180">Any outstanding child activities of the canceled activity will in turn be canceled.</span></span> <span data-ttu-id="f93e3-181">Pokusy o naplánovat další podřízené aktivity bude mít za následek pokus bude ignorována a aktivity budou označeny jako <xref:System.Activities.ActivityInstanceState.Canceled>.</span><span class="sxs-lookup"><span data-stu-id="f93e3-181">Any attempt to schedule additional child activities will result in the attempt being ignored and the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="f93e3-182">Pokud dokončení všech zbývajících podřízené aktivity v <xref:System.Activities.ActivityInstanceState.Canceled> nebo <xref:System.Activities.ActivityInstanceState.Faulted> stavu, pak aktivity budou označeny jako <xref:System.Activities.ActivityInstanceState.Canceled>.</span><span class="sxs-lookup"><span data-stu-id="f93e3-182">If any outstanding child activity completes in the <xref:System.Activities.ActivityInstanceState.Canceled> or <xref:System.Activities.ActivityInstanceState.Faulted> state, then the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="f93e3-183">Všimněte si, že žádost o zrušení můžete ignorovat.</span><span class="sxs-lookup"><span data-stu-id="f93e3-183">Note that a cancellation request can be ignored.</span></span> <span data-ttu-id="f93e3-184">Pokud aktivita nemá žádné nevyřízené záložky nebo provádění podřízené aktivity a naplánovat není žádné další pracovní položky po opatření příznakem pro zrušení, bude úspěšně dokončena.</span><span class="sxs-lookup"><span data-stu-id="f93e3-184">If an activity does not have any outstanding bookmarks or executing child activities and does not schedule any additional work items after being flagged for cancellation, it will complete successfully.</span></span> <span data-ttu-id="f93e3-185">Tento výchozí zrušení přípony pro mnoho scénářů, ale je potřeba další zrušení logiku, pak předdefinované zrušení aktivity nebo vlastní aktivity lze nastavit.</span><span class="sxs-lookup"><span data-stu-id="f93e3-185">This default cancellation suffices for many scenarios, but if additional cancellation logic is needed, then the built-in cancellation activities or custom activities can be used.</span></span>  
  
 <span data-ttu-id="f93e3-186">V následujícím příkladu <xref:System.Activities.NativeActivity.Cancel%2A> přepsat z <xref:System.Activities.NativeActivity> na základě vlastní `ParallelForEach` aktivity je definována.</span><span class="sxs-lookup"><span data-stu-id="f93e3-186">In the following example, the <xref:System.Activities.NativeActivity.Cancel%2A> override of a <xref:System.Activities.NativeActivity> based custom `ParallelForEach` activity is defined.</span></span> <span data-ttu-id="f93e3-187">Při zrušení aktivity toto přepsání zpracovává zrušení logiku pro aktivitu.</span><span class="sxs-lookup"><span data-stu-id="f93e3-187">When the activity is canceled, this override handles the cancellation logic for the activity.</span></span> <span data-ttu-id="f93e3-188">Tato ukázka je součástí [ParallelForEach Non-Obecné](../../../docs/framework/windows-workflow-foundation/samples/non-generic-parallelforeach.md) ukázka.</span><span class="sxs-lookup"><span data-stu-id="f93e3-188">This example is part of the [Non-Generic ParallelForEach](../../../docs/framework/windows-workflow-foundation/samples/non-generic-parallelforeach.md) sample.</span></span>  
  
```csharp  
protected override void Cancel(NativeActivityContext context)  
{  
    // If we do not have a completion condition then we can just  
    // use default logic.  
    if (this.CompletionCondition == null)  
    {  
        base.Cancel(context);  
    }  
    else  
    {  
        context.CancelChildren();  
    }  
}  
```  
  
 <span data-ttu-id="f93e3-189"><xref:System.Activities.NativeActivity>odvozené aktivity můžete určit, pokud zrušení požaduje zkontrolováním <xref:System.Activities.NativeActivityContext.IsCancellationRequested%2A> vlastnost a sami označit jako zrušená voláním <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> metoda.</span><span class="sxs-lookup"><span data-stu-id="f93e3-189"><xref:System.Activities.NativeActivity> derived activities can determine if cancellation has been requested by inspecting the <xref:System.Activities.NativeActivityContext.IsCancellationRequested%2A> property, and mark themselves as canceled by calling the <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> method.</span></span> <span data-ttu-id="f93e3-190">Volání metody <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> okamžitě nedokončí aktivity.</span><span class="sxs-lookup"><span data-stu-id="f93e3-190">Calling <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> does not immediately complete the activity.</span></span> <span data-ttu-id="f93e3-191">Modul runtime jako obvykle dokončí aktivity, když nemá žádné další zbývající práce, ale pokud <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> se označuje jako konečné stavu bude <xref:System.Activities.ActivityInstanceState.Canceled> místo <xref:System.Activities.ActivityInstanceState.Closed>.</span><span class="sxs-lookup"><span data-stu-id="f93e3-191">As usual, the runtime will complete the activity when it has no more outstanding work, but if <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> is called the final state will be <xref:System.Activities.ActivityInstanceState.Canceled> instead of <xref:System.Activities.ActivityInstanceState.Closed>.</span></span>  
  
### <a name="cancellation-using-asynccodeactivity"></a><span data-ttu-id="f93e3-192">Zrušení pomocí AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="f93e3-192">Cancellation using AsyncCodeActivity</span></span>  
 <span data-ttu-id="f93e3-193"><xref:System.Activities.AsyncCodeActivity>na základě aktivity můžete taky zadat vlastní zrušení logiku přepsáním <xref:System.Activities.AsyncCodeActivity.Cancel%2A> metoda.</span><span class="sxs-lookup"><span data-stu-id="f93e3-193"><xref:System.Activities.AsyncCodeActivity> based activities can also provide custom cancellation logic by overriding the <xref:System.Activities.AsyncCodeActivity.Cancel%2A> method.</span></span> <span data-ttu-id="f93e3-194">Pokud není tato metoda potlačena, se provádí žádné zpracování zrušení, pokud došlo ke zrušení aktivity.</span><span class="sxs-lookup"><span data-stu-id="f93e3-194">If this method is not overridden, then no cancellation handling is performed if the activity is canceled.</span></span> <span data-ttu-id="f93e3-195">V následujícím příkladu <xref:System.Activities.AsyncCodeActivity.Cancel%2A> přepsat z <xref:System.Activities.AsyncCodeActivity> na základě vlastní `ExecutePowerShell` aktivity je definována.</span><span class="sxs-lookup"><span data-stu-id="f93e3-195">In the following example, the <xref:System.Activities.AsyncCodeActivity.Cancel%2A> override of an <xref:System.Activities.AsyncCodeActivity> based custom `ExecutePowerShell` activity is defined.</span></span> <span data-ttu-id="f93e3-196">Po zrušení aktivity provede požadované zrušení chování.</span><span class="sxs-lookup"><span data-stu-id="f93e3-196">When the activity is canceled, it performs the desired cancellation behavior.</span></span> <span data-ttu-id="f93e3-197">Tato ukázka je součástí [pomocí aktivity InvokePowerShell](../../../docs/framework/windows-workflow-foundation/samples/using-the-invokepowershell-activity.md) ukázka.</span><span class="sxs-lookup"><span data-stu-id="f93e3-197">This example is part of the [Using the InvokePowerShell Activity](../../../docs/framework/windows-workflow-foundation/samples/using-the-invokepowershell-activity.md) sample.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#1020](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#1020)]  
  
 <span data-ttu-id="f93e3-198"><xref:System.Activities.AsyncCodeActivity>odvozené aktivity můžete určit, pokud zrušení požaduje zkontrolováním <xref:System.Activities.AsyncCodeActivityContext.IsCancellationRequested%2A> vlastnost a sami označit jako zrušená voláním <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A> metoda.</span><span class="sxs-lookup"><span data-stu-id="f93e3-198"><xref:System.Activities.AsyncCodeActivity> derived activities can determine if cancellation has been requested by inspecting the <xref:System.Activities.AsyncCodeActivityContext.IsCancellationRequested%2A> property, and mark themselves as canceled by calling the <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A> method.</span></span>
