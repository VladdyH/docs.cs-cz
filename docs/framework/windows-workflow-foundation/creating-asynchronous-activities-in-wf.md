---
title: Vytváření asynchronních aktivit v WF
ms.date: 03/30/2017
ms.assetid: 497e81ed-5eef-460c-ba55-fae73c05824f
ms.openlocfilehash: 8df876c9be020ece29683d1c101a4045b1c76322
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 05/04/2018
ms.locfileid: "33520065"
---
# <a name="creating-asynchronous-activities-in-wf"></a><span data-ttu-id="81576-102">Vytváření asynchronních aktivit v WF</span><span class="sxs-lookup"><span data-stu-id="81576-102">Creating Asynchronous Activities in WF</span></span>
<span data-ttu-id="81576-103"><xref:System.Activities.AsyncCodeActivity> poskytuje základní třídu používat, že umožňuje odvozené aktivity pro implementaci asynchronního spuštění logiku autoři aktivity.</span><span class="sxs-lookup"><span data-stu-id="81576-103"><xref:System.Activities.AsyncCodeActivity> provides activity authors a base class to use that enables derived activities to implement asynchronous execution logic.</span></span> <span data-ttu-id="81576-104">To je užitečné pro vlastní aktivity, které musíte provést asynchronní pracovní bez podržte podprocesu plánovače pracovního postupu a blokuje veškeré aktivity, které pravděpodobně bude moci spustit souběžně.</span><span class="sxs-lookup"><span data-stu-id="81576-104">This is useful for custom activities that must perform asynchronous work without holding the workflow scheduler thread and blocking any activities that may be able to run in parallel.</span></span> <span data-ttu-id="81576-105">Toto téma obsahuje přehled o tom, jak vytvořit vlastní asynchronní aktivity pomocí <xref:System.Activities.AsyncCodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="81576-105">This topic provides an overview of how to create custom asynchronous activities using <xref:System.Activities.AsyncCodeActivity>.</span></span>  
  
## <a name="using-asynccodeactivity"></a><span data-ttu-id="81576-106">Pomocí AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="81576-106">Using AsyncCodeActivity</span></span>  
 <span data-ttu-id="81576-107"><xref:System.Activities?displayProperty=nameWithType> vlastní aktivity autoři poskytuje různé základní třídy pro požadavky na autorizaci jiné aktivitě.</span><span class="sxs-lookup"><span data-stu-id="81576-107"><xref:System.Activities?displayProperty=nameWithType> provides custom activity authors with different base classes for different activity authoring requirements.</span></span> <span data-ttu-id="81576-108">Každé z nich představuje konkrétní sémantického a poskytuje Autor pracovního postupu (a aktivity runtime) odpovídající kontrakt.</span><span class="sxs-lookup"><span data-stu-id="81576-108">Each one carries a particular semantic and provides a workflow author (and the activity runtime) a corresponding contract.</span></span> <span data-ttu-id="81576-109"><xref:System.Activities.AsyncCodeActivity> Na základě aktivity je aktivitou, která provede práci asynchronně relativně k plánovač vláken a jehož logiky provádění vyjádřeného v spravovaný kód.</span><span class="sxs-lookup"><span data-stu-id="81576-109">An <xref:System.Activities.AsyncCodeActivity> based activity is an activity that performs work asynchronously relative to the scheduler thread and whose execution logic is expressed in managed code.</span></span> <span data-ttu-id="81576-110">V důsledku asynchronní, přejdete <xref:System.Activities.AsyncCodeActivity> může vyvolávat bod nečinnosti během provádění.</span><span class="sxs-lookup"><span data-stu-id="81576-110">As a result of going asynchronous, an <xref:System.Activities.AsyncCodeActivity> may induce an idle point during execution.</span></span> <span data-ttu-id="81576-111">Vzhledem k povaze volatile asynchronní práce <xref:System.Activities.AsyncCodeActivity> vždy vytvoří blok žádné zachovat po dobu trvání provádění aktivity.</span><span class="sxs-lookup"><span data-stu-id="81576-111">Due to the volatile nature of asynchronous work, an <xref:System.Activities.AsyncCodeActivity> always creates a no persist block for the duration of the activity’s execution.</span></span> <span data-ttu-id="81576-112">To zabrání modulu runtime pracovního postupu uložením k instanci pracovního postupu uprostřed asynchronní pracovní a rovněž zamezí k instanci pracovního postupu z uvolnění chvíli kód asynchronní provádění.</span><span class="sxs-lookup"><span data-stu-id="81576-112">This prevents the workflow runtime from persisting the workflow instance in the middle of the asynchronous work, and also prevents the workflow instance from unloading while the asynchronous code is executing.</span></span>  
  
### <a name="asynccodeactivity-methods"></a><span data-ttu-id="81576-113">AsyncCodeActivity metody</span><span class="sxs-lookup"><span data-stu-id="81576-113">AsyncCodeActivity Methods</span></span>  
 <span data-ttu-id="81576-114">Aktivity, které jsou odvozeny od <xref:System.Activities.AsyncCodeActivity> můžete vytvořit logiku asynchronního spuštění přepsáním <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> a <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> metody s vlastní kód.</span><span class="sxs-lookup"><span data-stu-id="81576-114">Activities that derive from <xref:System.Activities.AsyncCodeActivity> can create asynchronous execution logic by overriding the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> methods with custom code.</span></span> <span data-ttu-id="81576-115">Při volání modulem runtime, se předávají tyto metody <xref:System.Activities.AsyncCodeActivityContext>.</span><span class="sxs-lookup"><span data-stu-id="81576-115">When called by the runtime, these methods are passed an <xref:System.Activities.AsyncCodeActivityContext>.</span></span> <span data-ttu-id="81576-116"><xref:System.Activities.AsyncCodeActivityContext> umožňuje autorovi aktivity poskytnutí sdílené mezi <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> /  <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> v daném kontextu <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> vlastnost.</span><span class="sxs-lookup"><span data-stu-id="81576-116"><xref:System.Activities.AsyncCodeActivityContext> allows the activity author to provide shared state across <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>/ <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> in the context’s <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> property.</span></span> <span data-ttu-id="81576-117">V následujícím příkladu `GenerateRandom` aktivity asynchronně generuje náhodné číslo.</span><span class="sxs-lookup"><span data-stu-id="81576-117">In the following example, a `GenerateRandom` activity generates a random number asynchronously.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#8](../../../samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#8)]  
  
 <span data-ttu-id="81576-118">Předchozí příklad aktivita je odvozena z <xref:System.Activities.AsyncCodeActivity%601>, a má se zvýšenými oprávněními `OutArgument<int>` s názvem `Result`.</span><span class="sxs-lookup"><span data-stu-id="81576-118">The previous example activity derives from <xref:System.Activities.AsyncCodeActivity%601>, and has an elevated `OutArgument<int>` named `Result`.</span></span> <span data-ttu-id="81576-119">Hodnoty vrácené `GetRandom` metoda je extrahována a vrácené <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> override a tato hodnota je nastavena jako `Result` hodnotu.</span><span class="sxs-lookup"><span data-stu-id="81576-119">The value returned by the `GetRandom` method is extracted and returned by the <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> override, and this value is set as the `Result` value.</span></span> <span data-ttu-id="81576-120">Asynchronní aktivity, které nevracejí výsledek by měl být odvozen z <xref:System.Activities.AsyncCodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="81576-120">Asynchronous activities that do not return a result should derive from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="81576-121">V následujícím příkladu `DisplayRandom` aktivity je definován, která je odvozena z <xref:System.Activities.AsyncCodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="81576-121">In the following example, a `DisplayRandom` activity is defined which derives from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="81576-122">Tato aktivita je stejná jako `GetRandom` aktivity, ale místo vrácením výsledku zobrazí zprávu do konzoly.</span><span class="sxs-lookup"><span data-stu-id="81576-122">This activity is like the `GetRandom` activity but instead of returning a result it displays a message to the console.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#11](../../../samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#11)]  
  
 <span data-ttu-id="81576-123">Všimněte si, že vzhledem k tomu, že je žádnou návratovou hodnotu `DisplayRandom` používá <xref:System.Action> místo <xref:System.Func%602> k vyvolání jeho delegáta a delegát nevrací žádnou hodnotu.</span><span class="sxs-lookup"><span data-stu-id="81576-123">Note that because there is no return value, `DisplayRandom` uses an <xref:System.Action> instead of a <xref:System.Func%602> to invoke its delegate, and the delegate returns no value.</span></span>  
  
 <span data-ttu-id="81576-124"><xref:System.Activities.AsyncCodeActivity> také poskytuje <xref:System.Activities.AsyncCodeActivity.Cancel%2A> přepsat.</span><span class="sxs-lookup"><span data-stu-id="81576-124"><xref:System.Activities.AsyncCodeActivity> also provides a <xref:System.Activities.AsyncCodeActivity.Cancel%2A> override.</span></span> <span data-ttu-id="81576-125">Při <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> a <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> jsou požadované přepisy <xref:System.Activities.AsyncCodeActivity.Cancel%2A> je volitelný a může být přepsána tak aktivity můžete vyčistit stav nezpracovaných asynchronní při jeho zrušena nebo přerušena.</span><span class="sxs-lookup"><span data-stu-id="81576-125">While <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> are required overrides, <xref:System.Activities.AsyncCodeActivity.Cancel%2A> is optional, and can be overridden so the activity can clean up its outstanding asynchronous state when it is being canceled or aborted.</span></span> <span data-ttu-id="81576-126">Pokud vyčištění je možné, a `AsyncCodeActivity.ExecutingActivityInstance.IsCancellationRequested` je `true`, by měly volat aktivity <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A>.</span><span class="sxs-lookup"><span data-stu-id="81576-126">If clean up is possible and `AsyncCodeActivity.ExecutingActivityInstance.IsCancellationRequested` is `true`, the activity should call <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A>.</span></span> <span data-ttu-id="81576-127">Jakékoli výjimky vyvolány z této metody jsou závažné k instanci pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="81576-127">Any exceptions thrown from this method are fatal to the workflow instance.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#10](../../../samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#10)]  
  
### <a name="invoking-asynchronous-methods-on-a-class"></a><span data-ttu-id="81576-128">Volání asynchronních metod třídy</span><span class="sxs-lookup"><span data-stu-id="81576-128">Invoking Asynchronous Methods on a Class</span></span>  
 <span data-ttu-id="81576-129">Mnoho tříd v [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] asynchronní nakonfigurovánu a tato funkce umožňuje asynchronně volání pomocí <xref:System.Activities.AsyncCodeActivity> na základě aktivity.</span><span class="sxs-lookup"><span data-stu-id="81576-129">Many of the classes in the [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] provide asynchronous functionality, and this functionality can be asynchronously invoked by using an <xref:System.Activities.AsyncCodeActivity> based activity.</span></span> <span data-ttu-id="81576-130">V následujícím příkladu z [pomocí AsyncOperationContext v aktivitě](../../../docs/framework/windows-workflow-foundation/samples/using-asyncoperationcontext-in-an-activity-sample.md), aktivita je vytvořen, který asynchronně vytvoří soubor pomocí <xref:System.IO.FileStream> třídy.</span><span class="sxs-lookup"><span data-stu-id="81576-130">In the following example from the [Using AsyncOperationContext in an Activity](../../../docs/framework/windows-workflow-foundation/samples/using-asyncoperationcontext-in-an-activity-sample.md), an activity is created that asynchronously creates a file by using the <xref:System.IO.FileStream> class.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#12](../../../samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#12)]  
  
### <a name="sharing-state-between-the-beginexecute-and-endexecute-methods"></a><span data-ttu-id="81576-131">Sdílení stavu mezi BeginExecute a EndExecute metody</span><span class="sxs-lookup"><span data-stu-id="81576-131">Sharing State Between the BeginExecute and EndExecute Methods</span></span>  
 <span data-ttu-id="81576-132">V předchozím příkladu <xref:System.IO.FileStream> objekt, který byl vytvořen v <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> v přístupu <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="81576-132">In the previous example, the <xref:System.IO.FileStream> object that was created in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> was accessed in the <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="81576-133">To je možné, protože `file` proměnná byla předána <xref:System.Activities.AsyncCodeActivityContext.UserState%2A?displayProperty=nameWithType> vlastnost v <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="81576-133">This is possible because the `file` variable was passed in the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A?displayProperty=nameWithType> property in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span></span> <span data-ttu-id="81576-134">Toto je správný způsob pro sdílení stavu mezi <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> a <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="81576-134">This is the correct method for sharing state between <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="81576-135">Je nesprávný pro použití v odvozené třídě členské proměnné (`FileWriter` v tomto případě) ke sdílení stavu mezi <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> a <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> vzhledem k tomu, že objekt aktivity může být odkazován více instancemi aktivity.</span><span class="sxs-lookup"><span data-stu-id="81576-135">It is incorrect to use a member variable in the derived class (`FileWriter` in this case) to share state between <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> because the activity object may be referenced by multiple activity instances.</span></span> <span data-ttu-id="81576-136">Pokus o použití členské proměnné sdílet stavu může mít za následek hodnoty z jednoho <xref:System.Activities.ActivityInstance> přepsání nebo využívání hodnoty z jiné <xref:System.Activities.ActivityInstance>.</span><span class="sxs-lookup"><span data-stu-id="81576-136">Attempting to use a member variable to share state can result in values from one <xref:System.Activities.ActivityInstance> overwriting or consuming values from another <xref:System.Activities.ActivityInstance>.</span></span>  
  
### <a name="accessing-argument-values"></a><span data-ttu-id="81576-137">Přístup k argumentu hodnoty</span><span class="sxs-lookup"><span data-stu-id="81576-137">Accessing Argument Values</span></span>  
 <span data-ttu-id="81576-138">Prostředí <xref:System.Activities.AsyncCodeActivity> se skládá z argumentů definované na aktivity.</span><span class="sxs-lookup"><span data-stu-id="81576-138">The environment of an <xref:System.Activities.AsyncCodeActivity> consists of the arguments defined on the activity.</span></span> <span data-ttu-id="81576-139">Tyto argumenty je přístupná z <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> / <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> přepsání pomocí <xref:System.Activities.AsyncCodeActivityContext> parametr.</span><span class="sxs-lookup"><span data-stu-id="81576-139">These arguments can be accessed from the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>/<xref:System.Activities.AsyncCodeActivity.EndExecute%2A> overrides using the <xref:System.Activities.AsyncCodeActivityContext> parameter.</span></span> <span data-ttu-id="81576-140">Argumenty, které nejsou přístupné v delegáta, ale argument hodnoty nebo jiné požadovaným datům lze předat v delegáta pomocí jeho parametry.</span><span class="sxs-lookup"><span data-stu-id="81576-140">The arguments cannot be accessed in the delegate, but the argument values or any other desired data can be passed in to the delegate using its parameters.</span></span> <span data-ttu-id="81576-141">V následujícím příkladu je definován náhodné generování číslo aktivity který získá včetně horní mez z jeho `Max` argument.</span><span class="sxs-lookup"><span data-stu-id="81576-141">In the following example, a random number-generating activity is defined that obtains the inclusive upper bound from its `Max` argument.</span></span> <span data-ttu-id="81576-142">Hodnota argumentu je předané do asynchronní kód při vyvolání delegáta.</span><span class="sxs-lookup"><span data-stu-id="81576-142">The value of the argument is passed in to the asynchronous code when the delegate is invoked.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#9](../../../samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#9)]  
  
### <a name="scheduling-actions-or-child-activities-using-asynccodeactivity"></a><span data-ttu-id="81576-143">Plánování akce nebo podřízené aktivity pomocí AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="81576-143">Scheduling Actions or Child Activities Using AsyncCodeActivity</span></span>  
 <span data-ttu-id="81576-144"><xref:System.Activities.AsyncCodeActivity> odvozené vlastních aktivit poskytují metodu pro provádění pracovní asynchronně s ohledem na vlákno pracovního postupu, ale neposkytuje možnost plánování podřízené aktivity nebo akce.</span><span class="sxs-lookup"><span data-stu-id="81576-144"><xref:System.Activities.AsyncCodeActivity> derived custom activities  provide a method for performing work asynchronously with regard to the workflow thread, but do not provide the ability to schedule child activities or actions.</span></span> <span data-ttu-id="81576-145">Asynchronní chování však lze začlenit s plánování aktivit podřízené prostřednictvím složení.</span><span class="sxs-lookup"><span data-stu-id="81576-145">However, asynchronous behavior can be incorporated with scheduling of child activities through composition.</span></span> <span data-ttu-id="81576-146">Asynchronní aktivitu vytvořili a pak se skládá <xref:System.Activities.Activity> nebo <xref:System.Activities.NativeActivity> odvozené aktivity zajistit asynchronní chování a plánování podřízené aktivity nebo akce.</span><span class="sxs-lookup"><span data-stu-id="81576-146">An asynchronous activity can be created, and then composed with an <xref:System.Activities.Activity> or <xref:System.Activities.NativeActivity> derived activity to provide asynchronous behavior and scheduling of child activities or actions.</span></span> <span data-ttu-id="81576-147">Například aktivita by bylo možné vytvořit odvozenou od <xref:System.Activities.Activity>a jako jeho implementace <xref:System.Activities.Statements.Sequence> obsahující asynchronní aktivitu jako i další aktivity, které implementují logiku aktivity.</span><span class="sxs-lookup"><span data-stu-id="81576-147">For example, an activity could be created that derives from <xref:System.Activities.Activity>, and has as its implementation a <xref:System.Activities.Statements.Sequence> containing the asynchronous activity as well the other activities that implement the logic of the activity.</span></span> <span data-ttu-id="81576-148">Další příklady skládání aktivity pomocí <xref:System.Activities.Activity> a <xref:System.Activities.NativeActivity>, najdete v části [postupy: vytvoření aktivity](../../../docs/framework/windows-workflow-foundation/how-to-create-an-activity.md), [možnosti vytváření aktivity](../../../docs/framework/windows-workflow-foundation/activity-authoring-options-in-wf.md)a [složené](../../../docs/framework/windows-workflow-foundation/samples/composite.md) ukázky aktivity.</span><span class="sxs-lookup"><span data-stu-id="81576-148">For more examples of composing activities using <xref:System.Activities.Activity> and <xref:System.Activities.NativeActivity>, see [How to: Create an Activity](../../../docs/framework/windows-workflow-foundation/how-to-create-an-activity.md), [Activity Authoring Options](../../../docs/framework/windows-workflow-foundation/activity-authoring-options-in-wf.md), and the [Composite](../../../docs/framework/windows-workflow-foundation/samples/composite.md) activity samples.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="81576-149">Viz také</span><span class="sxs-lookup"><span data-stu-id="81576-149">See Also</span></span>  
 <xref:System.Action>  
 <xref:System.Func%602>  
 [<span data-ttu-id="81576-150">Použití AsyncOperationContext v aktivitě</span><span class="sxs-lookup"><span data-stu-id="81576-150">Using AsyncOperationContext in an Activity</span></span>](../../../docs/framework/windows-workflow-foundation/samples/using-asyncoperationcontext-in-an-activity-sample.md)
