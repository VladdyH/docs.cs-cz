---
title: "Návod: Vytváření kódu ve scénářích s částečnou důvěryhodností"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- reflection emit, anonymously hosted dynamic methods
- partial trust, reflection
- partial trust, emitting dynamic methods
- reflection emit, partial trust scenarios
- anonymously hosted dynamic methods [.NET Framework]
- emitting dynamic assemblies,partial trust scenarios
- reflection emit, dynamic methods
- dynamic methods
ms.assetid: c45be261-2a9d-4c4e-9bd6-27f0931b7d25
caps.latest.revision: "15"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 835483d740b60f98c3170a590edbfbfbe970d783
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 12/22/2017
---
# <a name="walkthrough-emitting-code-in-partial-trust-scenarios"></a><span data-ttu-id="602c1-102">Návod: Vytváření kódu ve scénářích s částečnou důvěryhodností</span><span class="sxs-lookup"><span data-stu-id="602c1-102">Walkthrough: Emitting Code in Partial Trust Scenarios</span></span>
<span data-ttu-id="602c1-103">Emitování reflexe používá stejné rozhraní API nastavit v úplné nebo částečné důvěryhodnosti, ale některé funkce vyžadují speciální oprávnění v částečně důvěryhodným kódem.</span><span class="sxs-lookup"><span data-stu-id="602c1-103">Reflection emit uses the same API set in full or partial trust, but some features require special permissions in partially trusted code.</span></span> <span data-ttu-id="602c1-104">Kromě toho emitování reflexe má funkci anonymně hostované dynamické metody, která je určená pro použití s částečnou důvěryhodností a transparentní pro zabezpečení sestavení.</span><span class="sxs-lookup"><span data-stu-id="602c1-104">In addition, reflection emit has a feature, anonymously hosted dynamic methods, that is designed to be used with partial trust and by security-transparent assemblies.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="602c1-105">Před [!INCLUDE[net_v35_long](../../../includes/net-v35-long-md.md)], vytváření kódu vyžaduje <xref:System.Security.Permissions.ReflectionPermission> s <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit?displayProperty=nameWithType> příznak.</span><span class="sxs-lookup"><span data-stu-id="602c1-105">Before [!INCLUDE[net_v35_long](../../../includes/net-v35-long-md.md)], emitting code required <xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit?displayProperty=nameWithType> flag.</span></span> <span data-ttu-id="602c1-106">Toto oprávnění je zahrnutá ve výchozím nastavení `FullTrust` a `Intranet` nastaví oprávnění, ale ne v `Internet` sadě oprávnění.</span><span class="sxs-lookup"><span data-stu-id="602c1-106">This permission is included by default in the `FullTrust` and `Intranet` named permission sets, but not in the `Internet` permission set.</span></span> <span data-ttu-id="602c1-107">Proto knihovny může z částečnou důvěryhodností jenom Pokud má <xref:System.Security.SecurityCriticalAttribute> atribut a také provést <xref:System.Security.PermissionSet.Assert%2A> metodu pro <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>.</span><span class="sxs-lookup"><span data-stu-id="602c1-107">Therefore, a library could be used from partial trust only if it had the <xref:System.Security.SecurityCriticalAttribute> attribute and also executed an <xref:System.Security.PermissionSet.Assert%2A> method for <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>.</span></span> <span data-ttu-id="602c1-108">Tyto knihovny vyžadovat kontrolu pozor, zabezpečení, protože chyby kódování může mít za následek celistvosti.</span><span class="sxs-lookup"><span data-stu-id="602c1-108">Such libraries require careful security review because coding errors could result in security holes.</span></span> <span data-ttu-id="602c1-109">[!INCLUDE[net_v35_short](../../../includes/net-v35-short-md.md)] Umožňuje kód pro vypuštění ve scénářích s částečnou důvěryhodností bez vydání všechny požadavky na zabezpečení, protože generování kódu není ze své podstaty privilegovaného operace.</span><span class="sxs-lookup"><span data-stu-id="602c1-109">The [!INCLUDE[net_v35_short](../../../includes/net-v35-short-md.md)] allows code to be emitted in partial trust scenarios without issuing any security demands, because generating code is not inherently a privileged operation.</span></span> <span data-ttu-id="602c1-110">To znamená že generovaný kód má žádná další oprávnění než sestavení, který vysílá ho.</span><span class="sxs-lookup"><span data-stu-id="602c1-110">That is, the generated code has no more permissions than the assembly that emits it.</span></span> <span data-ttu-id="602c1-111">To umožňuje knihovny, které emitování kód transparentní pro zabezpečení a eliminuje nutnost assert <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>tak, aby zápis knihovnu zabezpečené nevyžaduje, aby takové kontrolu důkladné zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="602c1-111">This enables libraries that emit code to be security-transparent and removes the need to assert <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>, so that writing a secure library does not require such a thorough security review.</span></span>  
  
 <span data-ttu-id="602c1-112">Tento návod znázorňuje následující úlohy:</span><span class="sxs-lookup"><span data-stu-id="602c1-112">This walkthrough illustrates the following tasks:</span></span>  
  
-   <span data-ttu-id="602c1-113">[Nastavení jednoduché izolovaného prostoru pro testování částečně důvěryhodného kódu](#Setting_up).</span><span class="sxs-lookup"><span data-stu-id="602c1-113">[Setting up a simple sandbox for testing partially trusted code](#Setting_up).</span></span>  
  
    > [!IMPORTANT]
    >  <span data-ttu-id="602c1-114">Toto je jednoduchý způsob, jak experimentovat s kódem v částečné důvěryhodnosti.</span><span class="sxs-lookup"><span data-stu-id="602c1-114">This is a simple way to experiment with code in partial trust.</span></span> <span data-ttu-id="602c1-115">Pokud chcete spustit kód, který je ve skutečnosti pochází z nedůvěryhodných umístěních, najdete v části [postupy: spuštění částečně důvěryhodného kódu v izolovaném prostoru](../../../docs/framework/misc/how-to-run-partially-trusted-code-in-a-sandbox.md).</span><span class="sxs-lookup"><span data-stu-id="602c1-115">To run code that actually comes from untrusted locations, see [How to: Run Partially Trusted Code in a Sandbox](../../../docs/framework/misc/how-to-run-partially-trusted-code-in-a-sandbox.md).</span></span>  
  
-   <span data-ttu-id="602c1-116">[Spuštění kódu v doménách částečně důvěryhodné aplikace](#Running_code).</span><span class="sxs-lookup"><span data-stu-id="602c1-116">[Running code in partially trusted application domains](#Running_code).</span></span>  
  
-   <span data-ttu-id="602c1-117">[Pomocí anonymně hostované dynamické metody pro vydávání a spouštění kódu v částečné důvěryhodnosti](#Using_methods).</span><span class="sxs-lookup"><span data-stu-id="602c1-117">[Using anonymously hosted dynamic methods to emit and execute code in partial trust](#Using_methods).</span></span>  
  
 <span data-ttu-id="602c1-118">Další informace o vytváření kódu ve scénářích s částečnou důvěryhodností najdete v tématu [problémy se zabezpečením v emitování reflexe](../../../docs/framework/reflection-and-codedom/security-issues-in-reflection-emit.md).</span><span class="sxs-lookup"><span data-stu-id="602c1-118">For more information about emitting code in partial trust scenarios, see [Security Issues in Reflection Emit](../../../docs/framework/reflection-and-codedom/security-issues-in-reflection-emit.md).</span></span>  
  
 <span data-ttu-id="602c1-119">Úplný seznam všech kód ukazuje tyto postupy, najdete v článku [oddílu příklad](#Example) na konci tohoto průvodce.</span><span class="sxs-lookup"><span data-stu-id="602c1-119">For a complete listing of the code shown in these procedures, see the [Example section](#Example) at the end of this walkthrough.</span></span>  
  
<a name="Setting_up"></a>   
## <a name="setting-up-partially-trusted-locations"></a><span data-ttu-id="602c1-120">Nastavení částečně důvěryhodného umístění</span><span class="sxs-lookup"><span data-stu-id="602c1-120">Setting up Partially Trusted Locations</span></span>  
 <span data-ttu-id="602c1-121">Tyto dva postupy ukazují, jak nastavit umístění, ze které můžete testovat kód s částečnou důvěryhodností.</span><span class="sxs-lookup"><span data-stu-id="602c1-121">The following two procedures show how to set up locations from which you can test code with partial trust.</span></span>  
  
-   <span data-ttu-id="602c1-122">První postup ukazuje, jak vytvořit doménu v izolovaném prostoru aplikace, ve kterém je kód udělena oprávnění Internetu.</span><span class="sxs-lookup"><span data-stu-id="602c1-122">The first procedure shows how to create a sandboxed application domain in which code is granted Internet permissions.</span></span>  
  
-   <span data-ttu-id="602c1-123">Druhý postup ukazuje, jak přidat <xref:System.Security.Permissions.ReflectionPermission> s <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> příznak do domény částečně důvěryhodné aplikace, abyste umožnili přístup k privátním data v sestaveních vztahu důvěryhodnosti, menší nebo rovno.</span><span class="sxs-lookup"><span data-stu-id="602c1-123">The second procedure shows how to add <xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> flag to a partially trusted application domain, to enable access to private data in assemblies of equal or lesser trust.</span></span>  
  
### <a name="creating-sandboxed-application-domains"></a><span data-ttu-id="602c1-124">Vytváření v izolovaném prostoru aplikační domény</span><span class="sxs-lookup"><span data-stu-id="602c1-124">Creating Sandboxed Application Domains</span></span>  
 <span data-ttu-id="602c1-125">Pokud chcete vytvořit doménu aplikace, ve kterém se vaše sestavení spouštět s částečnou důvěryhodností, musíte zadat sadu oprávnění lze udělit sestavení pomocí <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> přetížení metody pro vytvoření domény aplikace.</span><span class="sxs-lookup"><span data-stu-id="602c1-125">To create an application domain in which your assemblies run with partial trust, you must specify the set of permissions to be granted to the assemblies by using the <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> method overload to create the application domain.</span></span> <span data-ttu-id="602c1-126">Nejjednodušší způsob, jak určit sady udělení je načíst pojmenovanou sadu ze zásad zabezpečení oprávnění.</span><span class="sxs-lookup"><span data-stu-id="602c1-126">The easiest way to specify the grant set is to retrieve a named permission set from security policy.</span></span>  
  
 <span data-ttu-id="602c1-127">Následující postup vytvoří doméně v izolovaném prostoru aplikace, která používá kód s částečnou důvěryhodností k otestování scénářů, ve kterých emitovaného kód může přistupovat pouze veřejné členy veřejné typy.</span><span class="sxs-lookup"><span data-stu-id="602c1-127">The following procedure creates a sandboxed application domain that runs your code with partial trust, to test scenarios in which emitted code can access only public members of public types.</span></span> <span data-ttu-id="602c1-128">Následující postup ukazuje, jak přidat <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess>, k otestování scénářů, ve kterých můžete přístup emitovaného kód neveřejní typy a členy v sestavení, která jsou udělena oprávnění stejné nebo dřívější.</span><span class="sxs-lookup"><span data-stu-id="602c1-128">A subsequent procedure shows how to add <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess>, to test scenarios in which emitted code can access nonpublic types and members in assemblies that are granted equal or lesser permissions.</span></span>  
  
##### <a name="to-create-an-application-domain-with-partial-trust"></a><span data-ttu-id="602c1-129">Vytvoření domény aplikace s částečnou důvěryhodností</span><span class="sxs-lookup"><span data-stu-id="602c1-129">To create an application domain with partial trust</span></span>  
  
1.  <span data-ttu-id="602c1-130">Vytvořte nastavení oprávnění pro udělení sestavení v doméně aplikace v izolovaném prostoru.</span><span class="sxs-lookup"><span data-stu-id="602c1-130">Create a permission set to grant to the assemblies in the sandboxed application domain.</span></span> <span data-ttu-id="602c1-131">V takovém případě se používá sadu oprávnění zónu Internetu.</span><span class="sxs-lookup"><span data-stu-id="602c1-131">In this case, the permission set of the Internet zone is used.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#2](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#2)]
     [!code-vb[HowToEmitCodeInPartialTrust#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#2)]  
  
2.  <span data-ttu-id="602c1-132">Vytvoření <xref:System.AppDomainSetup> objektu k chybě při inicializaci domény aplikace se cesta k aplikaci.</span><span class="sxs-lookup"><span data-stu-id="602c1-132">Create an <xref:System.AppDomainSetup> object to initialize the application domain with an application path.</span></span>  
  
    > [!IMPORTANT]
    >  <span data-ttu-id="602c1-133">Pro zjednodušení tento příklad kódu používá aktuální složky.</span><span class="sxs-lookup"><span data-stu-id="602c1-133">For simplicity, this code example uses the current folder.</span></span> <span data-ttu-id="602c1-134">Pokud chcete spustit kód, který je ve skutečnosti pochází z Internetu, použít samostatnou složku pro nedůvěryhodné kód, a jak je popsáno v [postupy: spuštění částečně důvěryhodného kódu v izolovaném prostoru](../../../docs/framework/misc/how-to-run-partially-trusted-code-in-a-sandbox.md).</span><span class="sxs-lookup"><span data-stu-id="602c1-134">To run code that actually comes from the Internet, use a separate folder for the untrusted code, as described in [How to: Run Partially Trusted Code in a Sandbox](../../../docs/framework/misc/how-to-run-partially-trusted-code-in-a-sandbox.md).</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#3](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#3)]
     [!code-vb[HowToEmitCodeInPartialTrust#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#3)]  
  
3.  <span data-ttu-id="602c1-135">Vytvoření domény aplikace, zadání informací o nastavení domény aplikace a přidělit nastavení pro všechny sestavení, které jsou spouštěny v doméně aplikace.</span><span class="sxs-lookup"><span data-stu-id="602c1-135">Create the application domain, specifying the application domain setup information and the grant set for all assemblies that execute in the application domain.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#5](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#5)]
     [!code-vb[HowToEmitCodeInPartialTrust#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#5)]  
  
     <span data-ttu-id="602c1-136">Poslední parametr <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> přetížení metody můžete určit sadu sestavení, která jsou udělena úplný vztah důvěryhodnosti, místo udělení sadu domény aplikace.</span><span class="sxs-lookup"><span data-stu-id="602c1-136">The last parameter of the <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> method overload enables you to specify a set of assemblies that are to be granted full trust, instead of the grant set of the application domain.</span></span> <span data-ttu-id="602c1-137">Není nutné zadat [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] sestavení, které vaše aplikace používá, protože jsou tato sestavení v globální mezipaměti sestavení.</span><span class="sxs-lookup"><span data-stu-id="602c1-137">You do not have to specify the [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] assemblies that your application uses, because those assemblies are in the global assembly cache.</span></span> <span data-ttu-id="602c1-138">Sestavení v globální mezipaměti sestavení jsou vždy plně důvěryhodná.</span><span class="sxs-lookup"><span data-stu-id="602c1-138">Assemblies in the global assembly cache are always fully trusted.</span></span> <span data-ttu-id="602c1-139">Tento parametr slouží k zadání sestavení se silným názvem, které nejsou v globální mezipaměti sestavení.</span><span class="sxs-lookup"><span data-stu-id="602c1-139">You can use this parameter to specify strong-named assemblies that are not in the global assembly cache.</span></span>  
  
### <a name="adding-restrictedmemberaccess-to-sandboxed-domains"></a><span data-ttu-id="602c1-140">Přidání RestrictedMemberAccess do domén v izolovaném prostoru</span><span class="sxs-lookup"><span data-stu-id="602c1-140">Adding RestrictedMemberAccess to Sandboxed Domains</span></span>  
 <span data-ttu-id="602c1-141">Hostování aplikací můžete povolit anonymně hostované dynamické metody tak, aby měl přístup k datům privátní v sestavení, které mají úrovně důvěryhodnosti, rovna nebo menší než úroveň důvěryhodnosti sestavení, který vysílá kód.</span><span class="sxs-lookup"><span data-stu-id="602c1-141">Host applications can allow anonymously hosted dynamic methods to have access to private data in assemblies that have trust levels equal to or less than the trust level of the assembly that emits the code.</span></span> <span data-ttu-id="602c1-142">Pokud chcete povolit tento s omezeným přístupem možnost pro přeskočení kontroly viditelnosti za běhu (JIT), přidá hostitelskou aplikaci <xref:System.Security.Permissions.ReflectionPermission> objektu s <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> příznak (vrácené položky) do sady udělení.</span><span class="sxs-lookup"><span data-stu-id="602c1-142">To enable this restricted ability to skip just-in-time (JIT) visibility checks, the host application adds a <xref:System.Security.Permissions.ReflectionPermission> object with the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> (RMA) flag to the grant set.</span></span>  
  
 <span data-ttu-id="602c1-143">Pro hostitele může například udělit oprávnění Internet aplikací Internet plus vrácené položky, tak, aby internetové aplikace můžete vyvolat kód, který přistupuje k privátní data v jeho vlastní sestavení.</span><span class="sxs-lookup"><span data-stu-id="602c1-143">For example, a host might grant Internet applications Internet permissions plus RMA, so that an Internet application can emit code that accesses private data in its own assemblies.</span></span> <span data-ttu-id="602c1-144">Vzhledem k tomu, že přístup je omezen na sestavení menší nebo rovno vztahu důvěryhodnosti, internetovou aplikaci nelze například přístup ke členům plně důvěryhodných sestavení [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] sestavení.</span><span class="sxs-lookup"><span data-stu-id="602c1-144">Because the access is limited to assemblies of equal or lesser trust, an Internet application cannot access members of fully trusted assemblies such as [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] assemblies.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="602c1-145">Pokud chcete zabránit zvýšení úrovně oprávnění, informace zásobníku pro generování. sestavení je součástí anonymně hostované dynamické metody se vytvářejí.</span><span class="sxs-lookup"><span data-stu-id="602c1-145">To prevent elevation of privilege, stack information for the emitting assembly is included when anonymously hosted dynamic methods are constructed.</span></span> <span data-ttu-id="602c1-146">Po vyvolání metody se kontroluje informace zásobníku.</span><span class="sxs-lookup"><span data-stu-id="602c1-146">When the method is invoked, the stack information is checked.</span></span> <span data-ttu-id="602c1-147">Proto je stále omezen na úroveň důvěryhodnosti generování sestavení anonymně hostované dynamické metody, která je volána z plně důvěryhodný kód.</span><span class="sxs-lookup"><span data-stu-id="602c1-147">Thus, an anonymously hosted dynamic method that is invoked from fully trusted code is still limited to the trust level of the emitting assembly.</span></span>  
  
##### <a name="to-create-an-application-domain-with-partial-trust-plus-rma"></a><span data-ttu-id="602c1-148">Vytvoření domény aplikace s částečnou důvěryhodností plus vrácené položky</span><span class="sxs-lookup"><span data-stu-id="602c1-148">To create an application domain with partial trust plus RMA</span></span>  
  
1.  <span data-ttu-id="602c1-149">Vytvořte novou <xref:System.Security.Permissions.ReflectionPermission> objektu s <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> (vrácené položky) příznak a použít <xref:System.Security.PermissionSet.SetPermission%2A?displayProperty=nameWithType> metodu pro přidání do sady udělení oprávnění.</span><span class="sxs-lookup"><span data-stu-id="602c1-149">Create a new <xref:System.Security.Permissions.ReflectionPermission> object with the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> (RMA) flag, and use the <xref:System.Security.PermissionSet.SetPermission%2A?displayProperty=nameWithType> method to add the permission to the grant set.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#7](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#7)]
     [!code-vb[HowToEmitCodeInPartialTrust#7](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#7)]  
  
     <span data-ttu-id="602c1-150"><xref:System.Security.PermissionSet.AddPermission%2A> Metoda přidá k udělení nastavit, pokud již není součástí oprávnění.</span><span class="sxs-lookup"><span data-stu-id="602c1-150">The <xref:System.Security.PermissionSet.AddPermission%2A> method adds the permission to the grant set if it is not already included.</span></span> <span data-ttu-id="602c1-151">Pokud toto oprávnění je už součástí sady udělení, zadaný příznaky jsou přidány do existující oprávnění.</span><span class="sxs-lookup"><span data-stu-id="602c1-151">If the permission is already included in the grant set, the specified flags are added to the existing permission.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="602c1-152">Vrácené položky je funkce anonymně hostované dynamické metody.</span><span class="sxs-lookup"><span data-stu-id="602c1-152">RMA is a feature of anonymously hosted dynamic methods.</span></span> <span data-ttu-id="602c1-153">Pokud obyčejnou dynamické metody kontrolu JIT viditelnost, vyžaduje nástroj kód emitovaného úplný vztah důvěryhodnosti.</span><span class="sxs-lookup"><span data-stu-id="602c1-153">When ordinary dynamic methods skip JIT visibility checks, the emitted code requires full trust.</span></span>  
  
2.  <span data-ttu-id="602c1-154">Vytvoření domény aplikace, zadání informací o nastavení domény aplikace a poskytnutí nastavit.</span><span class="sxs-lookup"><span data-stu-id="602c1-154">Create the application domain, specifying the application domain setup information and the grant set.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#8](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#8)]
     [!code-vb[HowToEmitCodeInPartialTrust#8](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#8)]  
  
<a name="Running_code"></a>   
## <a name="running-code-in-sandboxed-application-domains"></a><span data-ttu-id="602c1-155">Spuštěním kódu v v izolovaném prostoru aplikační domény</span><span class="sxs-lookup"><span data-stu-id="602c1-155">Running Code in Sandboxed Application Domains</span></span>  
 <span data-ttu-id="602c1-156">Následující postup vysvětluje, jak definovat třídu pomocí metod, které mohou být provedeny v doméně aplikace, jak vytvořit instance třídy v doméně a jak provádět její metody.</span><span class="sxs-lookup"><span data-stu-id="602c1-156">The following procedure explains how to define a class by using methods that can be executed in an application domain, how to create an instance of the class in the domain, and how to execute its methods.</span></span>  
  
#### <a name="to-define-and-execute-a-method-in-an-application-domain"></a><span data-ttu-id="602c1-157">K definování a provedení metody v doméně aplikace</span><span class="sxs-lookup"><span data-stu-id="602c1-157">To define and execute a method in an application domain</span></span>  
  
1.  <span data-ttu-id="602c1-158">Definice třídy, která je odvozena z <xref:System.MarshalByRefObject>.</span><span class="sxs-lookup"><span data-stu-id="602c1-158">Define a class that derives from <xref:System.MarshalByRefObject>.</span></span> <span data-ttu-id="602c1-159">Díky tomu můžete vytvořit instance této třídy v jiných doménách aplikace a provádět volání metoda napříč hranicemi domény aplikace.</span><span class="sxs-lookup"><span data-stu-id="602c1-159">This enables you to create instances of the class in other application domains and to make method calls across application domain boundaries.</span></span> <span data-ttu-id="602c1-160">Třída v tomto příkladu se nazývá `Worker`.</span><span class="sxs-lookup"><span data-stu-id="602c1-160">The class in this example is named `Worker`.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#10](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#10)]
     [!code-vb[HowToEmitCodeInPartialTrust#10](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#10)]  
  
2.  <span data-ttu-id="602c1-161">Definujte veřejnou metodu, která obsahuje kód, který chcete spustit.</span><span class="sxs-lookup"><span data-stu-id="602c1-161">Define a public method that contains the code you want to execute.</span></span> <span data-ttu-id="602c1-162">V tomto příkladu kód vysílá dynamické jednoduše, vytvoří delegát pro spuštění metody a vyvolá delegáta.</span><span class="sxs-lookup"><span data-stu-id="602c1-162">In this example, the code emits a simple dynamic method, creates a delegate to execute the method, and invokes the delegate.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#11](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#11)]
     [!code-vb[HowToEmitCodeInPartialTrust#11](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#11)]  
  
3.  <span data-ttu-id="602c1-163">V hlavní aplikaci zobrazit zobrazovaný název vašeho sestavení.</span><span class="sxs-lookup"><span data-stu-id="602c1-163">In your main program, get the display name of your assembly.</span></span> <span data-ttu-id="602c1-164">Tento název se používá při vytváření instance `Worker` – třída v doméně aplikace v izolovaném prostoru.</span><span class="sxs-lookup"><span data-stu-id="602c1-164">This name is used when you create instances of the `Worker` class in the sandboxed application domain.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#14](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#14)]
     [!code-vb[HowToEmitCodeInPartialTrust#14](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#14)]  
  
4.  <span data-ttu-id="602c1-165">V hlavní aplikaci vytvořit doménu v izolovaném prostoru aplikace, jak je popsáno v [první postup](#Setting_up) v tomto návodu.</span><span class="sxs-lookup"><span data-stu-id="602c1-165">In your main program, create a sandboxed application domain, as described in [the first procedure](#Setting_up) in this walkthrough.</span></span> <span data-ttu-id="602c1-166">Nemáte žádné oprávnění k přidání `Internet` nastavit oprávnění, protože `SimpleEmitDemo` metoda se používá pouze veřejné metody.</span><span class="sxs-lookup"><span data-stu-id="602c1-166">You do not have to add any permissions to the `Internet` permission set, because the `SimpleEmitDemo` method uses only public methods.</span></span>  
  
5.  <span data-ttu-id="602c1-167">V hlavní aplikaci, vytvořte instanci `Worker` – třída v doméně aplikace v izolovaném prostoru.</span><span class="sxs-lookup"><span data-stu-id="602c1-167">In your main program, create an instance of the `Worker` class in the sandboxed application domain.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#12](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#12)]
     [!code-vb[HowToEmitCodeInPartialTrust#12](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#12)]  
  
     <span data-ttu-id="602c1-168"><xref:System.AppDomain.CreateInstanceAndUnwrap%2A> Metoda vytvoří objekt v cílové doméně aplikace a vrátí proxy server, který slouží k volání vlastnosti a metody objektu.</span><span class="sxs-lookup"><span data-stu-id="602c1-168">The <xref:System.AppDomain.CreateInstanceAndUnwrap%2A> method creates the object in the target application domain and returns a proxy that can be used to call the properties and methods of the object.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="602c1-169">Pokud použijete tento kód v [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], musíte změnit název třídy zahrnout obor názvů.</span><span class="sxs-lookup"><span data-stu-id="602c1-169">If you use this code in [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], you must change the name of the class to include the namespace.</span></span> <span data-ttu-id="602c1-170">Ve výchozím nastavení obor názvů je název projektu.</span><span class="sxs-lookup"><span data-stu-id="602c1-170">By default, the namespace is the name of the project.</span></span> <span data-ttu-id="602c1-171">Například pokud je projekt "PartialTrust", název třídy musí být "PartialTrust.Worker".</span><span class="sxs-lookup"><span data-stu-id="602c1-171">For example, if the project is "PartialTrust", the class name must be "PartialTrust.Worker".</span></span>  
  
6.  <span data-ttu-id="602c1-172">Přidejte kód volání `SimpleEmitDemo` metoda.</span><span class="sxs-lookup"><span data-stu-id="602c1-172">Add code to call the `SimpleEmitDemo` method.</span></span> <span data-ttu-id="602c1-173">Volání je zařazen přes hranice domény aplikace a kód se spustí v doméně aplikace v izolovaném prostoru.</span><span class="sxs-lookup"><span data-stu-id="602c1-173">The call is marshaled across the application domain boundary, and the code is executed in the sandboxed application domain.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#13](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#13)]
     [!code-vb[HowToEmitCodeInPartialTrust#13](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#13)]  
  
<a name="Using_methods"></a>   
## <a name="using-anonymously-hosted-dynamic-methods"></a><span data-ttu-id="602c1-174">Pomocí anonymně hostované dynamické metody</span><span class="sxs-lookup"><span data-stu-id="602c1-174">Using Anonymously Hosted Dynamic Methods</span></span>  
 <span data-ttu-id="602c1-175">Anonymně hostované dynamické metody jsou přidruženy k transparentní sestavení, které poskytuje v systému.</span><span class="sxs-lookup"><span data-stu-id="602c1-175">Anonymously hosted dynamic methods are associated with a transparent assembly that is provided by the system.</span></span> <span data-ttu-id="602c1-176">Proto je transparentní kód, který obsahují.</span><span class="sxs-lookup"><span data-stu-id="602c1-176">Therefore, the code they contain is transparent.</span></span> <span data-ttu-id="602c1-177">Obyčejnou dynamické metody na druhé straně, musí být přidruženy k existující modul (ať už přímo zadat nebo odvodit z přidružených typu) a proveďte jejich úroveň zabezpečení z tohoto modulu.</span><span class="sxs-lookup"><span data-stu-id="602c1-177">Ordinary dynamic methods, on the other hand, must be associated with an existing module (whether directly specified or inferred from an associated type), and take their security level from that module.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="602c1-178">Jediný způsob, jak přidružit sestavení, které poskytuje anonymní hostování dynamické metoda je použití konstruktory, které jsou popsány v následujícím postupu.</span><span class="sxs-lookup"><span data-stu-id="602c1-178">The only way to associate a dynamic method with the assembly that provides anonymous hosting is to use the constructors that are described in the following procedure.</span></span> <span data-ttu-id="602c1-179">V anonymní hostování sestavení nelze explicitně zadat modul.</span><span class="sxs-lookup"><span data-stu-id="602c1-179">You cannot explicitly specify a module in the anonymous hosting assembly.</span></span>  
  
 <span data-ttu-id="602c1-180">Obyčejnou dynamické metody mít přístup k interní členů, které jsou přidruženy modul, nebo soukromé členy typu, které jsou přidruženy.</span><span class="sxs-lookup"><span data-stu-id="602c1-180">Ordinary dynamic methods have access to the internal members of the module they are associated with, or to the private members of the type they are associated with.</span></span> <span data-ttu-id="602c1-181">Protože anonymně hostované dynamické metody jsou izolované od jiný kód, nemají přístup k privátním data.</span><span class="sxs-lookup"><span data-stu-id="602c1-181">Because anonymously hosted dynamic methods are isolated from other code, they do not have access to private data.</span></span> <span data-ttu-id="602c1-182">Ale mají s omezeným přístupem možnost pro přeskočení kontroly viditelnost JIT k získání přístupu k privátní data.</span><span class="sxs-lookup"><span data-stu-id="602c1-182">However, they do have a restricted ability to skip JIT visibility checks to gain access to private data.</span></span> <span data-ttu-id="602c1-183">Tato možnost je omezena na sestavení, které mají úrovně důvěryhodnosti, rovna nebo menší než úroveň důvěryhodnosti sestavení, který vysílá kód.</span><span class="sxs-lookup"><span data-stu-id="602c1-183">This ability is limited to assemblies that have trust levels equal to or less than the trust level of the assembly that emits the code.</span></span>  
  
 <span data-ttu-id="602c1-184">Pokud chcete zabránit zvýšení úrovně oprávnění, informace zásobníku pro generování. sestavení je součástí anonymně hostované dynamické metody se vytvářejí.</span><span class="sxs-lookup"><span data-stu-id="602c1-184">To prevent elevation of privilege, stack information for the emitting assembly is included when anonymously hosted dynamic methods are constructed.</span></span> <span data-ttu-id="602c1-185">Po vyvolání metody se kontroluje informace zásobníku.</span><span class="sxs-lookup"><span data-stu-id="602c1-185">When the method is invoked, the stack information is checked.</span></span> <span data-ttu-id="602c1-186">Anonymně hostované dynamické metody, která je volána z plně důvěryhodný kód je stále omezen na úroveň důvěryhodnosti sestavení, které vygenerované ho.</span><span class="sxs-lookup"><span data-stu-id="602c1-186">An anonymously hosted dynamic method that is invoked from fully trusted code is still limited to the trust level of the assembly that emitted it.</span></span>  
  
#### <a name="to-use-anonymously-hosted-dynamic-methods"></a><span data-ttu-id="602c1-187">Použít anonymně hostované dynamické metody</span><span class="sxs-lookup"><span data-stu-id="602c1-187">To use anonymously hosted dynamic methods</span></span>  
  
-   <span data-ttu-id="602c1-188">Anonymně hostované dynamické metody vytvořte pomocí konstruktoru, která neurčuje přiřazen modul nebo typ.</span><span class="sxs-lookup"><span data-stu-id="602c1-188">Create an anonymously hosted dynamic method by using a constructor that does not specify an associated module or type.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#15](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#15)]
     [!code-vb[HowToEmitCodeInPartialTrust#15](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#15)]  
  
     <span data-ttu-id="602c1-189">Pokud anonymně hostované dynamické metody používá pouze veřejné typy a metody, nevyžaduje přístup ke členu s omezeným přístupem a nemá tak, aby přeskočil JIT viditelnost kontroly.</span><span class="sxs-lookup"><span data-stu-id="602c1-189">If an anonymously hosted dynamic method uses only public types and methods, it does not require restricted member access and does not have to skip JIT visibility checks.</span></span>  
  
     <span data-ttu-id="602c1-190">Žádná zvláštní oprávnění jsou nezbytné pro vydávání dynamické metody, ale kód emitovaného vyžaduje oprávnění, které jsou vyžadovány typy a metody, které používá.</span><span class="sxs-lookup"><span data-stu-id="602c1-190">No special permissions are required to emit a dynamic method, but the emitted code requires the permissions that are demanded by the types and methods it uses.</span></span> <span data-ttu-id="602c1-191">Například pokud emitovaného kód volá metodu, která přistupuje k souboru, vyžaduje <xref:System.Security.Permissions.FileIOPermission>.</span><span class="sxs-lookup"><span data-stu-id="602c1-191">For example, if the emitted code calls a method that accesses a file, it requires <xref:System.Security.Permissions.FileIOPermission>.</span></span> <span data-ttu-id="602c1-192">Pokud úroveň důvěryhodnosti neobsahuje tato oprávnění, je vyvolána výjimka zabezpečení při spuštění emitovaného kódu.</span><span class="sxs-lookup"><span data-stu-id="602c1-192">If the trust level does not include that permission, a security exception is thrown when the emitted code is executed.</span></span> <span data-ttu-id="602c1-193">Kód zobrazí zde vysílá dynamické metody, která používá jenom <xref:System.Console.WriteLine%2A?displayProperty=nameWithType> metoda.</span><span class="sxs-lookup"><span data-stu-id="602c1-193">The code shown here emits a dynamic method that uses only the <xref:System.Console.WriteLine%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="602c1-194">Proto mohou být provedeny kód z částečně důvěryhodného umístění.</span><span class="sxs-lookup"><span data-stu-id="602c1-194">Therefore, the code can be executed from partially trusted locations.</span></span>  
  
-   <span data-ttu-id="602c1-195">Nebo můžete vytvořit pomocí anonymně hostované dynamické metody s s omezeným přístupem možnost pro přeskočení kontroly viditelnost JIT, pomocí <xref:System.Reflection.Emit.DynamicMethod.%23ctor%28System.String%2CSystem.Type%2CSystem.Type%5B%5D%2CSystem.Boolean%29> konstruktor a zadání `true` pro `restrictedSkipVisibility` parametr.</span><span class="sxs-lookup"><span data-stu-id="602c1-195">Alternatively, create an anonymously hosted dynamic method with restricted ability to skip JIT visibility checks, by using the <xref:System.Reflection.Emit.DynamicMethod.%23ctor%28System.String%2CSystem.Type%2CSystem.Type%5B%5D%2CSystem.Boolean%29> constructor and specifying `true` for the `restrictedSkipVisibility` parameter.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#16](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#16)]
     [!code-vb[HowToEmitCodeInPartialTrust#16](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#16)]  
  
     <span data-ttu-id="602c1-196">Omezení je, že anonymně hostované dynamické metody přístup k datům privátní pouze v sestavení s úrovní důvěryhodnosti rovna nebo menší než úroveň důvěryhodnosti generování sestavení.</span><span class="sxs-lookup"><span data-stu-id="602c1-196">The restriction is that the anonymously hosted dynamic method can access private data only in assemblies with trust levels equal to or less than the trust level of the emitting assembly.</span></span> <span data-ttu-id="602c1-197">Například pokud dynamické metoda provádí Internet vztahu důvěryhodnosti, má přístup k privátní data v jiných sestavení, které jsou také provádění Internet vztahu důvěryhodnosti, ale nemá přístup k privátním data [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] sestavení.</span><span class="sxs-lookup"><span data-stu-id="602c1-197">For example, if the dynamic method is executing with Internet trust, it can access private data in other assemblies that are also executing with Internet trust, but it cannot access private data of [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] assemblies.</span></span> [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)]<span data-ttu-id="602c1-198">sestavení jsou nainstalované v globální mezipaměti sestavení a vždy plně důvěryhodná.</span><span class="sxs-lookup"><span data-stu-id="602c1-198"> assemblies are installed in the global assembly cache and are always fully trusted.</span></span>  
  
     <span data-ttu-id="602c1-199">Anonymně hostované dynamické metody můžete použít s omezeným přístupem možnost pro přeskočení kontroly viditelnost JIT pouze v případě, že uděluje hostitelskou aplikaci <xref:System.Security.Permissions.ReflectionPermission> s <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> příznak.</span><span class="sxs-lookup"><span data-stu-id="602c1-199">Anonymously hosted dynamic methods can use this restricted ability to skip JIT visibility checks only if the host application grants <xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> flag.</span></span> <span data-ttu-id="602c1-200">Požadavek pro toto oprávnění je vytvořen při vyvolání metody.</span><span class="sxs-lookup"><span data-stu-id="602c1-200">The demand for this permission is made when the method is invoked.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="602c1-201">Informace v zásobníku volání pro generování sestavení se při dynamické metoda je vytvořený.</span><span class="sxs-lookup"><span data-stu-id="602c1-201">Call stack information for the emitting assembly is included when the dynamic method is constructed.</span></span> <span data-ttu-id="602c1-202">Proto je požadována proti oprávnění generování sestavení místo sestavení, která volá metodu.</span><span class="sxs-lookup"><span data-stu-id="602c1-202">Therefore, the demand is made against the permissions of the emitting assembly instead of the assembly that invokes the method.</span></span> <span data-ttu-id="602c1-203">To brání tomu, aby kód emitovaného vykonáván se zvýšenými oprávněními.</span><span class="sxs-lookup"><span data-stu-id="602c1-203">This prevents the emitted code from being executed with elevated permissions.</span></span>  
  
     <span data-ttu-id="602c1-204">[Úplný příklad kódu](#Example) na konci tento návod ukazuje použití a omezení přístup ke členu s omezeným přístupem.</span><span class="sxs-lookup"><span data-stu-id="602c1-204">The [complete code example](#Example) at the end of this walkthrough demonstrates the use and limitations of restricted member access.</span></span> <span data-ttu-id="602c1-205">Jeho `Worker` třída obsahuje metody, která můžete vytvořit anonymně hostované dynamické metody s nebo bez s omezeným přístupem možnost pro přeskočení kontroly viditelnost a příklad ukazuje výsledek provedení tuto metodu v doménách aplikace, které mají různé úrovně důvěryhodnosti.</span><span class="sxs-lookup"><span data-stu-id="602c1-205">Its `Worker` class includes a method that can create anonymously hosted dynamic methods with or without the restricted ability to skip visibility checks, and the example shows the result of executing this method in application domains that have different trust levels.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="602c1-206">S omezeným přístupem možnost pro přeskočení kontroly viditelnost je funkce anonymně hostované dynamické metody.</span><span class="sxs-lookup"><span data-stu-id="602c1-206">The restricted ability to skip visibility checks is a feature of anonymously hosted dynamic methods.</span></span> <span data-ttu-id="602c1-207">Když obyčejnou dynamické metody kontrolu JIT viditelnost, se musí mít udělen úplný vztah důvěryhodnosti.</span><span class="sxs-lookup"><span data-stu-id="602c1-207">When ordinary dynamic methods skip JIT visibility checks, they must be granted full trust.</span></span>  
  
<a name="Example"></a>   
## <a name="example"></a><span data-ttu-id="602c1-208">Příklad</span><span class="sxs-lookup"><span data-stu-id="602c1-208">Example</span></span>  
  
### <a name="description"></a><span data-ttu-id="602c1-209">Popis</span><span class="sxs-lookup"><span data-stu-id="602c1-209">Description</span></span>  
 <span data-ttu-id="602c1-210">Následující příklad kódu ukazuje použití <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> příznak povolit anonymně hostované dynamické metody pro přeskočení kontroly viditelnost JIT, ale jenom v případě, že je cílový člen na stejné nebo nižší úrovně důvěryhodnosti než sestavení, který vysílá kód.</span><span class="sxs-lookup"><span data-stu-id="602c1-210">The following code example demonstrates the use of the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> flag to allow anonymously hosted dynamic methods to skip JIT visibility checks, but only when the target member is at an equal or lower level of trust than the assembly that emits the code.</span></span>  
  
 <span data-ttu-id="602c1-211">V příkladu je definován `Worker` třídu, která může být zařazeno napříč hranicemi domény aplikace.</span><span class="sxs-lookup"><span data-stu-id="602c1-211">The example defines a `Worker` class that can be marshaled across application domain boundaries.</span></span> <span data-ttu-id="602c1-212">Třída má dva `AccessPrivateMethod` přetížení metody, které emitování a provádění dynamických metod.</span><span class="sxs-lookup"><span data-stu-id="602c1-212">The class has two `AccessPrivateMethod` method overloads that emit and execute dynamic methods.</span></span> <span data-ttu-id="602c1-213">První přetížení vysílá dynamické metodu, která volá privátní `PrivateMethod` metodu `Worker` třídy ale můžete Emitování dynamických metoda s nebo bez kontroly viditelnost JIT.</span><span class="sxs-lookup"><span data-stu-id="602c1-213">The first overload emits a dynamic method that calls the private `PrivateMethod` method of the `Worker` class, and it can emit the dynamic method with or without JIT visibility checks.</span></span> <span data-ttu-id="602c1-214">Druhý přetížení vysílá dynamické metodu, která přistupuje `internal` vlastnost (`Friend` vlastnost v jazyce Visual Basic) z <xref:System.String> – třída.</span><span class="sxs-lookup"><span data-stu-id="602c1-214">The second overload emits a dynamic method that accesses an `internal` property (`Friend` property in Visual Basic) of the <xref:System.String> class.</span></span>  
  
 <span data-ttu-id="602c1-215">Příklad používá metodu helper k vytvoření grant nastavit omezená na `Internet` oprávnění a pak vytváří doménu aplikace pomocí <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> přetížení metody k určení, že všechny kód, který se spustí v doméně používá tato sada udělení.</span><span class="sxs-lookup"><span data-stu-id="602c1-215">The example uses a helper method to create a grant set limited to `Internet` permissions, and then creates an application domain, using the <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> method overload to specify that all code that executes in the domain uses this grant set.</span></span> <span data-ttu-id="602c1-216">V příkladu se vytváří instance `Worker` třídy v doméně aplikace a spustí `AccessPrivateMethod` metoda dvakrát.</span><span class="sxs-lookup"><span data-stu-id="602c1-216">The example creates an instance of the `Worker` class in the application domain, and executes the `AccessPrivateMethod` method two times.</span></span>  
  
-   <span data-ttu-id="602c1-217">První `AccessPrivateMethod` spuštění metody, se vynucují JIT viditelnost kontroly.</span><span class="sxs-lookup"><span data-stu-id="602c1-217">The first time the `AccessPrivateMethod` method is executed, JIT visibility checks are enforced.</span></span> <span data-ttu-id="602c1-218">Dynamické metody selže při vyvolání, protože JIT viditelnost kontroly zabránit přístupu k metodě privátní.</span><span class="sxs-lookup"><span data-stu-id="602c1-218">The dynamic method fails when it is invoked, because JIT visibility checks prevent it from accessing the private method.</span></span>  
  
-   <span data-ttu-id="602c1-219">Při druhém `AccessPrivateMethod` spuštění metody, jsou přeskočeny JIT viditelnost kontroly.</span><span class="sxs-lookup"><span data-stu-id="602c1-219">The second time the `AccessPrivateMethod` method is executed, JIT visibility checks are skipped.</span></span> <span data-ttu-id="602c1-220">Dynamické metody selže, když je kompilován, protože `Internet` udělit sadu neuděluje dostatečná oprávnění pro přeskočení kontroly viditelnosti.</span><span class="sxs-lookup"><span data-stu-id="602c1-220">The dynamic method fails when it is compiled, because the `Internet` grant set does not grant sufficient permissions to skip visibility checks.</span></span>  
  
 <span data-ttu-id="602c1-221">V příkladu přidáme <xref:System.Security.Permissions.ReflectionPermission> s <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> poskytnutí nastavit.</span><span class="sxs-lookup"><span data-stu-id="602c1-221">The example adds <xref:System.Security.Permissions.ReflectionPermission> with <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> to the grant set.</span></span> <span data-ttu-id="602c1-222">Příklad poté vytvoří druhé domény, určení, že veškerý kód spustí v doméně je udělena oprávnění v nové sady udělení.</span><span class="sxs-lookup"><span data-stu-id="602c1-222">The example then creates a second domain, specifying that all code that executes in the domain is granted the permissions in the new grant set.</span></span> <span data-ttu-id="602c1-223">V příkladu se vytváří instance `Worker` třídy v nové doméně aplikace a provede oba přetížení `AccessPrivateMethod` metoda.</span><span class="sxs-lookup"><span data-stu-id="602c1-223">The example creates an instance of the `Worker` class in the new application domain, and executes both overloads of the `AccessPrivateMethod` method.</span></span>  
  
-   <span data-ttu-id="602c1-224">První přetížení `AccessPrivateMethod` spuštění metody a viditelnost JIT zkontroluje se přeskočí.</span><span class="sxs-lookup"><span data-stu-id="602c1-224">The first overload of the `AccessPrivateMethod` method is executed, and JIT visibility checks are skipped.</span></span> <span data-ttu-id="602c1-225">Dynamické metody zkompiluje a provede úspěšně, protože sestavení, který vysílá kód je stejný jako sestavení, které obsahuje soukromá metoda.</span><span class="sxs-lookup"><span data-stu-id="602c1-225">The dynamic method compiles and executes successfully, because the assembly that emits the code is the same as the assembly that contains the private method.</span></span> <span data-ttu-id="602c1-226">Proto jsou stejné úrovně důvěryhodnosti.</span><span class="sxs-lookup"><span data-stu-id="602c1-226">Therefore, the trust levels are equal.</span></span> <span data-ttu-id="602c1-227">Pokud aplikace, který obsahuje `Worker` třídy kdyby několik sestavení, stejný postup by pro každý z těchto sestavení úspěšné, protože všechny by být na stejné úrovni důvěryhodnosti.</span><span class="sxs-lookup"><span data-stu-id="602c1-227">If the application that contains the `Worker` class had several assemblies, the same process would succeed for any one of those assemblies, because they would all be at the same trust level.</span></span>  
  
-   <span data-ttu-id="602c1-228">Druhý přetížení `AccessPrivateMethod` spuštění metody, a opakujte viditelnost JIT zkontroluje se přeskočí.</span><span class="sxs-lookup"><span data-stu-id="602c1-228">The second overload of the `AccessPrivateMethod` method is executed, and again JIT visibility checks are skipped.</span></span> <span data-ttu-id="602c1-229">Tentokrát dynamické metody selže, když je kompilován, protože se pokusí o přístup k `internal` `FirstChar` vlastnost <xref:System.String> třídy.</span><span class="sxs-lookup"><span data-stu-id="602c1-229">This time the dynamic method fails when it is compiled, because it tries to access the `internal` `FirstChar` property of the <xref:System.String> class.</span></span> <span data-ttu-id="602c1-230">Sestavení, které obsahuje <xref:System.String> třída je plně důvěryhodná.</span><span class="sxs-lookup"><span data-stu-id="602c1-230">The assembly that contains the <xref:System.String> class is fully trusted.</span></span> <span data-ttu-id="602c1-231">Proto je na vyšší úrovni vztahu důvěryhodnosti, než je sestavení, který vysílá kód.</span><span class="sxs-lookup"><span data-stu-id="602c1-231">Therefore, it is at a higher level of trust than the assembly that emits the code.</span></span>  
  
 <span data-ttu-id="602c1-232">Toto porovnání ukazuje, jak <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> umožňuje částečně důvěryhodný kód, který přeskočí viditelnost vyhledává jiný částečně důvěryhodný kód, aniž by to ohrozilo zabezpečení důvěryhodný kód.</span><span class="sxs-lookup"><span data-stu-id="602c1-232">This comparison shows how <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> enables partially trusted code to skip visibility checks for other partially trusted code without compromising the security of trusted code.</span></span>  
  
### <a name="code"></a><span data-ttu-id="602c1-233">Kód</span><span class="sxs-lookup"><span data-stu-id="602c1-233">Code</span></span>  
 [!code-csharp[HowToEmitCodeInPartialTrust#1](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#1)]
 [!code-vb[HowToEmitCodeInPartialTrust#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#1)]  
  
## <a name="compiling-the-code"></a><span data-ttu-id="602c1-234">Probíhá kompilace kódu</span><span class="sxs-lookup"><span data-stu-id="602c1-234">Compiling the Code</span></span>  
  
-   <span data-ttu-id="602c1-235">Pokud vytvoříte tento příklad kódu [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], musíte změnit název třídy, které chcete zahrnout obor názvů, pokud předejte jej <xref:System.AppDomain.CreateInstanceAndUnwrap%2A> metoda.</span><span class="sxs-lookup"><span data-stu-id="602c1-235">If you build this code example in [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], you must change the name of the class to include the namespace when you pass it to the <xref:System.AppDomain.CreateInstanceAndUnwrap%2A> method.</span></span> <span data-ttu-id="602c1-236">Ve výchozím nastavení obor názvů je název projektu.</span><span class="sxs-lookup"><span data-stu-id="602c1-236">By default, the namespace is the name of the project.</span></span> <span data-ttu-id="602c1-237">Například pokud je projekt "PartialTrust", název třídy musí být "PartialTrust.Worker".</span><span class="sxs-lookup"><span data-stu-id="602c1-237">For example, if the project is "PartialTrust", the class name must be "PartialTrust.Worker".</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="602c1-238">Viz také</span><span class="sxs-lookup"><span data-stu-id="602c1-238">See Also</span></span>  
 [<span data-ttu-id="602c1-239">Bezpečnostní problémy v generování reflexe</span><span class="sxs-lookup"><span data-stu-id="602c1-239">Security Issues in Reflection Emit</span></span>](../../../docs/framework/reflection-and-codedom/security-issues-in-reflection-emit.md)  
 [<span data-ttu-id="602c1-240">Postupy: spuštění částečně důvěryhodného kódu v izolovaném prostoru</span><span class="sxs-lookup"><span data-stu-id="602c1-240">How to: Run Partially Trusted Code in a Sandbox</span></span>](../../../docs/framework/misc/how-to-run-partially-trusted-code-in-a-sandbox.md)
