---
title: "Collectible sestavení pro generování dynamickém typu"
description: 
ms.date: 08/29/2017
ms.prod: .net
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- reflection, dynamic assembly
- assemblies, collectible
- collectible assemblies, retrieving
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 0756fe317469898dd165e55be7125922f5b692f7
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 12/22/2017
---
# <a name="collectible-assemblies-for-dynamic-type-generation"></a><span data-ttu-id="6e2b5-102">Collectible sestavení pro generování dynamickém typu</span><span class="sxs-lookup"><span data-stu-id="6e2b5-102">Collectible assemblies for dynamic type generation</span></span>

<span data-ttu-id="6e2b5-103">*Collectible sestavení* jsou dynamická sestavení, které mohou být odpojen bez uvolnění domény aplikace, v jakém byly vytvořeny.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-103">*Collectible assemblies* are dynamic assemblies that can be unloaded without unloading the application domain in which they were created.</span></span> <span data-ttu-id="6e2b5-104">Se nedá uvolnit všechny spravovanými a nespravovanými paměti používané collectible sestavení a typy, které obsahuje.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-104">All managed and unmanaged memory used by a collectible assembly and the types it contains can be reclaimed.</span></span> <span data-ttu-id="6e2b5-105">Informace, jako je název sestavení je odebrán z vnitřní tabulky.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-105">Information such as the assembly name is removed from internal tables.</span></span>

<span data-ttu-id="6e2b5-106">Pokud chcete povolit uvolnění, použijte <xref:System.Reflection.Emit.AssemblyBuilderAccess.RunAndCollect?displayProperty=nameWithType> příznak při vytváření dynamických sestavení.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-106">To enable unloading, use the <xref:System.Reflection.Emit.AssemblyBuilderAccess.RunAndCollect?displayProperty=nameWithType> flag when you create a dynamic assembly.</span></span> <span data-ttu-id="6e2b5-107">Sestavení je přechodný (to znamená, nelze ji uložit) a mohou podléhat omezení popsaná v [omezení Collectible sestavení](#restrictions-on-collectible-assemblies) části.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-107">The assembly is transient (that is, it cannot be saved) and is subject to limitations described in the [Restrictions on Collectible Assemblies](#restrictions-on-collectible-assemblies) section.</span></span> <span data-ttu-id="6e2b5-108">Modul CLR (CLR) collectible sestavení uvolní automaticky při vydání všechny objekty přidružené sestavení.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-108">The common language runtime (CLR) unloads a collectible assembly automatically when you release all objects associated with the assembly.</span></span> <span data-ttu-id="6e2b5-109">V ostatních ohledech jsou collectible sestavení vytvořit a použít stejným způsobem jako ostatní dynamická sestavení.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-109">In all other respects, collectible assemblies are created and used in the same way as other dynamic assemblies.</span></span>

## <a name="lifetime-of-collectible-assemblies"></a><span data-ttu-id="6e2b5-110">Doba platnosti collectible sestavení</span><span class="sxs-lookup"><span data-stu-id="6e2b5-110">Lifetime of collectible assemblies</span></span>

<span data-ttu-id="6e2b5-111">Existují odkazy na typy, které obsahuje i s objekty, které jsou vytvořené z těchto typů řídí životnost collectible sestavení.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-111">The lifetime of a collectible assembly is controlled by the existence of references to the types it contains and the objects that are created from those types.</span></span> <span data-ttu-id="6e2b5-112">Modul common language runtime neuvolní sestavení tak dlouho, dokud jeden nebo více z následujících existují (`T` je žádný typ, který je definovaný v sestavení):</span><span class="sxs-lookup"><span data-stu-id="6e2b5-112">The common language runtime does not unload an assembly as long as one or more of the following exist (`T` is any type that is defined in the assembly):</span></span> 

- <span data-ttu-id="6e2b5-113">Instance `T`.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-113">An instance of `T`.</span></span>

- <span data-ttu-id="6e2b5-114">Instance pole `T`.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-114">An instance of an array of `T`.</span></span>
 
- <span data-ttu-id="6e2b5-115">Instance obecného typu, který má `T` jako jeden z jeho argumenty typu.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-115">An instance of a generic type that has `T` as one of its type arguments.</span></span> <span data-ttu-id="6e2b5-116">To zahrnuje obecné kolekce `T`i v případě, že kolekce je prázdná.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-116">This includes generic collections of `T`, even if that collection is empty.</span></span>

- <span data-ttu-id="6e2b5-117">Instance <xref:System.Type> nebo <xref:System.Reflection.Emit.TypeBuilder> představující `T`.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-117">An instance of <xref:System.Type> or <xref:System.Reflection.Emit.TypeBuilder> that represents `T`.</span></span> 

   > [!IMPORTANT]
   > <span data-ttu-id="6e2b5-118">Je nutné uvolnit všechny objekty, které představují části sestavení.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-118">You must release all objects that represent parts of the assembly.</span></span> <span data-ttu-id="6e2b5-119"><xref:System.Reflection.Emit.ModuleBuilder> , Který definuje `T` udržuje odkaz na <xref:System.Reflection.Emit.TypeBuilder>a <xref:System.Reflection.Emit.AssemblyBuilder> udržuje odkaz na objekt <xref:System.Reflection.Emit.ModuleBuilder>, takže odkazy na tyto objekty musí být vydání.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-119">The <xref:System.Reflection.Emit.ModuleBuilder> that defines `T` keeps a reference to the <xref:System.Reflection.Emit.TypeBuilder>, and the <xref:System.Reflection.Emit.AssemblyBuilder> object keeps a reference to the <xref:System.Reflection.Emit.ModuleBuilder>, so references to these objects must be released.</span></span> <span data-ttu-id="6e2b5-120">I existenci <xref:System.Reflection.Emit.LocalBuilder> nebo <xref:System.Reflection.Emit.ILGenerator> použít pro výpočet `T` brání uvolnění.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-120">Even the existence of a <xref:System.Reflection.Emit.LocalBuilder> or an <xref:System.Reflection.Emit.ILGenerator> used in the construction of `T` prevents unloading.</span></span>

- <span data-ttu-id="6e2b5-121">Statický odkaz na `T` jiným typem dynamicky definované `T1` spuštěním kódu se stále dostupný.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-121">A static reference to `T` by another dynamically defined type `T1` that is still reachable by executing code.</span></span> <span data-ttu-id="6e2b5-122">Například `T1` může být odvozen z `T`, nebo `T` může být typ parametru v metoda `T1`.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-122">For example, `T1` might derive from `T`, or `T` might be the type of a parameter in a method of `T1`.</span></span>
 
- <span data-ttu-id="6e2b5-123">A **ByRef** do statických polí, která patří do `T`.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-123">A **ByRef** to a static field that belongs to `T`.</span></span>

- <span data-ttu-id="6e2b5-124">A <xref:System.RuntimeTypeHandle>, <xref:System.RuntimeFieldHandle>, nebo <xref:System.RuntimeMethodHandle> který odkazuje na `T` nebo součást `T`.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-124">A <xref:System.RuntimeTypeHandle>, <xref:System.RuntimeFieldHandle>, or <xref:System.RuntimeMethodHandle> that refers to `T` or to a component of `T`.</span></span>

- <span data-ttu-id="6e2b5-125">Instance reflexe objektu, který by bylo možné použít nepřímo nebo přímo k přístupu <xref:System.Type> objekt, který reprezentuje `T`.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-125">An instance of any reflection object that could be used indirectly or directly to access the <xref:System.Type> object that represents `T`.</span></span> <span data-ttu-id="6e2b5-126">Například <xref:System.Type> objekt pro `T` lze získat z typu pole s typem elementu `T`, nebo z obecného typu, který má `T` jako argument typu.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-126">For example, the <xref:System.Type> object for `T` can be obtained from an array type whose element type is `T`, or from a generic type that has `T` as a type argument.</span></span> 

- <span data-ttu-id="6e2b5-127">Metoda `M` v zásobníku volání z libovolného vlákna, kde `M` je metoda `T` nebo úroveň modulu metodu, která je definována v sestavení.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-127">A method `M` on the call stack of any thread, where `M` is a method of `T` or a module-level method that is defined in the assembly.</span></span>

- <span data-ttu-id="6e2b5-128">Delegát pro statickou metodu, která je definována v modulu sestavení.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-128">A delegate to a static method that is defined in a module of the assembly.</span></span>

<span data-ttu-id="6e2b5-129">Pokud jen jednu položku ze seznamu existuje pouze jeden typ nebo jednu metodu v sestavení, modul runtime nelze odinstalovat, sestavení.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-129">If only one item from this list exists for only one type or one method in the assembly, the runtime cannot unload the assembly.</span></span>

> [!NOTE]
> <span data-ttu-id="6e2b5-130">Modul runtime neuvolní ve skutečnosti sestavení dokud spustili finalizační metody pro všechny položky v seznamu.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-130">The runtime does not actually unload the assembly until finalizers have run for all items in the list.</span></span>

<span data-ttu-id="6e2b5-131">Pro účely sledování životnosti sestavené Obecné zadejte například `List<int>` (v jazyku C#) nebo `List(Of Integer)` (v jazyce Visual Basic), který je vytvořen a použít v generování collectible sestavení se považuje za byly definované v sestavení, obsahuje obecná definice typu nebo v sestavení, který obsahuje definici jednoho z jeho argumenty typu.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-131">For purposes of tracking lifetime, a constructed generic type such as `List<int>` (in C#) or `List(Of Integer)` (in Visual Basic) that is created and used in the generation of a collectible assembly is considered to have been defined either in the assembly that contains the generic type definition or in an assembly that contains the definition of one of its type arguments.</span></span> <span data-ttu-id="6e2b5-132">Přesný sestavení, které se používá je podrobnosti implementace a která se může změnit.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-132">The exact assembly that is used is an implementation detail and subject to change.</span></span>
 
## <a name="restrictions-on-collectible-assemblies"></a><span data-ttu-id="6e2b5-133">Omezení collectible sestavení</span><span class="sxs-lookup"><span data-stu-id="6e2b5-133">Restrictions on collectible assemblies</span></span>

<span data-ttu-id="6e2b5-134">Na collectible sestavení se vztahují následující omezení:</span><span class="sxs-lookup"><span data-stu-id="6e2b5-134">The following restrictions apply to collectible assemblies:</span></span> 

- <span data-ttu-id="6e2b5-135">**Statické odkazy** </span><span class="sxs-lookup"><span data-stu-id="6e2b5-135">**Static references** </span></span>  
  <span data-ttu-id="6e2b5-136">Typy v sestavení obyčejnou dynamické nemůže mít statické odkazy na typy, které jsou definovány v collectible sestavení.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-136">Types in an ordinary dynamic assembly cannot have static references to types that are defined in a collectible assembly.</span></span> <span data-ttu-id="6e2b5-137">Pokud definujete obyčejnou typ, který dědí z typu v collectible sestavení, například <xref:System.NotSupportedException> je vyvolána výjimka.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-137">For example, if you define an ordinary type that inherits from a type in a collectible assembly, a <xref:System.NotSupportedException> exception is thrown.</span></span> <span data-ttu-id="6e2b5-138">K typu v collectible sestavení může mít statické odkazy na typ v jiném collectible sestavení, ale tato zásada rozšiřuje životnost odkazované sestavení do životnost odkazující sestavení.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-138">A type in a collectible assembly can have static references to a type in another collectible assembly, but this extends the lifetime of the referenced assembly to the lifetime of the referencing assembly.</span></span>

- <span data-ttu-id="6e2b5-139">**Zprostředkovatel komunikace s objekty COM** </span><span class="sxs-lookup"><span data-stu-id="6e2b5-139">**COM interop** </span></span>  
   <span data-ttu-id="6e2b5-140">V rámci collectible sestavení může být definováno žádné COM – rozhraní a žádné instance typů v rámci collectible sestavení mohou být převedeny na objekty modelu COM.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-140">No COM interfaces can be defined within a collectible assembly, and no instances of types within a collectible assembly can be converted into COM objects.</span></span> <span data-ttu-id="6e2b5-141">K typu v collectible sestavení nemůže sloužit jako obálka volatelná aplikacemi COM (doleva) nebo Obálka volatelná za běhu (RCW).</span><span class="sxs-lookup"><span data-stu-id="6e2b5-141">A type in a collectible assembly cannot serve as a COM callable wrapper (CCW) or runtime callable wrapper (RCW).</span></span> <span data-ttu-id="6e2b5-142">Typy v sestavení collectible však můžete použít objekty, které implementují rozhraní modelu COM.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-142">However, types in collectible assemblies can use objects that implement COM interfaces.</span></span>

- <span data-ttu-id="6e2b5-143">**Vyvolání platformy** </span><span class="sxs-lookup"><span data-stu-id="6e2b5-143">**Platform invoke** </span></span>  
   <span data-ttu-id="6e2b5-144">Metody, které mají <xref:System.Runtime.InteropServices.DllImportAttribute> atribut nebude kompilovat, když jsou deklarovány v collectible sestavení.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-144">Methods that have the <xref:System.Runtime.InteropServices.DllImportAttribute> attribute will not compile when they are declared in a collectible assembly.</span></span> <span data-ttu-id="6e2b5-145"><xref:System.Reflection.Emit.OpCodes.Calli?displayProperty=nameWithType> Instrukce nelze použít k implementaci určitého typu ve collectible sestavení a tyto typy nelze zařadit do nespravovaného kódu.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-145">The <xref:System.Reflection.Emit.OpCodes.Calli?displayProperty=nameWithType> instruction cannot be used in the implementation of a type in a collectible assembly, and such types cannot be marshaled to unmanaged code.</span></span> <span data-ttu-id="6e2b5-146">Můžete však volání do nativního kódu s použitím vstupní bod, který je deklarován v jiných collectible sestavení.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-146">However, you can call into native code by using an entry point that is declared in a non-collectible assembly.</span></span>
 
- <span data-ttu-id="6e2b5-147">**Zařazování** </span><span class="sxs-lookup"><span data-stu-id="6e2b5-147">**Marshaling** </span></span>  
   <span data-ttu-id="6e2b5-148">Objekty (ve konkrétní, delegáti), které jsou definovány v sestaveních collectible nelze zařadit.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-148">Objects (in particular, delegates) that are defined in collectible assemblies cannot be marshaled.</span></span> <span data-ttu-id="6e2b5-149">Toto je omezení na všech typech přechodný emitovaného.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-149">This is a restriction on all transient emitted types.</span></span>

- <span data-ttu-id="6e2b5-150">**Načítání sestavení** </span><span class="sxs-lookup"><span data-stu-id="6e2b5-150">**Assembly loading** </span></span>  
   <span data-ttu-id="6e2b5-151">Emitování reflexe pouze mechanismus, který je podporován pro načtení collectible sestavení.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-151">Reflection emit is the only mechanism that is supported for loading collectible assemblies.</span></span> <span data-ttu-id="6e2b5-152">Sestavení, která jsou načtena pomocí jakoukoli jinou formu načítání sestavení nelze odpojit.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-152">Assemblies that are loaded by using any other form of assembly loading cannot be unloaded.</span></span>
 
- <span data-ttu-id="6e2b5-153">**Kontext vazby objektů**  </span><span class="sxs-lookup"><span data-stu-id="6e2b5-153">**Context-bound objects**  </span></span>  
   <span data-ttu-id="6e2b5-154">Kontext statické proměnné nejsou podporovány.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-154">Context-static variables are not supported.</span></span> <span data-ttu-id="6e2b5-155">Typy v sestavení collectible nelze rozšířit <xref:System.ContextBoundObject>.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-155">Types in a collectible assembly cannot extend <xref:System.ContextBoundObject>.</span></span> <span data-ttu-id="6e2b5-156">Kód v collectible sestavení však můžete použít objekty kontext vazby, které jsou definovány jinde.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-156">However, code in collectible assemblies can use context-bound objects that are defined elsewhere.</span></span>

- <span data-ttu-id="6e2b5-157">**Data statické přístup z více vláken**     </span><span class="sxs-lookup"><span data-stu-id="6e2b5-157">**Thread-static data**     </span></span>  
   <span data-ttu-id="6e2b5-158">Vlákno statické proměnné nejsou podporovány.</span><span class="sxs-lookup"><span data-stu-id="6e2b5-158">Thread-static variables are not supported.</span></span>

## <a name="see-also"></a><span data-ttu-id="6e2b5-159">Viz také</span><span class="sxs-lookup"><span data-stu-id="6e2b5-159">See also</span></span>

[<span data-ttu-id="6e2b5-160">Generování dynamických metod a sestavení</span><span class="sxs-lookup"><span data-stu-id="6e2b5-160">Emitting Dynamic Methods and Assemblies</span></span>](emitting-dynamic-methods-and-assemblies.md)
