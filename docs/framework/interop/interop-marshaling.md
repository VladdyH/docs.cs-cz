---
title: "Zařazování spolupráce"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- marshaling, COM interop
- interop marshaling
- interop marshaling, about interop marshaling
ms.assetid: 115f7a2f-d422-4605-ab36-13a8dd28142a
caps.latest.revision: "22"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 17638390a07f752a7101209e5635752bc0511d1d
ms.sourcegitcommit: c0dd436f6f8f44dc80dc43b07f6841a00b74b23f
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 01/19/2018
---
# <a name="interop-marshaling"></a><span data-ttu-id="98ce3-102">Zařazování spolupráce</span><span class="sxs-lookup"><span data-stu-id="98ce3-102">Interop Marshaling</span></span>
<a name="top"></a><span data-ttu-id="98ce3-103">Zařazování spolupráce řídí, jak se data předávají v metoda argumentů a návratové hodnoty mezi spravovanými a nespravovanými paměti během volání.</span><span class="sxs-lookup"><span data-stu-id="98ce3-103">Interop marshaling governs how data is passed in method arguments and return values between managed and unmanaged memory during calls.</span></span> <span data-ttu-id="98ce3-104">Zařazování spolupráce je aktivita běhu zajišťuje služba zařazování modul common language runtime.</span><span class="sxs-lookup"><span data-stu-id="98ce3-104">Interop marshaling is a run-time activity performed by the common language runtime's marshaling service.</span></span>  
  
 <span data-ttu-id="98ce3-105">Většina datových typů mít běžných vyjádření ve spravované i nespravované paměti.</span><span class="sxs-lookup"><span data-stu-id="98ce3-105">Most data types have common representations in both managed and unmanaged memory.</span></span> <span data-ttu-id="98ce3-106">Tyto typy zpracovává spolupráce vláken.</span><span class="sxs-lookup"><span data-stu-id="98ce3-106">The interop marshaler handles these types for you.</span></span> <span data-ttu-id="98ce3-107">Jiné typy může být nejednoznačný nebo není reprezentována vůbec v spravované paměti.</span><span class="sxs-lookup"><span data-stu-id="98ce3-107">Other types can be ambiguous or not represented at all in managed memory.</span></span>  
  
 <span data-ttu-id="98ce3-108">Typ nejednoznačný může mít buď více nespravované reprezentací, které jsou mapovány na jeden spravovaný typ, nebo chybějící informace o typu, jako je například velikost pole.</span><span class="sxs-lookup"><span data-stu-id="98ce3-108">An ambiguous type can have either multiple unmanaged representations that map to a single managed type, or missing type information, such as the size of an array.</span></span> <span data-ttu-id="98ce3-109">Nejednoznačný typů poskytuje zařazování znázornění výchozí a alternativní zobrazení, kde existuje více reprezentace.</span><span class="sxs-lookup"><span data-stu-id="98ce3-109">For ambiguous types, the marshaler provides a default representation and alternative representations where multiple representations exist.</span></span> <span data-ttu-id="98ce3-110">Můžete zadat explicitní pokyny pro zařazování vláken v tom, jak je zařazování nejednoznačným typem.</span><span class="sxs-lookup"><span data-stu-id="98ce3-110">You can supply explicit instructions to the marshaler on how it is to marshal an ambiguous type.</span></span>  
  
 <span data-ttu-id="98ce3-111">Tento přehled obsahuje následující části:</span><span class="sxs-lookup"><span data-stu-id="98ce3-111">This overview contains the following sections:</span></span>  
  
-   [<span data-ttu-id="98ce3-112">Vyvolání platformy a modely zprostředkovatele komunikace s objekty COM</span><span class="sxs-lookup"><span data-stu-id="98ce3-112">Platform Invoke and COM Interop Models</span></span>](#platform_invoke_and_com_interop_models)  
  
-   [<span data-ttu-id="98ce3-113">Marshaling a Apartment COM</span><span class="sxs-lookup"><span data-stu-id="98ce3-113">Marshaling and COM Apartments</span></span>](#marshaling_and_com_apartments)  
  
-   [<span data-ttu-id="98ce3-114">Zařazování Vzdálená volání</span><span class="sxs-lookup"><span data-stu-id="98ce3-114">Marshaling Remote Calls</span></span>](#marshaling_remote_calls)  
  
-   [<span data-ttu-id="98ce3-115">Související témata</span><span class="sxs-lookup"><span data-stu-id="98ce3-115">Related Topics</span></span>](#related_topics)  
  
-   [<span data-ttu-id="98ce3-116">Referenční informace</span><span class="sxs-lookup"><span data-stu-id="98ce3-116">Reference</span></span>](#reference)  
  
<a name="platform_invoke_and_com_interop_models"></a>   
## <a name="platform-invoke-and-com-interop-models"></a><span data-ttu-id="98ce3-117">Vyvolání platformy a modely zprostředkovatele komunikace s objekty COM</span><span class="sxs-lookup"><span data-stu-id="98ce3-117">Platform Invoke and COM Interop Models</span></span>  
 <span data-ttu-id="98ce3-118">Modul common language runtime poskytuje dva mechanismy pro spolupráce s nespravovaným kódem:</span><span class="sxs-lookup"><span data-stu-id="98ce3-118">The common language runtime provides two mechanisms for interoperating with unmanaged code:</span></span>  
  
-   <span data-ttu-id="98ce3-119">Volání nespravovaného kódu, což umožňuje spravovaného kódu k volání funkce exportované z nespravovaných knihovny.</span><span class="sxs-lookup"><span data-stu-id="98ce3-119">Platform invoke, which enables managed code to call functions exported from an unmanaged library.</span></span>  
  
-   <span data-ttu-id="98ce3-120">Spoluprací COM, umožňující spravovaného kódu k interakci s objekty modelu COM (Component Object) prostřednictvím rozhraní.</span><span class="sxs-lookup"><span data-stu-id="98ce3-120">COM interop, which enables managed code to interact with Component Object Model (COM) objects through interfaces.</span></span>  
  
 <span data-ttu-id="98ce3-121">Vyvolání obě platformy a modelu COM pomocí zprostředkovatele komunikace s objekty zařazování spolupráce přesně metoda argumenty přecházet mezi volající a volaný a zpět, pokud to vyžaduje.</span><span class="sxs-lookup"><span data-stu-id="98ce3-121">Both platform invoke and COM interop use interop marshaling to accurately move method arguments between caller and callee and back, if required.</span></span> <span data-ttu-id="98ce3-122">Jak ukazuje následující obrázek, platformu vyvolání toky volání metoda ze spravovaného na nespravovaný kód a nikdy jiným způsobem, s výjimkou případů, kdy [funkce zpětného volání](../../../docs/framework/interop/callback-functions.md) se skládá.</span><span class="sxs-lookup"><span data-stu-id="98ce3-122">As the following illustration shows, a platform invoke method call flows from managed to unmanaged code and never the other way, except when [callback functions](../../../docs/framework/interop/callback-functions.md) are involved.</span></span> <span data-ttu-id="98ce3-123">I když vyvolání platformy volání můžete toku pouze ze spravovaného na nespravovaný kód, můžete toku dat v obou směrech jako vstupní nebo výstupní parametry.</span><span class="sxs-lookup"><span data-stu-id="98ce3-123">Even though platform invoke calls can flow only from managed to unmanaged code, data can flow in both directions as input or output parameters.</span></span> <span data-ttu-id="98ce3-124">Volání metody zprostředkovatele komunikace s objekty COM proudit oběma směry.</span><span class="sxs-lookup"><span data-stu-id="98ce3-124">COM interop method calls can flow in either direction.</span></span>  
  
 <span data-ttu-id="98ce3-125">![Vyvolání platformy](../../../docs/framework/interop/media/interopmarshaling.png "interopmarshaling")</span><span class="sxs-lookup"><span data-stu-id="98ce3-125">![Platform invoke](../../../docs/framework/interop/media/interopmarshaling.png "interopmarshaling")</span></span>  
<span data-ttu-id="98ce3-126">Vyvolání platformy a toku volání zprostředkovatele komunikace s objekty COM</span><span class="sxs-lookup"><span data-stu-id="98ce3-126">Platform invoke and COM interop call flow</span></span>  
  
 <span data-ttu-id="98ce3-127">Na nejnižší úrovni obou mechanismy používají stejný zprostředkovatel komunikace s objekty zařazování služby; ale některé datové typy jsou podporovány výhradně zprostředkovatel komunikace s objekty COM nebo vyvolání platformy.</span><span class="sxs-lookup"><span data-stu-id="98ce3-127">At the lowest level, both mechanisms use the same interop marshaling service; however, certain data types are supported exclusively by COM interop or platform invoke.</span></span> <span data-ttu-id="98ce3-128">Podrobnosti najdete v tématu [výchozí chování zařazování](../../../docs/framework/interop/default-marshaling-behavior.md).</span><span class="sxs-lookup"><span data-stu-id="98ce3-128">For details, see [Default Marshaling Behavior](../../../docs/framework/interop/default-marshaling-behavior.md).</span></span>  
  
 [<span data-ttu-id="98ce3-129">Zpět na začátek</span><span class="sxs-lookup"><span data-stu-id="98ce3-129">Back to top</span></span>](#top)  
  
<a name="marshaling_and_com_apartments"></a>   
## <a name="marshaling-and-com-apartments"></a><span data-ttu-id="98ce3-130">Marshaling a Apartment COM</span><span class="sxs-lookup"><span data-stu-id="98ce3-130">Marshaling and COM Apartments</span></span>  
 <span data-ttu-id="98ce3-131">Spolupráce vláken zařazuje dat mezi běžné haldy runtime jazyka a nespravované haldě.</span><span class="sxs-lookup"><span data-stu-id="98ce3-131">The interop marshaler marshals data between the common language runtime heap and the unmanaged heap.</span></span> <span data-ttu-id="98ce3-132">Zařazování dojde vždy, když volající a volaný nemůže pracovat na stejnou instanci data.</span><span class="sxs-lookup"><span data-stu-id="98ce3-132">Marshaling occurs whenever the caller and callee cannot operate on the same instance of data.</span></span> <span data-ttu-id="98ce3-133">Spolupráce vláken je umožněno pro volající a volaný vykazuje na stejná data i v případě, že mají své vlastní kopie dat.</span><span class="sxs-lookup"><span data-stu-id="98ce3-133">The interop marshaler makes it possible for the caller and callee to appear to be operating on the same data even if they have their own copy of the data.</span></span>  
  
 <span data-ttu-id="98ce3-134">COM má také vláken, která zařazuje dat mezi bytů COM nebo jiné procesy COM.</span><span class="sxs-lookup"><span data-stu-id="98ce3-134">COM also has a marshaler that marshals data between COM apartments or different COM processes.</span></span> <span data-ttu-id="98ce3-135">Při volání mezi spravovanými a nespravovanými kódu v rámci stejné typu apartment COM, spolupráce vláken je pouze vláken zahrnutých.</span><span class="sxs-lookup"><span data-stu-id="98ce3-135">When calling between managed and unmanaged code within the same COM apartment, the interop marshaler is the only marshaler involved.</span></span> <span data-ttu-id="98ce3-136">Při volání mezi spravovaného kódu a nespravovaného kódu v různých oddílu modelu COM nebo jiným procesem, se podílejí spolupráce vláken a COM vláken.</span><span class="sxs-lookup"><span data-stu-id="98ce3-136">When calling between managed code and unmanaged code in a different COM apartment or a different process, both the interop marshaler and the COM marshaler are involved.</span></span>  
  
### <a name="com-clients-and-managed-servers"></a><span data-ttu-id="98ce3-137">Klienti COM a spravovaných serverů</span><span class="sxs-lookup"><span data-stu-id="98ce3-137">COM Clients and Managed Servers</span></span>  
 <span data-ttu-id="98ce3-138">Exportovaný spravovaný server se knihovny typů registrovaných [Regasm.exe (Nástroj registrace sestavení)](../../../docs/framework/tools/regasm-exe-assembly-registration-tool.md) má `ThreadingModel` položky registru nastavena na `Both`.</span><span class="sxs-lookup"><span data-stu-id="98ce3-138">An exported managed server with a type library registered by the [Regasm.exe (Assembly Registration Tool)](../../../docs/framework/tools/regasm-exe-assembly-registration-tool.md) has a `ThreadingModel` registry entry set to `Both`.</span></span> <span data-ttu-id="98ce3-139">Tato hodnota označuje, že server může být aktivovaný single-threaded apartment (STA) nebo více vláken typu apartment (MTA).</span><span class="sxs-lookup"><span data-stu-id="98ce3-139">This value indicates that the server can be activated in a single-threaded apartment (STA) or a multithreaded apartment (MTA).</span></span> <span data-ttu-id="98ce3-140">Objekt serveru se vytvoří ve stejné typu apartment jako jeho volajícího, jak je znázorněno v následující tabulce.</span><span class="sxs-lookup"><span data-stu-id="98ce3-140">The server object is created in the same apartment as its caller, as shown in the following table.</span></span>  
  
|<span data-ttu-id="98ce3-141">Klient COM</span><span class="sxs-lookup"><span data-stu-id="98ce3-141">COM client</span></span>|<span data-ttu-id="98ce3-142">Rozhraní .NET serveru</span><span class="sxs-lookup"><span data-stu-id="98ce3-142">.NET server</span></span>|<span data-ttu-id="98ce3-143">Zařazování požadavky</span><span class="sxs-lookup"><span data-stu-id="98ce3-143">Marshaling requirements</span></span>|  
|----------------|-----------------|-----------------------------|  
|<span data-ttu-id="98ce3-144">STA</span><span class="sxs-lookup"><span data-stu-id="98ce3-144">STA</span></span>|<span data-ttu-id="98ce3-145">`Both` becomes STA.</span><span class="sxs-lookup"><span data-stu-id="98ce3-145">`Both` becomes STA.</span></span>|<span data-ttu-id="98ce3-146">Zařazování stejné typu apartment.</span><span class="sxs-lookup"><span data-stu-id="98ce3-146">Same-apartment marshaling.</span></span>|  
|<span data-ttu-id="98ce3-147">MTA</span><span class="sxs-lookup"><span data-stu-id="98ce3-147">MTA</span></span>|<span data-ttu-id="98ce3-148">`Both` becomes MTA.</span><span class="sxs-lookup"><span data-stu-id="98ce3-148">`Both` becomes MTA.</span></span>|<span data-ttu-id="98ce3-149">Zařazování stejné typu apartment.</span><span class="sxs-lookup"><span data-stu-id="98ce3-149">Same-apartment marshaling.</span></span>|  
  
 <span data-ttu-id="98ce3-150">Protože klient a server jsou ve stejné typu apartment, zprostředkovatel komunikace s objekty služby zařazování automaticky zpracovává všechny dat – zařazování.</span><span class="sxs-lookup"><span data-stu-id="98ce3-150">Because the client and server are in the same apartment, the interop marshaling service automatically handles all data marshaling.</span></span> <span data-ttu-id="98ce3-151">Následující obrázek znázorňuje službu spolupráce zařazování operační mezi spravovanými a nespravovanými haldách v rámci stejné COM stylu typu apartment.</span><span class="sxs-lookup"><span data-stu-id="98ce3-151">The following illustration shows the interop marshaling service operating between managed and unmanaged heaps within the same COM-style apartment.</span></span>  
  
 <span data-ttu-id="98ce3-152">![Zařazování spolupráce](../../../docs/framework/interop/media/interopheap.gif "interopheap")</span><span class="sxs-lookup"><span data-stu-id="98ce3-152">![Interop marshaling](../../../docs/framework/interop/media/interopheap.gif "interopheap")</span></span>  
<span data-ttu-id="98ce3-153">Zařazování procesu stejné objektu apartment</span><span class="sxs-lookup"><span data-stu-id="98ce3-153">Same-apartment marshaling process</span></span>  
  
 <span data-ttu-id="98ce3-154">Pokud budete chtít exportovat spravovaném serveru, mějte na paměti, že klient COM určuje typu apartment serveru.</span><span class="sxs-lookup"><span data-stu-id="98ce3-154">If you plan to export a managed server, be aware that the COM client determines the apartment of the server.</span></span> <span data-ttu-id="98ce3-155">Spravovaný server volá klient modelu COM v modelu MTA inicializovat musí zajistit bezpečný přístup z více vláken.</span><span class="sxs-lookup"><span data-stu-id="98ce3-155">A managed server called by a COM client initialized in an MTA must ensure thread safety.</span></span>  
  
### <a name="managed-clients-and-com-servers"></a><span data-ttu-id="98ce3-156">Spravovaných klientů a serverů modelu COM</span><span class="sxs-lookup"><span data-stu-id="98ce3-156">Managed Clients and COM Servers</span></span>  
 <span data-ttu-id="98ce3-157">Výchozí nastavení pro klienta spravovaného Apartment je MTA; Typ aplikace klienta rozhraní .NET můžete však změnit výchozí nastavení.</span><span class="sxs-lookup"><span data-stu-id="98ce3-157">The default setting for managed client apartments is MTA; however, the application type of the .NET client can change the default setting.</span></span> <span data-ttu-id="98ce3-158">Například [!INCLUDE[vbprvblong](../../../includes/vbprvblong-md.md)] STA je nastavení klienta objektu apartment</span><span class="sxs-lookup"><span data-stu-id="98ce3-158">For example, a [!INCLUDE[vbprvblong](../../../includes/vbprvblong-md.md)] client apartment setting is STA.</span></span> <span data-ttu-id="98ce3-159">Můžete použít <xref:System.STAThreadAttribute?displayProperty=nameWithType>, <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> vlastnost, nebo <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> vlastnost sloužící ke zkoumání a změňte nastavení typu apartment spravovaného klienta.</span><span class="sxs-lookup"><span data-stu-id="98ce3-159">You can use the <xref:System.STAThreadAttribute?displayProperty=nameWithType>, the <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, the <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> property, or the <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> property to examine and change the apartment setting of a managed client.</span></span>  
  
 <span data-ttu-id="98ce3-160">Autor komponentu nastaví spřažení podprocesu COM serveru.</span><span class="sxs-lookup"><span data-stu-id="98ce3-160">The author of the component sets the thread affinity of a COM server.</span></span> <span data-ttu-id="98ce3-161">V následující tabulce jsou uvedeny kombinace apartment nastavení pro rozhraní .NET klienty a servery COM.</span><span class="sxs-lookup"><span data-stu-id="98ce3-161">The following table shows the combinations of apartment settings for .NET clients and COM servers.</span></span> <span data-ttu-id="98ce3-162">Také ukazuje výsledná zařazování požadavky pro kombinace.</span><span class="sxs-lookup"><span data-stu-id="98ce3-162">It also shows the resulting marshaling requirements for the combinations.</span></span>  
  
|<span data-ttu-id="98ce3-163">Klient .NET</span><span class="sxs-lookup"><span data-stu-id="98ce3-163">.NET client</span></span>|<span data-ttu-id="98ce3-164">COM server</span><span class="sxs-lookup"><span data-stu-id="98ce3-164">COM server</span></span>|<span data-ttu-id="98ce3-165">Zařazování požadavky</span><span class="sxs-lookup"><span data-stu-id="98ce3-165">Marshaling requirements</span></span>|  
|-----------------|----------------|-----------------------------|  
|<span data-ttu-id="98ce3-166">Protokol MTA (výchozí)</span><span class="sxs-lookup"><span data-stu-id="98ce3-166">MTA (default)</span></span>|<span data-ttu-id="98ce3-167">MTA</span><span class="sxs-lookup"><span data-stu-id="98ce3-167">MTA</span></span><br /><br /> <span data-ttu-id="98ce3-168">STA</span><span class="sxs-lookup"><span data-stu-id="98ce3-168">STA</span></span>|<span data-ttu-id="98ce3-169">Zařazování spolupráce</span><span class="sxs-lookup"><span data-stu-id="98ce3-169">Interop marshaling.</span></span><br /><br /> <span data-ttu-id="98ce3-170">Zprostředkovatel komunikace s objekty a zařazování COM.</span><span class="sxs-lookup"><span data-stu-id="98ce3-170">Interop and COM marshaling.</span></span>|  
|<span data-ttu-id="98ce3-171">STA</span><span class="sxs-lookup"><span data-stu-id="98ce3-171">STA</span></span>|<span data-ttu-id="98ce3-172">MTA</span><span class="sxs-lookup"><span data-stu-id="98ce3-172">MTA</span></span><br /><br /> <span data-ttu-id="98ce3-173">STA</span><span class="sxs-lookup"><span data-stu-id="98ce3-173">STA</span></span>|<span data-ttu-id="98ce3-174">Zprostředkovatel komunikace s objekty a zařazování COM.</span><span class="sxs-lookup"><span data-stu-id="98ce3-174">Interop and COM marshaling.</span></span><br /><br /> <span data-ttu-id="98ce3-175">Zařazování spolupráce</span><span class="sxs-lookup"><span data-stu-id="98ce3-175">Interop marshaling.</span></span>|  
  
 <span data-ttu-id="98ce3-176">Při nespravovanému serveru a klienta spravovaného jsou ve stejné typu apartment, zprostředkovatel komunikace s objekty služby zařazování zpracovává všechny zařazování data.</span><span class="sxs-lookup"><span data-stu-id="98ce3-176">When a managed client and unmanaged server are in the same apartment, the interop marshaling service handles all data marshaling.</span></span> <span data-ttu-id="98ce3-177">Ale když klient a server se inicializují v různých apartment, COM zařazování je také nutný.</span><span class="sxs-lookup"><span data-stu-id="98ce3-177">However, when client and server are initialized in different apartments, COM marshaling is also required.</span></span> <span data-ttu-id="98ce3-178">Na následujícím obrázku je znázorněno volání mezi apartment.</span><span class="sxs-lookup"><span data-stu-id="98ce3-178">The following illustration shows the elements of a cross-apartment call.</span></span>  
  
 <span data-ttu-id="98ce3-179">![Zařazování COM](../../../docs/framework/interop/media/singleprocessmultapt.gif "singleprocessmultapt")</span><span class="sxs-lookup"><span data-stu-id="98ce3-179">![COM marshaling](../../../docs/framework/interop/media/singleprocessmultapt.gif "singleprocessmultapt")</span></span>  
<span data-ttu-id="98ce3-180">Volání mezi apartment mezi klient .NET a objekt modelu COM</span><span class="sxs-lookup"><span data-stu-id="98ce3-180">Cross-apartment call between a .NET client and COM object</span></span>  
  
 <span data-ttu-id="98ce3-181">Pro zařazování mezi apartment, můžete provést následující:</span><span class="sxs-lookup"><span data-stu-id="98ce3-181">For cross-apartment marshaling, you can do the following:</span></span>  
  
-   <span data-ttu-id="98ce3-182">Přijměte režii zařazování mezi apartment, což je patrné, jenom v případě, že existuje mnoho volání přes hranice.</span><span class="sxs-lookup"><span data-stu-id="98ce3-182">Accept the overhead of the cross-apartment marshaling, which is noticeable only when there are many calls across the boundary.</span></span> <span data-ttu-id="98ce3-183">Je nutné zaregistrovat knihovnu typů součásti COM pro volání úspěšně překročit hranice typu apartment.</span><span class="sxs-lookup"><span data-stu-id="98ce3-183">You must register the type library of the COM component for calls to successfully cross the apartment boundary.</span></span>  
  
-   <span data-ttu-id="98ce3-184">Změnit nastavení klientské vlákno STA nebo MTA hlavního vlákna.</span><span class="sxs-lookup"><span data-stu-id="98ce3-184">Alter the main thread by setting the client thread to STA or MTA.</span></span> <span data-ttu-id="98ce3-185">Například pokud váš klient C# volá mnoho STA COM – součásti, se můžete vyhnout mezi apartment zařazování nastavením hlavního vlákna na STA</span><span class="sxs-lookup"><span data-stu-id="98ce3-185">For example, if your C# client calls many STA COM components, you can avoid cross-apartment marshaling by setting the main thread to STA.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="98ce3-186">Vlákno klienta C# nastavenou na hodnotu STA, bude vyžadovat volání do modelu MTA COM – součásti zařazování mezi apartment.</span><span class="sxs-lookup"><span data-stu-id="98ce3-186">Once the thread of a C# client is set to STA, calls to MTA COM components will require cross-apartment marshaling.</span></span>  
  
 <span data-ttu-id="98ce3-187">Pokyny týkající se explicitně výběru apartment model najdete v tématu [spravovaná a nespravovaná vlákna](http://msdn.microsoft.com/library/db425c20-4b2f-4433-bf96-76071c7881e5).</span><span class="sxs-lookup"><span data-stu-id="98ce3-187">For instructions on explicitly selecting an apartment model, see [Managed and Unmanaged Threading](http://msdn.microsoft.com/library/db425c20-4b2f-4433-bf96-76071c7881e5).</span></span>  
  
 [<span data-ttu-id="98ce3-188">Zpět na začátek</span><span class="sxs-lookup"><span data-stu-id="98ce3-188">Back to top</span></span>](#top)  
  
<a name="marshaling_remote_calls"></a>   
## <a name="marshaling-remote-calls"></a><span data-ttu-id="98ce3-189">Zařazování Vzdálená volání</span><span class="sxs-lookup"><span data-stu-id="98ce3-189">Marshaling Remote Calls</span></span>  
 <span data-ttu-id="98ce3-190">Stejně jako u mezi apartment zařazování, COM zařazování je zahrnuta v každé volání mezi spravovanými a nespravovanými kódem vždy, když se objekty nacházejí v oddělených procesech.</span><span class="sxs-lookup"><span data-stu-id="98ce3-190">As with cross-apartment marshaling, COM marshaling is involved in each call between managed and unmanaged code whenever the objects reside in separate processes.</span></span> <span data-ttu-id="98ce3-191">Příklad:</span><span class="sxs-lookup"><span data-stu-id="98ce3-191">For example:</span></span>  
  
-   <span data-ttu-id="98ce3-192">Klient COM, který volá spravovaný server na vzdálený hostitel používá distributed COM (DCOM).</span><span class="sxs-lookup"><span data-stu-id="98ce3-192">A COM client that invokes a managed server on a remote host uses distributed COM (DCOM).</span></span>  
  
-   <span data-ttu-id="98ce3-193">Spravovaný klient, který volá server COM na vzdáleného hostitele používá model DCOM.</span><span class="sxs-lookup"><span data-stu-id="98ce3-193">A managed client that invokes a COM server on a remote host uses DCOM.</span></span>  
  
 <span data-ttu-id="98ce3-194">Následující obrázek znázorňuje, jak spolupráce zařazování a COM zařazování zadejte komunikačních kanálů napříč hranicemi proces a hostitele.</span><span class="sxs-lookup"><span data-stu-id="98ce3-194">The following illustration shows how interop marshaling and COM marshaling provide communications channels across process and host boundaries.</span></span>  
  
 <span data-ttu-id="98ce3-195">![Zařazování COM](../../../docs/framework/interop/media/interophost.gif "interophost")</span><span class="sxs-lookup"><span data-stu-id="98ce3-195">![COM marshaling](../../../docs/framework/interop/media/interophost.gif "interophost")</span></span>  
<span data-ttu-id="98ce3-196">Zařazování mezi procesy</span><span class="sxs-lookup"><span data-stu-id="98ce3-196">Cross-process marshaling</span></span>  
  
### <a name="preserving-identity"></a><span data-ttu-id="98ce3-197">Zachování Identity</span><span class="sxs-lookup"><span data-stu-id="98ce3-197">Preserving Identity</span></span>  
 <span data-ttu-id="98ce3-198">Modul common language runtime zachovává identitu spravovanými a nespravovanými odkazy.</span><span class="sxs-lookup"><span data-stu-id="98ce3-198">The common language runtime preserves the identity of managed and unmanaged references.</span></span> <span data-ttu-id="98ce3-199">Následující obrázek znázorňuje tok přímé nespravované odkazy (horní řádek) a přímé odkazy na spravovaného (dolní řádek) napříč hranicemi proces a hostitele.</span><span class="sxs-lookup"><span data-stu-id="98ce3-199">The following illustration shows the flow of direct unmanaged references (top row) and direct managed references (bottom row) across process and host boundaries.</span></span>  
  
 <span data-ttu-id="98ce3-200">![Obálka volatelná aplikacemi COM a obálka volatelná za běhu](../../../docs/framework/interop/media/interopdirectref.gif "interopdirectref")</span><span class="sxs-lookup"><span data-stu-id="98ce3-200">![COM callable wrapper and runtime callable wrapper](../../../docs/framework/interop/media/interopdirectref.gif "interopdirectref")</span></span>  
<span data-ttu-id="98ce3-201">Odkaz na předávání přes hranice procesu a hostitele</span><span class="sxs-lookup"><span data-stu-id="98ce3-201">Reference passing across process and host boundaries</span></span>  
  
 <span data-ttu-id="98ce3-202">V tomto obrázku:</span><span class="sxs-lookup"><span data-stu-id="98ce3-202">In this illustration:</span></span>  
  
-   <span data-ttu-id="98ce3-203">Nespravovaný klient získá odkaz na objekt COM ze spravovaného objektu, který získá odkaz na tento od vzdáleného hostitele.</span><span class="sxs-lookup"><span data-stu-id="98ce3-203">An unmanaged client gets a reference to a COM object from a managed object that gets this reference from a remote host.</span></span> <span data-ttu-id="98ce3-204">Tento mechanismus vzdálené komunikace je model DCOM.</span><span class="sxs-lookup"><span data-stu-id="98ce3-204">The remoting mechanism is DCOM.</span></span>  
  
-   <span data-ttu-id="98ce3-205">Spravovaný klient získá odkaz na objekt spravovaného z objektu COM, který získá odkaz na tento od vzdáleného hostitele.</span><span class="sxs-lookup"><span data-stu-id="98ce3-205">A managed client gets a reference to a managed object from a COM object that gets this reference from a remote host.</span></span> <span data-ttu-id="98ce3-206">Tento mechanismus vzdálené komunikace je model DCOM.</span><span class="sxs-lookup"><span data-stu-id="98ce3-206">The remoting mechanism is DCOM.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="98ce3-207">Knihovna exportovaný typ spravovaného serveru musí být zaregistrován.</span><span class="sxs-lookup"><span data-stu-id="98ce3-207">The exported type library of the managed server must be registered.</span></span>  
  
 <span data-ttu-id="98ce3-208">Počet proces hranice mezi volající a volaný je důležité; stejné přímé odkazujícího dochází v procesu a out-of-process volání.</span><span class="sxs-lookup"><span data-stu-id="98ce3-208">The number of process boundaries between caller and callee is irrelevant; the same direct referencing occurs for in-process and out-of-process calls.</span></span>  
  
### <a name="managed-remoting"></a><span data-ttu-id="98ce3-209">Spravované vzdálené komunikace</span><span class="sxs-lookup"><span data-stu-id="98ce3-209">Managed Remoting</span></span>  
 <span data-ttu-id="98ce3-210">Modul runtime také poskytuje spravované vzdálenou komunikaci, která vám pomůže vytvořit komunikační kanál mezi spravované objekty napříč hranicemi proces a hostitele.</span><span class="sxs-lookup"><span data-stu-id="98ce3-210">The runtime also provides managed remoting, which you can use to establish a communications channel between managed objects across process and host boundaries.</span></span> <span data-ttu-id="98ce3-211">Spravované vzdálenou komunikaci zvládne brány firewall mezi součástmi komunikuje, jak ukazuje následující obrázek.</span><span class="sxs-lookup"><span data-stu-id="98ce3-211">Managed remoting can accommodate a firewall between the communicating components, as the following illustration shows.</span></span>  
  
 <span data-ttu-id="98ce3-212">![Protokol SOAP nebo TcpChannel](../../../docs/framework/interop/media/interopremotesoap.gif "interopremotesoap")</span><span class="sxs-lookup"><span data-stu-id="98ce3-212">![SOAP or TcpChannel](../../../docs/framework/interop/media/interopremotesoap.gif "interopremotesoap")</span></span>  
<span data-ttu-id="98ce3-213">Vzdálená volání přes brány firewall pomocí protokolu SOAP nebo TcpChannel – třída</span><span class="sxs-lookup"><span data-stu-id="98ce3-213">Remote calls across firewalls using SOAP or the TcpChannel class</span></span>  
  
 <span data-ttu-id="98ce3-214">Některá volání nespravovaného můžete channeled prostřednictvím protokolu SOAP, jako je například volání mezi [obsluhované komponenty](http://msdn.microsoft.com/library/f109ee24-81ad-4d99-9892-51ac6f34978c) a COM.</span><span class="sxs-lookup"><span data-stu-id="98ce3-214">Some unmanaged calls can be channeled through SOAP, such as the calls between [serviced components](http://msdn.microsoft.com/library/f109ee24-81ad-4d99-9892-51ac6f34978c) and COM.</span></span>  
  
 [<span data-ttu-id="98ce3-215">Zpět na začátek</span><span class="sxs-lookup"><span data-stu-id="98ce3-215">Back to top</span></span>](#top)  
  
<a name="related_topics"></a>   
## <a name="related-topics"></a><span data-ttu-id="98ce3-216">Související témata</span><span class="sxs-lookup"><span data-stu-id="98ce3-216">Related Topics</span></span>  
  
|<span data-ttu-id="98ce3-217">Název</span><span class="sxs-lookup"><span data-stu-id="98ce3-217">Title</span></span>|<span data-ttu-id="98ce3-218">Popis</span><span class="sxs-lookup"><span data-stu-id="98ce3-218">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="98ce3-219">Výchozí chování zařazování</span><span class="sxs-lookup"><span data-stu-id="98ce3-219">Default Marshaling Behavior</span></span>](../../../docs/framework/interop/default-marshaling-behavior.md)|<span data-ttu-id="98ce3-220">Popisuje pravidla, která používá službu zařazování spolupráce zařazování dat.</span><span class="sxs-lookup"><span data-stu-id="98ce3-220">Describes the rules that the interop marshaling service uses to marshal data.</span></span>|  
|[<span data-ttu-id="98ce3-221">Zařazování dat s voláním platformy</span><span class="sxs-lookup"><span data-stu-id="98ce3-221">Marshaling Data with Platform Invoke</span></span>](../../../docs/framework/interop/marshaling-data-with-platform-invoke.md)|<span data-ttu-id="98ce3-222">Popisuje, jak deklarace parametry metody a předání argumentů funkce exportované sadou nespravované knihovny.</span><span class="sxs-lookup"><span data-stu-id="98ce3-222">Describes how to declare method parameters and pass arguments to functions exported by unmanaged libraries.</span></span>|  
|[<span data-ttu-id="98ce3-223">Zařazování dat se spoluprací COM</span><span class="sxs-lookup"><span data-stu-id="98ce3-223">Marshaling Data with COM Interop</span></span>](../../../docs/framework/interop/marshaling-data-with-com-interop.md)|<span data-ttu-id="98ce3-224">Popisuje, jak přizpůsobit COM – obálky ke změně chování zařazování.</span><span class="sxs-lookup"><span data-stu-id="98ce3-224">Describes how to customize COM wrappers to alter marshaling behavior.</span></span>|  
|[<span data-ttu-id="98ce3-225">Postup: Migrace spravovaného kódu DCOM do WCF</span><span class="sxs-lookup"><span data-stu-id="98ce3-225">How to: Migrate Managed-Code DCOM to WCF</span></span>](../../../docs/framework/interop/how-to-migrate-managed-code-dcom-to-wcf.md)|<span data-ttu-id="98ce3-226">Popisuje, jak migrovat z modelu DCOM do WCF.</span><span class="sxs-lookup"><span data-stu-id="98ce3-226">Describes how to migrate from DCOM to WCF.</span></span>|  
|[<span data-ttu-id="98ce3-227">Postupy: Mapování výsledků HRESULT a výjimek</span><span class="sxs-lookup"><span data-stu-id="98ce3-227">How to: Map HRESULTs and Exceptions</span></span>](../../../docs/framework/interop/how-to-map-hresults-and-exceptions.md)|<span data-ttu-id="98ce3-228">Popisuje, jak namapovat vlastní výjimky pro hodnoty HRESULT a poskytuje kompletní mapování z každé HRESULT do své třídy porovnatelný z hlediska výjimek v rozhraní .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="98ce3-228">Describes how to map custom exceptions to HRESULTs and provides the complete mapping from each HRESULT to its comparable exception class in the .NET Framework.</span></span>|  
|[<span data-ttu-id="98ce3-229">Spolupráce pomocí obecných typů</span><span class="sxs-lookup"><span data-stu-id="98ce3-229">Interoperating Using Generic Types</span></span>](http://msdn.microsoft.com/library/26b88e03-085b-4b53-94ba-a5a9c709ce58)|<span data-ttu-id="98ce3-230">Popisuje akce, které jsou podporovány při použití obecných typů pro interoperabilita modelů COM.</span><span class="sxs-lookup"><span data-stu-id="98ce3-230">Describes which actions are supported when using generic types for COM interoperability.</span></span>|  
|[<span data-ttu-id="98ce3-231">Spolupráce s nespravovaným kódem</span><span class="sxs-lookup"><span data-stu-id="98ce3-231">Interoperating with Unmanaged Code</span></span>](../../../docs/framework/interop/index.md)|<span data-ttu-id="98ce3-232">Popisuje vzájemná funkční spolupráce služeb poskytovaných tímto modul common language runtime.</span><span class="sxs-lookup"><span data-stu-id="98ce3-232">Describes interoperability services provided by the common language runtime.</span></span>|  
|[<span data-ttu-id="98ce3-233">Interoperabilita modelů COM Upřesnit</span><span class="sxs-lookup"><span data-stu-id="98ce3-233">Advanced COM Interoperability</span></span>](http://msdn.microsoft.com/library/3ada36e5-2390-4d70-b490-6ad8de92f2fb)|<span data-ttu-id="98ce3-234">Obsahuje odkazy na další informace o zahrnutí komponenty modelu COM do své aplikace rozhraní .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="98ce3-234">Provides links to more information about incorporating COM components into your .NET Framework application.</span></span>|  
|[<span data-ttu-id="98ce3-235">Aspekty návrhu pro spolupráci</span><span class="sxs-lookup"><span data-stu-id="98ce3-235">Design Considerations for Interoperation</span></span>](http://msdn.microsoft.com/library/b59637f6-fe35-40d6-ae72-901e7a707689)|<span data-ttu-id="98ce3-236">Poskytuje tipy pro zápis integrované COM – součásti.</span><span class="sxs-lookup"><span data-stu-id="98ce3-236">Provides tips for writing integrated COM components.</span></span>|  
  
 [<span data-ttu-id="98ce3-237">Zpět na začátek</span><span class="sxs-lookup"><span data-stu-id="98ce3-237">Back to top</span></span>](#top)  
  
<a name="reference"></a>   
## <a name="reference"></a><span data-ttu-id="98ce3-238">Odkaz</span><span class="sxs-lookup"><span data-stu-id="98ce3-238">Reference</span></span>  
 <xref:System.Runtime.InteropServices?displayProperty=nameWithType>  
  
 [<span data-ttu-id="98ce3-239">Zpět na začátek</span><span class="sxs-lookup"><span data-stu-id="98ce3-239">Back to top</span></span>](#top)
