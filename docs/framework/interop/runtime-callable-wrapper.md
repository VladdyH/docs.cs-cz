---
title: Obálka volatelná za běhu
ms.date: 03/30/2017
helpviewer_keywords:
- COM interop, COM wrappers
- RCW
- COM wrappers
- runtime callable wrappers
- interoperation with unmanaged code, COM wrappers
ms.assetid: 7e542583-1e31-4e10-b523-8cf2f29cb4a4
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 7366bfd6459a9387e8c57092ba85cac5f4da125b
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 05/04/2018
---
# <a name="runtime-callable-wrapper"></a><span data-ttu-id="f3ccf-102">Obálka volatelná za běhu</span><span class="sxs-lookup"><span data-stu-id="f3ccf-102">Runtime Callable Wrapper</span></span>
<span data-ttu-id="f3ccf-103">Modul common language runtime zpřístupní objektů COM prostřednictvím proxy serveru názvem obálka volatelná za běhu (RCW).</span><span class="sxs-lookup"><span data-stu-id="f3ccf-103">The common language runtime exposes COM objects through a proxy called the runtime callable wrapper (RCW).</span></span> <span data-ttu-id="f3ccf-104">I když RCW se zdá být objekt obyčejnou tak, aby klientů .NET, je jeho primární funkce zařazování volání mezi sebou klient .NET a objekt modelu COM.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-104">Although the RCW appears to be an ordinary object to .NET clients, its primary function is to marshal calls between a .NET client and a COM object.</span></span>  
  
 <span data-ttu-id="f3ccf-105">Modul runtime vytvoří přesně jeden RCW pro každý objekt modelu COM, bez ohledu na počet odkazů, které existují na tento objekt.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-105">The runtime creates exactly one RCW for each COM object, regardless of the number of references that exist on that object.</span></span> <span data-ttu-id="f3ccf-106">Modul runtime udržuje jeden RCW podle procesu pro každý objekt.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-106">The runtime maintains a single RCW per process for each object.</span></span>  <span data-ttu-id="f3ccf-107">Pokud vytvoříte RCW v jedné doméně aplikace nebo typu apartment a pak předejte odkaz na jiné domény aplikace nebo typu apartment, použije se proxy server na první objekt.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-107">If you create an RCW in one application domain or apartment, and then pass a reference to another application domain or apartment, a proxy to the first object will be used.</span></span>  <span data-ttu-id="f3ccf-108">Jak ukazuje následující obrázek, může obsahovat libovolný počet spravovaných klientů odkaz na objekty COM, které zveřejňují rozhraní INew a INewer.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-108">As the following illustration shows, any number of managed clients can hold a reference to the COM objects that expose INew and INewer interfaces.</span></span>  
  
 <span data-ttu-id="f3ccf-109">![RCW](./media/rcw.gif "rcw")</span><span class="sxs-lookup"><span data-stu-id="f3ccf-109">![RCW](./media/rcw.gif "rcw")</span></span>  
<span data-ttu-id="f3ccf-110">Přístup k objektům modelu COM pomocí obálka volatelná za běhu</span><span class="sxs-lookup"><span data-stu-id="f3ccf-110">Accessing COM objects through the runtime callable wrapper</span></span>  
  
 <span data-ttu-id="f3ccf-111">Modul runtime pomocí metadat, které jsou odvozené z knihovny typů, vytvoří objekt COM volané i obálku pro tento objekt.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-111">Using metadata derived from a type library, the runtime creates both the COM object being called and a wrapper for that object.</span></span> <span data-ttu-id="f3ccf-112">Každý RCW udržuje mezipaměť ukazatele rozhraní na objekt COM se zabalí a uvolní jeho odkaz na objekt COM, když RCW již není potřeba.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-112">Each RCW maintains a cache of interface pointers on the COM object it wraps and releases its reference on the COM object when the RCW is no longer needed.</span></span> <span data-ttu-id="f3ccf-113">Modul runtime provádí RCW uvolňování paměti.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-113">The runtime performs garbage collection on the RCW.</span></span>  
  
 <span data-ttu-id="f3ccf-114">Mimo jiné RCW zařazuje data mezi spravovanými a nespravovanými kódu jménem zabalené objektu.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-114">Among other activities, the RCW marshals data between managed and unmanaged code, on behalf of the wrapped object.</span></span> <span data-ttu-id="f3ccf-115">Konkrétně RCW poskytuje zařazování pro argumenty metoda a návratové hodnoty metoda vždy, když klient a server mají různé reprezentace dat předávaných mezi nimi.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-115">Specifically, the RCW provides marshaling for method arguments and method return values whenever the client and server have different representations of the data passed between them.</span></span>  
  
 <span data-ttu-id="f3ccf-116">Standardní obálku vynucuje vestavěné zařazování pravidla.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-116">The standard wrapper enforces built-in marshaling rules.</span></span> <span data-ttu-id="f3ccf-117">Když klient .NET předá typu String jako součást argument objekt nespravované, obálku převede řetězec na typ BSTR.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-117">For example, when a .NET client passes a String type as part of an argument to an unmanaged object, the wrapper converts the string to a BSTR type.</span></span> <span data-ttu-id="f3ccf-118">Volající by měl vrátit objekt COM BSTR jeho spravované volajícího, obdrží řetězec.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-118">Should the COM object return a BSTR to its managed caller, the caller receives a String.</span></span> <span data-ttu-id="f3ccf-119">Klient a server odesílat a přijímat data, která je jim dobře známé.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-119">Both the client and the server send and receive data that is familiar to them.</span></span> <span data-ttu-id="f3ccf-120">Jiné typy vyžadují žádný převod.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-120">Other types require no conversion.</span></span> <span data-ttu-id="f3ccf-121">Například standardní obálku vždycky předá 4bajtový celočíselný mezi spravovanými a nespravovanými kód bez převodu typu.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-121">For instance, a standard wrapper will always pass a 4-byte integer between managed and unmanaged code without converting the type.</span></span>  
  
## <a name="marshaling-selected-interfaces"></a><span data-ttu-id="f3ccf-122">Zařazování vybrané rozhraní</span><span class="sxs-lookup"><span data-stu-id="f3ccf-122">Marshaling selected interfaces</span></span>  
 <span data-ttu-id="f3ccf-123">Hlavním cílem, který [obálka volatelná za běhu](runtime-callable-wrapper.md) (RCW) je skrýt rozdíly mezi spravovanými a nespravovanými programovací modely.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-123">The primary goal of the [runtime callable wrapper](runtime-callable-wrapper.md) (RCW) is to hide the differences between the managed and unmanaged programming models.</span></span> <span data-ttu-id="f3ccf-124">Vytvořit snadný přechod, RCW spotřebuje vybrané rozhraní modelu COM bez vystavení je do klienta rozhraní .NET, jak je znázorněno na následujícím obrázku.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-124">To create a seamless transition, the RCW consumes selected COM interfaces without exposing them to the .NET client, as shown in the following illustration.</span></span>  
  
 <span data-ttu-id="f3ccf-125">![RCW s rozhraní](./media/rcwwithinterfaces.gif "rcwwithinterfaces")</span><span class="sxs-lookup"><span data-stu-id="f3ccf-125">![RCW With Interfaces](./media/rcwwithinterfaces.gif "rcwwithinterfaces")</span></span>  
<span data-ttu-id="f3ccf-126">Rozhraní COM a obálka volatelná za běhu</span><span class="sxs-lookup"><span data-stu-id="f3ccf-126">COM interfaces and the runtime callable wrapper</span></span>  
  
 <span data-ttu-id="f3ccf-127">Při vytváření jako objekt časné vazby RCW je konkrétního typu.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-127">When created as an early-bound object, the RCW is a specific type.</span></span> <span data-ttu-id="f3ccf-128">Implementuje rozhraní implementuje a poskytuje metody, vlastnosti a události z objektu rozhraní COM objektu.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-128">It implements the interfaces that the COM object implements and exposes the methods, properties, and events from the object's interfaces.</span></span> <span data-ttu-id="f3ccf-129">Na obrázku RCW zpřístupňuje rozhraní INew ale využívá **IUnknown** a **IDispatch** rozhraní.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-129">In the illustration, the RCW exposes the INew interface but consumes the **IUnknown** and **IDispatch** interfaces.</span></span> <span data-ttu-id="f3ccf-130">Navíc RCW zpřístupní všechny členy rozhraní INew klienta rozhraní .NET.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-130">Further, the RCW exposes all members of the INew interface to the .NET client.</span></span>  
  
 <span data-ttu-id="f3ccf-131">RCW využívá rozhraní uvedené v následující tabulce, které jsou vystavené objekt, který se zabalí.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-131">The RCW consumes the interfaces listed in the following table, which are exposed by the object it wraps.</span></span>  
  
|<span data-ttu-id="f3ccf-132">Rozhraní</span><span class="sxs-lookup"><span data-stu-id="f3ccf-132">Interface</span></span>|<span data-ttu-id="f3ccf-133">Popis</span><span class="sxs-lookup"><span data-stu-id="f3ccf-133">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="f3ccf-134">**IDispatch**</span><span class="sxs-lookup"><span data-stu-id="f3ccf-134">**IDispatch**</span></span>|<span data-ttu-id="f3ccf-135">Pozdní vazba objekty modelu COM pomocí reflexe.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-135">For late binding to COM objects through reflection.</span></span>|  
|<span data-ttu-id="f3ccf-136">**IErrorInfo**</span><span class="sxs-lookup"><span data-stu-id="f3ccf-136">**IErrorInfo**</span></span>|<span data-ttu-id="f3ccf-137">Obsahuje textový popis chyby, její zdroj, soubor nápovědy, kontextové nápovědy a identifikátor GUID rozhraní definované chyba (vždy **GUID_NULL** pro rozhraní .NET třídy).</span><span class="sxs-lookup"><span data-stu-id="f3ccf-137">Provides a textual description of the error, its source, a Help file, Help context, and the GUID of the interface that defined the error (always **GUID_NULL** for .NET classes).</span></span>|  
|<span data-ttu-id="f3ccf-138">**IProvideClassInfo**</span><span class="sxs-lookup"><span data-stu-id="f3ccf-138">**IProvideClassInfo**</span></span>|<span data-ttu-id="f3ccf-139">Pokud se objekt COM zabalené implementuje **IProvideClassInfo**, RCW extrahuje informace o typu z tohoto rozhraní poskytovat lepší typ identitu.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-139">If the COM object being wrapped implements **IProvideClassInfo**, the RCW extracts the type information from this interface to provide better type identity.</span></span>|  
|<span data-ttu-id="f3ccf-140">**IUnknown**</span><span class="sxs-lookup"><span data-stu-id="f3ccf-140">**IUnknown**</span></span>|<span data-ttu-id="f3ccf-141">Pro objekt identitu, převod typu a správu životního cyklu:</span><span class="sxs-lookup"><span data-stu-id="f3ccf-141">For object identity, type coercion, and lifetime management:</span></span><br /><br /> <span data-ttu-id="f3ccf-142">– Identity objekt</span><span class="sxs-lookup"><span data-stu-id="f3ccf-142">-   Object identity</span></span><br />     <span data-ttu-id="f3ccf-143">Modul runtime rozlišuje mezi objekty modelu COM tak, že porovnáte hodnotu **IUnknown** rozhraní pro každý objekt.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-143">The runtime distinguishes between COM objects by comparing the value of the **IUnknown** interface for each object.</span></span><br /><span data-ttu-id="f3ccf-144">– Typ převod</span><span class="sxs-lookup"><span data-stu-id="f3ccf-144">-   Type coercion</span></span><br />     <span data-ttu-id="f3ccf-145">RCW rozpozná dynamický typ zjišťování, provádí **QueryInterface** metoda.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-145">The RCW recognizes the dynamic type discovery performed by the **QueryInterface** method.</span></span><br /><span data-ttu-id="f3ccf-146">-Správa životního cyklu</span><span class="sxs-lookup"><span data-stu-id="f3ccf-146">-   Lifetime management</span></span><br />     <span data-ttu-id="f3ccf-147">Pomocí **QueryInterface** metodu, RCW získá a obsahuje odkaz na objekt nespravované, dokud modulu runtime provádí obálky, což uvolní nespravované objekt uvolňování paměti.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-147">Using the **QueryInterface** method, the RCW gets and holds a reference to an unmanaged object until the runtime performs garbage collection on the wrapper, which releases the unmanaged object.</span></span>|  
  
 <span data-ttu-id="f3ccf-148">RCW volitelně využívá rozhraní uvedené v následující tabulce, které jsou vystavené objekt, který se zabalí.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-148">The RCW optionally consumes the interfaces listed in the following table, which are exposed by the object it wraps.</span></span>  
  
|<span data-ttu-id="f3ccf-149">Rozhraní</span><span class="sxs-lookup"><span data-stu-id="f3ccf-149">Interface</span></span>|<span data-ttu-id="f3ccf-150">Popis</span><span class="sxs-lookup"><span data-stu-id="f3ccf-150">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="f3ccf-151">**IConnectionPoint –** a **IConnectionPointContainer**</span><span class="sxs-lookup"><span data-stu-id="f3ccf-151">**IConnectionPoint** and **IConnectionPointContainer**</span></span>|<span data-ttu-id="f3ccf-152">RCW převede objekty, které zveřejňují styl spojovací bod události na základě delegáta události.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-152">The RCW converts objects that expose the connection-point event style to delegate-based events.</span></span>|  
|<span data-ttu-id="f3ccf-153">**IDispatchEx**</span><span class="sxs-lookup"><span data-stu-id="f3ccf-153">**IDispatchEx**</span></span>|<span data-ttu-id="f3ccf-154">Pokud třída implementuje **IDispatchEx**, implementuje RCW **IExpando**.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-154">If the class implements **IDispatchEx**, the RCW implements **IExpando**.</span></span> <span data-ttu-id="f3ccf-155">**IDispatchEx** rozhraní je rozšířením **IDispatch** rozhraní, na rozdíl od **IDispatch**, umožňuje výčtu, přidání, odstranění a to malá a velká písmena volání metody členů.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-155">The **IDispatchEx** interface is an extension of the **IDispatch** interface that, unlike **IDispatch**, enables enumeration, addition, deletion, and case-sensitive calling of members.</span></span>|  
|<span data-ttu-id="f3ccf-156">**IEnumVARIANT**</span><span class="sxs-lookup"><span data-stu-id="f3ccf-156">**IEnumVARIANT**</span></span>|<span data-ttu-id="f3ccf-157">Umožňuje typy modelu COM, které podporují výčty jsou považovány za kolekce.</span><span class="sxs-lookup"><span data-stu-id="f3ccf-157">Enables COM types that support enumerations to be treated as collections.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="f3ccf-158">Viz také</span><span class="sxs-lookup"><span data-stu-id="f3ccf-158">See Also</span></span>  
 [<span data-ttu-id="f3ccf-159">COM – obálky</span><span class="sxs-lookup"><span data-stu-id="f3ccf-159">COM Wrappers</span></span>](com-wrappers.md)  
 <span data-ttu-id="f3ccf-160">[Zařazování vybrané rozhraní](https://msdn.microsoft.com/library/fdb97fd0-f694-4832-bf15-a4e7cf413840(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="f3ccf-160">[Marshaling Selected Interfaces](https://msdn.microsoft.com/library/fdb97fd0-f694-4832-bf15-a4e7cf413840(v=vs.100))</span></span>  
 [<span data-ttu-id="f3ccf-161">Obálka volatelná aplikacemi COM</span><span class="sxs-lookup"><span data-stu-id="f3ccf-161">COM Callable Wrapper</span></span>](com-callable-wrapper.md)  
 <span data-ttu-id="f3ccf-162">[Knihovny typů pro souhrn konverze sestavení](https://msdn.microsoft.com/library/bf3f90c5-4770-4ab8-895c-3ba1055cc958(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="f3ccf-162">[Type Library to Assembly Conversion Summary](https://msdn.microsoft.com/library/bf3f90c5-4770-4ab8-895c-3ba1055cc958(v=vs.100))</span></span>  
 [<span data-ttu-id="f3ccf-163">Import knihovny typů ve formě sestavení</span><span class="sxs-lookup"><span data-stu-id="f3ccf-163">Importing a Type Library as an Assembly</span></span>](importing-a-type-library-as-an-assembly.md)
