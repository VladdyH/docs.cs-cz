---
title: Distribuované transakce
ms.date: 03/30/2017
ms.assetid: 718b257c-bcb2-408e-b004-a7b0adb1c176
ms.openlocfilehash: 7792a719a73ca5183d57bcecc5d346153d824570
ms.sourcegitcommit: 11f11ca6cefe555972b3a5c99729d1a7523d8f50
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 05/03/2018
---
# <a name="distributed-transactions"></a><span data-ttu-id="b9ac4-102">Distribuované transakce</span><span class="sxs-lookup"><span data-stu-id="b9ac4-102">Distributed Transactions</span></span>
<span data-ttu-id="b9ac4-103">Transakce je sada souvisejících úloh, které buď (Potvrdit) úspěšná nebo neúspěšná (přerušení) jako jednotku, mimo jiné.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-103">A transaction is a set of related tasks that either succeeds (commit) or fails (abort) as a unit, among other things.</span></span> <span data-ttu-id="b9ac4-104">A *distribuované transakce* je transakci, která ovlivňuje několik prostředků.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-104">A *distributed transaction* is a transaction that affects several resources.</span></span> <span data-ttu-id="b9ac4-105">Pro distribuované transakce potvrzení musí všechny účastníky zaručit, že všechny změny dat bude trvalé.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-105">For a distributed transaction to commit, all participants must guarantee that any change to data will be permanent.</span></span> <span data-ttu-id="b9ac4-106">Změny musíte zachovat navzdory zhroucení systému nebo jiné nepředvídatelné události.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-106">Changes must persist despite system crashes or other unforeseen events.</span></span> <span data-ttu-id="b9ac4-107">Pokud jeden účastník neprovede tento záruka, selže celá transakce a všechny změny dat v rámci oboru transakce jsou vráceny zpět.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-107">If even a single participant fails to make this guarantee, the entire transaction fails, and any changes to data within the scope of the transaction are rolled back.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="b9ac4-108">Bude vyvolána výjimka, pokud se pokusíte potvrzení nebo vrácení transakce, pokud `DataReader` je zahájen, když je aktivní transakce.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-108">An exception will be thrown if you attempt to commit or roll back a transaction if a `DataReader` is started while the transaction is active.</span></span>  
  
## <a name="working-with-systemtransactions"></a><span data-ttu-id="b9ac4-109">Práce s System.Transactions –</span><span class="sxs-lookup"><span data-stu-id="b9ac4-109">Working with System.Transactions</span></span>  
 <span data-ttu-id="b9ac4-110">V rozhraní .NET Framework, distribuované transakce se spravují přes rozhraní API v <xref:System.Transactions> oboru názvů.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-110">In the .NET Framework, distributed transactions are managed through the API in the <xref:System.Transactions> namespace.</span></span> <span data-ttu-id="b9ac4-111"><xref:System.Transactions> Rozhraní API budou delegovat to zpracování monitorování transakce, jako je například Microsoft Distributed Transaction Coordinator (MS DTC) při více správců prostředků trvalé se účastní distribuované transakce.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-111">The <xref:System.Transactions> API will delegate distributed transaction handling to a transaction monitor such as the Microsoft Distributed Transaction Coordinator (MS DTC) when multiple persistent resource managers are involved.</span></span> <span data-ttu-id="b9ac4-112">Další informace najdete v tématu [transakce Základy](../../../../docs/framework/data/transactions/transaction-fundamentals.md).</span><span class="sxs-lookup"><span data-stu-id="b9ac4-112">For more information, see [Transaction Fundamentals](../../../../docs/framework/data/transactions/transaction-fundamentals.md).</span></span>  
  
 <span data-ttu-id="b9ac4-113">ADO.NET 2.0 zavedly podporu pro zapsání v distribuované transakce pomocí `EnlistTransaction` metodu, která využívá připojení v <xref:System.Transactions.Transaction> instance.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-113">ADO.NET 2.0 introduced support for enlisting in a distributed transaction using the `EnlistTransaction` method, which enlists a connection in a <xref:System.Transactions.Transaction> instance.</span></span> <span data-ttu-id="b9ac4-114">V předchozích verzích technologie ADO.NET, se provádí pomocí explicitní zařazení v distribuovaných transakcích `EnlistDistributedTransaction` metoda připojení k zařazení připojení v <xref:System.EnterpriseServices.ITransaction> instanci, která je podporována pro zpětné kompatibility.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-114">In previous versions of ADO.NET, explicit enlistment in distributed transactions was performed using the `EnlistDistributedTransaction` method of a connection to enlist a connection in a <xref:System.EnterpriseServices.ITransaction> instance, which is supported for backwards compatibility.</span></span> <span data-ttu-id="b9ac4-115">Další informace o transakcích podnikové služby, najdete v části [vzájemná funkční spolupráce s Enterprise služeb a transakcí modelu COM +](../../../../docs/framework/data/transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span><span class="sxs-lookup"><span data-stu-id="b9ac4-115">For more information on Enterprise Services transactions, see [Interoperability with Enterprise Services and COM+ Transactions](../../../../docs/framework/data/transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span></span>  
  
 <span data-ttu-id="b9ac4-116">Při použití <xref:System.Transactions> transakce s zprostředkovatel rozhraní .NET Framework pro SQL Server na databázi systému SQL Server, lehké <xref:System.Transactions.Transaction> se automaticky použije.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-116">When using a <xref:System.Transactions> transaction with the .NET Framework Provider for SQL Server against a SQL Server database, a lightweight <xref:System.Transactions.Transaction> will automatically be used.</span></span> <span data-ttu-id="b9ac4-117">Transakce lze pak převést na úplné distribuovanou transakci na podle potřeby.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-117">The transaction can then be promoted to a full distributed transaction on an as-needed basis.</span></span> <span data-ttu-id="b9ac4-118">Další informace najdete v tématu [System.Transactions – integrace s SQL serverem](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="b9ac4-118">For more information, see [System.Transactions Integration with SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="b9ac4-119">Maximální počet distribuovaných transakcí, které můžete najednou součástí databáze Oracle je ve výchozím nastavení do 10.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-119">The maximum number of distributed transactions that an Oracle database can participate in at one time is set to 10 by default.</span></span> <span data-ttu-id="b9ac4-120">Po 10 transakce je při připojení k databázi Oracle vyvolána výjimka.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-120">After the 10th transaction when connected to an Oracle database, an exception is thrown.</span></span> <span data-ttu-id="b9ac4-121">Oracle nepodporuje `DDL` uvnitř distribuované transakce.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-121">Oracle does not support `DDL` inside of a distributed transaction.</span></span>  
  
## <a name="automatically-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="b9ac4-122">Automaticky zapsání v distribuované transakce</span><span class="sxs-lookup"><span data-stu-id="b9ac4-122">Automatically Enlisting in a Distributed Transaction</span></span>  
 <span data-ttu-id="b9ac4-123">Automatické zařazení je výchozí (a upřednostňovaný) způsob integrace ADO.NET – připojení s `System.Transactions`.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-123">Automatic enlistment is the default (and preferred) way of integrating ADO.NET connections with `System.Transactions`.</span></span> <span data-ttu-id="b9ac4-124">Objekt připojení bude automaticky uvést v existující distribuované transakce, pokud zjistí, že transakce je aktivní, který v `System.Transaction` podmínky, znamená, že `Transaction.Current` není null.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-124">A connection object will automatically enlist in an existing distributed transaction if it determines that a transaction is active, which, in `System.Transaction` terms, means that `Transaction.Current` is not null.</span></span> <span data-ttu-id="b9ac4-125">Automatický zápis do transakce nastane, když je otevřen připojení.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-125">Automatic transaction enlistment occurs when the connection is opened.</span></span> <span data-ttu-id="b9ac4-126">Nebude dojít po, i když se příkaz spustí v oboru transakce.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-126">It will not happen after that even if a command is executed inside of a transaction scope.</span></span> <span data-ttu-id="b9ac4-127">Můžete zakázat automatické zařazení ve stávajících transakcí zadáním `Enlist=false` jako parametr s řetězcem připojení pro <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType>, nebo `OLE DB Services=-7` jako parametr s řetězcem připojení pro <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-127">You can disable auto-enlistment in existing transactions by specifying `Enlist=false` as a connection string parameter for a <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType>, or `OLE DB Services=-7` as a connection string parameter for an <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="b9ac4-128">Další informace o parametrech řetězec připojení Oracle a rozhraní ODBC najdete v tématu <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> a <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-128">For more information on Oracle and ODBC connection string parameters, see <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> and <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span>  
  
## <a name="manually-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="b9ac4-129">Ručně zapsání v distribuované transakce</span><span class="sxs-lookup"><span data-stu-id="b9ac4-129">Manually Enlisting in a Distributed Transaction</span></span>  
 <span data-ttu-id="b9ac4-130">Pokud je zakázáno automatické zařazení nebo potřebujete zařazení transakci, která byla spuštěna po otevření připojení, můžete zařazení existující distribuovanou transakci pomocí `EnlistTransaction` metodu <xref:System.Data.Common.DbConnection> objekt pro poskytovatele práci s.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-130">If auto-enlistment is disabled or you need to enlist a transaction that was started after the connection was opened, you can enlist in an existing distributed transaction using the `EnlistTransaction` method of the <xref:System.Data.Common.DbConnection> object for the provider you are working with.</span></span> <span data-ttu-id="b9ac4-131">Uvedení v existující distribuované transakce zajistí, že pokud je transakce potvrzena nebo vrácena zpět, změny provedené kód ve zdroji dat bude možné potvrzena nebo vrácena zpět také.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-131">Enlisting in an existing distributed transaction ensures that, if the transaction is committed or rolled back, modifications made by the code at the data source will be committed or rolled back as well.</span></span>  
  
 <span data-ttu-id="b9ac4-132">Uvedení v distribuovaných transakcích je zvláště použít, když sdružování obchodní objekty.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-132">Enlisting in distributed transactions is particularly applicable when pooling business objects.</span></span> <span data-ttu-id="b9ac4-133">Pokud obchodní objekt je ve fondu s otevřené připojení, automatické transakce zařazení dochází pouze po otevření připojení.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-133">If a business object is pooled with an open connection, automatic transaction enlistment only occurs when that connection is opened.</span></span> <span data-ttu-id="b9ac4-134">Pokud více transakcí se provádí pomocí objektu ve fondu firmy, otevřete připojení pro tento objekt nebude automaticky zapsat do nově initiated transakcí.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-134">If multiple transactions are performed using the pooled business object, the open connection for that object will not automatically enlist in newly initiated transactions.</span></span> <span data-ttu-id="b9ac4-135">V takovém případě můžete zakázat automatické transakce zařazení pro připojení a zařazení připojení v transakcích pomocí `EnlistTransaction`.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-135">In this case, you can disable automatic transaction enlistment for the connection and enlist the connection in transactions using `EnlistTransaction`.</span></span>  
  
 <span data-ttu-id="b9ac4-136">`EnlistTransaction` použije jeden argument typu <xref:System.Transactions.Transaction> tedy odkaz na stávající transakce.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-136">`EnlistTransaction` takes a single argument of type <xref:System.Transactions.Transaction> that is a reference to the existing transaction.</span></span> <span data-ttu-id="b9ac4-137">Po volání metody připojení `EnlistTransaction` metoda, všechny změny provedené v zdroje dat pomocí připojení jsou zahrnuty v transakci.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-137">After calling the connection's `EnlistTransaction` method, all modifications made at the data source using the connection are included in the transaction.</span></span> <span data-ttu-id="b9ac4-138">Předání hodnotou null unenlists připojení z jeho aktuálního zařazení distribuované transakce.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-138">Passing a null value unenlists the connection from its current distributed transaction enlistment.</span></span> <span data-ttu-id="b9ac4-139">Všimněte si, že musí být připojení otevřeno před voláním `EnlistTransaction`.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-139">Note that the connection must be opened before calling `EnlistTransaction`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="b9ac4-140">Po připojení je explicitně zařazeny do transakce, nemůže být zrušení zařazené nebo zařazené v jiné transakci, dokud nebude dokončeno první transakce.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-140">Once a connection is explicitly enlisted on a transaction, it cannot be un-enlisted or enlisted in another transaction until the first transaction finishes.</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="b9ac4-141">`EnlistTransaction` vyvolá výjimku, pokud připojení již zahájila transakci pomocí připojení <xref:System.Data.Common.DbConnection.BeginTransaction%2A> metoda.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-141">`EnlistTransaction` throws an exception if the connection has already begun a transaction using the connection's <xref:System.Data.Common.DbConnection.BeginTransaction%2A> method.</span></span> <span data-ttu-id="b9ac4-142">Ale pokud transakce je místní transakce spuštěna ve zdroji dat (například provádění příkazu BEGIN TRANSACTION explicitně pomocí <xref:System.Data.SqlClient.SqlCommand>), `EnlistTransaction` bude místní transakci vrátit zpět a uvést v existující distribuované transakce podle požadavku.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-142">However, if the transaction is a local transaction started at the data source (for example, executing the BEGIN TRANSACTION statement explicitly using a <xref:System.Data.SqlClient.SqlCommand>), `EnlistTransaction` will roll back the local transaction and enlist in the existing distributed transaction as requested.</span></span> <span data-ttu-id="b9ac4-143">Neobdrží Všimněte si, že místní transakce byla vrácena zpět a musí spravovat jakékoli místní transakce nebyla spuštěna pomocí <xref:System.Data.Common.DbConnection.BeginTransaction%2A>.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-143">You will not receive notice that the local transaction was rolled back, and must manage any local transactions not started using <xref:System.Data.Common.DbConnection.BeginTransaction%2A>.</span></span> <span data-ttu-id="b9ac4-144">Pokud používáte zprostředkovatele dat .NET Framework pro SQL Server (`SqlClient`) se systémem SQL Server, pokus o zařazení vyvolá výjimku.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-144">If you are using the .NET Framework Data Provider for SQL Server (`SqlClient`) with SQL Server, an attempt to enlist will throw an exception.</span></span> <span data-ttu-id="b9ac4-145">Všech ostatních případech pokračovat nezjištěné.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-145">All other cases will go undetected.</span></span>  
  
## <a name="promotable-transactions-in-sql-server"></a><span data-ttu-id="b9ac4-146">Možné zvýšit transakcí v systému SQL Server</span><span class="sxs-lookup"><span data-stu-id="b9ac4-146">Promotable Transactions in SQL Server</span></span>  
 <span data-ttu-id="b9ac4-147">Systém SQL Server podporuje možné zvýšit transakce, ve kterých místní transakce lightweight můžete bude automaticky povýšen na distribuovanou transakci pouze v případě potřeby.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-147">SQL Server supports promotable transactions in which a local lightweight transaction can be automatically promoted to a distributed transaction only if it is required.</span></span> <span data-ttu-id="b9ac4-148">Možné zvýšit transakce nevyvolá přidaném starat se o distribuované transakce Pokud přidaném režie není nutné.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-148">A promotable transaction does not invoke the added overhead of a distributed transaction unless the added overhead is required.</span></span> <span data-ttu-id="b9ac4-149">Další informace a ukázku kódu najdete v tématu [System.Transactions – integrace s SQL serverem](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="b9ac4-149">For more information and a code sample, see [System.Transactions Integration with SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span></span>  
  
## <a name="configuring-distributed-transactions"></a><span data-ttu-id="b9ac4-150">Konfiguraci distribuovaných transakcí</span><span class="sxs-lookup"><span data-stu-id="b9ac4-150">Configuring Distributed Transactions</span></span>  
 <span data-ttu-id="b9ac4-151">Musíte povolit MS DTC přes síť, aby bylo možné používat distribuované transakce.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-151">You may need to enable the MS DTC over the network in order to use distributed transactions.</span></span> <span data-ttu-id="b9ac4-152">Pokud máte Windows povolena brána Firewall, musíte povolit službu MS DTC se použití sítě nebo otevřít port MS DTC.</span><span class="sxs-lookup"><span data-stu-id="b9ac4-152">If have the Windows Firewall enabled, you must allow the MS DTC service to use the network or open the MS DTC port.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b9ac4-153">Viz také</span><span class="sxs-lookup"><span data-stu-id="b9ac4-153">See Also</span></span>  
 [<span data-ttu-id="b9ac4-154">Transakce a souběžnost</span><span class="sxs-lookup"><span data-stu-id="b9ac4-154">Transactions and Concurrency</span></span>](../../../../docs/framework/data/adonet/transactions-and-concurrency.md)  
 [<span data-ttu-id="b9ac4-155">Integrace System.Transactions s SQL Serverem</span><span class="sxs-lookup"><span data-stu-id="b9ac4-155">System.Transactions Integration with SQL Server</span></span>](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md)  
 [<span data-ttu-id="b9ac4-156">ADO.NET spravované zprostředkovatelé a středisku pro vývojáře datové sady</span><span class="sxs-lookup"><span data-stu-id="b9ac4-156">ADO.NET Managed Providers and DataSet Developer Center</span></span>](http://go.microsoft.com/fwlink/?LinkId=217917)
