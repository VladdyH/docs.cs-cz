---
title: Připojení k serveru SQL sdružování (ADO.NET)
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dotnet-ado
ms.tgt_pltfrm: ''
ms.topic: article
dev_langs:
- csharp
- vb
ms.assetid: 7e51d44e-7c4e-4040-9332-f0190fe36f07
caps.latest.revision: 11
author: douglaslMS
ms.author: douglasl
manager: craigg
ms.workload:
- dotnet
ms.openlocfilehash: c0be63e767255508ac93555a503980f3798e70c0
ms.sourcegitcommit: 86adcc06e35390f13c1e372c36d2e044f1fc31ef
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/26/2018
---
# <a name="sql-server-connection-pooling-adonet"></a><span data-ttu-id="eea2f-102">Připojení k serveru SQL sdružování (ADO.NET)</span><span class="sxs-lookup"><span data-stu-id="eea2f-102">SQL Server Connection Pooling (ADO.NET)</span></span>
<span data-ttu-id="eea2f-103">Připojení k serveru databáze obvykle se skládá z několika kroků časově náročná.</span><span class="sxs-lookup"><span data-stu-id="eea2f-103">Connecting to a database server typically consists of several time-consuming steps.</span></span> <span data-ttu-id="eea2f-104">Fyzický kanál například soket nebo pojmenovaný kanál je třeba stanovit, musí dojít k počáteční metody handshake se serverem, informace o připojovacím řetězci musí být analyzovány, připojení musí být ověřeny serverem, musí být spuštěn kontroly pro zapsání v aktuální transakce a tak dále.</span><span class="sxs-lookup"><span data-stu-id="eea2f-104">A physical channel such as a socket or a named pipe must be established, the initial handshake with the server must occur, the connection string information must be parsed, the connection must be authenticated by the server, checks must be run for enlisting in the current transaction, and so on.</span></span>  
  
 <span data-ttu-id="eea2f-105">V praxi, většina aplikací použít pro připojení pouze jednu nebo několik různých konfigurací.</span><span class="sxs-lookup"><span data-stu-id="eea2f-105">In practice, most applications use only one or a few different configurations for connections.</span></span> <span data-ttu-id="eea2f-106">To znamená, že během provádění aplikací, mnoha identické připojení bude možné opakovaně otevřít a uzavřen.</span><span class="sxs-lookup"><span data-stu-id="eea2f-106">This means that during application execution, many identical connections will be repeatedly opened and closed.</span></span> <span data-ttu-id="eea2f-107">Chcete-li minimalizovat náklady na otevření připojení, [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)] používá volat metodu optimalizace *sdružování připojení*.</span><span class="sxs-lookup"><span data-stu-id="eea2f-107">To minimize the cost of opening connections, [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)] uses an optimization technique called *connection pooling*.</span></span>  
  
 <span data-ttu-id="eea2f-108">Sdružování připojení snižuje počet pokusů, které musí být otevřeno nové připojení.</span><span class="sxs-lookup"><span data-stu-id="eea2f-108">Connection pooling reduces the number of times that new connections must be opened.</span></span> <span data-ttu-id="eea2f-109">*Pro sdružování* udržuje vlastnictví fyzické připojení.</span><span class="sxs-lookup"><span data-stu-id="eea2f-109">The *pooler* maintains ownership of the physical connection.</span></span> <span data-ttu-id="eea2f-110">Spravuje připojení tak aktivní sadu aktivních připojení pro každou konfiguraci dané připojení.</span><span class="sxs-lookup"><span data-stu-id="eea2f-110">It manages connections by keeping alive a set of active connections for each given connection configuration.</span></span> <span data-ttu-id="eea2f-111">Vždy, když uživatel volá `Open` na připojení, pro sdružování hledá dostupné připojení ve fondu.</span><span class="sxs-lookup"><span data-stu-id="eea2f-111">Whenever a user calls `Open` on a connection, the pooler looks for an available connection in the pool.</span></span> <span data-ttu-id="eea2f-112">Pokud je dostupné ve fondu připojení, vrátí ji do volající místo otevřít nové připojení.</span><span class="sxs-lookup"><span data-stu-id="eea2f-112">If a pooled connection is available, it returns it to the caller instead of opening a new connection.</span></span> <span data-ttu-id="eea2f-113">Pokud aplikace zavolá `Close` na připojení, pro sdružování vrátí ji do sadu aktivních připojení místo zavřením ve fondu.</span><span class="sxs-lookup"><span data-stu-id="eea2f-113">When the application calls `Close` on the connection, the pooler returns it to the pooled set of active connections instead of closing it.</span></span> <span data-ttu-id="eea2f-114">Po připojení se vrátí do fondu, je připraven k znovu použít při dalším `Open` volání.</span><span class="sxs-lookup"><span data-stu-id="eea2f-114">Once the connection is returned to the pool, it is ready to be reused on the next `Open` call.</span></span>  
  
 <span data-ttu-id="eea2f-115">Pouze připojení se stejnou konfigurací, můžete ve fondu.</span><span class="sxs-lookup"><span data-stu-id="eea2f-115">Only connections with the same configuration can be pooled.</span></span> [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)]<span data-ttu-id="eea2f-116"> udržuje několik fondů ve stejnou dobu, jeden pro každou konfiguraci.</span><span class="sxs-lookup"><span data-stu-id="eea2f-116"> keeps several pools at the same time, one for each configuration.</span></span> <span data-ttu-id="eea2f-117">Připojení jsou rozdělené do fondů připojovací řetězec a identitu systému Windows při použití integrovaného zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="eea2f-117">Connections are separated into pools by connection string, and by Windows identity when integrated security is used.</span></span> <span data-ttu-id="eea2f-118">Připojení jsou také fondu založené na tom, jestli jsou zařazeny v transakci.</span><span class="sxs-lookup"><span data-stu-id="eea2f-118">Connections are also pooled based on whether they are enlisted in a transaction.</span></span> <span data-ttu-id="eea2f-119">Při použití <xref:System.Data.SqlClient.SqlConnection.ChangePassword%2A>, <xref:System.Data.SqlClient.SqlCredential> instance ovlivňuje fondu připojení.</span><span class="sxs-lookup"><span data-stu-id="eea2f-119">When using <xref:System.Data.SqlClient.SqlConnection.ChangePassword%2A>, the <xref:System.Data.SqlClient.SqlCredential> instance affects the connection pool.</span></span> <span data-ttu-id="eea2f-120">Různé instance <xref:System.Data.SqlClient.SqlCredential> použije jiným připojením fondy, i v případě, že ID uživatele a heslo jsou stejné.</span><span class="sxs-lookup"><span data-stu-id="eea2f-120">Different instances of <xref:System.Data.SqlClient.SqlCredential> will use different connection pools, even if the user ID and password are the same.</span></span>  
  
 <span data-ttu-id="eea2f-121">Sdružování připojení může výrazně zvýšit výkon a škálovatelnost vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="eea2f-121">Pooling connections can significantly enhance the performance and scalability of your application.</span></span> <span data-ttu-id="eea2f-122">Ve výchozím nastavení, je povoleno sdružování připojení v [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)].</span><span class="sxs-lookup"><span data-stu-id="eea2f-122">By default, connection pooling is enabled in [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)].</span></span> <span data-ttu-id="eea2f-123">Pokud zakážete explicitně ho, optimalizuje pro sdružování připojení, jak jsou otevřené a uzavřené ve vaší aplikaci.</span><span class="sxs-lookup"><span data-stu-id="eea2f-123">Unless you explicitly disable it, the pooler optimizes the connections as they are opened and closed in your application.</span></span> <span data-ttu-id="eea2f-124">Můžete také zadat několik modifikátory řetězec připojení můžete řídit chování sdružování připojení.</span><span class="sxs-lookup"><span data-stu-id="eea2f-124">You can also supply several connection string modifiers to control connection pooling behavior.</span></span> <span data-ttu-id="eea2f-125">Další informace najdete v tématu "Řízení připojení sdružování s připojovací řetězec klíčová slova" dál v tomto tématu.</span><span class="sxs-lookup"><span data-stu-id="eea2f-125">For more information, see "Controlling Connection Pooling with Connection String Keywords" later in this topic.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="eea2f-126">Pokud je povoleno sdružování připojení, a pokud dojde k vypršení časového limitu nebo jiné chybě přihlášení, bude vyvolána výjimka, a následující pokusy o připojení se nezdaří pro další pět sekund, "blokování období".</span><span class="sxs-lookup"><span data-stu-id="eea2f-126">When connection pooling is enabled, and if a timeout error or other login error occurs, an exception will be thrown and subsequent connection attempts will fail for the next five seconds, the "blocking period".</span></span> <span data-ttu-id="eea2f-127">Pokud aplikace se pokusí připojit v rámci blokování období, bude první výjimka vyvolána znovu.</span><span class="sxs-lookup"><span data-stu-id="eea2f-127">If the application attempts to connect within the blocking period, the first exception will be thrown again.</span></span> <span data-ttu-id="eea2f-128">Následné selhání po skončení blokování doby bude výsledkem nová blokování období, které je dvakrát stejně dlouho jako předchozí blokování období až do maximálního počtu jednu minutu.</span><span class="sxs-lookup"><span data-stu-id="eea2f-128">Subsequent failures after a blocking period ends will result in a new blocking periods that is twice as long as the previous blocking period, up to a maximum of one minute.</span></span>  
  
## <a name="pool-creation-and-assignment"></a><span data-ttu-id="eea2f-129">Vytvoření fondu a přiřazení</span><span class="sxs-lookup"><span data-stu-id="eea2f-129">Pool Creation and Assignment</span></span>  
 <span data-ttu-id="eea2f-130">Při prvním otevření připojení, je vytvořen fond připojení podle přesný odpovídající algoritmu, který přidruží fondu připojovací řetězec v připojení.</span><span class="sxs-lookup"><span data-stu-id="eea2f-130">When a connection is first opened, a connection pool is created based on an exact matching algorithm that associates the pool with the connection string in the connection.</span></span> <span data-ttu-id="eea2f-131">Každý fond připojení je přidružen odlišné připojovací řetězec.</span><span class="sxs-lookup"><span data-stu-id="eea2f-131">Each connection pool is associated with a distinct connection string.</span></span> <span data-ttu-id="eea2f-132">Když je otevřít nové připojení, pokud připojovací řetězec není přesnou shodu na existující fond, vytvoří se nový fond.</span><span class="sxs-lookup"><span data-stu-id="eea2f-132">When a new connection is opened, if the connection string is not an exact match to an existing pool, a new pool is created.</span></span> <span data-ttu-id="eea2f-133">Připojení jsou ve fondu podle procesu, podle aplikační domény, na připojovací řetězec a pokud se používá integrované zabezpečení za identitu systému Windows.</span><span class="sxs-lookup"><span data-stu-id="eea2f-133">Connections are pooled per process, per application domain, per connection string and when integrated security is used, per Windows identity.</span></span> <span data-ttu-id="eea2f-134">Připojovací řetězce musí být také přesnou shodu; klíčová slova zadaná v jiném pořadí pro stejné připojení bude samostatně ve fondu.</span><span class="sxs-lookup"><span data-stu-id="eea2f-134">Connection strings must also be an exact match; keywords supplied in a different order for the same connection will be pooled separately.</span></span>  
  
 <span data-ttu-id="eea2f-135">V následujícím C# příkladu tři nové <xref:System.Data.SqlClient.SqlConnection> objekty se vytvoří, ale pouze dva fondy připojení jsou nezbytné ke správě je.</span><span class="sxs-lookup"><span data-stu-id="eea2f-135">In the following C# example, three new <xref:System.Data.SqlClient.SqlConnection> objects are created, but only two connection pools are required to manage them.</span></span> <span data-ttu-id="eea2f-136">První a druhý připojovací řetězce lišit podle hodnoty přiřazené `Initial Catalog`.</span><span class="sxs-lookup"><span data-stu-id="eea2f-136">Note that the first and second connection strings differ by the value assigned for `Initial Catalog`.</span></span>  
  
```  
using (SqlConnection connection = new SqlConnection(  
  "Integrated Security=SSPI;Initial Catalog=Northwind"))  
    {  
        connection.Open();        
        // Pool A is created.  
    }  
  
using (SqlConnection connection = new SqlConnection(  
  "Integrated Security=SSPI;Initial Catalog=pubs"))  
    {  
        connection.Open();        
        // Pool B is created because the connection strings differ.  
    }  
  
using (SqlConnection connection = new SqlConnection(  
  "Integrated Security=SSPI;Initial Catalog=Northwind"))  
    {  
        connection.Open();        
        // The connection string matches pool A.  
    }  
```  
  
 <span data-ttu-id="eea2f-137">Pokud `MinPoolSize` v připojovacím řetězci není zadána nebo je zadán jako nula, připojení ve fondu budou uzavřeny po určité době nečinnosti.</span><span class="sxs-lookup"><span data-stu-id="eea2f-137">If `MinPoolSize` is either not specified in the connection string or is specified as zero, the connections in the pool will be closed after a period of inactivity.</span></span> <span data-ttu-id="eea2f-138">Ale pokud zadaný `MinPoolSize` je větší než nula, fondu připojení nebude odstraněn, až `AppDomain` je odpojen a ukončení procesu.</span><span class="sxs-lookup"><span data-stu-id="eea2f-138">However, if the specified `MinPoolSize` is greater than zero, the connection pool is not destroyed until the `AppDomain` is unloaded and the process ends.</span></span> <span data-ttu-id="eea2f-139">Údržby neaktivní nebo prázdný fondů zahrnuje režijní náklady na minimální systém.</span><span class="sxs-lookup"><span data-stu-id="eea2f-139">Maintenance of inactive or empty pools involves minimal system overhead.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="eea2f-140">Fondu je automaticky vymazán poté, co dojde k závažné chybě, jako je například převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="eea2f-140">The pool is automatically cleared when a fatal error occurs, such as a failover.</span></span>  
  
## <a name="adding-connections"></a><span data-ttu-id="eea2f-141">Přidání připojení</span><span class="sxs-lookup"><span data-stu-id="eea2f-141">Adding Connections</span></span>  
 <span data-ttu-id="eea2f-142">Fond připojení se vytvoří pro každý jedinečný připojovací řetězec.</span><span class="sxs-lookup"><span data-stu-id="eea2f-142">A connection pool is created for each unique connection string.</span></span> <span data-ttu-id="eea2f-143">Při vytváření fondu více objektů připojení jsou vytvořen a přidán do fondu, aby je nesplňuje požadavek na minimální fondu velikost.</span><span class="sxs-lookup"><span data-stu-id="eea2f-143">When a pool is created, multiple connection objects are created and added to the pool so that the minimum pool size requirement is satisfied.</span></span> <span data-ttu-id="eea2f-144">Připojení jsou přidány do fondu, podle potřeby až k maximální velikosti fondu zadána (výchozí hodnota je 100).</span><span class="sxs-lookup"><span data-stu-id="eea2f-144">Connections are added to the pool as needed, up to the maximum pool size specified (100 is the default).</span></span> <span data-ttu-id="eea2f-145">Připojení jsou vydávány zpět do fondu, když jsou uzavřeny nebo zlikvidován.</span><span class="sxs-lookup"><span data-stu-id="eea2f-145">Connections are released back into the pool when they are closed or disposed.</span></span>  
  
 <span data-ttu-id="eea2f-146">Když <xref:System.Data.SqlClient.SqlConnection> je požadován objekt, se získávají z fondu, pokud je k dispozici použitelné připojení.</span><span class="sxs-lookup"><span data-stu-id="eea2f-146">When a <xref:System.Data.SqlClient.SqlConnection> object is requested, it is obtained from the pool if a usable connection is available.</span></span> <span data-ttu-id="eea2f-147">Být použitelná, připojení musí nepoužívané, mají odpovídající kontext transakce nebo nepřidružený s jakýkoliv obsah transakcí a mít platný odkaz na serveru.</span><span class="sxs-lookup"><span data-stu-id="eea2f-147">To be usable, a connection must be unused, have a matching transaction context or be unassociated with any transaction context, and have a valid link to the server.</span></span>  
  
 <span data-ttu-id="eea2f-148">Pro sdružování připojení splňuje požadavky na připojení pomocí změna přidělování připojení při jejich vydání zpět do fondu.</span><span class="sxs-lookup"><span data-stu-id="eea2f-148">The connection pooler satisfies requests for connections by reallocating connections as they are released back into the pool.</span></span> <span data-ttu-id="eea2f-149">Pokud byl dosažen maximální počet a není k dispozici žádné použitelné připojení, požadavek ve frontě.</span><span class="sxs-lookup"><span data-stu-id="eea2f-149">If the maximum pool size has been reached and no usable connection is available, the request is queued.</span></span> <span data-ttu-id="eea2f-150">Pro sdružování se potom pokusí získat všechna připojení, dokud nebude dosaženo časového limitu (výchozí hodnota je 15 sekund).</span><span class="sxs-lookup"><span data-stu-id="eea2f-150">The pooler then tries to reclaim any connections until the time-out is reached (the default is 15 seconds).</span></span> <span data-ttu-id="eea2f-151">Pokud pro sdružování nemůže splnit požadavek, než vyprší časový limit připojení, je vyvolána výjimka.</span><span class="sxs-lookup"><span data-stu-id="eea2f-151">If the pooler cannot satisfy the request before the connection times out, an exception is thrown.</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="eea2f-152">Důrazně doporučujeme po dokončení pomocí ho, aby připojení bude vrácen do fondu vždy ukončení připojení.</span><span class="sxs-lookup"><span data-stu-id="eea2f-152">We strongly recommend that you always close the connection when you are finished using it so that the connection will be returned to the pool.</span></span> <span data-ttu-id="eea2f-153">Můžete provést pomocí `Close` nebo `Dispose` metody `Connection` objektu, nebo pomocí otevírání všechna připojení uvnitř `using` příkaz v C#, nebo `Using` příkaz v jazyce Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="eea2f-153">You can do this using either the `Close` or `Dispose` methods of the `Connection` object, or by opening all connections inside a `using` statement in C#, or a `Using` statement in Visual Basic.</span></span> <span data-ttu-id="eea2f-154">Připojení, které nejsou výslovně nemusí přidat nebo vrátí do fondu.</span><span class="sxs-lookup"><span data-stu-id="eea2f-154">Connections that are not explicitly closed might not be added or returned to the pool.</span></span> <span data-ttu-id="eea2f-155">Další informace najdete v tématu [pomocí příkazu](~/docs/csharp/language-reference/keywords/using-statement.md) nebo [postupy: odstranění systémového prostředku](~/docs/visual-basic/programming-guide/language-features/control-flow/how-to-dispose-of-a-system-resource.md) jazyka Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="eea2f-155">For more information, see [using Statement](~/docs/csharp/language-reference/keywords/using-statement.md) or [How to: Dispose of a System Resource](~/docs/visual-basic/programming-guide/language-features/control-flow/how-to-dispose-of-a-system-resource.md) for Visual Basic.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="eea2f-156">Nevolejte `Close` nebo `Dispose` na `Connection`, `DataReader`, nebo jiné spravovaného objektu v `Finalize` metoda vaší třídy.</span><span class="sxs-lookup"><span data-stu-id="eea2f-156">Do not call `Close` or `Dispose` on a `Connection`, a `DataReader`, or any other managed object in the `Finalize` method of your class.</span></span> <span data-ttu-id="eea2f-157">V finalizační metodu vydání pouze nespravovaných prostředků, které vlastní třídu přímo.</span><span class="sxs-lookup"><span data-stu-id="eea2f-157">In a finalizer, only release unmanaged resources that your class owns directly.</span></span> <span data-ttu-id="eea2f-158">Pokud vaše třída nevlastní žádné nespravovaných prostředků, nezahrnujte `Finalize` metoda v definici vaší třídy.</span><span class="sxs-lookup"><span data-stu-id="eea2f-158">If your class does not own any unmanaged resources, do not include a `Finalize` method in your class definition.</span></span> <span data-ttu-id="eea2f-159">Další informace najdete v tématu [uvolňování paměti](../../../../docs/standard/garbage-collection/index.md).</span><span class="sxs-lookup"><span data-stu-id="eea2f-159">For more information, see [Garbage Collection](../../../../docs/standard/garbage-collection/index.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="eea2f-160">Události přihlášení a odhlášení nebudou vyvolávat na serveru, pokud připojení je načtena z nebo vrátí do fondu připojení.</span><span class="sxs-lookup"><span data-stu-id="eea2f-160">Login and logout events will not be raised on the server when a connection is fetched from or returned to the connection pool.</span></span> <span data-ttu-id="eea2f-161">Toto je, protože připojení není uzavřený ve skutečnosti, pokud se vrátí do fondu připojení.</span><span class="sxs-lookup"><span data-stu-id="eea2f-161">This is because the connection is not actually closed when it is returned to the connection pool.</span></span> <span data-ttu-id="eea2f-162">Další informace najdete v tématu [třídy událostí auditu přihlášení](http://msdn2.microsoft.com/library/ms190260.aspx) a [třídy událostí auditu odhlášení](http://msdn2.microsoft.com/library/ms175827.aspx) v SQL Server Books Online.</span><span class="sxs-lookup"><span data-stu-id="eea2f-162">For more information, see [Audit Login Event Class](http://msdn2.microsoft.com/library/ms190260.aspx) and [Audit Logout Event Class](http://msdn2.microsoft.com/library/ms175827.aspx) in SQL Server Books Online.</span></span>  
  
## <a name="removing-connections"></a><span data-ttu-id="eea2f-163">Odebrání připojení</span><span class="sxs-lookup"><span data-stu-id="eea2f-163">Removing Connections</span></span>  
 <span data-ttu-id="eea2f-164">Poté, co se má přibližně 4-8 minutách nečinnosti nebo pokud pro sdružování zjistí, že má bylo porušeno připojení se serverem pro sdružování připojení Odebere připojení z fondu.</span><span class="sxs-lookup"><span data-stu-id="eea2f-164">The connection pooler removes a connection from the pool after it has been idle for approximately 4-8 minutes, or if the pooler detects that the connection with the server has been severed.</span></span> <span data-ttu-id="eea2f-165">Všimněte si, že bude možné zjišťovat poškozený připojení až po pokusu o komunikaci se serverem.</span><span class="sxs-lookup"><span data-stu-id="eea2f-165">Note that a severed connection can be detected only after attempting to communicate with the server.</span></span> <span data-ttu-id="eea2f-166">Pokud se najde připojení, který je už připojený k serveru, je označena jako neplatná.</span><span class="sxs-lookup"><span data-stu-id="eea2f-166">If a connection is found that is no longer connected to the server, it is marked as invalid.</span></span> <span data-ttu-id="eea2f-167">Neplatný připojení jsou vyřazeny z fondu připojení jenom v případě, že jsou uzavřeny nebo uvolnit.</span><span class="sxs-lookup"><span data-stu-id="eea2f-167">Invalid connections are removed from the connection pool only when they are closed or reclaimed.</span></span>  
  
 <span data-ttu-id="eea2f-168">Pokud existuje připojení k serveru, který má smazán, můžete toto připojení čerpají z fondu i v případě, že nebyl zjištěn poškozený připojení a označena jako neplatná pro sdružování připojení.</span><span class="sxs-lookup"><span data-stu-id="eea2f-168">If a connection exists to a server that has disappeared, this connection can be drawn from the pool even if the connection pooler has not detected the severed connection and marked it as invalid.</span></span> <span data-ttu-id="eea2f-169">Je to tento případ, proto režii kontroluje, že připojení je stále platný by eliminovat o výhodách pro sdružování tím, že na jinou dobu odezvy na serveru, dochází.</span><span class="sxs-lookup"><span data-stu-id="eea2f-169">This is the case because the overhead of checking that the connection is still valid would eliminate the benefits of having a pooler by causing another round trip to the server to occur.</span></span> <span data-ttu-id="eea2f-170">V takovém případě první pokus o připojení k zjistí, že připojení bylo porušeno. a je vyvolána výjimka.</span><span class="sxs-lookup"><span data-stu-id="eea2f-170">When this occurs, the first attempt to use the connection will detect that the connection has been severed, and an exception is thrown.</span></span>  
  
## <a name="clearing-the-pool"></a><span data-ttu-id="eea2f-171">Vymazání fondu</span><span class="sxs-lookup"><span data-stu-id="eea2f-171">Clearing the Pool</span></span>  
 [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)]<span data-ttu-id="eea2f-172"> 2.0 zavedená dva nové metody pro vymazávání fondu: <xref:System.Data.SqlClient.SqlConnection.ClearAllPools%2A> a <xref:System.Data.SqlClient.SqlConnection.ClearPool%2A>.</span><span class="sxs-lookup"><span data-stu-id="eea2f-172"> 2.0 introduced two new methods to clear the pool: <xref:System.Data.SqlClient.SqlConnection.ClearAllPools%2A> and <xref:System.Data.SqlClient.SqlConnection.ClearPool%2A>.</span></span> <span data-ttu-id="eea2f-173">`ClearAllPools` Vymaže fondy připojení pro daného zprostředkovatele, a `ClearPool` vymaže fondu připojení, která souvisí s konkrétním připojení.</span><span class="sxs-lookup"><span data-stu-id="eea2f-173">`ClearAllPools` clears the connection pools for a given provider, and `ClearPool` clears the connection pool that is associated with a specific connection.</span></span> <span data-ttu-id="eea2f-174">Pokud je připojení používá při volání, jsou označena odpovídajícím způsobem.</span><span class="sxs-lookup"><span data-stu-id="eea2f-174">If there are connections being used at the time of the call, they are marked appropriately.</span></span> <span data-ttu-id="eea2f-175">Když jsou uzavřeny, jsou zahozeny místo nevrátila do fondu.</span><span class="sxs-lookup"><span data-stu-id="eea2f-175">When they are closed, they are discarded instead of being returned to the pool.</span></span>  
  
## <a name="transaction-support"></a><span data-ttu-id="eea2f-176">Podpora transakcí</span><span class="sxs-lookup"><span data-stu-id="eea2f-176">Transaction Support</span></span>  
 <span data-ttu-id="eea2f-177">Připojení jsou vykreslovány z fondu a kontext přiřazené na základě transakce.</span><span class="sxs-lookup"><span data-stu-id="eea2f-177">Connections are drawn from the pool and assigned based on transaction context.</span></span> <span data-ttu-id="eea2f-178">Pokud `Enlist=false` je zadaný v připojovacím řetězci, fondu připojení je zajištěno, že toto připojení je uvedené v <xref:System.Transactions.Transaction.Current%2A> kontextu.</span><span class="sxs-lookup"><span data-stu-id="eea2f-178">Unless `Enlist=false` is specified in the connection string, the connection pool makes sure that the connection is enlisted in the <xref:System.Transactions.Transaction.Current%2A> context.</span></span> <span data-ttu-id="eea2f-179">Když je připojení ukončeno a vrátí do fondu s zařazené `System.Transactions` transakce, ho je vyčleněné tak, že další žádost o tomto fondu připojení se stejným `System.Transactions` transakce se vrátí stejné připojení, pokud je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="eea2f-179">When a connection is closed and returned to the pool with an enlisted `System.Transactions` transaction, it is set aside in such a way that the next request for that connection pool with the same `System.Transactions` transaction will return the same connection if it is available.</span></span> <span data-ttu-id="eea2f-180">Pokud se objeví žádost a nejsou k dispozici žádná ve fondu připojení, je připojení čerpají z beztransakční součástí fondu a zařazen.</span><span class="sxs-lookup"><span data-stu-id="eea2f-180">If such a request is issued, and there are no pooled connections available, a connection is drawn from the non-transacted part of the pool and enlisted.</span></span> <span data-ttu-id="eea2f-181">Pokud žádná připojení jsou k dispozici v oblasti buď fondu, nové připojení se vytvoří a zařazen.</span><span class="sxs-lookup"><span data-stu-id="eea2f-181">If no connections are available in either area of the pool, a new connection is created and enlisted.</span></span>  
  
 <span data-ttu-id="eea2f-182">Když je připojení ukončeno, jeho vydání zpět do fondu a do příslušné pododdíl na základě jeho kontextu transakce.</span><span class="sxs-lookup"><span data-stu-id="eea2f-182">When a connection is closed, it is released back into the pool and into the appropriate subdivision based on its transaction context.</span></span> <span data-ttu-id="eea2f-183">Proto můžete zavřít připojení bez generování chybu, i když je stále distribuovanou transakci čekající na vyřízení.</span><span class="sxs-lookup"><span data-stu-id="eea2f-183">Therefore, you can close the connection without generating an error, even though a distributed transaction is still pending.</span></span> <span data-ttu-id="eea2f-184">To umožňuje potvrzení nebo přerušení později distribuované transakce.</span><span class="sxs-lookup"><span data-stu-id="eea2f-184">This allows you to commit or abort the distributed transaction later.</span></span>  
  
## <a name="controlling-connection-pooling-with-connection-string-keywords"></a><span data-ttu-id="eea2f-185">Řízení sdružování připojení s klíčovými slovy řetězec připojení</span><span class="sxs-lookup"><span data-stu-id="eea2f-185">Controlling Connection Pooling with Connection String Keywords</span></span>  
 <span data-ttu-id="eea2f-186">`ConnectionString` Vlastnost <xref:System.Data.SqlClient.SqlConnection> objekt podporuje dvojice klíč/hodnota řetězce připojení, které lze použít k úpravě chování logiky sdružování připojení.</span><span class="sxs-lookup"><span data-stu-id="eea2f-186">The `ConnectionString` property of the <xref:System.Data.SqlClient.SqlConnection> object supports connection string key/value pairs that can be used to adjust the behavior of the connection pooling logic.</span></span> <span data-ttu-id="eea2f-187">Další informace naleznete v tématu <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span><span class="sxs-lookup"><span data-stu-id="eea2f-187">For more information, see <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span></span>  
  
## <a name="pool-fragmentation"></a><span data-ttu-id="eea2f-188">Fragmentace fondu</span><span class="sxs-lookup"><span data-stu-id="eea2f-188">Pool Fragmentation</span></span>  
 <span data-ttu-id="eea2f-189">Fragmentace fondu je častých problémů v mnoha webových aplikací, kde aplikace může vytvářet velký počet fondy, které nejsou vydání, dokud proces bude ukončen.</span><span class="sxs-lookup"><span data-stu-id="eea2f-189">Pool fragmentation is a common problem in many Web applications where the application can create a large number of pools that are not freed until the process exits.</span></span> <span data-ttu-id="eea2f-190">Velký počet připojení zůstane otevřené a využívání paměti, což vede k nižšímu výkonu.</span><span class="sxs-lookup"><span data-stu-id="eea2f-190">This leaves a large number of connections open and consuming memory, which results in poor performance.</span></span>  
  
### <a name="pool-fragmentation-due-to-integrated-security"></a><span data-ttu-id="eea2f-191">Fragmentace fondu z důvodu integrované zabezpečení</span><span class="sxs-lookup"><span data-stu-id="eea2f-191">Pool Fragmentation Due to Integrated Security</span></span>  
 <span data-ttu-id="eea2f-192">Připojení jsou ve fondu podle připojovací řetězec a identity uživatele.</span><span class="sxs-lookup"><span data-stu-id="eea2f-192">Connections are pooled according to the connection string plus the user identity.</span></span> <span data-ttu-id="eea2f-193">Pokud používáte základní ověřování nebo ověřování systému Windows na webu a přihlášení k integrovanému zabezpečení, tedy získáte jeden fond na uživatele.</span><span class="sxs-lookup"><span data-stu-id="eea2f-193">Therefore, if you use Basic authentication or Windows Authentication on the Web site and an integrated security login, you get one pool per user.</span></span> <span data-ttu-id="eea2f-194">I když to zlepšuje výkon při následné databáze požadavků pro jednoho uživatele, tento uživatel nemůže využít výhod připojení vytvořená jinými uživateli.</span><span class="sxs-lookup"><span data-stu-id="eea2f-194">Although this improves the performance of subsequent database requests for a single user, that user cannot take advantage of connections made by other users.</span></span> <span data-ttu-id="eea2f-195">Výsledkem je také alespoň jedno připojení na uživatele k databázovému serveru.</span><span class="sxs-lookup"><span data-stu-id="eea2f-195">It also results in at least one connection per user to the database server.</span></span> <span data-ttu-id="eea2f-196">Toto je vedlejším účinkem konkrétní architektura webové aplikace, které vývojáři musí naváží proti auditování požadavky na zabezpečení a.</span><span class="sxs-lookup"><span data-stu-id="eea2f-196">This is a side effect of a particular Web application architecture that developers must weigh against security and auditing requirements.</span></span>  
  
### <a name="pool-fragmentation-due-to-many-databases"></a><span data-ttu-id="eea2f-197">Fragmentace fondu z důvodu mnoha databázemi</span><span class="sxs-lookup"><span data-stu-id="eea2f-197">Pool Fragmentation Due to Many Databases</span></span>  
 <span data-ttu-id="eea2f-198">Mnoho poskytovatelům internetových služeb hostovat několik webových serverů na jednom serveru.</span><span class="sxs-lookup"><span data-stu-id="eea2f-198">Many Internet service providers host several Web sites on a single server.</span></span> <span data-ttu-id="eea2f-199">Potvrďte Forms ověřování přihlášení a pak otevřete připojení k databázi specifické pro uživatele nebo skupiny uživatelů, mohou používat jednu databázi.</span><span class="sxs-lookup"><span data-stu-id="eea2f-199">They may use a single database to confirm a Forms authentication login and then open a connection to a specific database for that user or group of users.</span></span> <span data-ttu-id="eea2f-200">Připojení k databázi ověřování se ve fondu a kdokoliv používal.</span><span class="sxs-lookup"><span data-stu-id="eea2f-200">The connection to the authentication database is pooled and used by everyone.</span></span> <span data-ttu-id="eea2f-201">Je však samostatný fond připojení pro každou databázi, které zvýšit počet připojení k serveru.</span><span class="sxs-lookup"><span data-stu-id="eea2f-201">However, there is a separate pool of connections to each database, which increase the number of connections to the server.</span></span>  
  
 <span data-ttu-id="eea2f-202">Toto je také vedlejším účinkem návrh aplikace.</span><span class="sxs-lookup"><span data-stu-id="eea2f-202">This is also a side-effect of the application design.</span></span> <span data-ttu-id="eea2f-203">Existuje relativně jednoduchý způsob, jak tomuto vedlejšímu efektu zabránit, aniž by to ohrozilo zabezpečení při připojení k systému SQL Server.</span><span class="sxs-lookup"><span data-stu-id="eea2f-203">There is a relatively simple way to avoid this side effect without compromising security when you connect to SQL Server.</span></span> <span data-ttu-id="eea2f-204">Místo připojení k databázi samostatné pro jednotlivé uživatele nebo skupiny, připojit do stejné databáze na serveru a potom spusťte [!INCLUDE[tsql](../../../../includes/tsql-md.md)] příkaz USE změnit na požadovanou databázi.</span><span class="sxs-lookup"><span data-stu-id="eea2f-204">Instead of connecting to a separate database for each user or group, connect to the same database on the server and then execute the [!INCLUDE[tsql](../../../../includes/tsql-md.md)] USE statement to change to the desired database.</span></span> <span data-ttu-id="eea2f-205">Následující fragment kódu ukazuje vytvoření počátečního připojení k `master` databáze a poté přepne na požadovanou databáze zadaná v `databaseName` proměnnou string.</span><span class="sxs-lookup"><span data-stu-id="eea2f-205">The following code fragment demonstrates creating an initial connection to the `master` database and then switching to the desired database specified in the `databaseName` string variable.</span></span>  
  
```vb  
' Assumes that command is a valid SqlCommand object and that  
' connectionString connects to master.  
    command.Text = "USE DatabaseName"  
Using connection As New SqlConnection(connectionString)  
    connection.Open()  
    command.ExecuteNonQuery()  
End Using  
```  
  
```csharp  
// Assumes that command is a SqlCommand object and that  
// connectionString connects to master.  
command.Text = "USE DatabaseName";  
using (SqlConnection connection = new SqlConnection(  
  connectionString))  
  {  
    connection.Open();  
    command.ExecuteNonQuery();  
  }  
```  
  
## <a name="application-roles-and-connection-pooling"></a><span data-ttu-id="eea2f-206">Aplikační role a sdružování připojení</span><span class="sxs-lookup"><span data-stu-id="eea2f-206">Application Roles and Connection Pooling</span></span>  
 <span data-ttu-id="eea2f-207">Po systému SQL Server byl aktivován aplikační role voláním `sp_setapprole` systémové uložené procedury, kontext zabezpečení připojení nelze resetovat.</span><span class="sxs-lookup"><span data-stu-id="eea2f-207">After a SQL Server application role has been activated by calling the `sp_setapprole` system stored procedure, the security context of that connection cannot be reset.</span></span> <span data-ttu-id="eea2f-208">Ale pokud je povoleno sdružování připojení se vrátí do fondu a při ve fondu připojení se znovu použije dojde k chybě.</span><span class="sxs-lookup"><span data-stu-id="eea2f-208">However, if pooling is enabled, the connection is returned to the pool, and an error occurs when the pooled connection is reused.</span></span> <span data-ttu-id="eea2f-209">Další informace najdete v článku znalostní báze Knowledge Base "[chyby role SQL aplikace s sdružování prostředků OLE DB](http://support.microsoft.com/default.aspx?scid=KB;EN-US;Q229564)."</span><span class="sxs-lookup"><span data-stu-id="eea2f-209">For more information, see the Knowledge Base article, "[SQL application role errors with OLE DB resource pooling](http://support.microsoft.com/default.aspx?scid=KB;EN-US;Q229564)."</span></span>  
  
### <a name="application-role-alternatives"></a><span data-ttu-id="eea2f-210">Aplikace Role alternativy</span><span class="sxs-lookup"><span data-stu-id="eea2f-210">Application Role Alternatives</span></span>  
 <span data-ttu-id="eea2f-211">Doporučujeme vám, že můžete využít výhod mechanismy zabezpečení, které můžete použít místo aplikační role.</span><span class="sxs-lookup"><span data-stu-id="eea2f-211">We recommend that you take advantage of security mechanisms that you can use instead of application roles.</span></span> <span data-ttu-id="eea2f-212">Další informace najdete v tématu [vytváření aplikační role v systému SQL Server](../../../../docs/framework/data/adonet/sql/creating-application-roles-in-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="eea2f-212">For more information, see [Creating Application Roles in SQL Server](../../../../docs/framework/data/adonet/sql/creating-application-roles-in-sql-server.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="eea2f-213">Viz také</span><span class="sxs-lookup"><span data-stu-id="eea2f-213">See Also</span></span>  
 [<span data-ttu-id="eea2f-214">Sdružování připojení</span><span class="sxs-lookup"><span data-stu-id="eea2f-214">Connection Pooling</span></span>](../../../../docs/framework/data/adonet/connection-pooling.md)  
 [<span data-ttu-id="eea2f-215">SQL Server a ADO.NET</span><span class="sxs-lookup"><span data-stu-id="eea2f-215">SQL Server and ADO.NET</span></span>](../../../../docs/framework/data/adonet/sql/index.md)  
 [<span data-ttu-id="eea2f-216">Čítače výkonu</span><span class="sxs-lookup"><span data-stu-id="eea2f-216">Performance Counters</span></span>](../../../../docs/framework/data/adonet/performance-counters.md)  
 [<span data-ttu-id="eea2f-217">ADO.NET spravované zprostředkovatelé a středisku pro vývojáře datové sady</span><span class="sxs-lookup"><span data-stu-id="eea2f-217">ADO.NET Managed Providers and DataSet Developer Center</span></span>](http://go.microsoft.com/fwlink/?LinkId=217917)
