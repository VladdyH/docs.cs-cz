---
title: "Správa oprávnění pomocí uložené procedury v systému SQL Server"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-ado
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 08fa34e8-2ffa-470d-ba62-e511a5f8558e
caps.latest.revision: "6"
author: JennieHubbard
ms.author: jhubbard
manager: jhubbard
ms.openlocfilehash: 806cd23060dde3f7b466df0d4ce39162353380e6
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 11/21/2017
---
# <a name="managing-permissions-with-stored-procedures-in-sql-server"></a><span data-ttu-id="5965d-102">Správa oprávnění pomocí uložené procedury v systému SQL Server</span><span class="sxs-lookup"><span data-stu-id="5965d-102">Managing Permissions with Stored Procedures in SQL Server</span></span>
<span data-ttu-id="5965d-103">Jedna z metod vytváření více řádků obrany kolem vaše databáze je implementace všechny přístup k datům pomocí uložené procedury nebo funkce definované uživatelem.</span><span class="sxs-lookup"><span data-stu-id="5965d-103">One method of creating multiple lines of defense around your database is to implement all data access using stored procedures or user-defined functions.</span></span> <span data-ttu-id="5965d-104">Odvolání nebo odepřít všechna oprávnění k základní objekty, jako jsou tabulky a udělte oprávnění spouštět na uložené procedury.</span><span class="sxs-lookup"><span data-stu-id="5965d-104">You revoke or deny all permissions to underlying objects, such as tables, and grant EXECUTE permissions on stored procedures.</span></span> <span data-ttu-id="5965d-105">Tím se vytvoří efektivně zabezpečení hraniční kolem dat a databázových objektů.</span><span class="sxs-lookup"><span data-stu-id="5965d-105">This effectively creates a security perimeter around your data and database objects.</span></span>  
  
## <a name="stored-procedure-benefits"></a><span data-ttu-id="5965d-106">Výhody uložené procedury</span><span class="sxs-lookup"><span data-stu-id="5965d-106">Stored Procedure Benefits</span></span>  
 <span data-ttu-id="5965d-107">Uložené procedury mají následující výhody:</span><span class="sxs-lookup"><span data-stu-id="5965d-107">Stored procedures have the following benefits:</span></span>  
  
-   <span data-ttu-id="5965d-108">Data logiku a obchodní pravidla můžete zapouzdřené tak, aby uživatelé můžete přístup k datům a objekty pouze způsoby, které chcete vývojáři a správci databází.</span><span class="sxs-lookup"><span data-stu-id="5965d-108">Data logic and business rules can be encapsulated so that users can access data and objects only in ways that developers and database administrators intend.</span></span>  
  
-   <span data-ttu-id="5965d-109">Parametrizované uložené procedury, které ověření vstupu všechny uživatele lze zabránit útokům Injektáž SQL.</span><span class="sxs-lookup"><span data-stu-id="5965d-109">Parameterized stored procedures that validate all user input can be used to thwart SQL injection attacks.</span></span> <span data-ttu-id="5965d-110">Pokud používáte dynamické SQL, nezapomeňte Parametrizace příkazech a nikdy nezahrne hodnoty parametrů přímo do řetězce dotazu.</span><span class="sxs-lookup"><span data-stu-id="5965d-110">If you use dynamic SQL, be sure to parameterize your commands, and never include parameter values directly into a query string.</span></span>  
  
-   <span data-ttu-id="5965d-111">Ad hoc dotazy a data změny můžete povoleny.</span><span class="sxs-lookup"><span data-stu-id="5965d-111">Ad hoc queries and data modifications can be disallowed.</span></span> <span data-ttu-id="5965d-112">To zabrání uživatelům neoprávněnému nebo neúmyslně zničení dat nebo provádění dotazů, které zhoršit výkon na serveru nebo sítě.</span><span class="sxs-lookup"><span data-stu-id="5965d-112">This prevents users from maliciously or inadvertently destroying data or executing queries that impair performance on the server or the network.</span></span>  
  
-   <span data-ttu-id="5965d-113">Můžete zpracování chyb v postupu kódu bez předávány přímo pro klientské aplikace.</span><span class="sxs-lookup"><span data-stu-id="5965d-113">Errors can be handled in procedure code without being passed directly to client applications.</span></span> <span data-ttu-id="5965d-114">To brání chybové zprávy vracené, který může pomoci při testování útoku.</span><span class="sxs-lookup"><span data-stu-id="5965d-114">This prevents error messages from being returned that could aid in a probing attack.</span></span> <span data-ttu-id="5965d-115">Protokolování chyb a zpracovat je na serveru.</span><span class="sxs-lookup"><span data-stu-id="5965d-115">Log errors and handle them on the server.</span></span>  
  
-   <span data-ttu-id="5965d-116">Uložené procedury můžete zapisovat jednou a získat přístup k mnoha aplikacemi.</span><span class="sxs-lookup"><span data-stu-id="5965d-116">Stored procedures can be written once, and accessed by many applications.</span></span>  
  
-   <span data-ttu-id="5965d-117">Klienta aplikace není nutné znát základní datové struktury.</span><span class="sxs-lookup"><span data-stu-id="5965d-117">Client applications do not need to know anything about the underlying data structures.</span></span> <span data-ttu-id="5965d-118">Uložené procedury kódu můžete změnit bez nutnosti změny v klientských aplikacích tak dlouho, dokud se změny neovlivní seznamy parametrů nebo vrácena datové typy.</span><span class="sxs-lookup"><span data-stu-id="5965d-118">Stored procedure code can be changed without requiring changes in client applications as long as the changes do not affect parameter lists or returned data types.</span></span>  
  
-   <span data-ttu-id="5965d-119">Uložené procedury může snížit zatížení sítě kombinací více operací do jedné procedury volání.</span><span class="sxs-lookup"><span data-stu-id="5965d-119">Stored procedures can reduce network traffic by combining multiple operations into one procedure call.</span></span>  
  
## <a name="stored-procedure-execution"></a><span data-ttu-id="5965d-120">Spuštění uložené procedury</span><span class="sxs-lookup"><span data-stu-id="5965d-120">Stored Procedure Execution</span></span>  
 <span data-ttu-id="5965d-121">Uložené procedury využívá výhod vlastnictví řetězení zajistit přístup k datům tak, aby uživatelé nemusí mít výslovná oprávnění pro přístup k databázové objekty.</span><span class="sxs-lookup"><span data-stu-id="5965d-121">Stored procedures take advantage of ownership chaining to provide access to data so that users do not need to have explicit permission to access database objects.</span></span> <span data-ttu-id="5965d-122">Řetězce vlastnictví existuje objekty, které postupně k druhému přistupovat jsou vlastněny stejného uživatele.</span><span class="sxs-lookup"><span data-stu-id="5965d-122">An ownership chain exists when objects that access each other sequentially are owned by the same user.</span></span> <span data-ttu-id="5965d-123">Například uložené procedury můžete volat jiné uložené procedury nebo uložené procedury lze získat přístup k více tabulek.</span><span class="sxs-lookup"><span data-stu-id="5965d-123">For example, a stored procedure can call other stored procedures, or a stored procedure can access multiple tables.</span></span> <span data-ttu-id="5965d-124">Pokud mají všechny objekty v řetězu provádění stejného vlastníka, pak systému SQL Server zkontroluje pouze oprávnění ke spuštění pro volající, ne volajícího oprávnění na jiné objekty.</span><span class="sxs-lookup"><span data-stu-id="5965d-124">If all objects in the chain of execution have the same owner, then SQL Server only checks the EXECUTE permission for the caller, not the caller's permissions on other objects.</span></span> <span data-ttu-id="5965d-125">Proto musíte udělit pouze oprávnění spouštění na uložené procedury; můžete odvolat nebo odepřít všechna oprávnění pro základní tabulky.</span><span class="sxs-lookup"><span data-stu-id="5965d-125">Therefore you need to grant only EXECUTE permissions on stored procedures; you can revoke or deny all permissions on the underlying tables.</span></span>  
  
## <a name="best-practices"></a><span data-ttu-id="5965d-126">Doporučené postupy</span><span class="sxs-lookup"><span data-stu-id="5965d-126">Best Practices</span></span>  
 <span data-ttu-id="5965d-127">Jednoduše zápis uložených procedur není dost adekvátní zabezpečit vaše aplikace.</span><span class="sxs-lookup"><span data-stu-id="5965d-127">Simply writing stored procedures isn't enough to adequately secure your application.</span></span> <span data-ttu-id="5965d-128">Měli byste také zvážit následující potenciální bezpečnostní díry.</span><span class="sxs-lookup"><span data-stu-id="5965d-128">You should also consider the following potential security holes.</span></span>  
  
-   <span data-ttu-id="5965d-129">Udělte oprávnění spouštět na uložené procedury pro databázové role, které chcete mít možnost přístupu k datům.</span><span class="sxs-lookup"><span data-stu-id="5965d-129">Grant EXECUTE permissions on the stored procedures for database roles you want to be able to access the data.</span></span>  
  
-   <span data-ttu-id="5965d-130">Odvolat či odepřít všechna oprávnění na základní tabulky pro všechny role a uživatele v databázi, včetně `public` role.</span><span class="sxs-lookup"><span data-stu-id="5965d-130">Revoke or deny all permissions to the underlying tables for all roles and users in the database, including the `public` role.</span></span> <span data-ttu-id="5965d-131">Všichni uživatelé dědí oprávnění od veřejné.</span><span class="sxs-lookup"><span data-stu-id="5965d-131">All users inherit permissions from public.</span></span> <span data-ttu-id="5965d-132">Proto odepření oprávnění k `public` znamená to jenom vlastníci a `sysadmin` členové mají přístup; všichni ostatní uživatelé nebudou moci dědí oprávnění od členství v jiné role.</span><span class="sxs-lookup"><span data-stu-id="5965d-132">Therefore denying permissions to `public` means that only owners and `sysadmin` members have access; all other users will be unable to inherit permissions from membership in other roles.</span></span>  
  
-   <span data-ttu-id="5965d-133">Nepřidávejte uživatele nebo role, aby `sysadmin` nebo `db_owner` role.</span><span class="sxs-lookup"><span data-stu-id="5965d-133">Do not add users or roles to the `sysadmin` or `db_owner` roles.</span></span> <span data-ttu-id="5965d-134">Správci a vlastníci databáze můžete přístup ke všem objektům databáze.</span><span class="sxs-lookup"><span data-stu-id="5965d-134">System administrators and database owners can access all database objects.</span></span>  
  
-   <span data-ttu-id="5965d-135">Zakažte `guest` účtu.</span><span class="sxs-lookup"><span data-stu-id="5965d-135">Disable the `guest` account.</span></span> <span data-ttu-id="5965d-136">To bude anonymním uživatelům zabránit v připojení k databázi.</span><span class="sxs-lookup"><span data-stu-id="5965d-136">This will prevent anonymous users from connecting to the database.</span></span> <span data-ttu-id="5965d-137">Ve výchozím nastavení v nových databází vypnutá účet hosta.</span><span class="sxs-lookup"><span data-stu-id="5965d-137">The guest account is disabled by default in new databases.</span></span>  
  
-   <span data-ttu-id="5965d-138">Implementovat chyba zpracování a protokolu chyb.</span><span class="sxs-lookup"><span data-stu-id="5965d-138">Implement error handling and log errors.</span></span>  
  
-   <span data-ttu-id="5965d-139">Vytvořte parametrizované uložené procedury, které ověření vstupu všechny uživatele.</span><span class="sxs-lookup"><span data-stu-id="5965d-139">Create parameterized stored procedures that validate all user input.</span></span> <span data-ttu-id="5965d-140">Všechny uživatelský vstup považovat za nedůvěryhodný.</span><span class="sxs-lookup"><span data-stu-id="5965d-140">Treat all user input as untrusted.</span></span>  
  
-   <span data-ttu-id="5965d-141">Vyhnout dynamické SQL, pokud není nezbytně nutné.</span><span class="sxs-lookup"><span data-stu-id="5965d-141">Avoid dynamic SQL unless absolutely necessary.</span></span> <span data-ttu-id="5965d-142">Použijte funkci QUOTENAME() Transact-SQL a tím vymezit řetězcovou hodnotu vyhnuli kterýkoli z výskytů oddělovače ve vstupním řetězci.</span><span class="sxs-lookup"><span data-stu-id="5965d-142">Use the Transact-SQL QUOTENAME() function to delimit a string value and escape any occurrence of the delimiter in the input string.</span></span>  
  
## <a name="external-resources"></a><span data-ttu-id="5965d-143">Externí zdroje</span><span class="sxs-lookup"><span data-stu-id="5965d-143">External Resources</span></span>  
 <span data-ttu-id="5965d-144">Další informace najdete v následujících zdrojích informací.</span><span class="sxs-lookup"><span data-stu-id="5965d-144">For more information, see the following resources.</span></span>  
  
|<span data-ttu-id="5965d-145">Prostředek</span><span class="sxs-lookup"><span data-stu-id="5965d-145">Resource</span></span>|<span data-ttu-id="5965d-146">Popis</span><span class="sxs-lookup"><span data-stu-id="5965d-146">Description</span></span>|  
|--------------|-----------------|  
|<span data-ttu-id="5965d-147">[Uložené procedury](http://msdn.microsoft.com/library/ms190782.aspx) a [Injektáž SQL](http://go.microsoft.com/fwlink/?LinkId=98234) v Online knihách serveru SQL</span><span class="sxs-lookup"><span data-stu-id="5965d-147">[Stored Procedures](http://msdn.microsoft.com/library/ms190782.aspx) and [SQL Injection](http://go.microsoft.com/fwlink/?LinkId=98234) in SQL Server Books Online</span></span>|<span data-ttu-id="5965d-148">Témata popisují, jak vytvořit uložené procedury a jak funguje Injektáž SQL.</span><span class="sxs-lookup"><span data-stu-id="5965d-148">Topics describe how to create stored procedures and how SQL Injection works.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="5965d-149">Viz také</span><span class="sxs-lookup"><span data-stu-id="5965d-149">See Also</span></span>  
 [<span data-ttu-id="5965d-150">Zabezpečení aplikací ADO.NET</span><span class="sxs-lookup"><span data-stu-id="5965d-150">Securing ADO.NET Applications</span></span>](../../../../../docs/framework/data/adonet/securing-ado-net-applications.md)  
 [<span data-ttu-id="5965d-151">Přehled zabezpečení SQL serveru</span><span class="sxs-lookup"><span data-stu-id="5965d-151">Overview of SQL Server Security</span></span>](../../../../../docs/framework/data/adonet/sql/overview-of-sql-server-security.md)  
 [<span data-ttu-id="5965d-152">Scénáře zabezpečení aplikací v systému SQL Server</span><span class="sxs-lookup"><span data-stu-id="5965d-152">Application Security Scenarios in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/application-security-scenarios-in-sql-server.md)  
 [<span data-ttu-id="5965d-153">Zápis zabezpečené dynamické SQL v systému SQL Server</span><span class="sxs-lookup"><span data-stu-id="5965d-153">Writing Secure Dynamic SQL in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/writing-secure-dynamic-sql-in-sql-server.md)  
 [<span data-ttu-id="5965d-154">Podepisování uložené procedury v systému SQL Server</span><span class="sxs-lookup"><span data-stu-id="5965d-154">Signing Stored Procedures in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/signing-stored-procedures-in-sql-server.md)  
 [<span data-ttu-id="5965d-155">Přizpůsobení oprávnění s zosobnění v systému SQL Server</span><span class="sxs-lookup"><span data-stu-id="5965d-155">Customizing Permissions with Impersonation in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/customizing-permissions-with-impersonation-in-sql-server.md)  
 [<span data-ttu-id="5965d-156">Úprava dat pomocí uložené procedury</span><span class="sxs-lookup"><span data-stu-id="5965d-156">Modifying Data with Stored Procedures</span></span>](../../../../../docs/framework/data/adonet/modifying-data-with-stored-procedures.md)  
 [<span data-ttu-id="5965d-157">ADO.NET spravované zprostředkovatelé a středisku pro vývojáře datové sady</span><span class="sxs-lookup"><span data-stu-id="5965d-157">ADO.NET Managed Providers and DataSet Developer Center</span></span>](http://go.microsoft.com/fwlink/?LinkId=217917)
