---
title: "Přizpůsobení oprávnění s zosobnění v systému SQL Server"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-ado
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: dc733d09-1d6d-4af0-9c4b-8d24504860f1
caps.latest.revision: "6"
author: JennieHubbard
ms.author: jhubbard
manager: jhubbard
ms.workload: dotnet
ms.openlocfilehash: fbd5aa34fa9e90df972e718c28d0ba97287c3d8d
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 12/22/2017
---
# <a name="customizing-permissions-with-impersonation-in-sql-server"></a><span data-ttu-id="e0aec-102">Přizpůsobení oprávnění s zosobnění v systému SQL Server</span><span class="sxs-lookup"><span data-stu-id="e0aec-102">Customizing Permissions with Impersonation in SQL Server</span></span>
<span data-ttu-id="e0aec-103">Mnoho aplikací pomocí uložené procedury pro přístup k datům, spoléhat na vlastnictví řetězení omezit přístup k základní tabulky.</span><span class="sxs-lookup"><span data-stu-id="e0aec-103">Many applications use stored procedures to access data, relying on ownership chaining to restrict access to base tables.</span></span> <span data-ttu-id="e0aec-104">Můžete udělit oprávnění pro spouštění na uložené procedury, odvolání nebo odmítnout oprávnění u základní tabulky.</span><span class="sxs-lookup"><span data-stu-id="e0aec-104">You can grant EXECUTE permissions on stored procedures, revoking or denying permissions on the base tables.</span></span> <span data-ttu-id="e0aec-105">SQL Server oprávnění volajícího nekontroluje, pokud se uložené procedury a tabulky mít stejného vlastníka.</span><span class="sxs-lookup"><span data-stu-id="e0aec-105">SQL Server does not check the permissions of the caller if the stored procedure and tables have the same owner.</span></span> <span data-ttu-id="e0aec-106">Ale vlastnictví řetězení nefunguje Pokud objekty mají různé vlastníci, nebo v případě dynamických SQL.</span><span class="sxs-lookup"><span data-stu-id="e0aec-106">However, ownership chaining doesn't work if objects have different owners or in the case of dynamic SQL.</span></span>  
  
 <span data-ttu-id="e0aec-107">Můžete použít EXECUTE AS klauzule v uložené proceduře při volající nemá oprávnění pro odkazované databázové objekty.</span><span class="sxs-lookup"><span data-stu-id="e0aec-107">You can use the EXECUTE AS clause in a stored procedure when the caller doesn't have permissions on the referenced database objects.</span></span> <span data-ttu-id="e0aec-108">Účinek klauzule EXECUTE as je, že kontextu spuštění je přepnutá na uživatele proxy serveru.</span><span class="sxs-lookup"><span data-stu-id="e0aec-108">The effect of the EXECUTE AS clause is that the execution context is switched to the proxy user.</span></span> <span data-ttu-id="e0aec-109">Všechny kódu, stejně jako libovolný volání vnořené uložené procedury nebo aktivační události, spustí v kontextu zabezpečení uživatele proxy serveru.</span><span class="sxs-lookup"><span data-stu-id="e0aec-109">All code, as well as any calls to nested stored procedures or triggers, executes under the security context of the proxy user.</span></span> <span data-ttu-id="e0aec-110">Kontext spuštění je vrátit zpět na původní volající pouze po spuštění procedury nebo při vydání příkazu vrátit.</span><span class="sxs-lookup"><span data-stu-id="e0aec-110">Execution context is reverted to the original caller only after execution of the procedure or when a REVERT statement is issued.</span></span>  
  
## <a name="context-switching-with-the-execute-as-statement"></a><span data-ttu-id="e0aec-111">Kontext přepínání s EXECUTE AS – příkaz</span><span class="sxs-lookup"><span data-stu-id="e0aec-111">Context Switching with the EXECUTE AS Statement</span></span>  
 <span data-ttu-id="e0aec-112">Příkaz umožňuje přepínačem kontext provádění příkazu zosobnění jiného uživatele přihlášení nebo databáze provést AS jazyka Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="e0aec-112">The Transact-SQL EXECUTE AS statement allows you to switch the execution context of a statement by impersonating another login or database user.</span></span> <span data-ttu-id="e0aec-113">To je užitečné pro testování dotazů a postupy jako jiný uživatel.</span><span class="sxs-lookup"><span data-stu-id="e0aec-113">This is a useful technique for testing queries and procedures as another user.</span></span>  
  
```  
EXECUTE AS LOGIN = 'loginName';  
EXECUTE AS USER = 'userName';  
```  
  
 <span data-ttu-id="e0aec-114">Musí mít oprávnění ZOSOBNIT na přihlášení nebo uživateli, které jsou zosobnění.</span><span class="sxs-lookup"><span data-stu-id="e0aec-114">You must have IMPERSONATE permissions on the login or user you are impersonating.</span></span> <span data-ttu-id="e0aec-115">Toto oprávnění je implicitní pro `sysadmin` pro všechny databáze, a `db_owner` členy role v databázích, které vlastní.</span><span class="sxs-lookup"><span data-stu-id="e0aec-115">This permission is implied for `sysadmin` for all databases, and `db_owner` role members in databases that they own.</span></span>  
  
## <a name="granting-permissions-with-the-execute-as-clause"></a><span data-ttu-id="e0aec-116">Udělení oprávnění s EXECUTE AS – klauzule</span><span class="sxs-lookup"><span data-stu-id="e0aec-116">Granting Permissions with the EXECUTE AS Clause</span></span>  
 <span data-ttu-id="e0aec-117">Můžete použít EXECUTE AS klauzule v hlavičce definice uložené procedury, aktivační události nebo uživatelem definovanou funkci (s výjimkou vložené funkce vracející tabulku).</span><span class="sxs-lookup"><span data-stu-id="e0aec-117">You can use the EXECUTE AS clause in the definition header of a stored procedure, trigger, or user-defined function (except for inline table-valued functions).</span></span> <span data-ttu-id="e0aec-118">To způsobí, že postup spuštěn v kontextu uživatelské jméno nebo zadaný v EXECUTE AS – klíčové slovo klauzule.</span><span class="sxs-lookup"><span data-stu-id="e0aec-118">This causes the procedure to execute in the context of the user name or keyword specified in the EXECUTE AS clause.</span></span> <span data-ttu-id="e0aec-119">Vytvořit uživatele proxy serveru v databázi, která není namapován na přihlášení, udělení ho jenom nezbytná oprávnění u objektů přístup procedurou.</span><span class="sxs-lookup"><span data-stu-id="e0aec-119">You can create a proxy user in the database that is not mapped to a login, granting it only the necessary permissions on the objects accessed by the procedure.</span></span> <span data-ttu-id="e0aec-120">Pouze proxy uživatel zadaný v EXECUTE jako klauzule musí mít oprávnění pro přístup k modulu pro všechny objekty.</span><span class="sxs-lookup"><span data-stu-id="e0aec-120">Only the proxy user specified in the EXECUTE AS clause must have permissions on all objects accessed by the module.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="e0aec-121">Některé akce, jako je TRUNCATE TABLE nemají udělitelný oprávnění.</span><span class="sxs-lookup"><span data-stu-id="e0aec-121">Some actions, such as TRUNCATE TABLE, do not have grantable permissions.</span></span> <span data-ttu-id="e0aec-122">Zařadit příkaz v rámci procedury a zadání uživatele proxy serveru, který má oprávnění k příkazu ALTER TABLE, můžete rozšířit oprávnění ke zkrácení tabulky pro volající, kteří mají oprávnění provést jen v postupu.</span><span class="sxs-lookup"><span data-stu-id="e0aec-122">By incorporating the statement within a procedure and specifying a proxy user who has ALTER TABLE permissions, you can extend the permissions to truncate the table to callers who have only EXECUTE permissions on the procedure.</span></span>  
  
 <span data-ttu-id="e0aec-123">Kontext, zadaný v EXECUTE jako klauzule je platný po dobu trvání procesu, včetně vnořené procedur a triggerů.</span><span class="sxs-lookup"><span data-stu-id="e0aec-123">The context specified in the EXECUTE AS clause is valid for the duration of the procedure, including nested procedures and triggers.</span></span> <span data-ttu-id="e0aec-124">Po dokončení provádění nebo příkaz REVERT se objeví, vrátí kontext volajícímu.</span><span class="sxs-lookup"><span data-stu-id="e0aec-124">Context reverts to the caller when execution is complete or the REVERT statement is issued.</span></span>  
  
 <span data-ttu-id="e0aec-125">Existují tři kroky potřebné při používání EXECUTE AS klauzule v postupu.</span><span class="sxs-lookup"><span data-stu-id="e0aec-125">There are three steps involved in using the EXECUTE AS clause in a procedure.</span></span>  
  
1.  <span data-ttu-id="e0aec-126">Vytvořte uživatele proxy serveru v databázi, která není namapován na přihlášení.</span><span class="sxs-lookup"><span data-stu-id="e0aec-126">Create a proxy user in the database that is not mapped to a login.</span></span> <span data-ttu-id="e0aec-127">Tento krok není povinný, ale pomáhá při správě oprávnění.</span><span class="sxs-lookup"><span data-stu-id="e0aec-127">This is not required, but it helps when managing permissions.</span></span>  
  
```  
CREATE USER proxyUser WITHOUT LOGIN  
```  
  
1.  <span data-ttu-id="e0aec-128">Udělte nezbytná oprávnění uživatele proxy serveru.</span><span class="sxs-lookup"><span data-stu-id="e0aec-128">Grant the proxy user the necessary permissions.</span></span>  
  
2.  <span data-ttu-id="e0aec-129">Přidat EXECUTE AS klauzule uložená procedura nebo uživatelem definované funkce.</span><span class="sxs-lookup"><span data-stu-id="e0aec-129">Add the EXECUTE AS clause to the stored procedure or user-defined function.</span></span>  
  
```  
CREATE PROCEDURE [procName] WITH EXECUTE AS 'proxyUser' AS ...  
```  
  
> [!NOTE]
>  <span data-ttu-id="e0aec-130">Aplikace, které vyžadují auditování možné zrušit, protože původní kontext zabezpečení volajícího nezůstanou zachovány.</span><span class="sxs-lookup"><span data-stu-id="e0aec-130">Applications that require auditing can break because the original security context of the caller is not retained.</span></span> <span data-ttu-id="e0aec-131">Integrované funkce, které vrátí identitu aktuálního uživatele, jako je například SESSION_USER, uživatele nebo uživatelské_jméno, vrátí uživatele přidruženého k EXECUTE AS klauzule, není původní volající.</span><span class="sxs-lookup"><span data-stu-id="e0aec-131">Built-in functions that return the identity of the current user, such as SESSION_USER, USER, or USER_NAME, return the user associated with the EXECUTE AS clause, not the original caller.</span></span>  
  
### <a name="using-execute-as-with-revert"></a><span data-ttu-id="e0aec-132">Pomocí vrátit EXECUTE AS</span><span class="sxs-lookup"><span data-stu-id="e0aec-132">Using EXECUTE AS with REVERT</span></span>  
 <span data-ttu-id="e0aec-133">Příkaz vrátit Transact-SQL můžete obnovit původní kontextu spuštění.</span><span class="sxs-lookup"><span data-stu-id="e0aec-133">You can use the Transact-SQL REVERT statement to revert to the original execution context.</span></span>  
  
 <span data-ttu-id="e0aec-134">Klauzuli volitelné, s ne vrátit COOKIE = @variableName, umožňuje Pokud přepnete zpět do volající kontext provádění @variableName proměnná obsahuje správnou hodnotu.</span><span class="sxs-lookup"><span data-stu-id="e0aec-134">The optional clause, WITH NO REVERT COOKIE = @variableName, allows you switch the execution context back to the caller if the @variableName variable contains the correct value.</span></span> <span data-ttu-id="e0aec-135">Umožňuje přepnout kontext provádění volající v prostředích, kde se používá sdružování připojení.</span><span class="sxs-lookup"><span data-stu-id="e0aec-135">This allows you to switch the execution context back to the caller in environments where connection pooling is used.</span></span> <span data-ttu-id="e0aec-136">Protože hodnota @variableName známý pouze volající EXECUTE AS prohlášení, volající může zaručit, že kontextu spuštění nelze změnit koncovým uživatelem, která volá aplikaci.</span><span class="sxs-lookup"><span data-stu-id="e0aec-136">Because the value of @variableName is known only to the caller of the EXECUTE AS statement, the caller can guarantee that the execution context cannot be changed by the end user that invokes the application.</span></span> <span data-ttu-id="e0aec-137">Když se připojení uzavře, je vrácen do fondu.</span><span class="sxs-lookup"><span data-stu-id="e0aec-137">When the connection is closed, it is returned to the pool.</span></span> <span data-ttu-id="e0aec-138">Další informace o připojení sdružování v ADO.NET, najdete v části [SQL sdružování připojení serveru (ADO.NET)](../../../../../docs/framework/data/adonet/sql-server-connection-pooling.md).</span><span class="sxs-lookup"><span data-stu-id="e0aec-138">For more information on connection pooling in ADO.NET, see [SQL Server Connection Pooling (ADO.NET)](../../../../../docs/framework/data/adonet/sql-server-connection-pooling.md).</span></span>  
  
### <a name="specifying-the-execution-context"></a><span data-ttu-id="e0aec-139">Určení kontextu spuštění</span><span class="sxs-lookup"><span data-stu-id="e0aec-139">Specifying the Execution Context</span></span>  
 <span data-ttu-id="e0aec-140">Kromě určení uživatele, můžete také použít EXECUTE AS s žádným z následujících klíčových slov.</span><span class="sxs-lookup"><span data-stu-id="e0aec-140">In addition to specifying a user, you can also use EXECUTE AS with any of the following keywords.</span></span>  
  
-   <span data-ttu-id="e0aec-141">VOLAJÍCÍ.</span><span class="sxs-lookup"><span data-stu-id="e0aec-141">CALLER.</span></span> <span data-ttu-id="e0aec-142">Provádění jako VOLAJÍCÍ je výchozí; Pokud není zadána žádná další možnost, postup spustí v kontextu zabezpečení volajícího.</span><span class="sxs-lookup"><span data-stu-id="e0aec-142">Executing as CALLER is the default; if no other option is specified, then the procedure executes in the security context of the caller.</span></span>  
  
-   <span data-ttu-id="e0aec-143">VLASTNÍK.</span><span class="sxs-lookup"><span data-stu-id="e0aec-143">OWNER.</span></span> <span data-ttu-id="e0aec-144">Postup spuštění jako vlastník provede v rámci postupu vlastníka.</span><span class="sxs-lookup"><span data-stu-id="e0aec-144">Executing as OWNER executes the procedure in the context of the procedure owner.</span></span> <span data-ttu-id="e0aec-145">Pokud se ve schématu vlastníkem vytvoří postup `dbo` nebo vlastník databáze postup bude vykonán neomezená oprávnění.</span><span class="sxs-lookup"><span data-stu-id="e0aec-145">If the procedure is created in a schema owned by `dbo` or the database owner, the procedure will execute with unrestricted permissions.</span></span>  
  
-   <span data-ttu-id="e0aec-146">SÁM SEBOU.</span><span class="sxs-lookup"><span data-stu-id="e0aec-146">SELF.</span></span> <span data-ttu-id="e0aec-147">Provádění jako vlastní spustí v kontextu zabezpečení Tvůrce uložené procedury.</span><span class="sxs-lookup"><span data-stu-id="e0aec-147">Executing as SELF executes in the security context of the creator of the stored procedure.</span></span> <span data-ttu-id="e0aec-148">Jde o ekvivalent spuštění jako zadaného uživatele, pokud zadaný uživatel osobou vytvoření či změna postupu.</span><span class="sxs-lookup"><span data-stu-id="e0aec-148">This is equivalent to executing as a specified user, where the specified user is the person creating or altering the procedure.</span></span>  
  
## <a name="external-resources"></a><span data-ttu-id="e0aec-149">Externí zdroje</span><span class="sxs-lookup"><span data-stu-id="e0aec-149">External Resources</span></span>  
 <span data-ttu-id="e0aec-150">Další informace najdete v následujících zdrojích informací.</span><span class="sxs-lookup"><span data-stu-id="e0aec-150">For more information, see the following resources.</span></span>  
  
|<span data-ttu-id="e0aec-151">Prostředek</span><span class="sxs-lookup"><span data-stu-id="e0aec-151">Resource</span></span>|<span data-ttu-id="e0aec-152">Popis</span><span class="sxs-lookup"><span data-stu-id="e0aec-152">Description</span></span>|  
|--------------|-----------------|  
|<span data-ttu-id="e0aec-153">[Přepínání kontextu](http://msdn.microsoft.com/library/ms188268.aspx) v Online knihách serveru SQL</span><span class="sxs-lookup"><span data-stu-id="e0aec-153">[Context Switching](http://msdn.microsoft.com/library/ms188268.aspx) in SQL Server Books Online</span></span>|<span data-ttu-id="e0aec-154">Obsahuje odkazy na témata s popisem použití EXECUTE AS klauzule.</span><span class="sxs-lookup"><span data-stu-id="e0aec-154">Contains links to topics describing how to use the EXECUTE AS clause.</span></span>|  
|<span data-ttu-id="e0aec-155">[Pro vytvoření vlastní sadu oprávnění pomocí EXECUTE AS](http://msdn.microsoft.com/library/ms190384.aspx) a [pomocí EXECUTE AS v modulech](http://msdn.microsoft.com/library/ms178106.aspx) v Online knihách serveru SQL</span><span class="sxs-lookup"><span data-stu-id="e0aec-155">[Using EXECUTE AS to Create Custom Permission Sets](http://msdn.microsoft.com/library/ms190384.aspx) and [Using EXECUTE AS in Modules](http://msdn.microsoft.com/library/ms178106.aspx) in SQL Server Books Online</span></span>|<span data-ttu-id="e0aec-156">Témata popisují, jak používat EXECUTE AS klauzule.</span><span class="sxs-lookup"><span data-stu-id="e0aec-156">Topics describe how to use the EXECUTE AS clause.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="e0aec-157">Viz také</span><span class="sxs-lookup"><span data-stu-id="e0aec-157">See Also</span></span>  
 [<span data-ttu-id="e0aec-158">Zabezpečení aplikací ADO.NET</span><span class="sxs-lookup"><span data-stu-id="e0aec-158">Securing ADO.NET Applications</span></span>](../../../../../docs/framework/data/adonet/securing-ado-net-applications.md)  
 [<span data-ttu-id="e0aec-159">Přehled zabezpečení SQL Serveru</span><span class="sxs-lookup"><span data-stu-id="e0aec-159">Overview of SQL Server Security</span></span>](../../../../../docs/framework/data/adonet/sql/overview-of-sql-server-security.md)  
 [<span data-ttu-id="e0aec-160">Scénáře zabezpečení aplikací na SQL Serveru</span><span class="sxs-lookup"><span data-stu-id="e0aec-160">Application Security Scenarios in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/application-security-scenarios-in-sql-server.md)  
 [<span data-ttu-id="e0aec-161">Správa oprávnění pomocí uložených procedur na SQL Serveru</span><span class="sxs-lookup"><span data-stu-id="e0aec-161">Managing Permissions with Stored Procedures in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/managing-permissions-with-stored-procedures-in-sql-server.md)  
 [<span data-ttu-id="e0aec-162">Zápis zabezpečené dynamické SQL na SQL Serveru</span><span class="sxs-lookup"><span data-stu-id="e0aec-162">Writing Secure Dynamic SQL in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/writing-secure-dynamic-sql-in-sql-server.md)  
 [<span data-ttu-id="e0aec-163">Podepisování uložených procedur na SQL Serveru</span><span class="sxs-lookup"><span data-stu-id="e0aec-163">Signing Stored Procedures in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/signing-stored-procedures-in-sql-server.md)  
 [<span data-ttu-id="e0aec-164">Úpravy dat pomocí uložených procedur</span><span class="sxs-lookup"><span data-stu-id="e0aec-164">Modifying Data with Stored Procedures</span></span>](../../../../../docs/framework/data/adonet/modifying-data-with-stored-procedures.md)  
 [<span data-ttu-id="e0aec-165">ADO.NET spravované zprostředkovatelé a středisku pro vývojáře datové sady</span><span class="sxs-lookup"><span data-stu-id="e0aec-165">ADO.NET Managed Providers and DataSet Developer Center</span></span>](http://go.microsoft.com/fwlink/?LinkId=217917)
