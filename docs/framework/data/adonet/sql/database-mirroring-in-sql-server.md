---
title: "V systému SQL Server zrcadlení databáze"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-ado
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
ms.assetid: 89befaff-bb46-4290-8382-e67cdb0e3de9
caps.latest.revision: "6"
author: douglaslMS
ms.author: douglasl
manager: craigg
ms.workload: dotnet
ms.openlocfilehash: 8a955f62aa1e7b2f025a621840753e2213fcefe7
ms.sourcegitcommit: ed26cfef4e18f6d93ab822d8c29f902cff3519d1
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 01/17/2018
---
# <a name="database-mirroring-in-sql-server"></a><span data-ttu-id="d1021-102">V systému SQL Server zrcadlení databáze</span><span class="sxs-lookup"><span data-stu-id="d1021-102">Database Mirroring in SQL Server</span></span>
<span data-ttu-id="d1021-103">Zrcadlení databáze v systému SQL Server, můžete ponechat kopii nebo zrcadlení databáze systému SQL Server na pohotovostní server.</span><span class="sxs-lookup"><span data-stu-id="d1021-103">Database mirroring in SQL Server allows you to keep a copy, or mirror, of a SQL Server database on a standby server.</span></span> <span data-ttu-id="d1021-104">Zrcadlení zajišťuje, že dvě samostatné kopie dat existují na všechny časy tím vysokou dostupnost a redundanci dat dokončit.</span><span class="sxs-lookup"><span data-stu-id="d1021-104">Mirroring ensures that two separate copies of the data exist at all times, providing high availability and complete data redundancy.</span></span> <span data-ttu-id="d1021-105">Zprostředkovatel dat .NET pro SQL Server podporuje implicitní zrcadlení databáze, tak, aby vývojář není nutné provádět žádnou akci nebo psaní jakéhokoli kódu, jakmile byla nakonfigurována pro databázi systému SQL Server.</span><span class="sxs-lookup"><span data-stu-id="d1021-105">The .NET Data Provider for SQL Server provides implicit support for database mirroring, so that the developer does not need to take any action or write any code once it has been configured for a SQL Server database.</span></span> <span data-ttu-id="d1021-106">Kromě toho <xref:System.Data.SqlClient.SqlConnection> objekt podporuje režim explicitní spojení umožňující poskytuje název serveru partnera převzetí služeb při selhání v <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span><span class="sxs-lookup"><span data-stu-id="d1021-106">In addition, the <xref:System.Data.SqlClient.SqlConnection> object supports an explicit connection mode that allows supplying the name of a failover partner server in the <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span></span>  
  
 <span data-ttu-id="d1021-107">Následující zjednodušené posloupnost událostí pro <xref:System.Data.SqlClient.SqlConnection> objekt, který cílí nakonfigurována pro zrcadlení databáze:</span><span class="sxs-lookup"><span data-stu-id="d1021-107">The following simplified sequence of events occurs for a <xref:System.Data.SqlClient.SqlConnection> object that targets a database configured for mirroring:</span></span>  
  
1.  <span data-ttu-id="d1021-108">Klientská aplikace úspěšně připojí k hlavní databáze, a server odešle zpět název partnerského serveru, které jsou pak uloženy v mezipaměti klienta.</span><span class="sxs-lookup"><span data-stu-id="d1021-108">The client application successfully connects to the principal database, and the server sends back the name of the partner server, which is then cached on the client.</span></span>  
  
2.  <span data-ttu-id="d1021-109">Pokud dojde k selhání serveru, který obsahuje hlavní databázi nebo dojde k přerušení připojení, dojde ke ztrátě stavu připojení a transakce.</span><span class="sxs-lookup"><span data-stu-id="d1021-109">If the server containing the principal database fails or connectivity is interrupted, connection and transaction state is lost.</span></span> <span data-ttu-id="d1021-110">Klientská aplikace se pokusí znovu navázat připojení k hlavní databáze a selže.</span><span class="sxs-lookup"><span data-stu-id="d1021-110">The client application attempts to re-establish a connection to the principal database and fails.</span></span>  
  
3.  <span data-ttu-id="d1021-111">Klientská aplikace pak transparentně pokusí navázat připojení k databázi zrcadlení na partnerském serveru.</span><span class="sxs-lookup"><span data-stu-id="d1021-111">The client application then transparently attempts to establish a connection to the mirror database on the partner server.</span></span> <span data-ttu-id="d1021-112">Pokud se aktivace podaří, připojení se přesměruje na zrcadlení databáze, která se pak stane nový hlavní databáze.</span><span class="sxs-lookup"><span data-stu-id="d1021-112">If it succeeds, the connection is redirected to the mirror database, which then becomes the new principal database.</span></span>  
  
## <a name="specifying-the-failover-partner-in-the-connection-string"></a><span data-ttu-id="d1021-113">Určení partnerovi převzetí služeb při selhání v připojovacím řetězci</span><span class="sxs-lookup"><span data-stu-id="d1021-113">Specifying the Failover Partner in the Connection String</span></span>  
 <span data-ttu-id="d1021-114">Zadáte název partnerského serveru převzetí služeb při selhání v připojovacím řetězci, se klient pokusí připojení s partnerem převzetí služeb při selhání transparentně Pokud hlavní databáze není k dispozici, když se poprvé připojí klientské aplikace.</span><span class="sxs-lookup"><span data-stu-id="d1021-114">If you supply the name of a failover partner server in the connection string, the client will transparently attempt a connection with the failover partner if the principal database is unavailable when the client application first connects.</span></span>  
  
```  
";Failover Partner=PartnerServerName"  
```  
  
 <span data-ttu-id="d1021-115">Pokud nezadáte název partnerského serveru, převzetí služeb při selhání a hlavní databáze není k dispozici při klientská aplikace poprvé připojí potom <xref:System.Data.SqlClient.SqlException> je vyvolána.</span><span class="sxs-lookup"><span data-stu-id="d1021-115">If you omit the name of the failover partner server and the principal database is unavailable when the client application first connects then a <xref:System.Data.SqlClient.SqlException> is raised.</span></span>  
  
 <span data-ttu-id="d1021-116">Když <xref:System.Data.SqlClient.SqlConnection> je úspěšně otevřen, název partnera převzetí služeb při selhání je vrácená serverem a nahrazuje všechny hodnoty zadané v připojovacím řetězci.</span><span class="sxs-lookup"><span data-stu-id="d1021-116">When a <xref:System.Data.SqlClient.SqlConnection> is successfully opened, the failover partner name is returned by the server and supersedes any values supplied in the connection string.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d1021-117">Počáteční název katalogu nebo databáze musí explicitně zadáte v připojovacím řetězci pro scénáře zrcadlení databáze.</span><span class="sxs-lookup"><span data-stu-id="d1021-117">You must explicitly specify the initial catalog or database name in the connection string for database mirroring scenarios.</span></span> <span data-ttu-id="d1021-118">Pokud klient obdrží převzetí služeb při selhání informace o připojení, který nemá explicitně zadaný počáteční katalog ani databáze, informace o převzetí služeb při selhání není uložena v mezipaměti a aplikace nebude pokoušet o převzetí služeb při selhání Pokud hlavní server selže.</span><span class="sxs-lookup"><span data-stu-id="d1021-118">If the client receives failover information on a connection that doesn't have an explicitly specified initial catalog or database, the failover information is not cached and the application does not attempt to fail over if the principal server fails.</span></span> <span data-ttu-id="d1021-119">Pokud připojovací řetězec má hodnotu partnerovi převzetí služeb při selhání, ale žádná hodnota pro úvodního katalogu nebo databáze, `InvalidArgumentException` je vyvolána.</span><span class="sxs-lookup"><span data-stu-id="d1021-119">If a connection string has a value for the failover partner, but no value for the initial catalog or database, an `InvalidArgumentException` is raised.</span></span>  
  
## <a name="retrieving-the-current-server-name"></a><span data-ttu-id="d1021-120">Načítání aktuální název serveru</span><span class="sxs-lookup"><span data-stu-id="d1021-120">Retrieving the Current Server Name</span></span>  
 <span data-ttu-id="d1021-121">V případě selhání, můžete načíst název serveru, ke které je ve skutečnosti připojený k aktuálnímu připojení pomocí <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> vlastnost <xref:System.Data.SqlClient.SqlConnection> objektu.</span><span class="sxs-lookup"><span data-stu-id="d1021-121">In the event of a failover, you can retrieve the name of the server to which the current connection is actually connected by using the <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> property of a <xref:System.Data.SqlClient.SqlConnection> object.</span></span> <span data-ttu-id="d1021-122">Následující fragment kódu načte název aktivního serveru, za předpokladu, že proměnná připojení odkazuje otevřenou <xref:System.Data.SqlClient.SqlConnection>.</span><span class="sxs-lookup"><span data-stu-id="d1021-122">The following code fragment retrieves the name of the active server, assuming that the connection variable references an open <xref:System.Data.SqlClient.SqlConnection>.</span></span>  
  
 <span data-ttu-id="d1021-123">Když dojde k převzetí služeb při selhání události a připojení je přepnutá na zrcadlový server, **DataSource** vlastnosti podle názvu zrcadlení.</span><span class="sxs-lookup"><span data-stu-id="d1021-123">When a failover event occurs and the connection is switched to the mirror server, the **DataSource** property is updated to reflect the mirror name.</span></span>  
  
```vb  
Dim activeServer As String = connection.DataSource  
```  
  
```csharp  
string activeServer = connection.DataSource;  
```  
  
## <a name="sqlclient-mirroring-behavior"></a><span data-ttu-id="d1021-124">Chování zrcadlení SqlClient</span><span class="sxs-lookup"><span data-stu-id="d1021-124">SqlClient Mirroring Behavior</span></span>  
 <span data-ttu-id="d1021-125">Klient se vždy pokusí připojit k aktuální objekt zabezpečení serveru.</span><span class="sxs-lookup"><span data-stu-id="d1021-125">The client always tries to connect to the current principal server.</span></span> <span data-ttu-id="d1021-126">Pokud se nezdaří, se pokusí o partnerovi převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="d1021-126">If it fails, it tries the failover partner.</span></span> <span data-ttu-id="d1021-127">Pokud zrcadlové databáze již byla přepnuta na hlavní role na partnerském serveru, je připojení úspěšné a nový hlavní zrcadlení mapování odeslat klientovi a v mezipaměti po dobu jeho existence volání <xref:System.AppDomain>.</span><span class="sxs-lookup"><span data-stu-id="d1021-127">If the mirror database has already been switched to the principal role on the partner server, the connection succeeds and the new principal-mirror mapping is sent to the client and cached for the lifetime of the calling <xref:System.AppDomain>.</span></span> <span data-ttu-id="d1021-128">To se neuloží do trvalého úložiště a není k dispozici pro další připojení v jiné **AppDomain** nebo proces.</span><span class="sxs-lookup"><span data-stu-id="d1021-128">It is not stored in persistent storage and is not available for subsequent connections in a different **AppDomain** or process.</span></span> <span data-ttu-id="d1021-129">Je však k dispozici pro další připojení v rámci stejné **AppDomain**.</span><span class="sxs-lookup"><span data-stu-id="d1021-129">However, it is available for subsequent connections within the same **AppDomain**.</span></span> <span data-ttu-id="d1021-130">Poznámka: to jiný **AppDomain** nebo proces, který běží na stejném nebo na jiném počítači vždy má svůj fond připojení, a tato připojení se neresetují.</span><span class="sxs-lookup"><span data-stu-id="d1021-130">Note that another **AppDomain** or process running on the same or a different computer always has its pool of connections, and those connections are not reset.</span></span> <span data-ttu-id="d1021-131">V takovém případě pokud výpadku primární databázi, každý proces nebo **AppDomain** jednou selže a fondu, jsou automaticky vymazány.</span><span class="sxs-lookup"><span data-stu-id="d1021-131">In that case, if the primary database goes down, each process or **AppDomain** fails once, and the pool is automatically cleared.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d1021-132">Zrcadlení podporu na serveru je konfigurováno na základě jednotlivé databáze.</span><span class="sxs-lookup"><span data-stu-id="d1021-132">Mirroring support on the server is configured on a per-database basis.</span></span> <span data-ttu-id="d1021-133">Pokud jsou u jiných databází, které nejsou zahrnuté v sadě hlavní či zrcadla pomocí s více částmi názvů nebo změnou aktuální databázi spustit operace zpracování dat se změny těchto jiných databází nešířily v případě selhání.</span><span class="sxs-lookup"><span data-stu-id="d1021-133">If data manipulation operations are executed against other databases not included in the principal/mirror set, either by using multipart names or by changing the current database, the changes to these other databases do not propagate in the event of failure.</span></span> <span data-ttu-id="d1021-134">Při změně dat v databázi, která není zrcadlena, nevygeneruje se žádná chyba.</span><span class="sxs-lookup"><span data-stu-id="d1021-134">No error is generated when data is modified in a database that is not mirrored.</span></span> <span data-ttu-id="d1021-135">Vývojář se musí vyhodnotit možný účinek těchto operací.</span><span class="sxs-lookup"><span data-stu-id="d1021-135">The developer must evaluate the possible impact of such operations.</span></span>  
  
## <a name="database-mirroring-resources"></a><span data-ttu-id="d1021-136">Prostředky zrcadlení databáze</span><span class="sxs-lookup"><span data-stu-id="d1021-136">Database Mirroring Resources</span></span>  
 <span data-ttu-id="d1021-137">Rámcová dokumentace a informace o konfiguraci nasazování a správě zrcadlení, naleznete v následujících zdrojích v SQL Server Books Online.</span><span class="sxs-lookup"><span data-stu-id="d1021-137">For conceptual documentation and information on configuring, deploying and administering mirroring, see the following resources in SQL Server Books Online.</span></span>  
  
|<span data-ttu-id="d1021-138">Prostředek</span><span class="sxs-lookup"><span data-stu-id="d1021-138">Resource</span></span>|<span data-ttu-id="d1021-139">Popis</span><span class="sxs-lookup"><span data-stu-id="d1021-139">Description</span></span>|  
|--------------|-----------------|  
|<span data-ttu-id="d1021-140">[Zrcadlení databáze](http://msdn.microsoft.com/library/bb934127.aspx) v Online knihách serveru SQL</span><span class="sxs-lookup"><span data-stu-id="d1021-140">[Database Mirroring](http://msdn.microsoft.com/library/bb934127.aspx) in SQL Server Books Online</span></span>|<span data-ttu-id="d1021-141">Popisuje, jak nastavit a konfigurovat zrcadlení v systému SQL Server.</span><span class="sxs-lookup"><span data-stu-id="d1021-141">Describes how to set up and configure mirroring in SQL Server.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="d1021-142">Viz také</span><span class="sxs-lookup"><span data-stu-id="d1021-142">See Also</span></span>  
 [<span data-ttu-id="d1021-143">ADO.NET spravované zprostředkovatelé a středisku pro vývojáře datové sady</span><span class="sxs-lookup"><span data-stu-id="d1021-143">ADO.NET Managed Providers and DataSet Developer Center</span></span>](http://go.microsoft.com/fwlink/?LinkId=217917)
