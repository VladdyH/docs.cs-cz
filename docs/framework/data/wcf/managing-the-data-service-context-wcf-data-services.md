---
title: Správa služby kontextu dat (služby WCF Data Services)
ms.date: 03/30/2017
ms.assetid: 15b19d09-7de7-4638-9556-6ef396cc45ec
ms.openlocfilehash: 9b2b0bb709081ca7b0b2a1367f10e1f7a08c98c9
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 05/04/2018
ms.locfileid: "33365225"
---
# <a name="managing-the-data-service-context-wcf-data-services"></a>Správa služby kontextu dat (služby WCF Data Services)
<xref:System.Data.Services.Client.DataServiceContext> Třída zapouzdří operace, které jsou podporovány službě zadaná data. I když [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] jsou bezstavové služby, není kontextu. Proto můžete použít <xref:System.Data.Services.Client.DataServiceContext> třídy pro uchování stavu na straně klienta mezi interakce s službu data za účelem podpory funkcí, jako například Správa změn. Tato třída také spravuje identit a sleduje změny.  
  
## <a name="merge-options-and-identity-resolution"></a>Možnosti sloučení a řešení Identity  
 Když <xref:System.Data.Services.Client.DataServiceQuery%601> je proveden, entity v odpovědi kanálu materializována do objektů. Další informace najdete v tématu [Materialization objekt](../../../../docs/framework/data/wcf/object-materialization-wcf-data-services.md). Způsob, ve kterém jsou položky ve zprávě odpovědi materializována do objektů se provádí v závislosti na řešení identity a závisí na možnosti sloučení, pod kterým byl proveden dotaz. Když více dotazy nebo zatížení požadavky jsou spouštěny v oboru jedné <xref:System.Data.Services.Client.DataServiceContext>, [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] klienta sleduje pouze jednu instanci objektu s konkrétní hodnotou klíče. Tento klíč, který se používá k provádění řešení identity, jednoznačně identifikuje entity.  
  
 Ve výchozím nastavení, klient pouze bude realizována položku v odpovědi informačního kanálu do objektu entity, které nejsou již sledován pomocí <xref:System.Data.Services.Client.DataServiceContext>. To znamená, že se nepřepíšou změny objekty již v mezipaměti. Toto chování je řízen zadáním <xref:System.Data.Services.Client.MergeOption> hodnotu pro dotazy a operace načtení. Tato možnost je určený nastavením <xref:System.Data.Services.Client.DataServiceContext.MergeOption%2A> vlastnost <xref:System.Data.Services.Client.DataServiceContext>. Možnost sloučení výchozí hodnota je <xref:System.Data.Services.Client.MergeOption.AppendOnly>. To jenom bude realizována objekty pro entity, které nejsou již sledován, což znamená, že nejsou přepsat stávající objekty. Jiný způsob, jak zabránit změny k objektům v klientovi nepřepsal aktualizace ze služby dat slouží k zadání <xref:System.Data.Services.Client.MergeOption.PreserveChanges>. Pokud zadáte <xref:System.Data.Services.Client.MergeOption.OverwriteChanges>, hodnoty objektů na straně klienta jsou nahrazovány nejnovější hodnoty z položek v informačním kanálu odpovědi i v případě, že už byly provedeny změny těchto objektů. Když <xref:System.Data.Services.Client.MergeOption.NoTracking> možnost sloučení se používá, <xref:System.Data.Services.Client.DataServiceContext> nelze odeslat změny provedené u objektů klienta ke službě data. Pomocí této možnosti se změny vždy přepíší hodnotami z službu data.  
  
## <a name="managing-concurrency"></a>Správa souběžnosti  
 [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] podporuje optimistickou metodu souběžného, který povoluje službu data ke zjištění konfliktu aktualizace. Zprostředkovatel dat služby lze nakonfigurovat tak, že služba data vyhledává změny entity pomocí token souběžnosti. Tento token obsahuje jednu nebo více vlastností typu entity, které se ověřují pomocí služby data k určení, zda došlo ke změně prostředku. Tokeny souběžnosti, které jsou součástí hlavičku eTag žádostí a odpovědí z službu data, jsou spravovaná pomocí [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] klienta. Další informace najdete v tématu [aktualizaci dat služby](../../../../docs/framework/data/wcf/updating-the-data-service-wcf-data-services.md).  
  
 <xref:System.Data.Services.Client.DataServiceContext> Sleduje změny provedené u objektů, které byly ručně nahlášeny pomocí <xref:System.Data.Services.Client.DataServiceContext.AddObject%2A>, <xref:System.Data.Services.Client.DataServiceContext.UpdateObject%2A>, a <xref:System.Data.Services.Client.DataServiceContext.DeleteObject%2A>, nebo <xref:System.Data.Services.Client.DataServiceCollection%601>. Když <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> metoda je volána, klient odešle změny zpět na službu data. <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> může selhat, pokud změny dat v klientovi v konfliktu s změny ve službě data. V takovém případě musí dotaz pro daný prostředek entity znovu a přijímat data aktualizace. Chcete-li přepsat změny ve službě data, spustit dotaz pomocí <xref:System.Data.Services.Client.MergeOption.PreserveChanges> merge – možnost. Při volání <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> znovu, jsou změny zachovaná v klientovi trvalé ke službě data tak dlouho, dokud k prostředku ve službě dat nebyly již provedeny další změny.  
  
## <a name="saving-changes"></a>Ukládají se změny  
 Změny jsou sledovány v <xref:System.Data.Services.Client.DataServiceContext> instance však nebyla odeslána na server okamžitě. Po skončení požadované změny pro zadanou aktivitu, volat <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> odeslat všechny změny ve službě data. A <xref:System.Data.Services.Client.DataServiceResponse> objektu se vrátí po <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> bylo dokončeno. <xref:System.Data.Services.Client.DataServiceResponse> Objekt zahrnuje posloupnost <xref:System.Data.Services.Client.OperationResponse> objektů, které se pak obsahují posloupnost <xref:System.Data.Services.Client.EntityDescriptor> nebo <xref:System.Data.Services.Client.LinkDescriptor> instancí, které představují změny trvalé, nebo k pokusu o. Při vytvoření nebo úpravě ve službě data entity <xref:System.Data.Services.Client.EntityDescriptor> obsahuje odkaz na aktualizovanou entitu, včetně všechny hodnoty generované serverem vlastností, jako je například vygenerovaného `ProductID` hodnota v předchozím příkladu. Klientská knihovna automaticky aktualizuje [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] objekt, který chcete mít tyto nové hodnoty.  
  
 Pro úspěšné insert a operace aktualizace, vlastnost state <xref:System.Data.Services.Client.EntityDescriptor> nebo <xref:System.Data.Services.Client.LinkDescriptor> objekt přidružený k operaci je nastavena na <xref:System.Data.Services.Client.EntityStates.Unchanged> a nové hodnoty jsou sloučeny s použitím <xref:System.Data.Services.Client.MergeOption.OverwriteChanges>. Když typu vložení, aktualizace nebo odstranění operace selže ve službě data, stav entity zůstává stejná jako byl před <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> byla volána a <xref:System.Data.Services.Client.OperationResponse.Error%2A> vlastnost <xref:System.Data.Services.Client.OperationResponse> je nastaven na <xref:System.Data.Services.Client.DataServiceRequestException> obsahující informace o došlo k chybě. Další informace najdete v tématu [aktualizaci dat služby](../../../../docs/framework/data/wcf/updating-the-data-service-wcf-data-services.md).  
  
### <a name="setting-the-http-method-for-updates"></a>Nastavení metoda HTTP pro aktualizace  
 Ve výchozím nastavení odešle klientské knihovny rozhraní .NET Framework aktualizace stávající entity jako požadavky SLOUČENÍ. Požadavek SLOUČENÍ aktualizací vybraných vlastností entity; Klient ale vždycky obsahuje všechny vlastnosti v žádosti o SLOUČENÍ, i vlastnosti, které nebyly změněny. [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] Protokol také podporuje odesílání žádosti PUT k aktualizaci entity. V požadavku PUT se stávající entitu v podstatě nahradí novou instanci třídy entita se hodnoty vlastností z klienta. Chcete-li použít požadavky PUT, nastavte <xref:System.Data.Services.Client.SaveChangesOptions.ReplaceOnUpdate> příznak na <xref:System.Data.Services.Client.SaveChangesOptions> výčtu při volání metody <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A>.  
  
> [!NOTE]
>  Požadavek PUT budou chovat jinak než požadavek SLOUČENÍ, pokud klient nebude vědět o všech vlastností entity. Tomu může dojít při projekci typ entity do nového typu na straně klienta. Může také nastat, pokud byly přidány nové vlastnosti do entity v datovém modelu služby a <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> vlastnost <xref:System.Data.Services.Client.DataServiceContext> je nastaven na `true` ignorovat takové chyby mapování klienta. V těchto případech požadavek PUT resetuje všechny vlastnosti, které jsou pro nástroj neznámé klienta na výchozí hodnoty.  
  
### <a name="post-tunneling"></a>Tunelové propojení POST  
 Ve výchozím nastavení, odešle knihovny klienta vytvářet, číst, aktualizovat a odstranit žádosti o [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] pomocí odpovídající metody HTTP POST, GET, PUT/MERGE nebo opravy služeb a odstranění. To podporuje základní principy z přenosu REST (Representational State). Ne každý implementaci serveru pro webové však podporuje úplnou sadu metod HTTP. V některých případech může být omezené na právě GET a POST podporovaných metod. To může dojít v případě zprostředkovatele, jako je brána firewall blokuje požadavky u některých metod. Protože jsou nejčastěji podporované metody GET a POST, [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] předepisuje způsob, jak spouštět žádné nepodporované metody HTTP pomocí požadavek POST. Označuje jako *tunelování metod* nebo *POST tunelování*, to umožňuje klientovi umožní odeslat požadavek POST s skutečné metody popsané v vlastní `X-HTTP-Method` záhlaví. Chcete-li povolit pro požadavky POST vynucoval tunelové připojení, nastavte <xref:System.Data.Services.Client.DataServiceContext.UsePostTunneling%2A> vlastnost na <xref:System.Data.Services.Client.DataServiceContext> instance k `true`.  
  
## <a name="see-also"></a>Viz také  
 [Klientská knihovna pro WCF Data Services](../../../../docs/framework/data/wcf/wcf-data-services-client-library.md)  
 [Aktualizace datové služby](../../../../docs/framework/data/wcf/updating-the-data-service-wcf-data-services.md)  
 [Asynchronní operace](../../../../docs/framework/data/wcf/asynchronous-operations-wcf-data-services.md)  
 [Operace dávkování](../../../../docs/framework/data/wcf/batching-operations-wcf-data-services.md)
