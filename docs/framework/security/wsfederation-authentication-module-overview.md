---
title: "Přehled modulu ověřování WSFederation"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 02c4d5e8-f0a7-49ee-9cf5-3647578510ad
caps.latest.revision: "6"
author: BrucePerlerMS
ms.author: bruceper
manager: mbaldwin
ms.openlocfilehash: ea17e384ecb4536ed544e3b874631db6fe54e0e1
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 11/21/2017
---
# <a name="wsfederation-authentication-module-overview"></a><span data-ttu-id="ec65f-102">Přehled modulu ověřování WSFederation</span><span class="sxs-lookup"><span data-stu-id="ec65f-102">WSFederation Authentication Module Overview</span></span>
<span data-ttu-id="ec65f-103">Windows Identity Foundation (WIF) zahrnuje podpory federovaného ověřování v aplikacích ASP.NET prostřednictvím modulu ověřování WS-Federated (WS-služba FAM).</span><span class="sxs-lookup"><span data-stu-id="ec65f-103">Windows Identity Foundation (WIF) includes support for federated authentication in ASP.NET applications through the WS-Federated Authentication Module (WS-FAM).</span></span> <span data-ttu-id="ec65f-104">Toto téma vám pomůže pochopit, jak federovaného ověřování funguje a jak ji používat.</span><span class="sxs-lookup"><span data-stu-id="ec65f-104">This topic will help you understand how federated authentication works and how to use it.</span></span>  
  
### <a name="overview-of-federated-authentication"></a><span data-ttu-id="ec65f-105">Přehled federovaného ověřování</span><span class="sxs-lookup"><span data-stu-id="ec65f-105">Overview of Federated Authentication</span></span>  
 <span data-ttu-id="ec65f-106">Federované ověřování umožňuje zabezpečení tokenu služby (STS) v jedné doméně vztah důvěryhodnosti k poskytnutí informací ověřování služby tokenů zabezpečení v jiné doméně vztahu důvěryhodnosti, pokud je mezi těmito dvěma doménami vztah důvěryhodnosti.</span><span class="sxs-lookup"><span data-stu-id="ec65f-106">Federated authentication allows a Security Token Service (STS) in one trust domain to provide authentication information to an STS in another trust domain when there is a trust relationship between the two domains.</span></span> <span data-ttu-id="ec65f-107">Příkladem je znázorněno na následujícím obrázku.</span><span class="sxs-lookup"><span data-stu-id="ec65f-107">An example of this is shown in the following illustration.</span></span>  
  
 <span data-ttu-id="ec65f-108">![Scénář ověřování federace](../../../docs/framework/security/media/federatedauthentication.gif "FederatedAuthentication")</span><span class="sxs-lookup"><span data-stu-id="ec65f-108">![Federation Authentication Scenario](../../../docs/framework/security/media/federatedauthentication.gif "FederatedAuthentication")</span></span>  
  
1.  <span data-ttu-id="ec65f-109">Klienta ve vztahu důvěryhodnosti domény Fabrikam odešle požadavek na aplikaci předávající strany (RP) v doméně Contoso vztah důvěryhodnosti.</span><span class="sxs-lookup"><span data-stu-id="ec65f-109">A client in the Fabrikam trust domain sends a request to a Relying Party (RP) application in the Contoso trust domain.</span></span>  
  
2.  <span data-ttu-id="ec65f-110">RP přesměruje klienta do služby tokenů zabezpečení v doméně Contoso vztah důvěryhodnosti.</span><span class="sxs-lookup"><span data-stu-id="ec65f-110">The RP redirects the client to an STS in the Contoso trust domain.</span></span> <span data-ttu-id="ec65f-111">Tato služba tokenů zabezpečení nemá žádné informace o klientovi.</span><span class="sxs-lookup"><span data-stu-id="ec65f-111">This STS has no knowledge of the client.</span></span>  
  
3.  <span data-ttu-id="ec65f-112">Služba tokenů zabezpečení Contoso přesměruje klienta do služby tokenů zabezpečení v doméně Fabrikam vztahu důvěryhodnosti, pomocí kterého vztahu důvěryhodnosti domény Contoso má vztah důvěryhodnosti.</span><span class="sxs-lookup"><span data-stu-id="ec65f-112">The Contoso STS redirects the client to an STS in the Fabrikam trust domain, with which the Contoso trust domain has a trust relationship.</span></span>  
  
4.  <span data-ttu-id="ec65f-113">Služba tokenů zabezpečení Fabrikam ověří identitu klienta a vydá token zabezpečení na službu STS Contoso.</span><span class="sxs-lookup"><span data-stu-id="ec65f-113">The Fabrikam STS verifies the client’s identity and issues a security token to the Contoso STS.</span></span>  
  
5.  <span data-ttu-id="ec65f-114">Služba tokenů zabezpečení Contoso použije Fabrikam token k vytvoření vlastního tokenu, které mohou být využívána RP a odešle ji do RP.</span><span class="sxs-lookup"><span data-stu-id="ec65f-114">The Contoso STS uses the Fabrikam token to create its own token that can be used by the RP and sends it to the RP.</span></span>  
  
6.  <span data-ttu-id="ec65f-115">RP extrahuje klienta deklarací z tokenu zabezpečení a provádí rozhodnutí o autorizaci.</span><span class="sxs-lookup"><span data-stu-id="ec65f-115">The RP extracts the client’s claims from the security token and makes an authorization decision.</span></span>  
  
### <a name="using-the-federated-authentication-module-with-aspnet"></a><span data-ttu-id="ec65f-116">Modul federovaného ověřování pomocí technologie ASP.NET</span><span class="sxs-lookup"><span data-stu-id="ec65f-116">Using the Federated Authentication Module with ASP.NET</span></span>  
 <span data-ttu-id="ec65f-117"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule>(WS-služba FAM) je modul protokolu HTTP, která umožňuje přidat federovaného ověřování pro [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] aplikace.</span><span class="sxs-lookup"><span data-stu-id="ec65f-117"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule> (WS-FAM) is an HTTP module that lets you add federated authentication to an [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] application.</span></span> <span data-ttu-id="ec65f-118">Federované ověřování umožňuje zpracovávat služby tokenů zabezpečení a vám umožní soustředit na obchodní logiku zápis logiku ověřování.</span><span class="sxs-lookup"><span data-stu-id="ec65f-118">Federated authentication lets authentication logic be handled by the STS and lets you focus on writing business logic.</span></span>  
  
 <span data-ttu-id="ec65f-119">Můžete nakonfigurovat WS-služba FAM k určení tokenů zabezpečení, které chcete použít k přesměrování neověřené požadavky.</span><span class="sxs-lookup"><span data-stu-id="ec65f-119">You configure the WS-FAM to specify the STS to which non-authenticated requests should be redirected.</span></span> <span data-ttu-id="ec65f-120">WIF umožňuje ověření uživatele dvěma způsoby:</span><span class="sxs-lookup"><span data-stu-id="ec65f-120">WIF lets you authenticate a user in two ways:</span></span>  
  
1.  <span data-ttu-id="ec65f-121">Pasivní přesměrování: když neověřený uživatel pokusí o přístup k chráněnému prostředku a chcete jednoduše přesměruje je to služby tokenů zabezpečení bez nutnosti přihlašovací stránku a pak toto je správný přístup.</span><span class="sxs-lookup"><span data-stu-id="ec65f-121">Passive redirect: When an unauthenticated user tries to access a protected resource, and you want to simply redirect them to an STS without requiring a login page, then this is the right approach.</span></span> <span data-ttu-id="ec65f-122">Služba tokenů zabezpečení ověřuje identitu uživatele a vydá token zabezpečení, který obsahuje odpovídající deklarace identity pro daného uživatele.</span><span class="sxs-lookup"><span data-stu-id="ec65f-122">The STS verifies the user’s identity, and issues a security token that contains the appropriate claims for that user.</span></span> <span data-ttu-id="ec65f-123">Tato možnost vyžaduje WS-služba FAM k přidání do modulů HTTP v kanálu.</span><span class="sxs-lookup"><span data-stu-id="ec65f-123">This option requires the WS-FAM to be added in the HTTP Modules pipeline.</span></span> <span data-ttu-id="ec65f-124">Identita a přístup pro sadu Visual Studio 2012 můžete použít k úpravě souboru konfigurace aplikace k používání protokolu WS-služba FAM a vytvořit federaci s služby tokenů zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="ec65f-124">You can use the Identity and Access Tool for Visual Studio 2012 to modify your application’s configuration file to use the WS-FAM and to federate with an STS.</span></span> <span data-ttu-id="ec65f-125">Další informace najdete v tématu [identita a přístup pro sadu Visual Studio 2012](../../../docs/framework/security/identity-and-access-tool-for-vs.md).</span><span class="sxs-lookup"><span data-stu-id="ec65f-125">For more information, see [Identity and Access Tool for Visual Studio 2012](../../../docs/framework/security/identity-and-access-tool-for-vs.md).</span></span>  
  
2.  <span data-ttu-id="ec65f-126">Můžete volat <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignIn%2A?displayProperty=nameWithType> metoda nebo <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectToIdentityProvider%2A> z modelu code-behind metodu pro přihlašovací stránku ve vaší aplikaci RP.</span><span class="sxs-lookup"><span data-stu-id="ec65f-126">You can call the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignIn%2A?displayProperty=nameWithType> method or the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectToIdentityProvider%2A> method from the code-behind for a sign-in page in your RP application.</span></span>  
  
 <span data-ttu-id="ec65f-127">V pasivním přesměrování veškerá komunikace probíhá prostřednictvím odpovědi či přesměrování z klienta (obvykle prohlížeč).</span><span class="sxs-lookup"><span data-stu-id="ec65f-127">In passive redirect, all communication is performed through response/redirect from the client (typically a browser).</span></span> <span data-ttu-id="ec65f-128">Služba WS-FAM můžete přidat do kanálu vaší aplikace HTTP, kde ji sleduje pro neověřené uživatele požadavky a přesměruje uživatele na službu STS zadáte.</span><span class="sxs-lookup"><span data-stu-id="ec65f-128">You can add the WS-FAM to your application’s HTTP pipeline, where it watches for unauthenticated user requests and redirects users to the STS you specify.</span></span>  
  
 <span data-ttu-id="ec65f-129">Služba WS-FAM také vyvolá několik událostí, které umožňují přizpůsobit její funkce v [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] aplikace.</span><span class="sxs-lookup"><span data-stu-id="ec65f-129">The WS-FAM also raises several events that let you customize its functionality in an [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] application.</span></span>  
  
### <a name="how-the-ws-fam-works"></a><span data-ttu-id="ec65f-130">Jak funguje služba FAM WS</span><span class="sxs-lookup"><span data-stu-id="ec65f-130">How the WS-FAM Works</span></span>  
 <span data-ttu-id="ec65f-131">Služba WS-FAM je implementována ve <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> třídy.</span><span class="sxs-lookup"><span data-stu-id="ec65f-131">The WS-FAM is implemented in the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> class.</span></span> <span data-ttu-id="ec65f-132">Obvykle WS-služba FAM přidáte do kanálu HTTP z vaší [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] RP aplikace.</span><span class="sxs-lookup"><span data-stu-id="ec65f-132">Typically, you add the WS-FAM to the HTTP pipeline of your [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] RP application.</span></span> <span data-ttu-id="ec65f-133">Když neověřený uživatel pokusí o přístup k chráněnému prostředku, RP vrátí odpověď HTTP "401 autorizace byl odepřen".</span><span class="sxs-lookup"><span data-stu-id="ec65f-133">When an unauthenticated user tries to access a protected resource, the RP returns a "401 authorization denied" HTTP response.</span></span> <span data-ttu-id="ec65f-134">Služba WS-FAM zachycuje této odpovědi namísto umožnil tak klientovi ji přijmou a potom ho přesměruje uživatele na zadané služby tokenů zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="ec65f-134">The WS-FAM intercepts this response instead of allowing the client to receive it, then it redirects the user to the specified STS.</span></span> <span data-ttu-id="ec65f-135">Služba tokenů zabezpečení vydává tokeny zabezpečení, které služba WS-FAM zachycuje znovu.</span><span class="sxs-lookup"><span data-stu-id="ec65f-135">The STS issues a security token, which the WS-FAM again intercepts.</span></span> <span data-ttu-id="ec65f-136">Služba WS-FAM použije token pro vytvoření instance <xref:System.Security.Claims.ClaimsPrincipal> ověřeného uživatele, což umožňuje regular [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] mechanismy ověřování fungovat.</span><span class="sxs-lookup"><span data-stu-id="ec65f-136">The WS-FAM uses the token to create an instance of <xref:System.Security.Claims.ClaimsPrincipal> for the authenticated user, which enables regular [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] authorization mechanisms to function.</span></span>  
  
 <span data-ttu-id="ec65f-137">Vzhledem k tomu, že HTTP bezstavové, potřebujeme způsob, jak se vyhnout opakováním tohoto celého procesu pokaždé, když se uživatel pokusí o přístup k jiné chráněného prostředku.</span><span class="sxs-lookup"><span data-stu-id="ec65f-137">Because HTTP is stateless, we need a way to avoid repeating this whole process every time that the user tries to access another protected resource.</span></span> <span data-ttu-id="ec65f-138">To je, kdy <xref:System.IdentityModel.Services.SessionAuthenticationModule> odeslán.</span><span class="sxs-lookup"><span data-stu-id="ec65f-138">This is where the <xref:System.IdentityModel.Services.SessionAuthenticationModule> comes in.</span></span> <span data-ttu-id="ec65f-139">Když služba tokenů zabezpečení vydá token zabezpečení pro uživatele, <xref:System.IdentityModel.Services.SessionAuthenticationModule> také vytvoří token zabezpečení relace pro uživatele a vloží ho do souboru cookie.</span><span class="sxs-lookup"><span data-stu-id="ec65f-139">When the STS issues a security token for the user, <xref:System.IdentityModel.Services.SessionAuthenticationModule> also creates a session security token for the user and puts it in a cookie.</span></span> <span data-ttu-id="ec65f-140">Na další požadavky <xref:System.IdentityModel.Services.SessionAuthenticationModule> zachycuje tento soubor cookie a použije ho k rekonstrukci uživatele <xref:System.Security.Claims.ClaimsPrincipal>.</span><span class="sxs-lookup"><span data-stu-id="ec65f-140">On subsequent requests, the <xref:System.IdentityModel.Services.SessionAuthenticationModule> intercepts this cookie and uses it to reconstruct the user’s <xref:System.Security.Claims.ClaimsPrincipal>.</span></span>  
  
 <span data-ttu-id="ec65f-141">Následující diagram znázorňuje celkové toku informací v případě, že pasivní přesměrování.</span><span class="sxs-lookup"><span data-stu-id="ec65f-141">The following diagram shows the overall flow of information in the passive redirect case.</span></span> <span data-ttu-id="ec65f-142">Je žádost přesměrována automaticky prostřednictvím služby tokenů zabezpečení vytvořit přihlašovací údaje bez přihlašovací stránky:</span><span class="sxs-lookup"><span data-stu-id="ec65f-142">The request is automatically redirected via the STS to establish credentials without a login page:</span></span>  
  
 <span data-ttu-id="ec65f-143">![Diagram časování pro přihlašování & č. 45; pomocí pasivní přesměrování](../../../docs/framework/security/media/signinusingpassiveredirect.gif "SignInUsingPassiveRedirect")</span><span class="sxs-lookup"><span data-stu-id="ec65f-143">![Timing diagram for sign&#45;in with passive redirect](../../../docs/framework/security/media/signinusingpassiveredirect.gif "SignInUsingPassiveRedirect")</span></span>  
  
 <span data-ttu-id="ec65f-144">Následující diagram znázorňuje podrobněji na co se stane, když uživatel byl ověřen na službu STS a jejich tokeny zabezpečení jsou zpracovány <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>:</span><span class="sxs-lookup"><span data-stu-id="ec65f-144">The following diagram shows more detail on what happens when the user has authenticated to the STS and their security tokens are processed by the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>:</span></span>  
  
 <span data-ttu-id="ec65f-145">![Časování pro zpracování tokenu s pasivní přesměrování](../../../docs/framework/security/media/signinusingpassiveredirect-tokenprocessing.gif "SignInUsingPassiveRedirect_TokenProcessing")</span><span class="sxs-lookup"><span data-stu-id="ec65f-145">![Timing for token processing with passive redirect](../../../docs/framework/security/media/signinusingpassiveredirect-tokenprocessing.gif "SignInUsingPassiveRedirect_TokenProcessing")</span></span>  
  
 <span data-ttu-id="ec65f-146">Následující diagram znázorňuje podrobněji na co se stane, když tokeny zabezpečení uživatele byl serializován do souborů cookie a jsou zachycen <xref:System.IdentityModel.Services.SessionAuthenticationModule>:</span><span class="sxs-lookup"><span data-stu-id="ec65f-146">The following diagram shows more detail on what happens when the user’s security tokens have been serialized into cookies and are intercepted by the <xref:System.IdentityModel.Services.SessionAuthenticationModule>:</span></span>  
  
 <span data-ttu-id="ec65f-147">![SAM časování diagram znázorňující přihlašovací & č. 45; v použití ovládacích prvků](../../../docs/framework/security/media/signinusingconrols-sam.gif "SignInUsingConrols_SAM")</span><span class="sxs-lookup"><span data-stu-id="ec65f-147">![SAM timing diagram showing sign&#45;in using controls](../../../docs/framework/security/media/signinusingconrols-sam.gif "SignInUsingConrols_SAM")</span></span>  
  
### <a name="events"></a><span data-ttu-id="ec65f-148">Události</span><span class="sxs-lookup"><span data-stu-id="ec65f-148">Events</span></span>  
 <span data-ttu-id="ec65f-149"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule>, <xref:System.IdentityModel.Services.SessionAuthenticationModule>a jejich nadřazené třídy <xref:System.IdentityModel.Services.HttpModuleBase>, vyvolávání událostí v různých fázích zpracování požadavku HTTP.</span><span class="sxs-lookup"><span data-stu-id="ec65f-149"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule>, <xref:System.IdentityModel.Services.SessionAuthenticationModule>, and their parent class, <xref:System.IdentityModel.Services.HttpModuleBase>, raise events at various stages of processing of an HTTP request.</span></span> <span data-ttu-id="ec65f-150">Dokáže zpracovat tyto události v `global.asax` soubor vaší [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] aplikace.</span><span class="sxs-lookup"><span data-stu-id="ec65f-150">You can handle these events in the `global.asax` file of your [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] application.</span></span>  
  
-   <span data-ttu-id="ec65f-151">Infrastruktury ASP.NET vyvolá modulu <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> metoda k chybě při inicializaci modulu.</span><span class="sxs-lookup"><span data-stu-id="ec65f-151">The ASP.NET infrastructure invokes the module’s <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> method to initialize the module.</span></span>  
  
-   <span data-ttu-id="ec65f-152"><xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfigurationCreated?displayProperty=nameWithType> Událost se vyvolá, když vyvolá infrastruktury ASP.NET <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> metoda poprvé na jeden z modulů aplikace, které jsou odvozeny od <xref:System.IdentityModel.Services.HttpModuleBase>.</span><span class="sxs-lookup"><span data-stu-id="ec65f-152">The <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfigurationCreated?displayProperty=nameWithType> event is raised when the ASP.NET infrastructure invokes the <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> method for the first time on one of the application’s modules that derive from <xref:System.IdentityModel.Services.HttpModuleBase>.</span></span> <span data-ttu-id="ec65f-153">Tato metoda umožňuje přístup statických <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfiguration%2A?displayProperty=nameWithType> vlastnost, což způsobí, že konfigurace být načtená ze souboru Web.config.</span><span class="sxs-lookup"><span data-stu-id="ec65f-153">This method accesses the static <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfiguration%2A?displayProperty=nameWithType> property, which causes configuration to be loaded from the Web.config file.</span></span> <span data-ttu-id="ec65f-154">Tato událost je aktivována pouze při prvním získat přístup k této vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="ec65f-154">This event is only raised the first time this property is accessed.</span></span> <span data-ttu-id="ec65f-155"><xref:System.IdentityModel.Services.Configuration.FederationConfiguration> Objekt, který je inicializován ze konfigurace je možné přistupovat prostřednictvím <xref:System.IdentityModel.Services.Configuration.FederationConfigurationCreatedEventArgs.FederationConfiguration%2A?displayProperty=nameWithType> vlastnost v obslužné rutiny události.</span><span class="sxs-lookup"><span data-stu-id="ec65f-155">The <xref:System.IdentityModel.Services.Configuration.FederationConfiguration> object that is initialized from configuration can be accessed through the <xref:System.IdentityModel.Services.Configuration.FederationConfigurationCreatedEventArgs.FederationConfiguration%2A?displayProperty=nameWithType> property in an event handler.</span></span> <span data-ttu-id="ec65f-156">Tato událost můžete použít ke změně konfigurace předtím, než se použije pro všechny moduly.</span><span class="sxs-lookup"><span data-stu-id="ec65f-156">You can use this event to modify the configuration before it is applied to any modules.</span></span> <span data-ttu-id="ec65f-157">Obslužnou rutinu pro tuto událost můžete přidat do metody Application_Start:</span><span class="sxs-lookup"><span data-stu-id="ec65f-157">You can add a handler for this event in the Application_Start method:</span></span>  
  
    ```  
    void Application_Start(object sender, EventArgs e)  
    {  
        FederatedAuthentication.FederationConfigurationCreated += new EventHandler<FederationConfigurationCreatedEventArgs>(FederatedAuthentication_FederationConfigurationCreated);  
    }  
    ```  
  
     <span data-ttu-id="ec65f-158">Každý modul přepsání <xref:System.IdentityModel.Services.HttpModuleBase.InitializeModule%2A?displayProperty=nameWithType> a <xref:System.IdentityModel.Services.HttpModuleBase.InitializePropertiesFromConfiguration%2A?displayProperty=nameWithType> abstraktní metody.</span><span class="sxs-lookup"><span data-stu-id="ec65f-158">Each module overrides the <xref:System.IdentityModel.Services.HttpModuleBase.InitializeModule%2A?displayProperty=nameWithType> and <xref:System.IdentityModel.Services.HttpModuleBase.InitializePropertiesFromConfiguration%2A?displayProperty=nameWithType> abstract methods.</span></span> <span data-ttu-id="ec65f-159">První z těchto metod přidá obslužné rutiny pro události kanálu ASP.NET, které jsou důležité pro modul.</span><span class="sxs-lookup"><span data-stu-id="ec65f-159">The first of these methods adds handlers for ASP.NET pipeline events that are of interest to the module.</span></span> <span data-ttu-id="ec65f-160">Ve většině případů bude stačit výchozí implementace modulu.</span><span class="sxs-lookup"><span data-stu-id="ec65f-160">In most cases the module’s default implementation will suffice.</span></span> <span data-ttu-id="ec65f-161">Druhá z těchto metod inicializuje vlastnosti modulu z jeho <xref:System.IdentityModel.Services.HttpModuleBase.FederationConfiguration%2A?displayProperty=nameWithType> vlastnost.</span><span class="sxs-lookup"><span data-stu-id="ec65f-161">The second of these methods initializes the module’s properties from its <xref:System.IdentityModel.Services.HttpModuleBase.FederationConfiguration%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="ec65f-162">(Toto je kopie konfigurace, která byla načtena dříve). Budete muset přepsání této druhé metody, pokud chcete zajistit podporu Inicializace nové vlastnosti z konfigurace v třídy, které jsou odvozeny od <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> nebo <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="ec65f-162">(This is a copy of the configuration that was loaded previously.) You may need to override this second method if you want to support the initialization of new properties from configuration in classes that you derive from <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> or <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span></span> <span data-ttu-id="ec65f-163">V takových případech by také potřebujete odvozena od objekty odpovídající konfiguraci pro podporu přidání konfigurační vlastnosti; například z <xref:System.IdentityModel.Configuration.IdentityConfiguration>, <xref:System.IdentityModel.Services.Configuration.WsFederationConfiguration>, nebo <xref:System.IdentityModel.Services.Configuration.FederationConfiguration>.</span><span class="sxs-lookup"><span data-stu-id="ec65f-163">In such cases you would also need to derive from the appropriate configuration objects to support the added configuration properties; for example, from <xref:System.IdentityModel.Configuration.IdentityConfiguration>, <xref:System.IdentityModel.Services.Configuration.WsFederationConfiguration>, or <xref:System.IdentityModel.Services.Configuration.FederationConfiguration>.</span></span>  
  
-   <span data-ttu-id="ec65f-164">Služba WS-FAM vyvolá <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenReceived> událost v případě zachycuje token zabezpečení, který byl vystaven službou tokenů zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="ec65f-164">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenReceived> event when it intercepts a security token that has been issued by the STS.</span></span>  
  
-   <span data-ttu-id="ec65f-165">Služba WS-FAM vyvolá <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenValidated> událostí po ověřila token.</span><span class="sxs-lookup"><span data-stu-id="ec65f-165">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenValidated> event after it has validated the token.</span></span>  
  
-   <span data-ttu-id="ec65f-166"><xref:System.IdentityModel.Services.SessionAuthenticationModule> Vyvolá <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenCreated> událost v případě, že vytvoří token zabezpečení relace pro uživatele.</span><span class="sxs-lookup"><span data-stu-id="ec65f-166">The <xref:System.IdentityModel.Services.SessionAuthenticationModule> raises the <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenCreated> event when it creates a session security token for the user.</span></span>  
  
-   <span data-ttu-id="ec65f-167"><xref:System.IdentityModel.Services.SessionAuthenticationModule> Vyvolá <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenReceived> událost v případě zachycuje následných žádostí pomocí souboru cookie, který obsahuje token zabezpečení relace.</span><span class="sxs-lookup"><span data-stu-id="ec65f-167">The <xref:System.IdentityModel.Services.SessionAuthenticationModule> raises the <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenReceived> event when it intercepts subsequent requests with the cookie that contains the session security token.</span></span>  
  
-   <span data-ttu-id="ec65f-168">Předtím, než služba WS-FAM přesměruje uživatele na vystavitele, vyvolá <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider> událostí.</span><span class="sxs-lookup"><span data-stu-id="ec65f-168">Before the WS-FAM redirects the user to the issuer, it raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider> event.</span></span> <span data-ttu-id="ec65f-169">Je k dispozici prostřednictvím služby WS-Federation přihlašovací požadavek <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs.SignInRequestMessage%2A> vlastnost <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs> předán v události.</span><span class="sxs-lookup"><span data-stu-id="ec65f-169">The WS-Federation sign-in request is available through the <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs.SignInRequestMessage%2A> property of the <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs> passed in the event.</span></span> <span data-ttu-id="ec65f-170">Můžete upravit žádost před odesíláním to vystavitele.</span><span class="sxs-lookup"><span data-stu-id="ec65f-170">You may choose to modify the request before sending this out to the issuer.</span></span>  
  
-   <span data-ttu-id="ec65f-171">Služba WS-FAM vyvolá <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignedIn> událost v případě, že soubor cookie je úspěšně zapsána a je přihlášený uživatel.</span><span class="sxs-lookup"><span data-stu-id="ec65f-171">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignedIn> event when the cookie is successfully written and the user is signed in.</span></span>  
  
-   <span data-ttu-id="ec65f-172">Služba WS-FAM vyvolá <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SigningOut> událostí jednou relace jako relace dochází k uzavření pro každého uživatele.</span><span class="sxs-lookup"><span data-stu-id="ec65f-172">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SigningOut> event one time per session as the session is being closed down for each user.</span></span> <span data-ttu-id="ec65f-173">Není vyvolána, pokud relace je ukončena na straně klienta (například odstraněním souboru cookie relace).</span><span class="sxs-lookup"><span data-stu-id="ec65f-173">It is not raised if the session is closed down on the client-side (for example, by deleting the session cookie).</span></span> <span data-ttu-id="ec65f-174">V prostředí, jednotné přihlašování tokenů zabezpečení IP může požádat o každé RP se odhlásíte, příliš.</span><span class="sxs-lookup"><span data-stu-id="ec65f-174">In an SSO environment, the IP-STS can request each RP to sign out, too.</span></span> <span data-ttu-id="ec65f-175">Tato událost to bude zároveň vyvolává s <xref:System.IdentityModel.Services.SigningOutEventArgs.IsIPInitiated%2A> nastavena na `true`.</span><span class="sxs-lookup"><span data-stu-id="ec65f-175">This will also raise this event, with <xref:System.IdentityModel.Services.SigningOutEventArgs.IsIPInitiated%2A> set to `true`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="ec65f-176">Neměli byste používat <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> vlastnost během všechny události vyvolané <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> nebo <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="ec65f-176">You should not use the <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> property during any event raised by <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> or <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span></span> <span data-ttu-id="ec65f-177">Důvodem je, že <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> je nastavena po dokončení procesu ověřování, přičemž události jsou vyvolány během procesu ověřování.</span><span class="sxs-lookup"><span data-stu-id="ec65f-177">This is because <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> is set after the authentication process, while events are raised during the authentication process.</span></span>  
  
### <a name="configuration-of-federated-authentication"></a><span data-ttu-id="ec65f-178">Konfigurace federovaného ověřování</span><span class="sxs-lookup"><span data-stu-id="ec65f-178">Configuration of Federated Authentication</span></span>  
 <span data-ttu-id="ec65f-179">Služba WS-FAM a SAM se konfigurují prostřednictvím [ \<federationConfiguration >](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md) element.</span><span class="sxs-lookup"><span data-stu-id="ec65f-179">The WS-FAM and SAM are configured through the [\<federationConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md) element.</span></span> <span data-ttu-id="ec65f-180">[ \<WsFederation >](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/wsfederation.md) podřízený element konfiguruje výchozí hodnoty pro vlastnosti Služba WS-FAM; jako <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Issuer%2A> vlastnost a <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Realm%2A> vlastnost.</span><span class="sxs-lookup"><span data-stu-id="ec65f-180">The [\<wsFederation>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/wsfederation.md) child element configures default values for the WS-FAM properties; such as the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Issuer%2A> property and the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Realm%2A> property.</span></span> <span data-ttu-id="ec65f-181">(Tyto hodnoty lze změnit na základě žádosti tím, že poskytuje obslužné rutiny pro některé události Služba WS-FAM; například <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider>.) Obslužná rutina souboru cookie, který je používán správce zabezpečení účtů se konfigurují prostřednictvím [ \<cookieHandler >](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/cookiehandler.md) podřízený element.</span><span class="sxs-lookup"><span data-stu-id="ec65f-181">(These values can be changed on a per request basis by providing handlers for some of the WS-FAM events; for example, <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider>.) The cookie handler that is used by the SAM is configured through the [\<cookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/cookiehandler.md) child element.</span></span> <span data-ttu-id="ec65f-182">WIF poskytuje výchozí soubor cookie obslužnou rutinu implementované v <xref:System.IdentityModel.Services.ChunkedCookieHandler> třídu, která může mít jeho velikost bloku nastavit pomocí [ \<chunkedCookieHandler >](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/chunkedcookiehandler.md) element.</span><span class="sxs-lookup"><span data-stu-id="ec65f-182">WIF provides a default cookie handler implemented in the <xref:System.IdentityModel.Services.ChunkedCookieHandler> class that can have its chunk size set through the [\<chunkedCookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/chunkedcookiehandler.md) element.</span></span> <span data-ttu-id="ec65f-183">`<federationConfiguration>` Element odkazy <xref:System.IdentityModel.Configuration.IdentityConfiguration>, který poskytuje konfiguraci pro jiné komponenty WIF použít v aplikaci, například <xref:System.Security.Claims.ClaimsAuthenticationManager> a <xref:System.Security.Claims.ClaimsAuthorizationManager>.</span><span class="sxs-lookup"><span data-stu-id="ec65f-183">The `<federationConfiguration>` element references an <xref:System.IdentityModel.Configuration.IdentityConfiguration>, which provides configuration for other WIF components used in the application, such as the <xref:System.Security.Claims.ClaimsAuthenticationManager> and the <xref:System.Security.Claims.ClaimsAuthorizationManager>.</span></span> <span data-ttu-id="ec65f-184">Konfigurace identity může být výslovně odkazována zadáním pojmenovaná [ \<identityConfiguration >](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/identityconfiguration.md) element v `identityConfigurationName` atribut `<federationConfiguration>` elementu.</span><span class="sxs-lookup"><span data-stu-id="ec65f-184">The identity configuration may be referenced explicitly by specifying a named [\<identityConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/identityconfiguration.md) element in the `identityConfigurationName` attribute of the `<federationConfiguration>` element.</span></span> <span data-ttu-id="ec65f-185">Pokud není výslovně odkazována konfigurace identity, použije se výchozí konfigurace identity.</span><span class="sxs-lookup"><span data-stu-id="ec65f-185">If the identity configuration is not referenced explicitly, the default identity configuration will be used.</span></span>  
  
 <span data-ttu-id="ec65f-186">Následující kód XML znázorňuje konfiguraci technologie ASP.NET předávající stranu aplikace.</span><span class="sxs-lookup"><span data-stu-id="ec65f-186">The following XML shows a configuration of an ASP.NET relying party (RP) application.</span></span> <span data-ttu-id="ec65f-187"><xref:System.IdentityModel.Configuration.SystemIdentityModelSection> a <xref:System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection> konfiguračních oddílů, které se přidají pod `<configSections>` elementu.</span><span class="sxs-lookup"><span data-stu-id="ec65f-187">The <xref:System.IdentityModel.Configuration.SystemIdentityModelSection> and <xref:System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection> configuration sections are added under the `<configSections>` element.</span></span> <span data-ttu-id="ec65f-188">SAM a služba WS-FAM jsou přidány do modulů HTTP v části `<system.webServer>` / `<modules>` element.</span><span class="sxs-lookup"><span data-stu-id="ec65f-188">The SAM and WS-FAM are added to the HTTP Modules under the `<system.webServer>`/`<modules>` element.</span></span> <span data-ttu-id="ec65f-189">Nakonec jsou komponenty WIF nakonfigurované v části `<system.identityModel>` / `<identityConfiguration>` a `<system.identityModel.services>` / `<federationConfiguration>` elementy.</span><span class="sxs-lookup"><span data-stu-id="ec65f-189">Finally the WIF components are configured under the `<system.identityModel>`/`<identityConfiguration>` and `<system.identityModel.services>`/`<federationConfiguration>` elements.</span></span> <span data-ttu-id="ec65f-190">Tato konfigurace určuje obslužná rutina soubor cookie rozdělený, jako je výchozí popisovač souboru cookie a typu souboru cookie obslužná rutina zadaná v není `<cookieHandler>` elementu.</span><span class="sxs-lookup"><span data-stu-id="ec65f-190">This configuration specifies the chunked cookie handler as it is the default cookie handler and there is not a cookie handler type specified in the `<cookieHandler>` element.</span></span>  
  
> [!WARNING]
>  <span data-ttu-id="ec65f-191">V následujícím příkladu jak `requireHttps` atribut `<wsFederation>` elementu a `requireSsl` atribut `<cookieHandler>` element jsou `false`.</span><span class="sxs-lookup"><span data-stu-id="ec65f-191">In the following example, both the `requireHttps` attribute of the `<wsFederation>` element and the `requireSsl` attribute of the `<cookieHandler>` element are `false`.</span></span> <span data-ttu-id="ec65f-192">To představuje potenciální ohrožení zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="ec65f-192">This presents a potential security threat.</span></span> <span data-ttu-id="ec65f-193">V produkčním prostředí, měli nastavit obě tyto hodnoty `true`.</span><span class="sxs-lookup"><span data-stu-id="ec65f-193">In production, both these values should be set `true`.</span></span>  
  
```xml  
<configuration>  
  <configSections>  
    <section name="system.identityModel" type="System.IdentityModel.Configuration.SystemIdentityModelSection, System.IdentityModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" />  
    <section name="system.identityModel.services" type="System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" />  
  </configSections>  
  
  ...  
  
  <system.webServer>  
    <modules>  
      <add name="WSFederationAuthenticationModule" type="System.IdentityModel.Services.WSFederationAuthenticationModule, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" preCondition="managedHandler" />  
      <add name="SessionAuthenticationModule" type="System.IdentityModel.Services.SessionAuthenticationModule, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" preCondition="managedHandler" />  
    </modules>  
  </system.webServer>  
  
  <system.identityModel>  
    <identityConfiguration>  
      <audienceUris>  
        <add value="http://localhost:50969/" />  
      </audienceUris>  
      <certificateValidation certificateValidationMode="None" />  
      <issuerNameRegistry type="System.IdentityModel.Tokens.ConfigurationBasedIssuerNameRegistry, System.IdentityModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">  
        <trustedIssuers>  
          <add thumbprint="9B74CB2F320F7AAFC156E1252270B1DC01EF40D0" name="LocalSTS" />  
        </trustedIssuers>  
      </issuerNameRegistry>  
    </identityConfiguration>  
  </system.identityModel>  
  <system.identityModel.services>  
    <federationConfiguration>  
      <wsFederation passiveRedirectEnabled="true" issuer="http://localhost:15839/wsFederationSTS/Issue" realm="http://localhost:50969/" reply="http://localhost:50969/" requireHttps="false" />  
      <cookieHandler requireSsl="false" />  
    </federationConfiguration>  
  </system.identityModel.services>  
</configuration>  
```  
  
## <a name="see-also"></a><span data-ttu-id="ec65f-194">Viz také</span><span class="sxs-lookup"><span data-stu-id="ec65f-194">See Also</span></span>  
 <xref:System.IdentityModel.Services.SessionAuthenticationModule>  
 <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>  
 [<span data-ttu-id="ec65f-195">\<federationConfiguration ></span><span class="sxs-lookup"><span data-stu-id="ec65f-195">\<federationConfiguration></span></span>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md)
