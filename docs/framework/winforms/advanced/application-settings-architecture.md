---
title: "Architektura nastavení aplikace"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-winforms
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords: application settings [Windows Forms], architecture
ms.assetid: c8eb2ad0-fac6-4ea2-9140-675a4a44d562
caps.latest.revision: "25"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 9c437f305b847ff7922c98b4917e86ebd39ee100
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 12/22/2017
---
# <a name="application-settings-architecture"></a><span data-ttu-id="2e849-102">Architektura nastavení aplikace</span><span class="sxs-lookup"><span data-stu-id="2e849-102">Application Settings Architecture</span></span>
<span data-ttu-id="2e849-103">Toto téma popisuje, jak funguje architektura nastavení aplikace a jsou zde popsány pokročilé funkce architektury, jako jsou seskupené nastavení a nastavení klíče.</span><span class="sxs-lookup"><span data-stu-id="2e849-103">This topic describes how the Application Settings architecture works, and explores advanced features of the architecture, such as grouped settings and settings keys.</span></span>  
  
 <span data-ttu-id="2e849-104">Architektura nastavení aplikace podporuje definující silného typu nastavení s aplikací nebo oboru uživatele a uložením nastavení mezi relacemi aplikace.</span><span class="sxs-lookup"><span data-stu-id="2e849-104">The application settings architecture supports defining strongly typed settings with either application or user scope, and persisting the settings between application sessions.</span></span> <span data-ttu-id="2e849-105">Architektura poskytuje výchozí trvalost modul pro ukládání nastavení a jejich načtení z místního systému souborů.</span><span class="sxs-lookup"><span data-stu-id="2e849-105">The architecture provides a default persistence engine for saving settings to and loading them from the local file system.</span></span> <span data-ttu-id="2e849-106">Architektura také definuje rozhraní pro zadávání vlastního modulu.</span><span class="sxs-lookup"><span data-stu-id="2e849-106">The architecture also defines interfaces for supplying a custom persistence engine.</span></span>  
  
 <span data-ttu-id="2e849-107">Rozhraní jsou k dispozici, které umožňují vlastní součásti se zachovat jejich vlastní nastavení, když jsou hostované v aplikaci.</span><span class="sxs-lookup"><span data-stu-id="2e849-107">Interfaces are provided that enable custom components to persist their own settings when they are hosted in an application.</span></span> <span data-ttu-id="2e849-108">Pomocí nastavení klíčů součásti můžete oddělit nastavení pro více instancí součásti.</span><span class="sxs-lookup"><span data-stu-id="2e849-108">By using settings keys, components can keep settings for multiple instances of the component separate.</span></span>  
  
## <a name="defining-settings"></a><span data-ttu-id="2e849-109">Definování nastavení</span><span class="sxs-lookup"><span data-stu-id="2e849-109">Defining Settings</span></span>  
 <span data-ttu-id="2e849-110">Architektura nastavení aplikace se používá v rámci obě [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] a Windows Forms a obsahuje počet základní třídy, které se sdílí v obou prostředích.</span><span class="sxs-lookup"><span data-stu-id="2e849-110">The application settings architecture is used within both [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] and Windows Forms, and it contains a number of base classes that are shared across both environments.</span></span> <span data-ttu-id="2e849-111">Nejdůležitější je <xref:System.Configuration.SettingsBase>, který poskytuje přístup k nastavení v kolekci a poskytuje metody, nízké úrovně pro načítání a ukládá se nastavení.</span><span class="sxs-lookup"><span data-stu-id="2e849-111">The most important is <xref:System.Configuration.SettingsBase>, which provides access to settings through a collection, and provides low-level methods for loading and saving settings.</span></span> <span data-ttu-id="2e849-112">Každé prostředí implementuje vlastní třídy odvozené od <xref:System.Configuration.SettingsBase> nabízí funkce další nastavení pro prostředí.</span><span class="sxs-lookup"><span data-stu-id="2e849-112">Each environment implements its own class derived from <xref:System.Configuration.SettingsBase> to provide additional settings functionality for that environment.</span></span> <span data-ttu-id="2e849-113">V aplikaci na základě formulářů Windows, musí být definovaný všechna nastavení aplikace pro třídy odvozené od <xref:System.Configuration.ApplicationSettingsBase> třída, která přidá následující funkce základní třídy:</span><span class="sxs-lookup"><span data-stu-id="2e849-113">In a Windows Forms-based application, all application settings must be defined on a class derived from the <xref:System.Configuration.ApplicationSettingsBase> class, which adds the following functionality to the base class:</span></span>  
  
-   <span data-ttu-id="2e849-114">Načítání vyšší úrovně a ukládání operace</span><span class="sxs-lookup"><span data-stu-id="2e849-114">Higher-level loading and saving operations</span></span>  
  
-   <span data-ttu-id="2e849-115">Podpora pro nastavení rozsahu uživatele</span><span class="sxs-lookup"><span data-stu-id="2e849-115">Support for user-scoped settings</span></span>  
  
-   <span data-ttu-id="2e849-116">Vrácení nastavení uživatele na předdefinované výchozí hodnoty</span><span class="sxs-lookup"><span data-stu-id="2e849-116">Reverting a user's settings to the predefined defaults</span></span>  
  
-   <span data-ttu-id="2e849-117">Upgrade nastavení z předchozí verze aplikace</span><span class="sxs-lookup"><span data-stu-id="2e849-117">Upgrading settings from a previous application version</span></span>  
  
-   <span data-ttu-id="2e849-118">Ověření nastavení, než jsou změněna nebo před jsou uloženy</span><span class="sxs-lookup"><span data-stu-id="2e849-118">Validating settings, either before they are changed or before they are saved</span></span>  
  
 <span data-ttu-id="2e849-119">Nastavení lze popsat pomocí několik atributů, které jsou definované v rámci <xref:System.Configuration> obor názvů; tyto možnosti jsou popsány v [atributy nastavení aplikace](../../../../docs/framework/winforms/advanced/application-settings-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="2e849-119">The settings can be described using a number of attributes defined within the <xref:System.Configuration> namespace; these are described in [Application Settings Attributes](../../../../docs/framework/winforms/advanced/application-settings-attributes.md).</span></span> <span data-ttu-id="2e849-120">Při definování nastavení, musíte ho použít s buď <xref:System.Configuration.ApplicationScopedSettingAttribute> nebo <xref:System.Configuration.UserScopedSettingAttribute>, který popisuje, zda nastavení platí v celé aplikaci nebo jenom pro aktuálního uživatele.</span><span class="sxs-lookup"><span data-stu-id="2e849-120">When you define a setting, you must apply it with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>, which describes whether the setting applies to the entire application or just to the current user.</span></span>  
  
 <span data-ttu-id="2e849-121">Následující příklad kódu definuje třídu vlastní nastavení s jedním nastavením `BackgroundColor`.</span><span class="sxs-lookup"><span data-stu-id="2e849-121">The following code example defines a custom settings class with a single setting, `BackgroundColor`.</span></span>  
  
 [!code-csharp[ApplicationSettings.Create#1](../../../../samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Create/CS/MyAppSettings.cs#1)]
 [!code-vb[ApplicationSettings.Create#1](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Create/VB/MyAppSettings.vb#1)]  
  
## <a name="settings-persistence"></a><span data-ttu-id="2e849-122">Trvalost nastavení</span><span class="sxs-lookup"><span data-stu-id="2e849-122">Settings Persistence</span></span>  
 <span data-ttu-id="2e849-123"><xref:System.Configuration.ApplicationSettingsBase> Třída není samotné zachovat nebo načíst nastavení; tato úloha se k nastavení poskytovatele, třída odvozená z <xref:System.Configuration.SettingsProvider>.</span><span class="sxs-lookup"><span data-stu-id="2e849-123">The <xref:System.Configuration.ApplicationSettingsBase> class does not itself persist or load settings; this job falls to the settings provider, a class that derives from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="2e849-124">Pokud odvozené třídy z <xref:System.Configuration.ApplicationSettingsBase> neurčuje nastavení zprostředkovatele prostřednictvím <xref:System.Configuration.SettingsProviderAttribute>, pak výchozího zprostředkovatele, <xref:System.Configuration.LocalFileSettingsProvider>, se používá.</span><span class="sxs-lookup"><span data-stu-id="2e849-124">If a derived class of <xref:System.Configuration.ApplicationSettingsBase> does not specify a settings provider through the <xref:System.Configuration.SettingsProviderAttribute>, then the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span>  
  
 <span data-ttu-id="2e849-125">Konfigurace systému, původně vydaná s [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] podporuje poskytuje data konfigurace statických aplikace pomocí souboru machine.config v místním počítači nebo v `app.`exe.config souboru, který nasazujete s vaše aplikace.</span><span class="sxs-lookup"><span data-stu-id="2e849-125">The configuration system that was originally released with the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] supports providing static application configuration data through either the local computer's machine.config file or within an `app.`exe.config file that you deploy with your application.</span></span> <span data-ttu-id="2e849-126"><xref:System.Configuration.LocalFileSettingsProvider> Třída rozšíří tato nativní podpora následujícími způsoby:</span><span class="sxs-lookup"><span data-stu-id="2e849-126">The <xref:System.Configuration.LocalFileSettingsProvider> class expands this native support in the following ways:</span></span>  
  
-   <span data-ttu-id="2e849-127">Nastavení rozsahu aplikace se dá uložit buď souboru machine.config nebo `app.`exe.config soubory.</span><span class="sxs-lookup"><span data-stu-id="2e849-127">Application-scoped settings can be stored in either the machine.config or `app.`exe.config files.</span></span> <span data-ttu-id="2e849-128">Souboru Machine.config je vždy jen pro čtení, při `app`. exe.config je omezené na základě aspekty zabezpečení jen pro čtení pro většinu aplikací.</span><span class="sxs-lookup"><span data-stu-id="2e849-128">Machine.config is always read-only, while `app`.exe.config is restricted by security considerations to read-only for most applications.</span></span>  
  
-   <span data-ttu-id="2e849-129">Nastavení rozsahu uživatele mohou být uloženy ve `app`. exe.config souborů, v takovém případě jsou považovány za statickou výchozí hodnoty.</span><span class="sxs-lookup"><span data-stu-id="2e849-129">User-scoped settings can be stored in `app`.exe.config files, in which case they are treated as static defaults.</span></span>  
  
-   <span data-ttu-id="2e849-130">Jiné než výchozí nastavení uživatele nastavení ukládají do nového souboru *uživatele*.config, kde *uživatele* je uživatelské jméno osoby, které jsou aktuálně spuštěné aplikace.</span><span class="sxs-lookup"><span data-stu-id="2e849-130">Non-default user-scoped settings are stored in a new file, *user*.config, where *user* is the user name of the person currently executing the application.</span></span> <span data-ttu-id="2e849-131">Můžete zadat výchozí hodnoty pro nastavení rozsahu uživatele s <xref:System.Configuration.DefaultSettingValueAttribute>.</span><span class="sxs-lookup"><span data-stu-id="2e849-131">You can specify a default for a user-scoped setting with <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="2e849-132">Protože uživatelských nastavení při spuštění aplikace, často mění `user`.config je vždy pro čtení a zápis.</span><span class="sxs-lookup"><span data-stu-id="2e849-132">Because user-scoped settings often change during application execution, `user`.config is always read/write.</span></span>  
  
 <span data-ttu-id="2e849-133">Všechny tři konfigurační soubory uložit nastavení ve formátu XML.</span><span class="sxs-lookup"><span data-stu-id="2e849-133">All three configuration files store settings in XML format.</span></span> <span data-ttu-id="2e849-134">Element XML nejvyšší úrovně pro nastavení rozsahu aplikace je `<appSettings>`, zatímco `<userSettings>` se používá pro nastavení rozsahu uživatele.</span><span class="sxs-lookup"><span data-stu-id="2e849-134">The top-level XML element for application-scoped settings is `<appSettings>`, while `<userSettings>` is used for user-scoped settings.</span></span> <span data-ttu-id="2e849-135">`app`. Exe.config soubor, který obsahuje nastavení pro obor aplikace a výchozí hodnoty pro nastavení rozsahu uživatele bude vypadat takto:</span><span class="sxs-lookup"><span data-stu-id="2e849-135">An `app`.exe.config file which contains both application-scoped settings and defaults for user-scoped settings would look like this:</span></span>  
  
```xml  
<?xml version="1.0" encoding="utf-8" ?>  
<configuration>  
    <configSections>  
        <sectionGroup name="applicationSettings" type="System.Configuration.ApplicationSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >  
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />  
        </sectionGroup>  
        <sectionGroup name="userSettings" type="System.Configuration.UserSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >  
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" allowExeDefinition="MachineToLocalUser" />  
        </sectionGroup>  
    </configSections>  
    <applicationSettings>  
        <WindowsApplication1.Properties.Settings>  
            <setting name="Cursor" serializeAs="String">  
                <value>Default</value>  
            </setting>  
            <setting name="DoubleBuffering" serializeAs="String">  
                <value>False</value>  
            </setting>  
        </WindowsApplication1.Properties.Settings>  
    </applicationSettings>  
    <userSettings>  
        <WindowsApplication1.Properties.Settings>  
            <setting name="FormTitle" serializeAs="String">  
                <value>Form1</value>  
            </setting>  
            <setting name="FormSize" serializeAs="String">  
                <value>595, 536</value>  
            </setting>  
        </WindowsApplication1.Properties.Settings>  
    </userSettings>  
</configuration>  
```  
  
 <span data-ttu-id="2e849-136">Definice elementů v rámci část konfiguračního souboru pro nastavení aplikace, najdete v části [aplikace – schéma nastavení](../../../../docs/framework/configure-apps/file-schema/application-settings-schema.md).</span><span class="sxs-lookup"><span data-stu-id="2e849-136">For a definition of the elements within the application settings section of a configuration file, see [Application Settings Schema](../../../../docs/framework/configure-apps/file-schema/application-settings-schema.md).</span></span>  
  
### <a name="settings-bindings"></a><span data-ttu-id="2e849-137">Nastavení vazby</span><span class="sxs-lookup"><span data-stu-id="2e849-137">Settings Bindings</span></span>  
 <span data-ttu-id="2e849-138">Nastavení aplikace používá architektuře Windows Forms datové vazby k poskytnutí obousměrné komunikace aktualizace nastavení mezi objekt nastavení a součásti.</span><span class="sxs-lookup"><span data-stu-id="2e849-138">Application settings uses the Windows Forms data binding architecture to provide two-way communication of settings updates between the settings object and components.</span></span> <span data-ttu-id="2e849-139">Pokud používáte Visual Studio k vytvoření nastavení aplikace a přiřadit k vlastnosti součásti, jsou automaticky generovány těchto vazeb.</span><span class="sxs-lookup"><span data-stu-id="2e849-139">If you use Visual Studio to create application settings and assign them to component properties, these bindings are generated automatically.</span></span>  
  
 <span data-ttu-id="2e849-140">Nastavení aplikace můžete vázat jen na komponenty, která podporuje <xref:System.Windows.Forms.IBindableComponent> rozhraní.</span><span class="sxs-lookup"><span data-stu-id="2e849-140">You can only bind an application setting to a component that supports the <xref:System.Windows.Forms.IBindableComponent> interface.</span></span> <span data-ttu-id="2e849-141">Navíc musí implementovat událost změny pro konkrétní vázaný vlastnost komponentu, nebo oznámit nastavení aplikace, která má vlastnost změnit prostřednictvím <xref:System.ComponentModel.INotifyPropertyChanged> rozhraní.</span><span class="sxs-lookup"><span data-stu-id="2e849-141">Also, the component must implement a change event for a specific bound property, or notify application settings that the property has changed through the <xref:System.ComponentModel.INotifyPropertyChanged> interface.</span></span> <span data-ttu-id="2e849-142">Pokud komponentu neimplementuje <xref:System.Windows.Forms.IBindableComponent> a vytváříte vazbu pomocí sady Visual Studio, nastaví se poprvé vázané vlastnosti, ale nebude aktualizovat.</span><span class="sxs-lookup"><span data-stu-id="2e849-142">If the component does not implement <xref:System.Windows.Forms.IBindableComponent> and you are binding through Visual Studio, the bound properties will be set the first time, but will not update.</span></span> <span data-ttu-id="2e849-143">Pokud komponentu implementuje <xref:System.Windows.Forms.IBindableComponent> , ale nemá vlastnost podpora upozornění na změnu, vazba nebude aktualizovat v souboru nastavení při změně vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="2e849-143">If the component implements <xref:System.Windows.Forms.IBindableComponent> but does not support property change notifications, the binding will not update in the settings file when the property is changed.</span></span>  
  
 <span data-ttu-id="2e849-144">Některé součásti Windows Forms, jako například <xref:System.Windows.Forms.ToolStripItem>, nepodporují nastavení vazby.</span><span class="sxs-lookup"><span data-stu-id="2e849-144">Some Windows Forms components, such as <xref:System.Windows.Forms.ToolStripItem>, do not support settings bindings.</span></span>  
  
### <a name="settings-serialization"></a><span data-ttu-id="2e849-145">Nastavení serializace</span><span class="sxs-lookup"><span data-stu-id="2e849-145">Settings Serialization</span></span>  
 <span data-ttu-id="2e849-146">Když <xref:System.Configuration.LocalFileSettingsProvider> nastavení musíte uložit na disk, provede následující akce:</span><span class="sxs-lookup"><span data-stu-id="2e849-146">When <xref:System.Configuration.LocalFileSettingsProvider> must save settings to disk, it performs the following actions:</span></span>  
  
1.  <span data-ttu-id="2e849-147">Zkontrolujte všechna vlastnosti definované na pomocí reflexe vaše <xref:System.Configuration.ApplicationSettingsBase> odvozené třídy, ty, které se použijí s buď hledání <xref:System.Configuration.ApplicationScopedSettingAttribute> nebo <xref:System.Configuration.UserScopedSettingAttribute>.</span><span class="sxs-lookup"><span data-stu-id="2e849-147">Uses reflection to examine all of the properties defined on your <xref:System.Configuration.ApplicationSettingsBase> derived class, finding those that are applied with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>.</span></span>  
  
2.  <span data-ttu-id="2e849-148">Serializuje vlastnost na disk.</span><span class="sxs-lookup"><span data-stu-id="2e849-148">Serializes the property to disk.</span></span> <span data-ttu-id="2e849-149">Nejprve pokusí zavolat <xref:System.ComponentModel.TypeConverter.ConvertToString%2A> nebo <xref:System.ComponentModel.TypeConverter.ConvertFromString%2A> na typ přidruženému <xref:System.ComponentModel.TypeConverter>.</span><span class="sxs-lookup"><span data-stu-id="2e849-149">It first attempts to call the <xref:System.ComponentModel.TypeConverter.ConvertToString%2A> or <xref:System.ComponentModel.TypeConverter.ConvertFromString%2A> on the type's associated <xref:System.ComponentModel.TypeConverter>.</span></span> <span data-ttu-id="2e849-150">Pokud to nebude úspěšná, používá serializace XML místo.</span><span class="sxs-lookup"><span data-stu-id="2e849-150">If this does not succeed, it uses XML serialization instead.</span></span>  
  
3.  <span data-ttu-id="2e849-151">Určuje nastavení, které v které soubory, přejděte na základě atributu název nastavení.</span><span class="sxs-lookup"><span data-stu-id="2e849-151">Determines which settings go in which files, based on the setting's attribute.</span></span>  
  
 <span data-ttu-id="2e849-152">Pokud budete implementovat vlastní třída nastavení, můžete použít <xref:System.Configuration.SettingsSerializeAsAttribute> označit nastavení buď pomocí binary nebo vlastní serializace <xref:System.Configuration.SettingsSerializeAs> výčtu.</span><span class="sxs-lookup"><span data-stu-id="2e849-152">If you implement your own settings class, you can use the <xref:System.Configuration.SettingsSerializeAsAttribute> to mark a setting for either binary or custom serialization using the <xref:System.Configuration.SettingsSerializeAs> enumeration.</span></span> <span data-ttu-id="2e849-153">Další informace o vytvoření vlastní třídy nastavení v kódu najdete v tématu [postupy: vytvoření nastavení aplikace](../../../../docs/framework/winforms/advanced/how-to-create-application-settings.md).</span><span class="sxs-lookup"><span data-stu-id="2e849-153">For more information on creating your own settings class in code, see [How to: Create Application Settings](../../../../docs/framework/winforms/advanced/how-to-create-application-settings.md).</span></span>  
  
### <a name="settings-file-locations"></a><span data-ttu-id="2e849-154">Nastavení umístění souborů</span><span class="sxs-lookup"><span data-stu-id="2e849-154">Settings File Locations</span></span>  
 <span data-ttu-id="2e849-155">Umístění `app`. exe.config a *uživatele*soubory .config se liší podle toho, jak je aplikace nainstalována.</span><span class="sxs-lookup"><span data-stu-id="2e849-155">The location of the `app`.exe.config and *user*.config files will differ based on how the application is installed.</span></span> <span data-ttu-id="2e849-156">Pro aplikaci na základě formulářů Windows zkopírovali do místního počítače `app`. exe.config se bude nacházet ve stejném adresáři jako základního adresáře aplikace hlavní spustitelný soubor, a *uživatele*.config se bude nacházet v umístění, které <xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType> vlastnost.</span><span class="sxs-lookup"><span data-stu-id="2e849-156">For a Windows Forms-based application copied onto the local computer, `app`.exe.config will reside in the same directory as the base directory of the application's main executable file, and *user*.config will reside in the location specified by the <xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="2e849-157">Pro aplikaci nainstalovat prostřednictvím [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)], oba tyto soubory se bude nacházet v [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] adresář dat pod %InstallRoot%\Documents a nastavení\\*uživatelské jméno*\Local nastavení.</span><span class="sxs-lookup"><span data-stu-id="2e849-157">For an application installed by means of [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)], both of these files will reside in the [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] Data Directory underneath %InstallRoot%\Documents and Settings\\*username*\Local Settings.</span></span>  
  
 <span data-ttu-id="2e849-158">Umístění úložiště těchto souborů se mírně liší, pokud uživatel aktivoval cestovní profily, díky čemuž by uživatelé k definování různých Windows a nastavení aplikace, když uživatel používá jiné počítače v rámci domény.</span><span class="sxs-lookup"><span data-stu-id="2e849-158">The storage location of these files is slightly different if a user has enabled roaming profiles, which enables a user to define different Windows and application settings when he or she is using other computers within a domain.</span></span> <span data-ttu-id="2e849-159">V takovém případě obě [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] aplikace a jiných-[!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] aplikace bude mít jejich `app`. exe.config a *uživatele*.config soubory uložené v části Nastavení a %InstallRoot%\Documents\\ *uživatelské jméno*\Application Data.</span><span class="sxs-lookup"><span data-stu-id="2e849-159">In that case, both [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] applications and non-[!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] applications will have their `app`.exe.config and *user*.config files stored under %InstallRoot%\Documents and Settings\\*username*\Application Data.</span></span>  
  
 <span data-ttu-id="2e849-160">Další informace o fungování funkce nastavení aplikace s novou technologií nasazení najdete v tématu [ClickOnce a nastavení aplikace](/visualstudio/deployment/clickonce-and-application-settings).</span><span class="sxs-lookup"><span data-stu-id="2e849-160">For more information about how the Application Settings feature works with the new deployment technology, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span> <span data-ttu-id="2e849-161">Další informace o [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] adresář dat najdete v části [přístup k místním a vzdáleným datům v aplikacích ClickOnce](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications).</span><span class="sxs-lookup"><span data-stu-id="2e849-161">For more information about the [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] Data Directory, see [Accessing Local and Remote Data in ClickOnce Applications](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications).</span></span>  
  
## <a name="application-settings-and-security"></a><span data-ttu-id="2e849-162">Nastavení aplikace a zabezpečení</span><span class="sxs-lookup"><span data-stu-id="2e849-162">Application Settings and Security</span></span>  
 <span data-ttu-id="2e849-163">Nastavení aplikace jsou navrženy pro práci v částečné důvěryhodnosti, prostředí s omezeným přístupem, které je výchozí nastavení pro aplikace Windows Forms hostované prostřednictvím Internetu nebo intranetu.</span><span class="sxs-lookup"><span data-stu-id="2e849-163">Application settings are designed to work in partial trust, a restricted environment that is the default for Windows Forms applications hosted over the Internet or an intranet.</span></span> <span data-ttu-id="2e849-164">Žádná zvláštní oprávnění nad rámec částečné důvěryhodnosti jsou potřeba k použití nastavení aplikace pomocí výchozího nastavení zprostředkovatele.</span><span class="sxs-lookup"><span data-stu-id="2e849-164">No special permissions beyond partial trust are needed to use application settings with the default settings provider.</span></span>  
  
 <span data-ttu-id="2e849-165">Při použití nastavení aplikace v [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] aplikace, `user`.config soubor je uložen v [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] datový adresář.</span><span class="sxs-lookup"><span data-stu-id="2e849-165">When application settings are used in a [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] application, the `user`.config file is stored in the [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] data directory.</span></span> <span data-ttu-id="2e849-166">Velikost aplikace `user`souboru .config nesmí překročit kvótu directory data, která nastavuje [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2e849-166">The size of the application's `user`.config file cannot exceed the data directory quota set by [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)].</span></span> <span data-ttu-id="2e849-167">Další informace najdete v tématu [ClickOnce a nastavení aplikace](/visualstudio/deployment/clickonce-and-application-settings).</span><span class="sxs-lookup"><span data-stu-id="2e849-167">For more information, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span>  
  
## <a name="custom-settings-providers"></a><span data-ttu-id="2e849-168">Vlastní nastavení zprostředkovatele</span><span class="sxs-lookup"><span data-stu-id="2e849-168">Custom Settings Providers</span></span>  
 <span data-ttu-id="2e849-169">V architektuře nastavení aplikace je volné párování mezi nastavení aplikací obálkovou třídu, odvozené od <xref:System.Configuration.ApplicationSettingsBase>, a související nastavení poskytovatele nebo poskytovatelů, odvozené z <xref:System.Configuration.SettingsProvider>.</span><span class="sxs-lookup"><span data-stu-id="2e849-169">In the Application Settings architecture, there is a loose coupling between the applications settings wrapper class, derived from <xref:System.Configuration.ApplicationSettingsBase>, and the associated settings provider or providers, derived from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="2e849-170">Toto přidružení je definována pouze pomocí <xref:System.Configuration.SettingsProviderAttribute> použít pro třídu obálky nebo jeho jednotlivé vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="2e849-170">This association is defined only by the <xref:System.Configuration.SettingsProviderAttribute> applied to the wrapper class or its individual properties.</span></span> <span data-ttu-id="2e849-171">Pokud zadaný zprostředkovatel není explicitně nastavení, výchozího zprostředkovatele, <xref:System.Configuration.LocalFileSettingsProvider>, se používá.</span><span class="sxs-lookup"><span data-stu-id="2e849-171">If a settings provider is not explicitly specified, the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span> <span data-ttu-id="2e849-172">V důsledku toho tato architektura podporuje vytváření a používání zprostředkovatelů vlastní nastavení.</span><span class="sxs-lookup"><span data-stu-id="2e849-172">As a result, this architecture supports creating and using custom settings providers.</span></span>  
  
 <span data-ttu-id="2e849-173">Předpokládejme například, že chcete pro vývoj a použít `SqlSettingsProvider`, zprostředkovatele, který se uloží všechna nastavení data v databázi Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2e849-173">For example, suppose that you want to develop and use `SqlSettingsProvider`, a provider that will store all settings data in a Microsoft SQL Server database.</span></span> <span data-ttu-id="2e849-174">Vaše <xref:System.Configuration.SettingsProvider>-odvozené třídy by se zobrazit tyto informace v jeho `Initialize` metoda jako parametr typu <xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="2e849-174">Your <xref:System.Configuration.SettingsProvider>-derived class would receive this information in its `Initialize` method as a parameter of type <xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>.</span></span> <span data-ttu-id="2e849-175">Potom by implementovat <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> metoda pro načtení nastavení z úložiště dat a <xref:System.Configuration.SettingsProvider.SetPropertyValues%2A> o jejich uložení.</span><span class="sxs-lookup"><span data-stu-id="2e849-175">You would then implement the <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> method to retrieve your settings from the data store, and <xref:System.Configuration.SettingsProvider.SetPropertyValues%2A> to save them.</span></span> <span data-ttu-id="2e849-176">Můžete použít poskytovatele <xref:System.Configuration.SettingsPropertyCollection> zadané <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> k určení názvu vlastnosti, typ a oboru, stejně jako všechny ostatní atributy nastavení definované pro tuto vlastnost.</span><span class="sxs-lookup"><span data-stu-id="2e849-176">Your provider can use the <xref:System.Configuration.SettingsPropertyCollection> supplied to <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> to determine the property's name, type, and scope, as well as any other settings attributes defined for that property.</span></span>  
  
 <span data-ttu-id="2e849-177">Poskytovatel bude nutné implementovat jednu vlastnost a jedna metoda, jejíž implementace nemusí být samozřejmé.</span><span class="sxs-lookup"><span data-stu-id="2e849-177">Your provider will need to implement one property and one method whose implementations may not be obvious.</span></span> <span data-ttu-id="2e849-178"><xref:System.Configuration.SettingsProvider.ApplicationName%2A> Vlastnost je abstraktní vlastnosti <xref:System.Configuration.SettingsProvider>; by ho vrátit následující program:</span><span class="sxs-lookup"><span data-stu-id="2e849-178">The <xref:System.Configuration.SettingsProvider.ApplicationName%2A> property is an abstract property of <xref:System.Configuration.SettingsProvider>; you should program it to return the following:</span></span>  
  
 [!code-csharp[ApplicationSettings.Architecture#2](../../../../samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#2)]
 [!code-vb[ApplicationSettings.Architecture#2](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#2)]  
  
 <span data-ttu-id="2e849-179">Odvozené třídy musí také implementovat `Initialize` metodu, která nezadávaly žádné argumenty a nevrací žádnou hodnotu.</span><span class="sxs-lookup"><span data-stu-id="2e849-179">Your derived class must also implement an `Initialize` method that takes no arguments and returns no value.</span></span> <span data-ttu-id="2e849-180">Tato metoda není definované <xref:System.Configuration.SettingsProvider>.</span><span class="sxs-lookup"><span data-stu-id="2e849-180">This method is not defined by <xref:System.Configuration.SettingsProvider>.</span></span>  
  
 <span data-ttu-id="2e849-181">Nakonec implementovat <xref:System.Configuration.IApplicationSettingsProvider> na svého poskytovatele kvůli zajištění podpory pro aktualizaci nastavení vrácení nastavení na výchozí nastavení a nastavení upgrade z verze jednu aplikaci do jiného.</span><span class="sxs-lookup"><span data-stu-id="2e849-181">Finally, you implement <xref:System.Configuration.IApplicationSettingsProvider> on your provider to provide support for refreshing settings, reverting settings to their defaults, and upgrading settings from one application version to another.</span></span>  
  
 <span data-ttu-id="2e849-182">Po implementovat a zkompilovat svého poskytovatele, budete muset pokyn třídu pro tohoto zprostředkovatele použijte místo výchozího nastavení.</span><span class="sxs-lookup"><span data-stu-id="2e849-182">Once you have implemented and compiled your provider, you need to instruct your settings class to use this provider instead of the default.</span></span> <span data-ttu-id="2e849-183">Můžete dosáhnout pomocí <xref:System.Configuration.SettingsProviderAttribute>.</span><span class="sxs-lookup"><span data-stu-id="2e849-183">You accomplish this through the <xref:System.Configuration.SettingsProviderAttribute>.</span></span> <span data-ttu-id="2e849-184">Pokud pro celou třídu nastavení, je pro každé nastavení, která definuje třídu; používá zprostředkovatele Pokud pro jednotlivá nastavení, architektura nastavení aplikace používá tohoto zprostředkovatele pro taková nastavení pouze a <xref:System.Configuration.LocalFileSettingsProvider> pro zbytek.</span><span class="sxs-lookup"><span data-stu-id="2e849-184">If applied to an entire settings class, the provider is used for each setting that the class defines; if applied to individual settings, Application Settings architecture uses that provider for those settings only, and uses <xref:System.Configuration.LocalFileSettingsProvider> for the rest.</span></span> <span data-ttu-id="2e849-185">Následující příklad kódu ukazuje, jak se udělit pokyny třídu nastavení vlastního zprostředkovatele.</span><span class="sxs-lookup"><span data-stu-id="2e849-185">The following code example shows how to instruct the settings class to use your custom provider.</span></span>  
  
 [!code-csharp[ApplicationSettings.Architecture#1](../../../../samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#1)]
 [!code-vb[ApplicationSettings.Architecture#1](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#1)]  
  
 <span data-ttu-id="2e849-186">Zprostředkovatel může být volána z více vláken současně, ale bude vždy zapisovat do stejného umístění úložiště; Architektura nastavení aplikace vytvoří instanci proto vždy jen jednu instanci třídě zprostředkovatele.</span><span class="sxs-lookup"><span data-stu-id="2e849-186">A provider may be called from multiple threads simultaneously, but it will always write to the same storage location; therefore, the Application Settings architecture will only ever instantiate a single instance of your provider class.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="2e849-187">Můžete by měl zkontrolujte, zda poskytovatel je bezpečné pro přístup z více vláken a umožňuje pouze jedno vlákno současně zapisovat do konfigurační soubory.</span><span class="sxs-lookup"><span data-stu-id="2e849-187">You should ensure that your provider is thread-safe, and only allows one thread at a time to write to the configuration files.</span></span>  
  
 <span data-ttu-id="2e849-188">Poskytovatel nemusí podporovat všechny atributy definované v nastavení <xref:System.Configuration?displayProperty=nameWithType> obor názvů, i když se musí nacházet na minimální podporu <xref:System.Configuration.ApplicationScopedSettingAttribute> a <xref:System.Configuration.UserScopedSettingAttribute>a musí taky podporovat <xref:System.Configuration.DefaultSettingValueAttribute>.</span><span class="sxs-lookup"><span data-stu-id="2e849-188">Your provider does not need to support all of the settings attributes defined in the <xref:System.Configuration?displayProperty=nameWithType> namespace, though it must at a minimum support <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute>, and should also support <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="2e849-189">Pro tyto atributy, které nejsou podporovány má poskytovatel právě selhat bez oznámení; nesmí se vyvolat výjimku.</span><span class="sxs-lookup"><span data-stu-id="2e849-189">For those attributes that it does not support, your provider should just fail without notification; it should not throw an exception.</span></span> <span data-ttu-id="2e849-190">Pokud třída nastavení používá neplatnou kombinaci atributů, ale – například použití <xref:System.Configuration.ApplicationScopedSettingAttribute> a <xref:System.Configuration.UserScopedSettingAttribute> na stejnou hodnotu nastavení – poskytovatel by měla vyvolat výjimku a ukončení provádění operace.</span><span class="sxs-lookup"><span data-stu-id="2e849-190">If the settings class uses an invalid combination of attributes, however — such as applying <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute> to the same setting — your provider should throw an exception and cease operation.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2e849-191">Viz také</span><span class="sxs-lookup"><span data-stu-id="2e849-191">See Also</span></span>  
 <xref:System.Configuration.ApplicationSettingsBase>  
 <xref:System.Configuration.SettingsProvider>  
 <xref:System.Configuration.LocalFileSettingsProvider>  
 [<span data-ttu-id="2e849-192">Přehled nastavení aplikace</span><span class="sxs-lookup"><span data-stu-id="2e849-192">Application Settings Overview</span></span>](../../../../docs/framework/winforms/advanced/application-settings-overview.md)  
 [<span data-ttu-id="2e849-193">Nastavení aplikace pro vlastní ovládací prvky</span><span class="sxs-lookup"><span data-stu-id="2e849-193">Application Settings for Custom Controls</span></span>](../../../../docs/framework/winforms/advanced/application-settings-for-custom-controls.md)  
 [<span data-ttu-id="2e849-194">ClickOnce a nastavení aplikace</span><span class="sxs-lookup"><span data-stu-id="2e849-194">ClickOnce and Application Settings</span></span>](/visualstudio/deployment/clickonce-and-application-settings)  
 [<span data-ttu-id="2e849-195">Schéma nastavení aplikace</span><span class="sxs-lookup"><span data-stu-id="2e849-195">Application Settings Schema</span></span>](../../../../docs/framework/configure-apps/file-schema/application-settings-schema.md)
