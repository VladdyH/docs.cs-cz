---
title: "Přepsání identity služby kvůli ověřování"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
ms.assetid: d613a22b-07d7-41a4-bada-1adc653b9b5d
caps.latest.revision: "9"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: 6a3125504326f2cb129fef6f1f3e01dba577f599
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 11/21/2017
---
# <a name="overriding-the-identity-of-a-service-for-authentication"></a><span data-ttu-id="3f295-102">Přepsání identity služby kvůli ověřování</span><span class="sxs-lookup"><span data-stu-id="3f295-102">Overriding the Identity of a Service for Authentication</span></span>
<span data-ttu-id="3f295-103">Obvykle nemáte nastavit identitu u služby, protože výběr typu pověření klienta Určuje typ identity vystavené v metadatech služby.</span><span class="sxs-lookup"><span data-stu-id="3f295-103">Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata.</span></span> <span data-ttu-id="3f295-104">Například následující kód konfigurace používá [ \<wsHttpBinding >](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) elementu a nastaví `clientCredentialType` atribut systému Windows.</span><span class="sxs-lookup"><span data-stu-id="3f295-104">For example, the following configuration code uses the [\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) element and sets the `clientCredentialType` attribute to Windows.</span></span>  
  
  
  
 <span data-ttu-id="3f295-105">Následující fragment webové služby popis Language (WSDL) ukazuje identity pro koncový bod předtím definovaný.</span><span class="sxs-lookup"><span data-stu-id="3f295-105">The following Web Services Description Language (WSDL) fragment shows the identity for the endpoint previously defined.</span></span> <span data-ttu-id="3f295-106">V tomto příkladu je služba spuštěna jako služba s vlastním hostováním v rámci určitého uživatelského účtu (username@contoso.com), a proto identity hlavní název (UPN) uživatele obsahuje název účtu.</span><span class="sxs-lookup"><span data-stu-id="3f295-106">In this example, the service is running as a self-hosted service under a particular user account (username@contoso.com) and therefore the user principal name (UPN) identity contains the account name.</span></span> <span data-ttu-id="3f295-107">Hlavní název uživatele je také známé jako přihlašovací jméno uživatele v doméně systému Windows.</span><span class="sxs-lookup"><span data-stu-id="3f295-107">The UPN is also known as the user logon name in a Windows domain.</span></span>  
  
  
  
 <span data-ttu-id="3f295-108">Ukázkovou aplikaci, která demonstruje nastavení identity, najdete v části [ukázka Identity služby](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span><span class="sxs-lookup"><span data-stu-id="3f295-108">For a sample application that demonstrates identity setting, see [Service Identity Sample](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="3f295-109">Služba identity najdete v tématu [identita a ověřování služby](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="3f295-109"> service identity, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span></span>  
  
## <a name="kerberos-authentication-and-identity"></a><span data-ttu-id="3f295-110">Ověřování protokolem Kerberos a Identity</span><span class="sxs-lookup"><span data-stu-id="3f295-110">Kerberos Authentication and Identity</span></span>  
 <span data-ttu-id="3f295-111">Ve výchozím nastavení, pokud služba je nakonfigurovaný na použití pověření systému Windows [ \<identity >](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) elementu, který obsahuje [ \<userPrincipalName >](../../../../docs/framework/configure-apps/file-schema/wcf/userprincipalname.md) nebo [ \<servicePrincipalName >](../../../../docs/framework/configure-apps/file-schema/wcf/serviceprincipalname.md) element se generuje ve schématu WSDL.</span><span class="sxs-lookup"><span data-stu-id="3f295-111">By default, when a service is configured to use a Windows credential, an [\<identity>](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) element that contains a [\<userPrincipalName>](../../../../docs/framework/configure-apps/file-schema/wcf/userprincipalname.md) or [\<servicePrincipalName>](../../../../docs/framework/configure-apps/file-schema/wcf/serviceprincipalname.md) element is generated in the WSDL.</span></span> <span data-ttu-id="3f295-112">Pokud je služba spuštěna pod `LocalSystem`, `LocalService`, nebo `NetworkService` účtu, služby (SPN) pro hlavní název je generována ve výchozím nastavení ve formě `host/` \< *hostname*> protože Tyto účty s přístupem k datům SPN počítače.</span><span class="sxs-lookup"><span data-stu-id="3f295-112">If the service is running under the `LocalSystem`, `LocalService`, or `NetworkService` account, a service principal name (SPN) is generated by default in the form of `host/`\<*hostname*> because those accounts have access to the computer's SPN data.</span></span> <span data-ttu-id="3f295-113">Pokud služba běží pod jiným účtem, [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] generuje UPN ve formě \< *uživatelské jméno*>@<*domainName*`>`.</span><span class="sxs-lookup"><span data-stu-id="3f295-113">If the service is running under a different account, [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] generates a UPN in the form of \<*username*>@<*domainName*`>`.</span></span> <span data-ttu-id="3f295-114">K tomu dochází, protože ověřování pomocí protokolu Kerberos vyžaduje, aby (UPN) nebo hlavní název služby je nutné zadat klienta k ověřování.</span><span class="sxs-lookup"><span data-stu-id="3f295-114">This occurs because Kerberos authentication requires that a UPN or SPN be supplied to the client to authenticate the service.</span></span>  
  
 <span data-ttu-id="3f295-115">Můžete taky nástroje Setspn.exe zaregistrovat další SPN se účtu služby v doméně.</span><span class="sxs-lookup"><span data-stu-id="3f295-115">You can also use the Setspn.exe tool to register an additional SPN with a service's account in a domain.</span></span> <span data-ttu-id="3f295-116">Potom můžete vytvořit hlavní název služby jako identitu služby.</span><span class="sxs-lookup"><span data-stu-id="3f295-116">You can then use the SPN as the identity of the service.</span></span> <span data-ttu-id="3f295-117">Si můžete stáhnout nástroj [nástroj Windows 2000 Resource Kit: Setspn.exe](http://go.microsoft.com/fwlink/?LinkId=91752).</span><span class="sxs-lookup"><span data-stu-id="3f295-117">To download the tool, see [Windows 2000 Resource Kit Tool : Setspn.exe](http://go.microsoft.com/fwlink/?LinkId=91752).</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="3f295-118">nástroj, najdete v části [přehled nástroje Setspn](http://go.microsoft.com/fwlink/?LinkId=61374).</span><span class="sxs-lookup"><span data-stu-id="3f295-118"> the tool, see [Setspn Overview](http://go.microsoft.com/fwlink/?LinkId=61374).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="3f295-119">Pokud chcete použít typ přihlašovacích údajů Windows bez vyjednávání, služby uživatelský účet musí mít přístup k hlavní název služby, která je zaregistrovaná u domény služby Active Directory.</span><span class="sxs-lookup"><span data-stu-id="3f295-119">To use the Windows credential type without negotiation, the service's user account must have access to the SPN that is registered with the Active Directory domain.</span></span> <span data-ttu-id="3f295-120">Můžete provést těmito způsoby:</span><span class="sxs-lookup"><span data-stu-id="3f295-120">You can do this in the following ways:</span></span>  
  
-   <span data-ttu-id="3f295-121">Použití účtu NetworkService nebo LocalSystem ke spouštění služby.</span><span class="sxs-lookup"><span data-stu-id="3f295-121">Use the NetworkService or LocalSystem account to run your service.</span></span> <span data-ttu-id="3f295-122">Protože tyto účty mít přístup k počítači hlavní název služby, který je vytvořen, když je počítač připojen k doméně služby Active Directory [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] automaticky vygeneruje správné element SPN uvnitř koncový bod služby v metadatech služby (WSDL).</span><span class="sxs-lookup"><span data-stu-id="3f295-122">Because those accounts have access to the machine SPN that is established when the machine joins the Active Directory domain, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] automatically generates the proper SPN element inside the service's endpoint in the service's metadata (WSDL).</span></span>  
  
-   <span data-ttu-id="3f295-123">Použijte libovolný účet domény služby Active Directory ke spuštění služby.</span><span class="sxs-lookup"><span data-stu-id="3f295-123">Use an arbitrary Active Directory domain account to run your service.</span></span> <span data-ttu-id="3f295-124">V takovém případě vytvořte název SPN pro účet domény, což lze provést pomocí nástroje Setspn.exe nástroj.</span><span class="sxs-lookup"><span data-stu-id="3f295-124">In this case, establish an SPN for that domain account, which you can do by using the Setspn.exe utility tool.</span></span> <span data-ttu-id="3f295-125">Jakmile vytvoříte název SPN pro účet služby, konfigurace [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] publikovat tento hlavní název služby klientům služby prostřednictvím jeho metadata (WSDL).</span><span class="sxs-lookup"><span data-stu-id="3f295-125">Once you create the SPN for the service's account, configure [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] to publish that SPN to the service's clients through its metadata (WSDL).</span></span> <span data-ttu-id="3f295-126">To se provádí nastavením identitu koncového bodu pro zveřejněné koncový bod, buď prostřednictvím konfiguračního souboru aplikace nebo kódu.</span><span class="sxs-lookup"><span data-stu-id="3f295-126">This is done by setting the endpoint identity for the exposed endpoint, either through an application configuration file or code.</span></span>  
  
 [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="3f295-127">Hlavní názvy služby SPN, protokol Kerberos a služby Active Directory, najdete v části [Kerberos technické Supplement pro Windows](http://go.microsoft.com/fwlink/?LinkId=88330).</span><span class="sxs-lookup"><span data-stu-id="3f295-127"> SPNs, the Kerberos protocol, and Active Directory, see [Kerberos Technical Supplement for Windows](http://go.microsoft.com/fwlink/?LinkId=88330).</span></span>  
  
### <a name="when-spn-or-upn-equals-the-empty-string"></a><span data-ttu-id="3f295-128">Pokud hlavní název služby nebo UPN rovná prázdný řetězec</span><span class="sxs-lookup"><span data-stu-id="3f295-128">When SPN or UPN Equals the Empty String</span></span>  
 <span data-ttu-id="3f295-129">Pokud nastavíte hlavní název služby nebo UPN rovna prázdný řetězec, situace, počet různých věcí v závislosti na úrovni a ověřování režim zabezpečení používá:</span><span class="sxs-lookup"><span data-stu-id="3f295-129">If you set the SPN or UPN equal to an empty string, a number of different things happen, depending on the security level and authentication mode being used:</span></span>  
  
-   <span data-ttu-id="3f295-130">Pokud používáte zabezpečení na úrovni přenosu, je zvolen ověřování LanMan NT (NTLM).</span><span class="sxs-lookup"><span data-stu-id="3f295-130">If you are using transport level security, NT LanMan (NTLM) authentication is chosen.</span></span>  
  
-   <span data-ttu-id="3f295-131">Pokud používáte úroveň zabezpečení zpráv, může selhat ověřování, v závislosti na režim ověřování:</span><span class="sxs-lookup"><span data-stu-id="3f295-131">If you are using message level security, authentication may fail, depending on the authentication mode:</span></span>  
  
-   <span data-ttu-id="3f295-132">Pokud používáte `spnego` režimu a `AllowNtlm` je atribut nastaven na `false`, ověřování selže.</span><span class="sxs-lookup"><span data-stu-id="3f295-132">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `false`, authentication fail.</span></span>  
  
-   <span data-ttu-id="3f295-133">Pokud používáte `spnego` režimu a `AllowNtlm` je atribut nastaven na `true`, ověření nezdaří, pokud hlavní název uživatele je prázdný, ale bude úspěšné, pokud hlavní název je prázdný.</span><span class="sxs-lookup"><span data-stu-id="3f295-133">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `true`, authentication fails if the UPN is empty, but succeeds if the SPN is empty.</span></span>  
  
-   <span data-ttu-id="3f295-134">Pokud používáte přímo pomocí protokolu Kerberos (také označované jako "jednorázové"), ověření se nezdaří.</span><span class="sxs-lookup"><span data-stu-id="3f295-134">If you are using Kerberos direct (also known as "one-shot"), authentication fails.</span></span>  
  
### <a name="using-the-identity-element-in-configuration"></a><span data-ttu-id="3f295-135">Pomocí \<identity > Element v konfiguraci</span><span class="sxs-lookup"><span data-stu-id="3f295-135">Using the \<identity> Element in Configuration</span></span>  
 <span data-ttu-id="3f295-136">Pokud změníte typ pověření klienta vazba dříve zobrazí certifikát`,` pak generovaného WSDL obsahuje Base64 serializovat certifikátů X.509 pro hodnotu identity, jak je znázorněno v následujícím kódu.</span><span class="sxs-lookup"><span data-stu-id="3f295-136">If you change the client credential type in the binding previously shown to Certificate`,` then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code.</span></span> <span data-ttu-id="3f295-137">Toto je výchozí nastavení pro všechny typy pověření klienta než Windows.</span><span class="sxs-lookup"><span data-stu-id="3f295-137">This is the default for all client credential types other than Windows.</span></span>  
  
  
  
 <span data-ttu-id="3f295-138">Můžete změnit hodnotu výchozí identitu služby nebo změňte typ identity pomocí <`identity`> element v konfiguraci nebo nastavení identity v kódu.</span><span class="sxs-lookup"><span data-stu-id="3f295-138">You can change the value of the default service identity or change the type of the identity by using the <`identity`> element in configuration or by setting the identity in code.</span></span> <span data-ttu-id="3f295-139">Následující kód konfigurace nastaví identitu domain name system (DNS) s hodnotou `contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="3f295-139">The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.</span></span>  
  
  
  
### <a name="setting-identity-programmatically"></a><span data-ttu-id="3f295-140">Nastavení Identity prostřednictvím kódu programu</span><span class="sxs-lookup"><span data-stu-id="3f295-140">Setting Identity Programmatically</span></span>  
 <span data-ttu-id="3f295-141">Služby není nutné explicitně zadat svou identitu, protože [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] automaticky určuje ho.</span><span class="sxs-lookup"><span data-stu-id="3f295-141">Your service does not have to explicitly specify an identity, because [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] automatically determines it.</span></span> <span data-ttu-id="3f295-142">Ale [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] vám umožní určit identity na koncový bod, pokud je to nutné.</span><span class="sxs-lookup"><span data-stu-id="3f295-142">However, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] allows you to specify an identity on an endpoint, if required.</span></span> <span data-ttu-id="3f295-143">Následující kód přidá nový koncový bod služby s konkrétní identity DNS.</span><span class="sxs-lookup"><span data-stu-id="3f295-143">The following code adds a new service endpoint with a specific DNS identity.</span></span>  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## <a name="see-also"></a><span data-ttu-id="3f295-144">Viz také</span><span class="sxs-lookup"><span data-stu-id="3f295-144">See Also</span></span>  
 [<span data-ttu-id="3f295-145">Postupy: vytvoření Identity ověřovatel vlastní klienta</span><span class="sxs-lookup"><span data-stu-id="3f295-145">How to: Create a Custom Client Identity Verifier</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md)  
 [<span data-ttu-id="3f295-146">Identita a ověřování služby</span><span class="sxs-lookup"><span data-stu-id="3f295-146">Service Identity and Authentication</span></span>](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)
