---
title: "Postupy: Změna zprostředkovatele kryptografických služeb pro certifikát X.509 & č. 39; s privátním klíčem"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- cryptographic provider [WCF], changing
- cryptographic provider [WCF]
ms.assetid: b4254406-272e-4774-bd61-27e39bbb6c12
caps.latest.revision: "7"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: e7dea9834b654be0b86155e18524053efa4b778b
ms.sourcegitcommit: c0dd436f6f8f44dc80dc43b07f6841a00b74b23f
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 01/19/2018
---
# <a name="how-to-change-the-cryptographic-provider-for-an-x509-certificate39s-private-key"></a><span data-ttu-id="0d492-102">Postupy: Změna zprostředkovatele kryptografických služeb pro certifikát X.509 & č. 39; s privátním klíčem</span><span class="sxs-lookup"><span data-stu-id="0d492-102">How to: Change the Cryptographic Provider for an X.509 Certificate&#39;s Private Key</span></span>
<span data-ttu-id="0d492-103">Toto téma ukazuje, jak změnit zprostředkovatele kryptografických služeb používá k zajištění privátní klíč certifikátu X.509 a jak integrovat do zprostředkovatele [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] framework zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="0d492-103">This topic shows how to change the cryptographic provider used to provide an X.509 certificate's private key and how to integrate the provider into the [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] security framework.</span></span> <span data-ttu-id="0d492-104">Další informace o používání certifikátů najdete v tématu [práce s certifikáty](../../../../docs/framework/wcf/feature-details/working-with-certificates.md).</span><span class="sxs-lookup"><span data-stu-id="0d492-104">For more information about using certificates, see [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md).</span></span>  
  
 <span data-ttu-id="0d492-105">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] Zabezpečení framework poskytuje způsob, jak zavést nové typy tokenů zabezpečení, jak je popsáno v [postupy: vytvoření vlastního tokenu](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="0d492-105">The [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] security framework provides a way to introduce new security token types as described in [How to: Create a Custom Token](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span></span> <span data-ttu-id="0d492-106">Je také možné použít vlastní token k nahrazení stávající poskytované systémem typy tokenů.</span><span class="sxs-lookup"><span data-stu-id="0d492-106">It is also possible to use a custom token to replace existing system-provided token types.</span></span>  
  
 <span data-ttu-id="0d492-107">V tomto tématu se token zabezpečení poskytované systémem X.509 nahrazuje token vlastní X.509, který poskytuje jinou implementaci pro privátní klíč certifikátu.</span><span class="sxs-lookup"><span data-stu-id="0d492-107">In this topic, the system-provided X.509 security token is replaced by a custom X.509 token that provides a different implementation for the certificate private key.</span></span> <span data-ttu-id="0d492-108">To je užitečné v situacích, kdy skutečná privátní klíč poskytuje různé zprostředkovatele kryptografických služeb než výchozí Windows zprostředkovatele kryptografických služeb.</span><span class="sxs-lookup"><span data-stu-id="0d492-108">This is useful in scenarios where the actual private key is provided by a different cryptographic provider than the default Windows cryptographic provider.</span></span> <span data-ttu-id="0d492-109">Příkladem alternativního zprostředkovatele kryptografických služeb je modul hardwarového zabezpečení, který provede všechny privátní klíče související kryptografických operací a privátní klíče nejsou uložené v paměti, a zlepšit zabezpečení systému.</span><span class="sxs-lookup"><span data-stu-id="0d492-109">One example of an alternative cryptographic provider is a hardware security module that performs all private key related cryptographic operations, and does not store the private keys in memory, thus improving security of the system.</span></span>  
  
 <span data-ttu-id="0d492-110">V následujícím příkladu je pouze pro demonstrační účely.</span><span class="sxs-lookup"><span data-stu-id="0d492-110">The following example is for demonstration purposes only.</span></span> <span data-ttu-id="0d492-111">Nenahrazuje výchozí zprostředkovatel kryptografických služeb systému Windows, ale ukazuje, kde může integrovat takové zprostředkovatele.</span><span class="sxs-lookup"><span data-stu-id="0d492-111">It does not replace the default Windows cryptographic provider, but it shows where such a provider could be integrated.</span></span>  
  
## <a name="procedures"></a><span data-ttu-id="0d492-112">Procedury</span><span class="sxs-lookup"><span data-stu-id="0d492-112">Procedures</span></span>  
 <span data-ttu-id="0d492-113">Každý token zabezpečení, který má přiřazený bezpečnostní klíč nebo klíče musí implementovat <xref:System.IdentityModel.Tokens.SecurityToken.SecurityKeys%2A> vlastnosti, která vrátí kolekci klíčů z instance tokenu zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="0d492-113">Every security token that has an associated security key or keys must implement the <xref:System.IdentityModel.Tokens.SecurityToken.SecurityKeys%2A> property, which returns a collection of keys from the security token instance.</span></span> <span data-ttu-id="0d492-114">Pokud je token token zabezpečení X.509, kolekce obsahuje jednu instanci <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> třídu, která představuje veřejné a soukromé klíče přidruženého k certifikátu.</span><span class="sxs-lookup"><span data-stu-id="0d492-114">If the token is an X.509 security token, the collection contains a single instance of the <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> class that represents both public and private keys associated with the certificate.</span></span> <span data-ttu-id="0d492-115">Chcete-li nahradit výchozí zprostředkovatele kryptografických služeb použitý k poskytnutí klíčů certifikátu, vytvořte novou implementací této třídy.</span><span class="sxs-lookup"><span data-stu-id="0d492-115">To replace the default cryptographic provider used to provide the certificate's keys, create a new implementation of this class.</span></span>  
  
#### <a name="to-create-a-custom-x509-asymmetric-key"></a><span data-ttu-id="0d492-116">Chcete-li vytvořit vlastní asymetrický klíč X.509</span><span class="sxs-lookup"><span data-stu-id="0d492-116">To create a custom X.509 asymmetric key</span></span>  
  
1.  <span data-ttu-id="0d492-117">Definovat nové třídy odvozené od <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> třídy.</span><span class="sxs-lookup"><span data-stu-id="0d492-117">Define a new class derived from the <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> class.</span></span>  
  
2.  <span data-ttu-id="0d492-118">Přepsání <xref:System.IdentityModel.Tokens.SecurityKey.KeySize%2A> vlastnost určenou jen pro čtení.</span><span class="sxs-lookup"><span data-stu-id="0d492-118">Override the <xref:System.IdentityModel.Tokens.SecurityKey.KeySize%2A> read-only property.</span></span> <span data-ttu-id="0d492-119">Tato vlastnost vrátí skutečná velikost klíče certifikátu pár veřejného a privátního klíče.</span><span class="sxs-lookup"><span data-stu-id="0d492-119">This property returns the actual key size of the certificate's public/private key pair.</span></span>  
  
3.  <span data-ttu-id="0d492-120">Přepsání <xref:System.IdentityModel.Tokens.SecurityKey.DecryptKey%2A> metoda.</span><span class="sxs-lookup"><span data-stu-id="0d492-120">Override the <xref:System.IdentityModel.Tokens.SecurityKey.DecryptKey%2A> method.</span></span> <span data-ttu-id="0d492-121">Tato metoda je volána [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] framework zabezpečení k dešifrování symetrického klíče s privátním klíčem certifikátu.</span><span class="sxs-lookup"><span data-stu-id="0d492-121">This method is called by the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] security framework to decrypt a symmetric key with the certificate's private key.</span></span> <span data-ttu-id="0d492-122">(Klíč byl dříve zašifrován pomocí veřejného klíče certifikátu.)</span><span class="sxs-lookup"><span data-stu-id="0d492-122">(The key was previously encrypted with the certificate's public key.)</span></span>  
  
4.  <span data-ttu-id="0d492-123">Přepsání <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetAsymmetricAlgorithm%2A> metoda.</span><span class="sxs-lookup"><span data-stu-id="0d492-123">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetAsymmetricAlgorithm%2A> method.</span></span> <span data-ttu-id="0d492-124">Tato metoda je volána [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] framework zabezpečení získat instanci <xref:System.Security.Cryptography.AsymmetricAlgorithm> třídu, která představuje zprostředkovatele kryptografických služeb pro buď privátního nebo veřejného klíče certifikátu, v závislosti na parametrech předaný metodě.</span><span class="sxs-lookup"><span data-stu-id="0d492-124">This method is called by the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] security framework to obtain an instance of the <xref:System.Security.Cryptography.AsymmetricAlgorithm> class that represents the cryptographic provider for either the certificate's private or public key, depending on the parameters passed to the method.</span></span>  
  
5.  <span data-ttu-id="0d492-125">Volitelné.</span><span class="sxs-lookup"><span data-stu-id="0d492-125">Optional.</span></span> <span data-ttu-id="0d492-126">Přepsání <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetHashAlgorithmForSignature%2A> metoda.</span><span class="sxs-lookup"><span data-stu-id="0d492-126">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetHashAlgorithmForSignature%2A> method.</span></span> <span data-ttu-id="0d492-127">Potlačí tuto metodu, pokud na různé implementace <xref:System.Security.Cryptography.HashAlgorithm> je vyžadován.</span><span class="sxs-lookup"><span data-stu-id="0d492-127">Override this method if a different implementation of the <xref:System.Security.Cryptography.HashAlgorithm> class is required.</span></span>  
  
6.  <span data-ttu-id="0d492-128">Přepsání <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetSignatureFormatter%2A> metoda.</span><span class="sxs-lookup"><span data-stu-id="0d492-128">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetSignatureFormatter%2A> method.</span></span> <span data-ttu-id="0d492-129">Tato metoda vrací instanci třídy <xref:System.Security.Cryptography.AsymmetricSignatureFormatter> třídy, který je přidružený privátní klíč certifikátu.</span><span class="sxs-lookup"><span data-stu-id="0d492-129">This method returns an instance of the <xref:System.Security.Cryptography.AsymmetricSignatureFormatter> class that is associated with the certificate's private key.</span></span>  
  
7.  <span data-ttu-id="0d492-130">Přepsání <xref:System.IdentityModel.Tokens.SecurityKey.IsSupportedAlgorithm%2A> metoda.</span><span class="sxs-lookup"><span data-stu-id="0d492-130">Override the <xref:System.IdentityModel.Tokens.SecurityKey.IsSupportedAlgorithm%2A> method.</span></span> <span data-ttu-id="0d492-131">Tato metoda se používá k označení, zda je podporováno konkrétní kryptografický algoritmus klíče implementace zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="0d492-131">This method is used to indicate whether a particular cryptographic algorithm is supported by the security key implementation.</span></span>  
  
     [!code-csharp[c_CustomX509Token#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#1)]
     [!code-vb[c_CustomX509Token#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#1)]  
  
 <span data-ttu-id="0d492-132">Následující postup ukazuje, jak integrovat vlastní X.509 zabezpečení asymetrického klíče implementace vytvořili v předchozím postupu se [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] framework zabezpečení, aby bylo možné nahradit token zabezpečení poskytované systémem X.509.</span><span class="sxs-lookup"><span data-stu-id="0d492-132">The following procedure shows how to integrate the custom X.509 asymmetric security key implementation created in the preceding procedure with the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] security framework in order to replace the system-provided X.509 security token.</span></span>  
  
#### <a name="to-replace-the-system-provided-x509-security-token-with-a-custom-x509-asymmetric-security-key-token"></a><span data-ttu-id="0d492-133">Nahradit token zabezpečení poskytované systémem X.509 vlastní X.509 asymetrického klíče token zabezpečení</span><span class="sxs-lookup"><span data-stu-id="0d492-133">To replace the system-provided X.509 security token with a custom X.509 asymmetric security key token</span></span>  
  
1.  <span data-ttu-id="0d492-134">Vytvoření vlastního tokenu zabezpečení X.509, který vrací vlastní klíč asymetrické zabezpečení X.509 místo klíč zabezpečení poskytované systémem, jak je znázorněno v následujícím příkladu.</span><span class="sxs-lookup"><span data-stu-id="0d492-134">Create a custom X.509 security token that returns the custom X.509 asymmetric security key instead of the system-provided security key, as shown in the following example.</span></span> <span data-ttu-id="0d492-135">Další informace o tokeny vlastní zabezpečení najdete v tématu [postupy: vytvoření vlastního tokenu](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="0d492-135">For more information about custom security tokens, see [How to: Create a Custom Token](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#2)]
     [!code-vb[c_CustomX509Token#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#2)]  
  
2.  <span data-ttu-id="0d492-136">Vytvořte vlastní zabezpečovací zprostředkovatele tokenů, který vrátí token zabezpečení vlastní X.509, jak je znázorněno v příkladu.</span><span class="sxs-lookup"><span data-stu-id="0d492-136">Create a custom security token provider that returns a custom X.509 security token, as shown in the example.</span></span> <span data-ttu-id="0d492-137">Další informace o poskytovatele tokenů vlastní zabezpečení najdete v tématu [postupy: vytvoření vlastního poskytovatele tokenu zabezpečení](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md).</span><span class="sxs-lookup"><span data-stu-id="0d492-137">For more information about custom security token providers, see [How to: Create a Custom Security Token Provider](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#3)]
     [!code-vb[c_CustomX509Token#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#3)]  
  
3.  <span data-ttu-id="0d492-138">Pokud klíč vlastní zabezpečení se musí použít na straně iniciátor, vytvořte vlastní klienta Správce tokenů zabezpečení a vlastních klientských třídy přihlašovací údaje, jak je znázorněno v následujícím příkladu.</span><span class="sxs-lookup"><span data-stu-id="0d492-138">If the custom security key needs to be used on the initiator side, create a custom client security token manager and custom client credentials classes, as shown in the following example.</span></span> <span data-ttu-id="0d492-139">Další informace o pověření vlastního klienta a správci tokenu zabezpečení klienta najdete v tématu [návod: vytvoření vlastního klienta a pověření služby](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="0d492-139">For more information about custom client credentials and client security token managers, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#4)]
     [!code-vb[c_CustomX509Token#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#4)]  
  
     [!code-csharp[c_CustomX509Token#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#6)]
     [!code-vb[c_CustomX509Token#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#6)]  
  
4.  <span data-ttu-id="0d492-140">Pokud klíč vlastní zabezpečení se musí použít na straně příjemce, vytvořte Správce tokenů zabezpečení vlastní služby a přihlašovací údaje vlastní služby, jak je znázorněno v následujícím příkladu.</span><span class="sxs-lookup"><span data-stu-id="0d492-140">If the custom security key needs to be used on the recipient side, create a custom service security token manager and custom service credentials, as shown in the following example.</span></span> <span data-ttu-id="0d492-141">Další informace o pověření vlastní služby a služby jako správci tokenu zabezpečení najdete v tématu [návod: vytvoření vlastního klienta a pověření služby](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="0d492-141">For more information about custom service credentials and service security token managers, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#5)]
     [!code-vb[c_CustomX509Token#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#5)]  
  
     [!code-csharp[c_CustomX509Token#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#7)]
     [!code-vb[c_CustomX509Token#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#7)]  
  
## <a name="see-also"></a><span data-ttu-id="0d492-142">Viz také</span><span class="sxs-lookup"><span data-stu-id="0d492-142">See Also</span></span>  
 <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey>  
 <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey>  
 <xref:System.IdentityModel.Tokens.SecurityKey>  
 <xref:System.Security.Cryptography.AsymmetricAlgorithm>  
 <xref:System.Security.Cryptography.HashAlgorithm>  
 <xref:System.Security.Cryptography.AsymmetricSignatureFormatter>  
 [<span data-ttu-id="0d492-143">Návod: Vytvoření vlastních přihlašovacích údajů klienta a služby</span><span class="sxs-lookup"><span data-stu-id="0d492-143">Walkthrough: Creating Custom Client and Service Credentials</span></span>](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md)  
 [<span data-ttu-id="0d492-144">Postupy: Vytvoření vlastních ověřovacích dat tokenu zabezpečení</span><span class="sxs-lookup"><span data-stu-id="0d492-144">How to: Create a Custom Security Token Authenticator</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md)  
 [<span data-ttu-id="0d492-145">Postupy: Vytvoření vlastního zprostředkovatele tokenů zabezpečení</span><span class="sxs-lookup"><span data-stu-id="0d492-145">How to: Create a Custom Security Token Provider</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)  
 [<span data-ttu-id="0d492-146">Postupy: Vytvoření vlastního tokenu</span><span class="sxs-lookup"><span data-stu-id="0d492-146">How to: Create a Custom Token</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md)  
 [<span data-ttu-id="0d492-147">Architektura zabezpečení</span><span class="sxs-lookup"><span data-stu-id="0d492-147">Security Architecture</span></span>](http://msdn.microsoft.com/library/16593476-d36a-408d-808c-ae6fd483e28f)
