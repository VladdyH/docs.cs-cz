---
title: "Ukázka zabezpečení zjišťování"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: b8db01f4-b4a1-43fe-8e31-26d4e9304a65
caps.latest.revision: "13"
author: BrucePerlerMS
ms.author: bruceper
manager: mbaldwin
ms.openlocfilehash: 2b21017be0927f0d5189744111437c5afa6dd623
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/18/2017
---
# <a name="discovery-security-sample"></a><span data-ttu-id="60294-102">Ukázka zabezpečení zjišťování</span><span class="sxs-lookup"><span data-stu-id="60294-102">Discovery Security Sample</span></span>
<span data-ttu-id="60294-103">Specifikace zjišťování nevyžaduje, aby koncové body, které jsou součástí procesu zjišťování jako zabezpečené.</span><span class="sxs-lookup"><span data-stu-id="60294-103">The Discovery specification does not require that endpoints that participate in the discovery process to be secure.</span></span> <span data-ttu-id="60294-104">Rozšíření zjišťování zprávy s zabezpečení snižuje různé typy útoků (zprávy změnou, odepření služby, opakování, falšování identity).</span><span class="sxs-lookup"><span data-stu-id="60294-104">Enhancing the discovery messages with security mitigates various types of attacks (message alteration, denial of service, replay, spoofing).</span></span> <span data-ttu-id="60294-105">Tato ukázka implementuje vlastní kanály, které výpočetní a ověřte podpisy zpráv compact podpis formátu (popsaný v části 8.2 specifikace WS-Discovery).</span><span class="sxs-lookup"><span data-stu-id="60294-105">This sample implements custom channels that compute and verify message signatures using the compact signature format (described in Section 8.2 of the WS-Discovery specification).</span></span> <span data-ttu-id="60294-106">Ukázka podporuje i [2005 zjišťování specifikace](http://go.microsoft.com/fwlink/?LinkId=177912) a [verze 1.1](http://go.microsoft.com/fwlink/?LinkId=179677).</span><span class="sxs-lookup"><span data-stu-id="60294-106">The sample supports both the [2005 Discovery specification](http://go.microsoft.com/fwlink/?LinkId=177912) and the [1.1 version](http://go.microsoft.com/fwlink/?LinkId=179677).</span></span>  
  
 <span data-ttu-id="60294-107">Vlastní kanál je použita na existující zásobníku kanál pro oznámení a zjišťování koncových bodů.</span><span class="sxs-lookup"><span data-stu-id="60294-107">The custom channel is applied on top of the existing channel stack for Discovery and Announcement endpoints.</span></span> <span data-ttu-id="60294-108">Tímto způsobem hlavičku podpis platí pro všechny zprávy určené.</span><span class="sxs-lookup"><span data-stu-id="60294-108">This way, a signature header is applied for every message sent.</span></span> <span data-ttu-id="60294-109">Ověření podpisu na přijatých zpráv a pokud neodpovídá nebo pokud zprávy neobsahuje podpis, jsou zprávy vyřadit.</span><span class="sxs-lookup"><span data-stu-id="60294-109">The signature is verified on received messages and when it does not match or when the messages do not have a signature, the messages are dropped.</span></span> <span data-ttu-id="60294-110">Příklad k podepisování a zkontrolujte zprávy, používá certifikáty.</span><span class="sxs-lookup"><span data-stu-id="60294-110">To sign and verify messages, the sample uses certificates.</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="60294-111">Diskusní</span><span class="sxs-lookup"><span data-stu-id="60294-111">Discussion</span></span>  
 <span data-ttu-id="60294-112">WCF velmi rozšiřitelný a umožňuje uživatelům možnost kanály podle potřeby přizpůsobit.</span><span class="sxs-lookup"><span data-stu-id="60294-112">WCF is very extensible and allows users the possibility to customize channels as desired.</span></span> <span data-ttu-id="60294-113">Ukázka implementuje element zabezpečené vazby a zjišťování, který sestaví zabezpečené kanály.</span><span class="sxs-lookup"><span data-stu-id="60294-113">The sample implements a discovery secure binding element that builds secure channels.</span></span> <span data-ttu-id="60294-114">Zabezpečené kanály použít ověřte podpisy zpráv a uplatňují na základě aktuálního zásobníku.</span><span class="sxs-lookup"><span data-stu-id="60294-114">The secure channels apply and verify message signatures and are applied on top of the current stack.</span></span>  
  
 <span data-ttu-id="60294-115">Element zabezpečené vazby sestavení objektů Factory zabezpečeného kanálu a moduly pro naslouchání kanálu.</span><span class="sxs-lookup"><span data-stu-id="60294-115">The secure binding element builds secure channel factories and channel listeners.</span></span>  
  
## <a name="secure-channel-factory"></a><span data-ttu-id="60294-116">Zabezpečeného kanálu</span><span class="sxs-lookup"><span data-stu-id="60294-116">Secure Channel Factory</span></span>  
 <span data-ttu-id="60294-117">Objekt factory zabezpečený kanál vytvoří výstupní nebo duplexní kanály, které přidat compact podpis do záhlaví zpráv.</span><span class="sxs-lookup"><span data-stu-id="60294-117">The secure channel factory creates output or duplex channels that add a compact signature to message headers.</span></span> <span data-ttu-id="60294-118">Chcete-li zachovat zprávy co nejmenší compact podpis formát byl použit.</span><span class="sxs-lookup"><span data-stu-id="60294-118">To keep messages as small as possible the compact signature format is used.</span></span> <span data-ttu-id="60294-119">Struktura compact podpisu je znázorněno v následujícím příkladu.</span><span class="sxs-lookup"><span data-stu-id="60294-119">The structure of a compact signature is shown in the following example.</span></span>  
  
```xml  
<d:Security ... >   
  [<d:Sig Scheme="xs:anyURI"   
         [KeyId="xs:base64Binary"]?  
          Refs="..."  
         [PrefixList]="xs:NMTOKENS"   
          Sig="xs:base64Binary"   
          ... />]?  
  ...   
</d:Security>  
```  
  
> [!NOTE]
>  <span data-ttu-id="60294-120">`PrefixList` Byl přidán protokolu verze zjišťování 2008.</span><span class="sxs-lookup"><span data-stu-id="60294-120">The `PrefixList` was added in the 2008 Discovery version protocol.</span></span>  
  
 <span data-ttu-id="60294-121">Vypočítat podpis, určuje ukázku rozšířené podpis položky.</span><span class="sxs-lookup"><span data-stu-id="60294-121">To compute the signature, the sample determines the expanded signature items.</span></span> <span data-ttu-id="60294-122">Podpis XML (`SignedInfo`) je vytvořený pomocí `ds` předponu oboru názvů, podle potřeby ve specifikaci WS-Discovery.</span><span class="sxs-lookup"><span data-stu-id="60294-122">An XML signature (`SignedInfo`) is created, using the `ds` namespace prefix, as required by the WS-Discovery specification.</span></span> <span data-ttu-id="60294-123">Text a všechny hlavičky v zjišťování a adresování obory názvů se odkazuje v podpisu, aby nemohlo být manipulováno s.</span><span class="sxs-lookup"><span data-stu-id="60294-123">The body and all the headers in discovery and addressing namespaces are referenced in the signature, so they cannot be tampered with.</span></span> <span data-ttu-id="60294-124">Každý odkazovaný element převede pomocí výhradní kanonizace (http://www.w3.org/2001/10/xml-exc-c14n#) a potom hodnotu hodnotu hash SHA-1 je počítaný (http://www.w3.org/2000/09/xmldsig#sha1).</span><span class="sxs-lookup"><span data-stu-id="60294-124">Each referenced element is transformed using the Exclusive Canonicalization (http://www.w3.org/2001/10/xml-exc-c14n# ), and then an SHA-1 digest value is computed (http://www.w3.org/2000/09/xmldsig#sha1 ).</span></span> <span data-ttu-id="60294-125">Na základě všechny odkazované elementy a jejich hodnoty digest, podpis hodnota je vypočítána pomocí algoritmu RSA (http://www.w3.org/2000/09/xmldsig#rsa-sha1).</span><span class="sxs-lookup"><span data-stu-id="60294-125">Based on all referenced elements and their digest values, the signature value is computed using the RSA algorithm (http://www.w3.org/2000/09/xmldsig#rsa-sha1 ).</span></span>  
  
 <span data-ttu-id="60294-126">Zprávy jsou podepsané certifikátem zadaného klienta.</span><span class="sxs-lookup"><span data-stu-id="60294-126">The messages are signed with a client-specified certificate.</span></span> <span data-ttu-id="60294-127">Umístění úložiště, název a název subjektu certifikátu musí zadat při vytváření prvku vazby.</span><span class="sxs-lookup"><span data-stu-id="60294-127">The store location, name and the certificate subject name must be specified when the binding element is created.</span></span> <span data-ttu-id="60294-128">`KeyId` v compact podpis představuje identifikátor klíče podpisového tokenu a je subjektu klíč identifikátor (identifikátor klíče subjektu) podpisový tokenu nebo (Pokud identifikátor klíče subjektu neexistuje) hash SHA-1 podpisový tokenu veřejného klíče.</span><span class="sxs-lookup"><span data-stu-id="60294-128">The `KeyId` in the compact signature represents the key identifier of the signing token and is the Subject Key Identifier (SKI) of the signing token or (if the SKI does not exist) a SHA-1 hash of the public key of the signing token.</span></span>  
  
## <a name="secure-channel-listener"></a><span data-ttu-id="60294-129">Zabezpečený kanál naslouchání</span><span class="sxs-lookup"><span data-stu-id="60294-129">Secure Channel Listener</span></span>  
 <span data-ttu-id="60294-130">Naslouchací proces zabezpečený kanál vytvoří vstupní nebo duplexní kanály, které ověřují compact podpis v přijatých zpráv.</span><span class="sxs-lookup"><span data-stu-id="60294-130">The secure channel listener creates input or duplex channels that verify the compact signature in received messages.</span></span> <span data-ttu-id="60294-131">Ověření podpisu, `KeyId` zadaný v zkomprimovat podpisu připojeného ke zprávě slouží k výběru certifikát z určeného úložiště.</span><span class="sxs-lookup"><span data-stu-id="60294-131">To verify the signature, the `KeyId` specified in the compact signature attached to the message is used to select a certificate from the specified store.</span></span> <span data-ttu-id="60294-132">Pokud zpráva nemá podpis nebo Kontrola podpisu selže, jsou zprávy vyřadit.</span><span class="sxs-lookup"><span data-stu-id="60294-132">If the message does not have a signature or the signature check fails, the messages are dropped.</span></span> <span data-ttu-id="60294-133">Pokud chcete používat zabezpečené vazby, ukázky definuje objekt factory, který vytvoří vlastní <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> a <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> s elementem zabezpečené vazby přidané zjišťování.</span><span class="sxs-lookup"><span data-stu-id="60294-133">To use the secure binding, the sample defines a factory that creates custom <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> and <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> with the added discovery secure binding element.</span></span> <span data-ttu-id="60294-134">Naslouchací procesy oznámení zjišťování a zjistitelný služeb lze tyto zabezpečené koncové body.</span><span class="sxs-lookup"><span data-stu-id="60294-134">These secure endpoints can be used in discovery announcement listeners and discoverable services.</span></span>  
  
## <a name="sample-details"></a><span data-ttu-id="60294-135">Ukázka podrobnosti</span><span class="sxs-lookup"><span data-stu-id="60294-135">Sample Details</span></span>  
 <span data-ttu-id="60294-136">Ukázka obsahuje knihovnu a 4 konzolové aplikace:</span><span class="sxs-lookup"><span data-stu-id="60294-136">The sample includes a library and 4 console applications:</span></span>  
  
-   <span data-ttu-id="60294-137">**DiscoverySecurityChannels**: knihovnu, která zveřejňuje zabezpečené vazby.</span><span class="sxs-lookup"><span data-stu-id="60294-137">**DiscoverySecurityChannels**: A library that exposes the secure binding.</span></span> <span data-ttu-id="60294-138">Knihovny vypočítá a ověří compact podpis pro odchozí nebo příchozí zprávy.</span><span class="sxs-lookup"><span data-stu-id="60294-138">The library computes and verifies the compact signature for outgoing/incoming messages.</span></span>  
  
-   <span data-ttu-id="60294-139">**Služba**: vystavení ICalculatorService kontrakt služby s vlastním hostováním.</span><span class="sxs-lookup"><span data-stu-id="60294-139">**Service**: A service exposing ICalculatorService contract, self hosted.</span></span> <span data-ttu-id="60294-140">Služba je označena jako zjistitelné.</span><span class="sxs-lookup"><span data-stu-id="60294-140">The service is marked as Discoverable.</span></span> <span data-ttu-id="60294-141">Určuje podrobnosti certifikát používaný k podepisování zpráv tak, že zadáte umístění úložiště a název a název předmětu nebo jiný jedinečný identifikátor pro certifikát uživatele a úložiště, kde jsou klientské certifikáty umístěny (certifikátů používaných pro Zkontrolujte, zda podpis pro příchozí zprávy).</span><span class="sxs-lookup"><span data-stu-id="60294-141">The user specifies the details of the certificate used to sign messages by specifying the store location and name and the subject name or other unique identifier for the certificate, and the store where the client certificates are located (the certificates used to check signature for incoming messages).</span></span> <span data-ttu-id="60294-142">Podle toho, tyto podrobnosti, je UdpDiscoveryEndpoint s zvýšení zabezpečení vytvořené a používat.</span><span class="sxs-lookup"><span data-stu-id="60294-142">Based on these details, a UdpDiscoveryEndpoint with added security is built and used.</span></span>  
  
-   <span data-ttu-id="60294-143">**Klient**: Tato třída se pokusí zjistit ICalculatorService a volat metody pro službu.</span><span class="sxs-lookup"><span data-stu-id="60294-143">**Client**: This class tries to discover an ICalculatorService and to call methods on the service.</span></span> <span data-ttu-id="60294-144">Znovu <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> s přidat zabezpečení je vytvořená a použít k podepsání a ověření zprávy.</span><span class="sxs-lookup"><span data-stu-id="60294-144">Again, a <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> with added security is built and used to sign and verify the messages.</span></span>  
  
-   <span data-ttu-id="60294-145">**AnnouncementListener**: samoobslužné hostovanou službu, která naslouchá online a offline oznámení a používá koncový bod zabezpečené oznámení.</span><span class="sxs-lookup"><span data-stu-id="60294-145">**AnnouncementListener**: A self-hosted service that listens for online and offline announcements and uses the secure announcement endpoint.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="60294-146">Když Setup.bat je spustit vícekrát, vyzve vás správce certifikátů pro zvolit certifikát, který chcete přidat, protože existují duplicitní certifikáty.</span><span class="sxs-lookup"><span data-stu-id="60294-146">If Setup.bat is run multiple times, the certificate manager prompts you for choosing a certificate to add, as there are duplicate certificates.</span></span> <span data-ttu-id="60294-147">V takovém případě by měl být Setup.bat přerušena a Cleanup.bat by měla být volána, protože tyto duplikáty již byly vytvořeny.</span><span class="sxs-lookup"><span data-stu-id="60294-147">In that case, Setup.bat should be aborted and Cleanup.bat should be called, because the duplicates have already been created.</span></span> <span data-ttu-id="60294-148">CleanUp.bat taky výzva k výběru certifikát odstranit.</span><span class="sxs-lookup"><span data-stu-id="60294-148">Cleanup.bat also prompts you to choose a certificate to delete.</span></span> <span data-ttu-id="60294-149">Vyberte certifikát ze seznamu a pokračovat v provádění Cleanup.bat, dokud se zbývající žádné certifikáty.</span><span class="sxs-lookup"><span data-stu-id="60294-149">Select a certificate from the list and continue executing Cleanup.bat until no certificates are remaining.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="60294-150">Pro fungování této ukázky</span><span class="sxs-lookup"><span data-stu-id="60294-150">To use this sample</span></span>  
  
1.  <span data-ttu-id="60294-151">Spusťte skript Setup.bat z příkazového řádku Visual Studia.</span><span class="sxs-lookup"><span data-stu-id="60294-151">Execute the Setup.bat script from a Visual Studio command prompt.</span></span> <span data-ttu-id="60294-152">Ukázka používá certifikáty pro podepsání a ověření zprávy.</span><span class="sxs-lookup"><span data-stu-id="60294-152">The sample uses certificates to sign and verify messages.</span></span> <span data-ttu-id="60294-153">Skript vytvoří certifikáty pomocí Makecert.exe a potom nainstaluje je pomocí Certmgr.exe.</span><span class="sxs-lookup"><span data-stu-id="60294-153">The script creates the certificates using Makecert.exe and then installs them using Certmgr.exe.</span></span> <span data-ttu-id="60294-154">Skript musí být spuštěn s oprávněními správce.</span><span class="sxs-lookup"><span data-stu-id="60294-154">The script must be run with administrator privileges.</span></span>  
  
2.  <span data-ttu-id="60294-155">Sestavení a spuštění ukázky, otevřete soubor Security.sln v sadě Visual Studio a zvolte **znovu vytvořit všechny**.</span><span class="sxs-lookup"><span data-stu-id="60294-155">To build and run the sample, open the Security.sln file in Visual Studio and choose **Rebuild All**.</span></span> <span data-ttu-id="60294-156">Aktualizovat vlastnosti řešení spuštění více projektů: vyberte **spustit** pro všechny projekty s výjimkou DiscoverySecureChannels.</span><span class="sxs-lookup"><span data-stu-id="60294-156">Update the solution properties to start multiple projects: select **Start** for all projects except DiscoverySecureChannels.</span></span> <span data-ttu-id="60294-157">Spuštění řešení normálně.</span><span class="sxs-lookup"><span data-stu-id="60294-157">Run the solution normally.</span></span>  
  
3.  <span data-ttu-id="60294-158">Jakmile jste hotovi s ukázkou spusťte Cleanup.bat skript, který odstraní certifikáty vytvořené pro tuto ukázku.</span><span class="sxs-lookup"><span data-stu-id="60294-158">After you are done with the sample, execute the Cleanup.bat script that removes the certificates created for this sample.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="60294-159">Ukázky může být již nainstalována na váš počítač.</span><span class="sxs-lookup"><span data-stu-id="60294-159">The samples may already be installed on your machine.</span></span> <span data-ttu-id="60294-160">Před pokračováním zkontrolovat na následující adresář (výchozí).</span><span class="sxs-lookup"><span data-stu-id="60294-160">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="60294-161">Pokud tento adresář neexistuje, přejděte na [Windows Communication Foundation (WCF) a ukázky Windows Workflow Foundation (WF) pro rozhraní .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) ke stažení všechny [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] a [!INCLUDE[wf1](../../../../includes/wf1-md.md)] ukázky.</span><span class="sxs-lookup"><span data-stu-id="60294-161">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="60294-162">Tato ukázka se nachází v následujícím adresáři.</span><span class="sxs-lookup"><span data-stu-id="60294-162">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Scenario\DiscoveryScenario`  
  
## <a name="see-also"></a><span data-ttu-id="60294-163">Viz také</span><span class="sxs-lookup"><span data-stu-id="60294-163">See Also</span></span>
