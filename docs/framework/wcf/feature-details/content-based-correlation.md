---
title: Korelace na základě obsahu
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: f46a2b68-8d24-4122-bbee-9573fc3f9fb4
caps.latest.revision: 17
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: 4b4ebd49fbed12f1e8120e67f32496cd782531da
ms.sourcegitcommit: 94d33cadc5ff81d2ac389bf5f26422c227832052
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/30/2018
---
# <a name="content-based-correlation"></a><span data-ttu-id="b59d7-102">Korelace na základě obsahu</span><span class="sxs-lookup"><span data-stu-id="b59d7-102">Content Based Correlation</span></span>
<span data-ttu-id="b59d7-103">Když pracovní postup služby komunikaci s klienty a další služby, je často některá data v výměně zpráv, který jednoznačně zpráva má vztah k určité instance.</span><span class="sxs-lookup"><span data-stu-id="b59d7-103">When workflow services communicate with clients and other services, often there is some data in the exchanged messages that uniquely relates a message to a particular instance.</span></span> <span data-ttu-id="b59d7-104">Korelace na základě obsahu používá tato data ve zprávě, jako je například číslo nebo pořadí ID zákazníka, pro směrování zpráv do instance správné pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="b59d7-104">Content-based correlation uses this data in the message, such as a customer number or order ID, to route messages to the proper workflow instance.</span></span> <span data-ttu-id="b59d7-105">Toto téma vysvětluje, jak používat korelace na základě obsahu v pracovních postupech.</span><span class="sxs-lookup"><span data-stu-id="b59d7-105">This topic explains how to use content-based correlation in workflows.</span></span>  
  
## <a name="using-content-based-correlation"></a><span data-ttu-id="b59d7-106">Pomocí korelace na základě obsahu</span><span class="sxs-lookup"><span data-stu-id="b59d7-106">Using Content-Based Correlation</span></span>  
 <span data-ttu-id="b59d7-107">Korelace na základě obsahu se používá, když pracovní postup služby má několik metod, které jsou dostupné přes jednoho klienta a část dat v výměně zpráv určuje požadovanou instanci.</span><span class="sxs-lookup"><span data-stu-id="b59d7-107">Content-based correlation is used when a workflow service has multiple methods that are accessed by a single client and a piece of data in the exchanged messages identifies the desired instance.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="b59d7-108">Korelace na základě obsahu je užitečné, když korelace kontextu nelze použít, protože vazba není jedním z podporovaných kontext vazby exchange.</span><span class="sxs-lookup"><span data-stu-id="b59d7-108">Content-based correlation is useful when context correlation cannot be used because the binding is not one of the supported context exchange bindings.</span></span> <span data-ttu-id="b59d7-109">Další informace o kontextu korelace najdete v tématu [kontextová výměna](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md).</span><span class="sxs-lookup"><span data-stu-id="b59d7-109">For more information about context correlation, see [Context Exchange](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md).</span></span>  
  
 <span data-ttu-id="b59d7-110">Každá zasílání zpráv aktivita používá v tyto komunikace musíte zadat umístění dat ve zprávě, která jednoznačně identifikuje instanci.</span><span class="sxs-lookup"><span data-stu-id="b59d7-110">Each messaging activity used in these communications must specify the location of the data in the message that uniquely identifies the instance.</span></span> <span data-ttu-id="b59d7-111">To se provádí zadáním <xref:System.ServiceModel.MessageQuerySet>, buď pomocí <xref:System.ServiceModel.Activities.QueryCorrelationInitializer> nebo <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A>, který dotazuje zprávu pro část nebo kusy data, která jednoznačně instance.</span><span class="sxs-lookup"><span data-stu-id="b59d7-111">This is done by providing a <xref:System.ServiceModel.MessageQuerySet>, using either a <xref:System.ServiceModel.Activities.QueryCorrelationInitializer> or <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A>, that queries the message for the piece or pieces of data that uniquely identify the instance.</span></span>  
  
> [!WARNING]
>  <span data-ttu-id="b59d7-112">Data, která se používá k identifikaci instance je algoritmus hash, do klíče korelace.</span><span class="sxs-lookup"><span data-stu-id="b59d7-112">The data that is used to identify the instance is hashed into a correlation key.</span></span> <span data-ttu-id="b59d7-113">Dbát musí zajistit, že data pro korelačního jedinečné, jinak může dojít a způsobit zpráv, které mají být nesprávně směrovanými kolizí v klíči hash.</span><span class="sxs-lookup"><span data-stu-id="b59d7-113">Care must be taken to ensure that the data used for correlation is unique or else collisions in the hashed key could occur and cause messages to be misrouted.</span></span> <span data-ttu-id="b59d7-114">Například existuje korelace zakládá výhradně na jménu zákazníka mohou způsobit kolize, protože může být více zákazníků se stejným názvem.</span><span class="sxs-lookup"><span data-stu-id="b59d7-114">For example, a correlation based solely on a customer name may cause a collision because there may be multiple customers with the same name.</span></span> <span data-ttu-id="b59d7-115">Dvojtečkou (`:`) nesmí být použity jako součást dat použít ke korelaci zprávu, protože se již používá pro vymezení klíč a hodnotu a vytvořit řetězec, který je následně rozdělí dotazu zprávu.</span><span class="sxs-lookup"><span data-stu-id="b59d7-115">The colon (`:`) should not be used as part of the data used to correlate the message because it is already used to delimit the message query’s key and value to form the string that is subsequently hashed.</span></span>  
  
 <span data-ttu-id="b59d7-116">V následujícím příkladu, počáteční <xref:System.ServiceModel.Activities.Receive> / <xref:System.ServiceModel.Activities.SendReply> ve službě pracovní postup vrátí `OrderId`, který byl následně předán zpět klientem při volání těchto <xref:System.ServiceModel.Activities.Receive> aktivity v rámci služby pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="b59d7-116">In the following example, the initial <xref:System.ServiceModel.Activities.Receive>/<xref:System.ServiceModel.Activities.SendReply> in a workflow service returns an `OrderId`, which is then passed back by the client on the call to the following <xref:System.ServiceModel.Activities.Receive> activity in the workflow service.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#1)]  
  
 <span data-ttu-id="b59d7-117">Ukazuje předchozí příklad korelace na základě obsahu, který se inicializuje pomocí <xref:System.ServiceModel.Activities.SendReply>.</span><span class="sxs-lookup"><span data-stu-id="b59d7-117">The previous example shows a content-based correlation that is initialized by the <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="b59d7-118"><xref:System.ServiceModel.MessageQuerySet> Určuje, že se data použít k identifikaci následné zprávy a pokuste se tato služba `OrderId`.</span><span class="sxs-lookup"><span data-stu-id="b59d7-118">The <xref:System.ServiceModel.MessageQuerySet> specifies that the data used to identify subsequent messages to this service is the `OrderId`.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)]  
  
 <span data-ttu-id="b59d7-119"><xref:System.ServiceModel.Activities.Receive> Aktivitě, která následuje <xref:System.ServiceModel.Activities.SendReply> v pracovním postupu následuje korelace, který byl inicializován nástrojem <xref:System.ServiceModel.Activities.SendReply>.</span><span class="sxs-lookup"><span data-stu-id="b59d7-119">The <xref:System.ServiceModel.Activities.Receive> activity that follows the <xref:System.ServiceModel.Activities.SendReply> in the workflow follows the correlation that was initialized by the <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="b59d7-120">Obě aktivity sdílejí stejné <xref:System.ServiceModel.Activities.CorrelationHandle>, ale každé z nich má svou vlastní <xref:System.ServiceModel.MessageQuerySet> a <xref:System.ServiceModel.XPathMessageQuery> určující, kde je identifikace data v této konkrétní zprávě.</span><span class="sxs-lookup"><span data-stu-id="b59d7-120">Both activities share the same <xref:System.ServiceModel.Activities.CorrelationHandle>, but each one has its own <xref:System.ServiceModel.MessageQuerySet> and <xref:System.ServiceModel.XPathMessageQuery> that specifies where the identifying data is in that particular message.</span></span> <span data-ttu-id="b59d7-121">Na aktivitu, která inicializuje korelace to <xref:System.ServiceModel.MessageQuerySet> je uveden v <xref:System.ServiceModel.Activities.Receive.CorrelationInitializers%2A> vlastnost a pro všechny následující <xref:System.ServiceModel.Activities.Receive> aktivity, je zadán pomocí <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A> vlastnost.</span><span class="sxs-lookup"><span data-stu-id="b59d7-121">On the activity that initializes the correlation, this <xref:System.ServiceModel.MessageQuerySet> is specified in the <xref:System.ServiceModel.Activities.Receive.CorrelationInitializers%2A> property, and for any following <xref:System.ServiceModel.Activities.Receive> activities, it is specified using the <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A> property.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)]  
  
 <span data-ttu-id="b59d7-122">Existuje korelace na základě obsahu můžete inicializovat pomocí všechny aktivity zasílání zpráv (<xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.Receive>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.ReceiveReply>) při tok dat v rámci zprávy.</span><span class="sxs-lookup"><span data-stu-id="b59d7-122">A content-based correlation can be initialized by any messaging activity (<xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.Receive>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.ReceiveReply>) when the data flows as part of a message.</span></span> <span data-ttu-id="b59d7-123">Pokud jako součást zprávu nepostupuje konkrétním dat, pak může být inicializována explicitně pomocí <xref:System.ServiceModel.Activities.InitializeCorrelation> aktivity.</span><span class="sxs-lookup"><span data-stu-id="b59d7-123">If the particular piece of data does not flow as part of a message, then it can be initialized explicitly by using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span> <span data-ttu-id="b59d7-124">Pokud data na více místech jsou potřeba k jednoznačné identifikaci zprávy, pak lze přidat více dotazů <xref:System.ServiceModel.MessageQuerySet>.</span><span class="sxs-lookup"><span data-stu-id="b59d7-124">If multiple pieces of data are required to uniquely identify the message, then multiple queries can be added to the <xref:System.ServiceModel.MessageQuerySet>.</span></span> <span data-ttu-id="b59d7-125">V těchto příkladech <xref:System.ServiceModel.Activities.CorrelationHandle> explicitně zadaná pro všechny aktivity pomocí `CorrelatesWith` nebo `CorrelationHandle` vlastnosti, ale pokud existuje jenom jedna korelace požadované pro celý pracovní postup, například v tomto příkladu kde všechno korelaci na `OrderId`, správu popisovač implicitní korelace poskytované <xref:System.ServiceModel.Activities.WorkflowServiceHost> je dostačující.</span><span class="sxs-lookup"><span data-stu-id="b59d7-125">In these examples, a <xref:System.ServiceModel.Activities.CorrelationHandle> was explicitly provided to each of the activities using the `CorrelatesWith` or `CorrelationHandle` properties, but if there is only one correlation required for the entire workflow, such as in this example where everything correlates on `OrderId`, the implicit correlation handle management provided by <xref:System.ServiceModel.Activities.WorkflowServiceHost> is sufficient.</span></span>  
  
## <a name="using-the-initializecorrelation-activity"></a><span data-ttu-id="b59d7-126">Pomocí aktivity InitializeCorrelation</span><span class="sxs-lookup"><span data-stu-id="b59d7-126">Using the InitializeCorrelation Activity</span></span>  
 <span data-ttu-id="b59d7-127">V předchozím příkladu `OrderId` plynoucích volajícího prostřednictvím <xref:System.ServiceModel.Activities.SendReply> aktivitu a to je, kde byl inicializován korelaci.</span><span class="sxs-lookup"><span data-stu-id="b59d7-127">In the previous example, the `OrderId` flowed to the caller through the <xref:System.ServiceModel.Activities.SendReply> activity and this is where the correlation was initialized.</span></span> <span data-ttu-id="b59d7-128">Stejné chování se dá udělat pomocí <xref:System.ServiceModel.Activities.InitializeCorrelation> aktivity.</span><span class="sxs-lookup"><span data-stu-id="b59d7-128">The same behavior can be accomplished by using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span> <span data-ttu-id="b59d7-129"><xref:System.ServiceModel.Activities.InitializeCorrelation> Trvá aktivity <xref:System.ServiceModel.Activities.CorrelationHandle> a slovník položek, které představují data použít k mapování zprávy na správnou instanci.</span><span class="sxs-lookup"><span data-stu-id="b59d7-129">The <xref:System.ServiceModel.Activities.InitializeCorrelation> activity takes the <xref:System.ServiceModel.Activities.CorrelationHandle> and a dictionary of items that represent the data used to map the message to the correct instance.</span></span> <span data-ttu-id="b59d7-130">Použít <xref:System.ServiceModel.Activities.InitializeCorrelation> odebrat aktivitu v předchozím příkladu <xref:System.ServiceModel.Activities.SendReply.CorrelationInitializers%2A> z <xref:System.ServiceModel.Activities.SendReply> aktivity a inicializovat pomocí korelace <xref:System.ServiceModel.Activities.InitializeCorrelation> aktivity.</span><span class="sxs-lookup"><span data-stu-id="b59d7-130">To use the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity in the preceding sample, remove the <xref:System.ServiceModel.Activities.SendReply.CorrelationInitializers%2A> from the <xref:System.ServiceModel.Activities.SendReply> activity and initialize the correlation using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#4)]  
  
 <span data-ttu-id="b59d7-131"><xref:System.ServiceModel.Activities.InitializeCorrelation> Aktivita se pak používá v pracovním postupu po proměnné, které mají data jsou naplněny ale předtím, než <xref:System.ServiceModel.Activities.Receive> aktivity, které koreluje s inicializovaná <xref:System.ServiceModel.Activities.CorrelationHandle>.</span><span class="sxs-lookup"><span data-stu-id="b59d7-131">The <xref:System.ServiceModel.Activities.InitializeCorrelation> activity is then used in the workflow, after the variables that hold the data are populated but before the <xref:System.ServiceModel.Activities.Receive> activity that correlates with the initialized <xref:System.ServiceModel.Activities.CorrelationHandle>.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#5)]  
  
## <a name="configuring-xpath-queries-using-the-workflow-designer"></a><span data-ttu-id="b59d7-132">Konfigurace dotazů XPath pomocí návrháře pracovních postupů</span><span class="sxs-lookup"><span data-stu-id="b59d7-132">Configuring XPath Queries Using the Workflow Designer</span></span>  
 <span data-ttu-id="b59d7-133">V předchozích příkladech aktivity a dotazy jazyka XPath používají v dotazech zpráv byly zadány v kódu.</span><span class="sxs-lookup"><span data-stu-id="b59d7-133">In the previous examples, the activities and the XPath queries used in the message queries were specified in code.</span></span> <span data-ttu-id="b59d7-134">Návrhář postupu provádění v [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] také nabízí možnost k vygenerování výrazů XPath z `DataContract` typy pro korelace na základě obsahu.</span><span class="sxs-lookup"><span data-stu-id="b59d7-134">The workflow designer in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] also provides the ability to generate XPaths from `DataContract` types for content-based correlation.</span></span> <span data-ttu-id="b59d7-135">První výraz XPath nakonfigurované v předchozím příkladu byl nakonfigurován na <xref:System.ServiceModel.Activities.SendReply>.</span><span class="sxs-lookup"><span data-stu-id="b59d7-135">The first XPath configured in the previous example was configured for the <xref:System.ServiceModel.Activities.SendReply>.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)]  
  
 <span data-ttu-id="b59d7-136">Pokud chcete konfigurovat cestu XPath pro zasílání zpráv aktivity v Návrháři pracovních postupů, vyberte aktivitu v Návrháři pracovních postupů.</span><span class="sxs-lookup"><span data-stu-id="b59d7-136">To configure the XPath for a messaging activity in the workflow designer, select the activity in the workflow designer.</span></span> <span data-ttu-id="b59d7-137">Pokud aktivita je inicializace korelace, jako v předchozím příkladu, klikněte na tlačítko se třemi tečkami pro **CorrelationInitializers** vlastnost **vlastnosti** okno.</span><span class="sxs-lookup"><span data-stu-id="b59d7-137">If the activity is initializing the correlation, as in the previous example, click the ellipsis button for the **CorrelationInitializers** property in the **Properties** window.</span></span> <span data-ttu-id="b59d7-138">Zobrazí se **přidat inicializátory korelace** dialogového okna.</span><span class="sxs-lookup"><span data-stu-id="b59d7-138">This displays the **Add Correlation Initializers** dialog window.</span></span> <span data-ttu-id="b59d7-139">Z tohoto dialogového okna můžete zadat typ korelace a vyberte obsah, který slouží pro korelaci.</span><span class="sxs-lookup"><span data-stu-id="b59d7-139">From this dialog you can specify the correlation type and select the content that is used for the correlation.</span></span> <span data-ttu-id="b59d7-140"><xref:System.ServiceModel.Activities.CorrelationHandle> Proměnná zadaná v **přidat inicializátoru** pole a korelace typu a data pro korelaci je vybraný **dotazů XPath** části dialogového okna.</span><span class="sxs-lookup"><span data-stu-id="b59d7-140">The <xref:System.ServiceModel.Activities.CorrelationHandle> variable is specified in the **Add initializer** box, and the correlation type and data used for the correlation is selected from the **XPath Queries** section of the dialog box.</span></span>  
  
 <span data-ttu-id="b59d7-141">![Dialogové okno CorrelationInitializer](../../../../docs/framework/wcf/feature-details/media/correlationinitializerdlg.jpg "CorrelationInitializerDlg")</span><span class="sxs-lookup"><span data-stu-id="b59d7-141">![CorrelationInitializer Dialog](../../../../docs/framework/wcf/feature-details/media/correlationinitializerdlg.jpg "CorrelationInitializerDlg")</span></span>  
  
 <span data-ttu-id="b59d7-142">Druhý dotaz XPath v předchozím příkladu jste nakonfigurovali v <xref:System.ServiceModel.Activities.Receive> aktivity.</span><span class="sxs-lookup"><span data-stu-id="b59d7-142">The second XPath query in the previous example was configured in the <xref:System.ServiceModel.Activities.Receive> activity.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)]  
  
 <span data-ttu-id="b59d7-143">Pokud chcete nakonfigurovat dotaz XPath pro zasílání zpráv aktivity, která se neinicializuje korelaci, vyberte aktivitu v Návrháři pracovních postupů a pak klikněte na tlačítko se třemi tečkami pro **CorrelatesOn** vlastnost v  **Vlastnosti** okno.</span><span class="sxs-lookup"><span data-stu-id="b59d7-143">To configure the XPath query for a messaging activity that does not initialize the correlation, select the activity in the workflow designer and then click the ellipsis button for the **CorrelatesOn** property in the **Properties** window.</span></span> <span data-ttu-id="b59d7-144">Zobrazí se **CorrelatesOn definice** dialogového okna.</span><span class="sxs-lookup"><span data-stu-id="b59d7-144">This displays the **CorrelatesOn Definition** dialog window.</span></span>  
  
 <span data-ttu-id="b59d7-145">![Definice CorrelatesOn](../../../../docs/framework/wcf/feature-details/media/correlatesondialog.jpg "CorrelatesOnDialog")</span><span class="sxs-lookup"><span data-stu-id="b59d7-145">![CorrelatesOn Definition](../../../../docs/framework/wcf/feature-details/media/correlatesondialog.jpg "CorrelatesOnDialog")</span></span>  
  
 <span data-ttu-id="b59d7-146">Z tohoto dialogového okna zadejte <xref:System.ServiceModel.Activities.CorrelationHandle> a vyberte položky v **dotazů XPath** seznamu k vytvoření dotazu XPath.</span><span class="sxs-lookup"><span data-stu-id="b59d7-146">From this dialog you specify the <xref:System.ServiceModel.Activities.CorrelationHandle> and choose items in the **XPath Queries** list to build the XPath query.</span></span>
