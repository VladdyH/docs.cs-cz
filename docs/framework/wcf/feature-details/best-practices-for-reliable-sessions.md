---
title: "Doporučené postupy pro spolehlivé relace"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: b94f6e01-8070-40b6-aac7-a2cb7b4cb4f2
caps.latest.revision: "6"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: 6e20b5cf02e7aef31127bb88e27e21965a192a6b
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/18/2017
---
# <a name="best-practices-for-reliable-sessions"></a><span data-ttu-id="59739-102">Doporučené postupy pro spolehlivé relace</span><span class="sxs-lookup"><span data-stu-id="59739-102">Best Practices for Reliable Sessions</span></span>

<span data-ttu-id="59739-103">Toto téma popisuje osvědčené postupy pro spolehlivé relace.</span><span class="sxs-lookup"><span data-stu-id="59739-103">This topic discusses best practices for reliable sessions.</span></span>

## <a name="setting-maxtransferwindowsize"></a><span data-ttu-id="59739-104">Nastavení MaxTransferWindowSize</span><span class="sxs-lookup"><span data-stu-id="59739-104">Setting MaxTransferWindowSize</span></span>

<span data-ttu-id="59739-105">Spolehlivé relace v [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] použít okno přenosu pro uložení zpráv na klientovi a služby.</span><span class="sxs-lookup"><span data-stu-id="59739-105">Reliable sessions in [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] use a transfer window to hold messages on the client and service.</span></span> <span data-ttu-id="59739-106">Konfigurovatelná vlastnost <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> Určuje, kolik zpráv, které mohou být uloženy okno přenosu.</span><span class="sxs-lookup"><span data-stu-id="59739-106">The configurable property <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> indicates how many messages the transfer window can hold.</span></span>

<span data-ttu-id="59739-107">U odesílatele to znamená, kolik zpráv, které mohou být uloženy okno přenos při čekání na potvrzení; na příjemce znamená to, kolik zpráv do vyrovnávací paměti pro službu.</span><span class="sxs-lookup"><span data-stu-id="59739-107">On the sender, this indicates how many messages the transfer window can hold while waiting for acknowledgements; on the receiver, it indicates how many messages to buffer for the service.</span></span>

<span data-ttu-id="59739-108">Výběr správnou velikost ovlivňuje účinnost sítě a optimální kapacita služby.</span><span class="sxs-lookup"><span data-stu-id="59739-108">Choosing the right size impacts the efficiency of the network and the optimal capacity of the service.</span></span> <span data-ttu-id="59739-109">Následujících oddílech jsou upřesněny co je potřeba zvážit při výběru hodnotu této vlastnosti a vliv hodnoty.</span><span class="sxs-lookup"><span data-stu-id="59739-109">The following sections detail what to consider when choosing a value for this property and the impact of the value.</span></span>

<span data-ttu-id="59739-110">Výchozí velikost okna přenosu je osmi zprávy.</span><span class="sxs-lookup"><span data-stu-id="59739-110">The default transfer window size is eight messages.</span></span>

### <a name="efficient-use-of-the-network"></a><span data-ttu-id="59739-111">Efektivní využití sítě</span><span class="sxs-lookup"><span data-stu-id="59739-111">Efficient use of the network</span></span>

<span data-ttu-id="59739-112">V tomto kontextu termín *sítě* odpovídá všechno použít jako základ pro komunikaci mezi klientem (odesílatel) a služby (příjemce).</span><span class="sxs-lookup"><span data-stu-id="59739-112">In this context, the term *network* corresponds to everything used as the basis of communication between a client (sender) and a service (receiver).</span></span> <span data-ttu-id="59739-113">To zahrnuje připojení přenosu a všechny zprostředkovatele nebo mostů v mezi, včetně směrovače protokolu SOAP a HTTP proxy nebo brány firewall.</span><span class="sxs-lookup"><span data-stu-id="59739-113">This includes the transport connections and any intermediary or bridges in between, including SOAP routers or HTTP proxies/firewalls.</span></span>

<span data-ttu-id="59739-114">Efektivní využití sítě zajistí, že je plně použít dostatečnou kapacitu sítě.</span><span class="sxs-lookup"><span data-stu-id="59739-114">Efficient use of the network ensures that network capacity is fully used.</span></span> <span data-ttu-id="59739-115">Obě množství dat, které se dá přenést za sekundu přes síť (*přenosová rychlost*) a doby potřebné k přenosu dat od odesilatele k příjemci (*latence*) vliv jak efektivně sítě je použít.</span><span class="sxs-lookup"><span data-stu-id="59739-115">Both the amount of data that can be transferred per second over the network (*data rate*) and the time it takes to transfer data from the sender to the receiver (*latency*) impact how effectively the network is utilized.</span></span>

<span data-ttu-id="59739-116">Na odesílatele, vlastnost <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> Určuje, kolik zpráv jeho přenos okno pojme při čekání na potvrzení.</span><span class="sxs-lookup"><span data-stu-id="59739-116">On the sender, the property <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> indicates how many messages its transfer window can hold while waiting for acknowledgements.</span></span> <span data-ttu-id="59739-117">Pokud je latence sítě vysoké a aby se zajistilo přizpůsobivý odesílatele a využití efektivní sítě, měli byste zvýšit velikost okna přenosu.</span><span class="sxs-lookup"><span data-stu-id="59739-117">If the network latency is high and in order to ensure a responsive sender and effective network utilization, you should increase the transfer window size.</span></span>

<span data-ttu-id="59739-118">I v případě, že odesílatel držela s přenosovou rychlost, latenci může být například vysoké pokud existuje několik prostředníci mezi odesílatele a příjemce nebo data musí projít míru ztrát zprostředkovatele nebo sítě.</span><span class="sxs-lookup"><span data-stu-id="59739-118">For example even if the sender keeps up with data rate, latency could be high if several intermediaries exist between the sender and receiver or the data must pass through a lossy intermediary or network.</span></span> <span data-ttu-id="59739-119">Odesílatel proto musí čekat potvrzení pro zprávy v okně jeho přenos před přijetím nové zprávy k odeslání v drátové síti.</span><span class="sxs-lookup"><span data-stu-id="59739-119">Thus, the sender has to wait for acknowledgements for the messages in its transfer window before accepting new messages to send on the wire.</span></span> <span data-ttu-id="59739-120">Menší vyrovnávací paměti s vysokou latencí menší platné využití sítě.</span><span class="sxs-lookup"><span data-stu-id="59739-120">The smaller the buffer with high latency, the less effective the network utilization.</span></span> <span data-ttu-id="59739-121">Na druhé straně příliš vysoká. velikost okna přenosu může mít vliv na službu vzhledem k tomu, aby se do vysoká míra data odeslaná klientem, možná bude nutné službu.</span><span class="sxs-lookup"><span data-stu-id="59739-121">On the other hand, too high a transfer window size may impact the service because the service may need to catch up to the high rate of data sent by the client.</span></span>

### <a name="running-the-service-to-capacity"></a><span data-ttu-id="59739-122">Spuštěná služba kapacity</span><span class="sxs-lookup"><span data-stu-id="59739-122">Running the service to capacity</span></span>

<span data-ttu-id="59739-123">Tolik, jako síť se používá efektivně, ideálně také chcete službu spustit na optimální kapacitě.</span><span class="sxs-lookup"><span data-stu-id="59739-123">As much as the network is used efficiently, ideally you also want the service to run at optimal capacity.</span></span> <span data-ttu-id="59739-124">Vlastnost velikost okna přenos na příjemce udává, kolik zpráv příjemce může ukládat do vyrovnávací paměti.</span><span class="sxs-lookup"><span data-stu-id="59739-124">The transfer window size property on the receiver indicates how many messages the receiver can buffer.</span></span> <span data-ttu-id="59739-125">Tato zpráva ukládání do vyrovnávací paměti pomáhá nejen řízení toku sítě, ale také povoluje službu spustit na úplné kapacity.</span><span class="sxs-lookup"><span data-stu-id="59739-125">This message buffering helps not only the network flow control but also enables the service to run to full capacity.</span></span> <span data-ttu-id="59739-126">Například pokud vyrovnávací paměť je jednu zprávu a doručování zpráv rychleji, než služba dokáže zpracovat, pak v síti může vyřaďte zprávy a kapacity může být ke znehodnocení části nebo nedostatečně využité.</span><span class="sxs-lookup"><span data-stu-id="59739-126">For example if the buffer is one message and messages arrive faster than the service can process them, then the network might drop messages and capacity might be wasted or underutilized.</span></span>

<span data-ttu-id="59739-127">Používání vyrovnávací paměť zvyšuje dostupnost služby, jako souběžně obdrží a uloží zprávu při zpracování dříve přijatých zpráv.</span><span class="sxs-lookup"><span data-stu-id="59739-127">Using a buffer increases the availability of the service as it concurrently receives and buffers a message while processing the previously received messages.</span></span>

<span data-ttu-id="59739-128">Doporučujeme používat stejné `MaxTransferWindowSize` na odesílatele i příjemce.</span><span class="sxs-lookup"><span data-stu-id="59739-128">We recommended that you use the same `MaxTransferWindowSize` on both the sender and receiver.</span></span>

### <a name="enabling-flow-control"></a><span data-ttu-id="59739-129">Povolení řízení toku</span><span class="sxs-lookup"><span data-stu-id="59739-129">Enabling flow control</span></span>

<span data-ttu-id="59739-130">*Řízení toku* mechanismus, který zajišťuje, aby odesílatele a příjemce držet krok mezi sebou, to znamená, jsou zprávy spotřebované a reagovali na ni tak rychle, jak jste se vytváří.</span><span class="sxs-lookup"><span data-stu-id="59739-130">*Flow control* is a mechanism that ensures that the sender and receiver keep pace with each other, that is, the messages are consumed and acted upon as fast as they're produced.</span></span> <span data-ttu-id="59739-131">Velikost okna přenosu na klient a služba zajistí odesílatele a příjemce v rámci přiměřené období synchronizace.</span><span class="sxs-lookup"><span data-stu-id="59739-131">The transfer window size on the client and service ensures that the sender and receiver are within a reasonable window of synchronization.</span></span>

<span data-ttu-id="59739-132">Důrazně doporučujeme nastavit vlastnost <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.FlowControlEnabled%2A> k `true` když používáte spolehlivé relace mezi [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] klienta a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] služby.</span><span class="sxs-lookup"><span data-stu-id="59739-132">We highly recommended that you set the property <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.FlowControlEnabled%2A> to `true` when you're using a reliable session between a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client and a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service.</span></span>

## <a name="setting-maxpendingchannels"></a><span data-ttu-id="59739-133">Nastavení MaxPendingChannels</span><span class="sxs-lookup"><span data-stu-id="59739-133">Setting MaxPendingChannels</span></span>

<span data-ttu-id="59739-134">Při zápisu služba, která umožňuje komunikaci spolehlivé relace z různých klientů, je možné, že mnoho klientů vytvoření spolehlivé relace ve službě ve stejnou dobu.</span><span class="sxs-lookup"><span data-stu-id="59739-134">When writing a service that enables reliable session communication from different clients, it's possible to have many clients establish a reliable session to the service at the same time.</span></span> <span data-ttu-id="59739-135">Odpověď služby v těchto situacích závisí na `MaxPendingChannels` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="59739-135">The response of the service in these situations depends on the `MaxPendingChannels` property.</span></span>

<span data-ttu-id="59739-136">Odesílatel vytvoří kanál spolehlivé relace k příjemce, vytváří handshake mezi nimi spolehlivé relace.</span><span class="sxs-lookup"><span data-stu-id="59739-136">When the sender creates a reliable session channel to a receiver, a handshake between them establishes a reliable session.</span></span> <span data-ttu-id="59739-137">Po navázání spolehlivé relace kanál je uvést do fronty čekající kanál pro přijetí službou.</span><span class="sxs-lookup"><span data-stu-id="59739-137">After the reliable session is established, the channel is put in a pending channel queue for acceptance by the service.</span></span> <span data-ttu-id="59739-138">`MaxPendingChannels` Vlastnost udává, kolik kanály může být v tomto stavu.</span><span class="sxs-lookup"><span data-stu-id="59739-138">The `MaxPendingChannels` property indicates how many channels can be in this state.</span></span>

<span data-ttu-id="59739-139">Je možné, má být ve stavu, kde ji nemůže přijímat další kanály pro službu.</span><span class="sxs-lookup"><span data-stu-id="59739-139">It's possible for the service to be in a state where it can't accept more channels.</span></span> <span data-ttu-id="59739-140">Pokud fronta je plná, pokus o vytvoření spolehlivé relace se odmítne a klient musí opakovat pokus.</span><span class="sxs-lookup"><span data-stu-id="59739-140">If the queue is full, an attempt to establish a reliable session is rejected, and the client must retry.</span></span>

<span data-ttu-id="59739-141">Je také možné, že tyto kanály čekající na vyřízení ve frontě zůstat ve frontě delší dobu.</span><span class="sxs-lookup"><span data-stu-id="59739-141">It's also possible that the pending channels in the queue remain in the queue for a longer duration.</span></span> <span data-ttu-id="59739-142">Do té doby může dojít vypršení časového limitu nečinnosti na spolehlivé relace, způsobuje kanálu pro přechod do stavu chybou.</span><span class="sxs-lookup"><span data-stu-id="59739-142">In the meantime, an inactivity timeout on the reliable session may occur, causing the channel to transition to a faulted state.</span></span>

<span data-ttu-id="59739-143">Při zápisu služby, která obsluhuje víc klientů současně, byste měli nastavit hodnotu, která je vhodná pro vaše potřeby.</span><span class="sxs-lookup"><span data-stu-id="59739-143">When writing a service that services multiple clients simultaneously, you should set a value that's suitable for your needs.</span></span> <span data-ttu-id="59739-144">Nastavení příliš velkou hodnotu pro `MaxPendingChannels` vlastnost ovlivňuje pracovní sady.</span><span class="sxs-lookup"><span data-stu-id="59739-144">Setting too high a value for the `MaxPendingChannels` property impacts your working set.</span></span>

<span data-ttu-id="59739-145">Výchozí hodnota pro <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxPendingChannels%2A> je čtyři kanály.</span><span class="sxs-lookup"><span data-stu-id="59739-145">The default value for <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxPendingChannels%2A> is four channels.</span></span>

## <a name="reliable-sessions-and-hosting"></a><span data-ttu-id="59739-146">Spolehlivé relace a hostování</span><span class="sxs-lookup"><span data-stu-id="59739-146">Reliable sessions and hosting</span></span>

<span data-ttu-id="59739-147">Pokud webovou službu, která používá spolehlivé relace hostování, byste měli mít na paměti následující důležité informace:</span><span class="sxs-lookup"><span data-stu-id="59739-147">When web hosting a service that uses reliable sessions, you should keep the following important considerations in mind:</span></span>

- <span data-ttu-id="59739-148">Spolehlivé relace jsou stavová a stavu se udržuje v domény aplikace.</span><span class="sxs-lookup"><span data-stu-id="59739-148">Reliable sessions are stateful, and state is maintained in the AppDomain.</span></span> <span data-ttu-id="59739-149">To znamená, že všechny zprávy, které jsou součástí spolehlivé relace musí být zpracovány do stejné domény aplikace.</span><span class="sxs-lookup"><span data-stu-id="59739-149">This means that all messages that are part of a reliable session must be processed in the same AppDomain.</span></span> <span data-ttu-id="59739-150">Webové farmy a webové zahrada, kde je větší než jeden uzel velikost farmy nebo zahrada nemůže zaručit toto omezení.</span><span class="sxs-lookup"><span data-stu-id="59739-150">Web farms and web gardens where the size of the farm or garden is greater than one node can't guarantee this constraint.</span></span>

- <span data-ttu-id="59739-151">Spolehlivé relace pomocí dva kanály protokolu HTTP (například pomocí `WsDualHttpBinding`) může vyžadovat více než výchozí dvě připojení za klienta HTTP.</span><span class="sxs-lookup"><span data-stu-id="59739-151">Reliable sessions using dual HTTP channels (for example, using `WsDualHttpBinding`) can require more than the default of two HTTP connections per-client.</span></span> <span data-ttu-id="59739-152">To znamená, že duplexní spolehlivé relace může vyžadovat až dvě připojení každého způsobem, protože souběžné aplikace a protokol zpráv může přenosu každý způsob v každém okamžiku.</span><span class="sxs-lookup"><span data-stu-id="59739-152">This means a duplex reliable session can require up to two connections each way because concurrent application and protocol messages may be transferring each way at any given time.</span></span> <span data-ttu-id="59739-153">Za určitých podmínek v závislosti na vzorce výměny zpráv služby to znamená, že je možné k zablokování hostované webové služby pomocí duální HTTP a spolehlivé relace.</span><span class="sxs-lookup"><span data-stu-id="59739-153">Under certain conditions depending on the message exchange pattern of the service, this means that it's possible to deadlock a web-hosted service using dual HTTP and reliable sessions.</span></span> <span data-ttu-id="59739-154">Pokud chcete zvýšit počet povolených připojení prostřednictvím protokolu HTTP pro každého klienta, přidejte následující důležité konfigurační soubor (například *web.config* dotyčné služby):</span><span class="sxs-lookup"><span data-stu-id="59739-154">To increase the number of allowable HTTP connections per client, add the following to the relevant configuration file (for example, *web.config* of the service in question):</span></span>

  ```xml
  <configuration>
    <system.net>
      <connectionManagement>
        <add name="*" maxconnection="4" />
      </connectionManagement>
    </system.net>
  </configuration>
  ```

  <span data-ttu-id="59739-155">Hodnota `maxconnection` atribut je počet připojení, které jsou potřeba.</span><span class="sxs-lookup"><span data-stu-id="59739-155">The value of the `maxconnection` attribute is the number of connections needed.</span></span> <span data-ttu-id="59739-156">Minimální v takovém případě by měl být čtyři připojení.</span><span class="sxs-lookup"><span data-stu-id="59739-156">The minimum in this case should be four connections.</span></span>
