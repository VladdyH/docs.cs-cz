---
title: Doporučené postupy hostování Internetové informační služby
ms.date: 03/30/2017
ms.assetid: 0834768e-9665-46bf-86eb-d4b09ab91af5
ms.openlocfilehash: 119f14df9d46883a33272903558d83128501b293
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 05/04/2018
ms.locfileid: "33495759"
---
# <a name="internet-information-services-hosting-best-practices"></a><span data-ttu-id="0a3f5-102">Doporučené postupy hostování Internetové informační služby</span><span class="sxs-lookup"><span data-stu-id="0a3f5-102">Internet Information Services Hosting Best Practices</span></span>
<span data-ttu-id="0a3f5-103">Toto téma popisuje některé z osvědčených postupů pro hostování služby Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="0a3f5-103">This topic outlines some best practices for hosting Windows Communication Foundation (WCF) services.</span></span>  
  
## <a name="implementing-wcf-services-as-dlls"></a><span data-ttu-id="0a3f5-104">Implementace služby WCF jako knihovny DLL</span><span class="sxs-lookup"><span data-stu-id="0a3f5-104">Implementing WCF Services as DLLs</span></span>  
 <span data-ttu-id="0a3f5-105">Implementace službou WCF umožňuje služby jako knihovny DLL, která je nasazena do adresáře \bin webové aplikace, že můžete znovu použít službu mimo model webové aplikace, například v testovacím prostředí, která nemusí mít nasazený Internetové informační služby (IIS).</span><span class="sxs-lookup"><span data-stu-id="0a3f5-105">Implementing a WCF service as a DLL that is deployed to the \bin directory of a Web application allows you reuse the service outside of the Web application model, for example, in a test environment that may not have Internet Information Services (IIS) deployed.</span></span>  
  
## <a name="service-hosts-in-iis-hosted-applications"></a><span data-ttu-id="0a3f5-106">Hostitelé služeb v aplikace hostované služby IIS</span><span class="sxs-lookup"><span data-stu-id="0a3f5-106">Service Hosts in IIS-Hosted Applications</span></span>  
 <span data-ttu-id="0a3f5-107">Vytvořit nové hostitele služby tohoto naslouchání na síťové přenosy není nativně podporované službou IIS hostování prostředí nepoužívejte imperativní rozhraní API hostování na vlastním serveru (například [!INCLUDE[iis601](../../../../includes/iis601-md.md)] k hostování TCP služby, protože komunikaci TCP nativně nepodporují [!INCLUDE[iis601](../../../../includes/iis601-md.md)]).</span><span class="sxs-lookup"><span data-stu-id="0a3f5-107">Do not use the imperative self-host APIs to create new service hosts that listen on network transports not natively supported by the IIS hosting environment (For example, [!INCLUDE[iis601](../../../../includes/iis601-md.md)] to host TCP services, because TCP communication is not natively supported on [!INCLUDE[iis601](../../../../includes/iis601-md.md)]).</span></span> <span data-ttu-id="0a3f5-108">Tento přístup se nedoporučuje.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-108">This approach is not recommended.</span></span> <span data-ttu-id="0a3f5-109">Hostitelé služeb z vytvořili imperativní nejsou známá v rámci služby IIS hostitelské prostředí.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-109">Service hosts created imperatively are not known within the IIS hosting environment.</span></span> <span data-ttu-id="0a3f5-110">Kritický bod je, že zpracování provádí imperativní vytvořený služby není pozornost službou IIS při určování, zda je v nečinnosti hostování fondu aplikací.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-110">The critical point is that processing done by imperatively created services is not accounted for by IIS when it determines whether the hosting application pool is idle.</span></span> <span data-ttu-id="0a3f5-111">Výsledkem je, že aplikace, které mají takové hostitelé služeb z imperativní vytvořený mají hostování prostředí služby IIS, které intenzivně uvolní procesy hostitele služby IIS.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-111">The result is that applications that have such imperatively created service hosts have an IIS hosting environment that aggressively disposes of IIS host processes.</span></span>  
  
## <a name="uris-and-iis-hosted-endpoints"></a><span data-ttu-id="0a3f5-112">Koncové body hostované službou IIS a identifikátory URI</span><span class="sxs-lookup"><span data-stu-id="0a3f5-112">URIs and IIS-Hosted Endpoints</span></span>  
 <span data-ttu-id="0a3f5-113">Koncové body pro služby hostované službou IIS musí být nakonfigurovaný pomocí relativní identifikátory Uniform Resource (Identifier), není absolutní adresy.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-113">Endpoints for an IIS-hosted service should be configured using relative Uniform Resource Identifiers (URIs), not absolute addresses.</span></span> <span data-ttu-id="0a3f5-114">To zaručuje, že adresa koncového bodu spadá do sadu adresy URI, které patří k hostování aplikací a zajišťuje, že na základě zpráv aktivace se stane dle očekávání.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-114">This guarantees that the endpoint address falls within the set of URI addresses that belong to the hosting application and ensures that message-based activation happens as expected.</span></span>  
  
## <a name="state-management-and-process-recycling"></a><span data-ttu-id="0a3f5-115">Stav správy a recyklace procesů</span><span class="sxs-lookup"><span data-stu-id="0a3f5-115">State Management and Process Recycling</span></span>  
 <span data-ttu-id="0a3f5-116">Hostitelské prostředí služby IIS je optimalizovaná pro služby, které neudržují lokálního stavu v paměti.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-116">The IIS hosting environment is optimized for services that do not maintain local state in memory.</span></span> <span data-ttu-id="0a3f5-117">Služby IIS recykluje procesu hostitele v reakci na celou řadu událostí externí i interní způsobuje žádný volatile stav uložena výhradně v paměti, aby ztratí.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-117">IIS recycles the host process in response to a variety of external and internal events, causing any volatile state stored exclusively in memory to be lost.</span></span> <span data-ttu-id="0a3f5-118">Služby hostované ve službě IIS měli uložit jejich stavu externího procesu (například v databázi) nebo do mezipaměti v paměti, mohou být snadno znovu vytvořit Pokud události recyklace aplikace dojde k.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-118">Services hosted in IIS should store their state external to the process (for example, in a database) or in an in-memory cache that can easily be re-created if an application recycle event occurs.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="0a3f5-119">Protokoly WCF používají pro zabezpečení a spolehlivost zpráva vrstvy provedete pomocí volatile stavu v paměti.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-119">The protocols WCF uses for message-layer reliability and security make use of the volatile in-memory state.</span></span> <span data-ttu-id="0a3f5-120">Spolehlivé relace WCF a zabezpečení relací může neočekávaně ukončit kvůli aplikace recykluje.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-120">WCF reliable sessions and security sessions may terminate unexpectedly due to application recycles.</span></span> <span data-ttu-id="0a3f5-121">Aplikace hostované službou IIS, které pomocí těchto protokolů by měl buď závisí na něco jiného než klíč relace zadaný WCF pro korelace stavu aplikační vrstvu (například aplikační vrstvě konstrukce nebo vlastní korelace záhlaví) nebo zakázat Proces služby IIS recyklování pro hostované aplikace.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-121">IIS-hosted applications that make use of these protocols should either depend on something other than the WCF-provided session key for correlating application-layer state (for example, an application-layer construct or custom correlation header) or disable IIS process recycling for the hosted application.</span></span>  
  
## <a name="optimizing-performance-in-middle-tier-scenarios"></a><span data-ttu-id="0a3f5-122">Optimalizace výkonu ve scénářích střední vrstvy</span><span class="sxs-lookup"><span data-stu-id="0a3f5-122">Optimizing Performance in Middle-Tier Scenarios</span></span>  
 <span data-ttu-id="0a3f5-123">Pro optimální výkon v *střední vrstvy scénář*– služba, která volá k jiným službám v reakci na příchozí zprávy – vytvoření klienta služby WCF službě vzdálené instance jednou a opakovaně ji používat napříč více příchozí požadavky.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-123">For optimal performance in a *middle-tier scenario*—a service that calls out to other services in response to incoming messages—instantiate the WCF service client to the remote service once and reuse it across multiple incoming requests.</span></span> <span data-ttu-id="0a3f5-124">Vytváření instancí klienti služby WCF je relativní vzhledem k provedení služby v existující instanci klienta volat náročná operace a střední vrstvy scénáře vytváření zvýšení výkonu odlišné pomocí ukládání do mezipaměti vzdálených klientů napříč požadavky.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-124">Instantiating WCF service clients is an expensive operation relative to making a service call on a pre-existing client instance, and middle-tier scenarios produce distinct performance gains by caching remote clients across requests.</span></span> <span data-ttu-id="0a3f5-125">Klienti služby WCF jsou bezpečné pro přístup z více vláken, takže není nutné k synchronizaci přístup ke klientovi napříč více vláken.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-125">WCF service clients are thread-safe, so it is not necessary to synchronize access to a client across multiple threads.</span></span>  
  
 <span data-ttu-id="0a3f5-126">Střední vrstvy scénáře také vytvořit zvýšení výkonu pomocí asynchronní rozhraní API generovaných `svcutil /a` možnost.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-126">Middle-tier scenarios also produce performance gains by using the asynchronous APIs generated by the `svcutil /a` option.</span></span> <span data-ttu-id="0a3f5-127">`/a` Možnost příčiny [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) ke generování `BeginXXX/EndXXX` metody pro každou operaci služby, která umožňuje vzdálené volání potenciálně dlouho běžící na vlákna na pozadí.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-127">The `/a` option causes the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to generate `BeginXXX/EndXXX` methods for each service operation, which allows potentially long-running calls to remote services to be made on background threads.</span></span>  
  
## <a name="wcf-in-multi-homed-or-multi-named-scenarios"></a><span data-ttu-id="0a3f5-128">WCF ve scénářích s více adresami nebo více s názvem</span><span class="sxs-lookup"><span data-stu-id="0a3f5-128">WCF in Multi-Homed or Multi-named scenarios</span></span>  
 <span data-ttu-id="0a3f5-129">Nasazením služby WCF v IIS webové farmy služby, kde sadu počítačů sdílí společný externí název (například http://www.contoso.com) , ale jsou jednotlivě používala různé názvy hostitelů (například http://www.contoso.com může směrovat přenosy na dva různé počítače s názvem http://machine1.internal.contoso.com a http://machine2.internal.contoso.com).</span><span class="sxs-lookup"><span data-stu-id="0a3f5-129">You can deploy WCF services inside of an IIS Web farm, where a set of computers share a common external name (such as http://www.contoso.com) but are individually addressed by different hostnames (for example, http://www.contoso.com might direct traffic to two different machines named http://machine1.internal.contoso.com and http://machine2.internal.contoso.com).</span></span> <span data-ttu-id="0a3f5-130">Tento scénář nasazení plně podporuje WCF, ale vyžaduje zvláštní konfiguraci služby IIS webu hostování služby WCF, které chcete zobrazit správný název hostitele (external) v metadatech služby (Web Services Description Language).</span><span class="sxs-lookup"><span data-stu-id="0a3f5-130">This deployment scenario is fully supported by WCF, but requires special configuration of the IIS Web site hosting WCF services to display the correct (external) hostname in the service's metadata (Web Services Description Language).</span></span>  
  
 <span data-ttu-id="0a3f5-131">Chcete-li zajistit, aby se správný název hostitele v metadatech služby WCF generuje, nakonfigurovat výchozí identitu pro web služby IIS, který je hostitelem služby WCF použít explicitní název hostitele.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-131">To ensure that the correct hostname appears in the service metadata WCF generates, configure the default identity for the IIS Web site that hosts WCF services to use an explicit hostname.</span></span> <span data-ttu-id="0a3f5-132">Počítače, které se nacházejí v rámci farmy www.contoso.com by měl použít například vazba webu služby IIS *:80:www.contoso.com pro protokol HTTP a \*: 443:www.contoso.com pro protokol HTTPS.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-132">For example, computers that reside inside of the www.contoso.com farm should use an IIS site binding of *:80:www.contoso.com for HTTP and \*:443:www.contoso.com for HTTPS.</span></span>  
  
 <span data-ttu-id="0a3f5-133">Vazby webu služby IIS můžete nakonfigurovat pomocí modulu snap-in služby IIS Microsoft Management Console (MMC).</span><span class="sxs-lookup"><span data-stu-id="0a3f5-133">You can configure IIS Web site bindings by using the IIS Microsoft Management Console (MMC) snap-in.</span></span>  
  
## <a name="application-pools-running-in-different-user-contexts-overwrite-assemblies-from-other-accounts-in-the-temporary-folder"></a><span data-ttu-id="0a3f5-134">Fondy aplikací, které jsou spuštěné v kontextu jiného uživatele přepsat sestavení z jiné účty v dočasné složce</span><span class="sxs-lookup"><span data-stu-id="0a3f5-134">Application Pools Running in Different User Contexts Overwrite Assemblies from Other Accounts in the Temporary Folder</span></span>  
 <span data-ttu-id="0a3f5-135">K zajištění, že fondy aplikací, které jsou spuštěné v kontextu jiného uživatele nelze přepsat sestavení z jiné účty v dočasný [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] soubory, složky, použijte jiný identity a dočasných složek pro různé aplikace.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-135">To ensure that application pools running in different user contexts cannot overwrite assemblies from other accounts in the temporary [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] files folder, use different identities and temporary folders for different applications.</span></span> <span data-ttu-id="0a3f5-136">Například, pokud máte dva/Application1 virtuální aplikace a / Application2, můžete vytvořit dvěma fondy aplikací, A a B, pomocí dvou různých identit.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-136">For example, if you have two virtual applications /Application1 and / Application2, you can create two Application pools, A and B, with two different identities.</span></span> <span data-ttu-id="0a3f5-137">Fond aplikací A můžete spustit identity v rámci jednoho uživatele (uživatel1), zatímco fond aplikací B může běžet pod jinou identitu uživatele (uživatel2) a nakonfigurovat/Application1 A použití a /Application2 používat B.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-137">Application pool A can run under one user identity (user1) while application pool B can run under another user identity (user2), and configure /Application1 to use A and /Application2 to use B.</span></span>  
  
 <span data-ttu-id="0a3f5-138">V souboru Web.config, můžete nakonfigurovat dočasnou složku použitím \< system.web/compilation/@tempFolder>.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-138">In Web.config, you can configure the temporary folder using \<system.web/compilation/@tempFolder>.</span></span> <span data-ttu-id="0a3f5-139">Pro/Application1 může být "c:\tempForUser1" a pro application2 může být "c:\tempForUser2".</span><span class="sxs-lookup"><span data-stu-id="0a3f5-139">For /Application1, it can be "c:\tempForUser1" and for application2 it can be "c:\tempForUser2".</span></span> <span data-ttu-id="0a3f5-140">Udělte odpovídající oprávnění k zápisu do těchto složek pro dvě identity.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-140">Grant corresponding write permission to these folders for the two identities.</span></span>  
  
 <span data-ttu-id="0a3f5-141">Potom uživatel2 nelze změnit složku generování kódu pro /application2 (v rámci c:\tempForUser1).</span><span class="sxs-lookup"><span data-stu-id="0a3f5-141">Then user2 cannot change the code-generation folder for /application2 (under c:\tempForUser1).</span></span>  
  
## <a name="enabling-asynchronous-processing"></a><span data-ttu-id="0a3f5-142">Povolení asynchronního zpracování</span><span class="sxs-lookup"><span data-stu-id="0a3f5-142">Enabling asynchronous processing</span></span>  
 <span data-ttu-id="0a3f5-143">Ve výchozím nastavení jsou zpracovávány zprávy odeslané do služby WCF hostované v rámci služby IIS 6.0 a starší synchronním způsobem.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-143">By default messages sent to a WCF service hosted under IIS 6.0 and earlier are processed in a synchronous manner.</span></span> <span data-ttu-id="0a3f5-144">ASP.NET volá do WCF ve vlastním vlákně (pracovní vlákno ASP.NET) a WCF používá jiné vlákno pro zpracování požadavku.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-144">ASP.NET calls into WCF on its own thread (the ASP.NET worker thread) and WCF uses another thread to process the request.</span></span> <span data-ttu-id="0a3f5-145">Na pracovní vlákno ASP.NET obsahuje WCF, až do dokončení jeho zpracování.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-145">WCF holds onto the ASP.NET worker thread until it completes its processing.</span></span> <span data-ttu-id="0a3f5-146">To vede k synchronní zpracování požadavků.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-146">This leads to synchronous processing of requests.</span></span> <span data-ttu-id="0a3f5-147">Asynchronní zpracování požadavků umožňuje větší škálovatelnost, protože snižuje počet vláken, které jsou potřebné ke zpracování žádosti – WCF nemá nastaveno vlákno ASP.NET při zpracování požadavku.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-147">Processing requests asynchronously enables greater scalability because it reduces the number of threads required to process a request –WCF does not hold on to the ASP.NET thread while processing the request.</span></span> <span data-ttu-id="0a3f5-148">Použití asynchronní chování není doporučeno pro počítače, které běží služby IIS 6.0, protože neexistuje žádný způsob, jak omezit příchozích požadavků, které otevře serveru *Denial Of Service* útoky (DOS).</span><span class="sxs-lookup"><span data-stu-id="0a3f5-148">Use of asynchronous behavior is not recommended for machines running IIS 6.0 because there is no way to throttle incoming requests that open up the server to *Denial Of Service* (DOS) attacks.</span></span> <span data-ttu-id="0a3f5-149">Od verze služby IIS 7.0, bylo zavedeno omezení počtu souběžných požadavků: `[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ASP.NET\2.0.50727.0]"MaxConcurrentRequestsPerCpu`.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-149">Starting with IIS 7.0, a concurrent request throttle has been introduced: `[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ASP.NET\2.0.50727.0]"MaxConcurrentRequestsPerCpu`.</span></span> <span data-ttu-id="0a3f5-150">Pomocí této nové omezení je bezpečné použít asynchronní zpracování.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-150">With this new throttle it is safe to use the asynchronous processing.</span></span>  <span data-ttu-id="0a3f5-151">Ve výchozím nastavení ve službě IIS 7.0 je zaregistrovaný modul a asynchronní obslužné rutiny.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-151">By default in IIS 7.0, the asynchronous handler and module are registered.</span></span> <span data-ttu-id="0a3f5-152">Pokud to byl vypnut, můžete ručně povolit asynchronní zpracování požadavků v souboru Web.config vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-152">If this has been turned off, you can manually enable asynchronous processing of requests in your application's Web.config file.</span></span> <span data-ttu-id="0a3f5-153">Nastavení použijete, závisí na vaší `aspNetCompatibilityEnabled` nastavení.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-153">The settings you use depend on your `aspNetCompatibilityEnabled` setting.</span></span> <span data-ttu-id="0a3f5-154">Pokud máte `aspNetCompatibilityEnabled` nastavena na `false`, nakonfigurujte `System.ServiceModel.Activation.ServiceHttpModule` jak je znázorněno v následujícím fragmentu kódu konfigurace.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-154">If you have `aspNetCompatibilityEnabled` set to `false`, configure the `System.ServiceModel.Activation.ServiceHttpModule` as shown in the following configuration snippet.</span></span>  
  
```xml  
<system.serviceModel>  
    <serviceHostingEnvironment aspNetCompatibilityEnabled="false" />      
  </system.serviceModel>  
  <system.webServer>  
    <modules>  
      <remove name="ServiceModel"/>  
      <add name="ServiceModel"   
           preCondition="integratedMode,runtimeVersionv2.0"   
           type="System.ServiceModel.Activation.ServiceHttpModule, System.ServiceModel,Version=3.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"/>  
    </modules>  
    </system.webServer>  
```  
  
 <span data-ttu-id="0a3f5-155">Pokud máte `aspNetCompatibilityEnabled` nastavena na `true`, nakonfigurujte `System.ServiceModel.Activation.ServiceHttpHandlerFactory` jak je znázorněno v následujícím fragmentu kódu konfigurace.</span><span class="sxs-lookup"><span data-stu-id="0a3f5-155">If you have `aspNetCompatibilityEnabled` set to `true`, configure the `System.ServiceModel.Activation.ServiceHttpHandlerFactory` as shown in the following config snippet.</span></span>  
  
```xml  
<system.serviceModel>  
    <serviceHostingEnvironment aspNetCompatibilityEnabled="true" />      
  </system.serviceModel>  
  <system.webServer>  
    <handlers>  
          <clear/>  
          <add name="TestAsyncHttpHandler"   
               path="*.svc"   
               verb="*"   
               type="System.ServiceModel.Activation.ServiceHttpHandlerFactory, System.ServiceModel, Version=3.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"           
               />  
    </handlers>      
  </system.webServer>  
```  
  
## <a name="see-also"></a><span data-ttu-id="0a3f5-156">Viz také</span><span class="sxs-lookup"><span data-stu-id="0a3f5-156">See Also</span></span>  
 [<span data-ttu-id="0a3f5-157">Ukázky služby hostování</span><span class="sxs-lookup"><span data-stu-id="0a3f5-157">Service Hosting Samples</span></span>](http://msdn.microsoft.com/library/f703a3f6-0fba-418a-a92f-7ce75ccfa47e)  
 [<span data-ttu-id="0a3f5-158">Hostování funkcí systému Windows Server App Fabric</span><span class="sxs-lookup"><span data-stu-id="0a3f5-158">Windows Server App Fabric Hosting Features</span></span>](http://go.microsoft.com/fwlink/?LinkId=201276)
