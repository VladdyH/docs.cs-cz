---
title: Delegace a zosobnění se službou WCF
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: ''
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- impersonation [WCF]
- delegation [WCF]
ms.assetid: 110e60f7-5b03-4b69-b667-31721b8e3152
caps.latest.revision: 40
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: 885faab43b620cf347c1780d445a72361cb5cdb4
ms.sourcegitcommit: 03ee570f6f528a7d23a4221dcb26a9498edbdf8c
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/28/2018
---
# <a name="delegation-and-impersonation-with-wcf"></a><span data-ttu-id="01acb-102">Delegace a zosobnění se službou WCF</span><span class="sxs-lookup"><span data-stu-id="01acb-102">Delegation and Impersonation with WCF</span></span>
<span data-ttu-id="01acb-103">*Zosobnění* je běžný postup, který služby použít k omezení klientský přístup k prostředkům doména služby.</span><span class="sxs-lookup"><span data-stu-id="01acb-103">*Impersonation* is a common technique that services use to restrict client access to a service domain's resources.</span></span> <span data-ttu-id="01acb-104">Prostředky služby domény může být buď prostředky počítače, jako je například místní soubory (zosobnění), nebo prostředku na jiném počítači, například do sdílené složky (delegování).</span><span class="sxs-lookup"><span data-stu-id="01acb-104">Service domain resources can either be machine resources, such as local files (impersonation), or a resource on another machine, such as a file share (delegation).</span></span> <span data-ttu-id="01acb-105">Ukázkovou aplikaci, najdete v části [zosobnění klienta](../../../../docs/framework/wcf/samples/impersonating-the-client.md).</span><span class="sxs-lookup"><span data-stu-id="01acb-105">For a sample application, see [Impersonating the Client](../../../../docs/framework/wcf/samples/impersonating-the-client.md).</span></span> <span data-ttu-id="01acb-106">Příklad použití zosobnění naleznete v části [postupy: zosobnění klienta ve službě](../../../../docs/framework/wcf/how-to-impersonate-a-client-on-a-service.md).</span><span class="sxs-lookup"><span data-stu-id="01acb-106">For an example of how to use impersonation, see [How to: Impersonate a Client on a Service](../../../../docs/framework/wcf/how-to-impersonate-a-client-on-a-service.md).</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="01acb-107">Upozorňujeme, že při zosobnění klienta ve službě, služba bude spuštěna s přihlašovacími údaji klienta, které mohou mít vyšší oprávnění než procesu serveru.</span><span class="sxs-lookup"><span data-stu-id="01acb-107">Be aware that when impersonating a client on a service, the service runs with the client's credentials, which may have higher privileges than the server process.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="01acb-108">Přehled</span><span class="sxs-lookup"><span data-stu-id="01acb-108">Overview</span></span>  
 <span data-ttu-id="01acb-109">Klienti obvykle volání služby pro službu provést některé akce jménem klienta.</span><span class="sxs-lookup"><span data-stu-id="01acb-109">Typically, clients call a service to have the service perform some action on the client’s behalf.</span></span> <span data-ttu-id="01acb-110">Zosobnění umožňuje služby tak, aby fungoval jako klient při provádění akce.</span><span class="sxs-lookup"><span data-stu-id="01acb-110">Impersonation allows the service to act as the client while performing the action.</span></span> <span data-ttu-id="01acb-111">Delegování umožňuje front-endová služba pro předávání požadavek klienta ke službě back-end tak, že služba back endu může také zosobnit klienta.</span><span class="sxs-lookup"><span data-stu-id="01acb-111">Delegation allows a front-end service to forward the client’s request to a back-end service in such a way that the back-end service can also impersonate the client.</span></span> <span data-ttu-id="01acb-112">Zosobnění se nejčastěji používá jako způsob kontroly, jestli je klient oprávněn provádět určité akce, zatímco delegování je způsob průchodu možnosti zosobnění, společně s identity klienta ke službě back-end.</span><span class="sxs-lookup"><span data-stu-id="01acb-112">Impersonation is most commonly used as a way of checking whether a client is authorized to perform a particular action, while delegation is a way of flowing impersonation capabilities, along with the client’s identity, to a back-end service.</span></span> <span data-ttu-id="01acb-113">Delegování je funkce domény systému Windows, která lze použít, pokud se provádí ověřování pomocí protokolu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="01acb-113">Delegation is a Windows domain feature that can be used when Kerberos-based authentication is performed.</span></span> <span data-ttu-id="01acb-114">Delegování se liší od identity toku, a protože delegování přenáší možnost zosobnění klienta bez u sebe hesla klienta, je mnohem vyšší privilegované operace než identity toku.</span><span class="sxs-lookup"><span data-stu-id="01acb-114">Delegation is distinct from identity flow and, because delegation transfers the ability to impersonate the client without possession of the client’s password, it is a much higher privileged operation than identity flow.</span></span>  
  
 <span data-ttu-id="01acb-115">Zosobnění a delegování nutné, aby klient identitu systému Windows.</span><span class="sxs-lookup"><span data-stu-id="01acb-115">Both impersonation and delegation require that the client have a Windows identity.</span></span> <span data-ttu-id="01acb-116">Pokud klient nemá identitu systému Windows, je k dispozici pouze možnost tok identity klienta ke službě druhý.</span><span class="sxs-lookup"><span data-stu-id="01acb-116">If a client does not possess a Windows identity, then the only option available is to flow the client’s identity to the second service.</span></span>  
  
## <a name="impersonation-basics"></a><span data-ttu-id="01acb-117">Základní informace o zosobnění</span><span class="sxs-lookup"><span data-stu-id="01acb-117">Impersonation Basics</span></span>  
 [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]<span data-ttu-id="01acb-118"> podporuje zosobnění pro celou řadu pověření klienta.</span><span class="sxs-lookup"><span data-stu-id="01acb-118"> supports impersonation for a variety of client credentials.</span></span> <span data-ttu-id="01acb-119">Toto téma popisuje podporu modelu služby pro zosobnění volajícího během provádění metody služby.</span><span class="sxs-lookup"><span data-stu-id="01acb-119">This topic describes service model support for impersonating the caller during the implementation of a service method.</span></span> <span data-ttu-id="01acb-120">Popsány i jsou běžné scénáře nasazení zahrnující zosobnění a zabezpečení protokolu SOAP a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] možnosti v těchto scénářích.</span><span class="sxs-lookup"><span data-stu-id="01acb-120">Also discussed are common deployment scenarios involving impersonation and SOAP security and [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] options in these scenarios.</span></span>  
  
 <span data-ttu-id="01acb-121">Toto téma se zaměřuje na zosobnění a delegování v [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] při použití protokolu SOAP zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="01acb-121">This topic focuses on impersonation and delegation in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] when using SOAP security.</span></span> <span data-ttu-id="01acb-122">Můžete také použít zosobnění a delegování s [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] při použití zabezpečení přenosu, jak je popsáno v [pomocí zosobnění se zabezpečením přenosu](../../../../docs/framework/wcf/feature-details/using-impersonation-with-transport-security.md).</span><span class="sxs-lookup"><span data-stu-id="01acb-122">You can also use impersonation and delegation with [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] when using transport security, as described in [Using Impersonation with Transport Security](../../../../docs/framework/wcf/feature-details/using-impersonation-with-transport-security.md).</span></span>  
  
## <a name="two-methods"></a><span data-ttu-id="01acb-123">Dvě metody</span><span class="sxs-lookup"><span data-stu-id="01acb-123">Two Methods</span></span>  
 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="01acb-124"> Zabezpečení protokolu SOAP má dvě odlišné metody pro provádění zosobnění.</span><span class="sxs-lookup"><span data-stu-id="01acb-124"> SOAP security has two distinct methods for performing impersonation.</span></span> <span data-ttu-id="01acb-125">Metoda použitá závisí na vazby.</span><span class="sxs-lookup"><span data-stu-id="01acb-125">The method used depends on the binding.</span></span> <span data-ttu-id="01acb-126">Jeden je zosobnění z tokenu Windows získané z rozhraní SSPI (Security Support Provider Interface) nebo protokolu Kerberos ověřování, které jsou pak uloženy v mezipaměti služby.</span><span class="sxs-lookup"><span data-stu-id="01acb-126">One is impersonation from a Windows token obtained from the Security Support Provider Interface (SSPI) or Kerberos authentication, which is then cached on the service.</span></span> <span data-ttu-id="01acb-127">Druhá je zosobnění z tokenu Windows získané z rozšíření protokolu Kerberos, se nazývají *Service-for-User* (S4U).</span><span class="sxs-lookup"><span data-stu-id="01acb-127">The second is impersonation from a Windows token obtained from the Kerberos extensions, collectively called *Service-for-User* (S4U).</span></span>  
  
### <a name="cached-token-impersonation"></a><span data-ttu-id="01acb-128">V mezipaměti Token zosobnění</span><span class="sxs-lookup"><span data-stu-id="01acb-128">Cached Token Impersonation</span></span>  
 <span data-ttu-id="01acb-129">Můžete provádět v mezipaměti token zosobnění s následujícími službami:</span><span class="sxs-lookup"><span data-stu-id="01acb-129">You can perform cached-token impersonation with the following:</span></span>  
  
-   <span data-ttu-id="01acb-130"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding>, a <xref:System.ServiceModel.NetTcpBinding> s pověření klienta systému Windows.</span><span class="sxs-lookup"><span data-stu-id="01acb-130"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding>, and <xref:System.ServiceModel.NetTcpBinding> with a Windows client credential.</span></span>  
  
-   <span data-ttu-id="01acb-131"><xref:System.ServiceModel.BasicHttpBinding> s <xref:System.ServiceModel.BasicHttpSecurityMode> nastavte na <xref:System.ServiceModel.BasicHttpSecurityMode.TransportWithMessageCredential> přihlašovacích údajů nebo standardní vazby kde klient uvede název přihlašovací údaje uživatele, který službu můžete namapovat platný účet systému Windows.</span><span class="sxs-lookup"><span data-stu-id="01acb-131"><xref:System.ServiceModel.BasicHttpBinding> with a <xref:System.ServiceModel.BasicHttpSecurityMode> set to the <xref:System.ServiceModel.BasicHttpSecurityMode.TransportWithMessageCredential> credential, or any other standard binding where the client presents a user name credential that the service can map to a valid Windows account.</span></span>  
  
-   <span data-ttu-id="01acb-132">Všechny <xref:System.ServiceModel.Channels.CustomBinding> používající pověření klienta systému Windows s `requireCancellation` nastavena na `true`.</span><span class="sxs-lookup"><span data-stu-id="01acb-132">Any <xref:System.ServiceModel.Channels.CustomBinding> that uses a Windows client credential with the `requireCancellation` set to `true`.</span></span> <span data-ttu-id="01acb-133">(Vlastnost je k dispozici na následující třídy: <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters>, <xref:System.ServiceModel.Security.Tokens.SslSecurityTokenParameters>, a <xref:System.ServiceModel.Security.Tokens.SspiSecurityTokenParameters>.) Pokud se v vazba používá zabezpečené konverzaci, musí mít rovněž `requireCancellation` vlastnost nastavena na hodnotu `true`.</span><span class="sxs-lookup"><span data-stu-id="01acb-133">(The property is available on the following classes: <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters>, <xref:System.ServiceModel.Security.Tokens.SslSecurityTokenParameters>, and <xref:System.ServiceModel.Security.Tokens.SspiSecurityTokenParameters>.) If a secure conversation is used on the binding, it must also have the `requireCancellation` property set to `true`.</span></span>  
  
-   <span data-ttu-id="01acb-134">Všechny <xref:System.ServiceModel.Channels.CustomBinding> kde klient uvede název pověření uživatele.</span><span class="sxs-lookup"><span data-stu-id="01acb-134">Any <xref:System.ServiceModel.Channels.CustomBinding> where the client presents a user name credential.</span></span> <span data-ttu-id="01acb-135">Pokud se na vazby používá k zabezpečené konverzaci, musí mít rovněž `requireCancellation` vlastnost nastavena na hodnotu `true`.</span><span class="sxs-lookup"><span data-stu-id="01acb-135">If secure conversation is used on the binding, it must also have the `requireCancellation` property set to `true`.</span></span>  
  
### <a name="s4u-based-impersonation"></a><span data-ttu-id="01acb-136">Na základě S4U zosobnění</span><span class="sxs-lookup"><span data-stu-id="01acb-136">S4U-Based Impersonation</span></span>  
 <span data-ttu-id="01acb-137">Můžete provádět na základě S4U zosobnění s následujícími službami:</span><span class="sxs-lookup"><span data-stu-id="01acb-137">You can perform S4U-based impersonation with the following:</span></span>  
  
-   <span data-ttu-id="01acb-138"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding>, a <xref:System.ServiceModel.NetTcpBinding> s pověřením certifikátu klienta služby je možné namapovat platný účet systému Windows.</span><span class="sxs-lookup"><span data-stu-id="01acb-138"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding>, and <xref:System.ServiceModel.NetTcpBinding> with a certificate client credential that the service can map to a valid Windows account.</span></span>  
  
-   <span data-ttu-id="01acb-139">Všechny <xref:System.ServiceModel.Channels.CustomBinding> používající pověření klienta systému Windows s `requireCancellation` vlastnost nastavena na hodnotu `false`.</span><span class="sxs-lookup"><span data-stu-id="01acb-139">Any <xref:System.ServiceModel.Channels.CustomBinding> that uses a Windows client credential with the `requireCancellation` property set to `false`.</span></span>  
  
-   <span data-ttu-id="01acb-140">Všechny <xref:System.ServiceModel.Channels.CustomBinding> používající uživatelské jméno nebo pověření klienta pro systém Windows a zabezpečené konverzace s `requireCancellation` vlastnost nastavena na hodnotu `false`.</span><span class="sxs-lookup"><span data-stu-id="01acb-140">Any <xref:System.ServiceModel.Channels.CustomBinding> that uses a user name or Windows client credential and secure conversation with the `requireCancellation` property set to `false`.</span></span>  
  
 <span data-ttu-id="01acb-141">V rozsahu, ke které může služba zosobnit klienta závisí na oprávnění, které obsahuje účet služby, když se ho pokusí zosobnění, typ zosobnění použít a může být v rozsahu zosobnění, které umožňuje klientovi.</span><span class="sxs-lookup"><span data-stu-id="01acb-141">The extent to which the service can impersonate the client depends on the privileges the service account holds when it attempts impersonation, the type of impersonation used, and possibly the extent of impersonation the client permits.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="01acb-142">Když klient a služba běží na stejném počítači a klient je spuštěn pod účtem systému (například `Local System` nebo `Network Service`), když zabezpečené relace se naváže stavová kontext zabezpečení nelze zosobnit klienta tokeny.</span><span class="sxs-lookup"><span data-stu-id="01acb-142">When the client and service are running on the same computer and the client is running under a system account (for example, `Local System` or `Network Service`), the client cannot be impersonated when a secure session is established with stateful Security Context tokens.</span></span> <span data-ttu-id="01acb-143">Formuláře Windows nebo konzolové aplikace se obvykle běží pod účtem aktuálně přihlášeného tak, aby ve výchozím nastavení se můžou zosobnit účet.</span><span class="sxs-lookup"><span data-stu-id="01acb-143">A Windows Form or console application typically runs under the currently logged-in account, so that account can be impersonated by default.</span></span> <span data-ttu-id="01acb-144">Nicméně, pokud je klient [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] stránky a že stránky je hostován v [!INCLUDE[iis601](../../../../includes/iis601-md.md)] nebo [!INCLUDE[iisver](../../../../includes/iisver-md.md)], spusťte klienta v části `Network Service` účet ve výchozím nastavení.</span><span class="sxs-lookup"><span data-stu-id="01acb-144">However, when the client is an [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] page and that page is hosted in [!INCLUDE[iis601](../../../../includes/iis601-md.md)] or [!INCLUDE[iisver](../../../../includes/iisver-md.md)], then the client does run under the `Network Service` account by default.</span></span> <span data-ttu-id="01acb-145">Ve výchozím nastavení všechny vazby poskytované systémem, které podporují zabezpečených relací pomocí tokenu kontextu zabezpečení bezstavové (SCT).</span><span class="sxs-lookup"><span data-stu-id="01acb-145">All of the system-provided bindings that support secure sessions use a stateless security context token (SCT) by default.</span></span> <span data-ttu-id="01acb-146">Ale pokud je klient [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] stránky a zabezpečených relací s stavová SCTs se používají, nelze jej zosobnit klienta.</span><span class="sxs-lookup"><span data-stu-id="01acb-146">However, if the client is an [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] page, and secure sessions with stateful SCTs are used, the client cannot be impersonated.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="01acb-147"> pomocí stavová SCTs v zabezpečené relaci, najdete v tématu [postupy: vytvoření tokenu kontextu zabezpečení pro zabezpečenou relaci](../../../../docs/framework/wcf/feature-details/how-to-create-a-security-context-token-for-a-secure-session.md).</span><span class="sxs-lookup"><span data-stu-id="01acb-147"> using stateful SCTs in a secure session, see [How to: Create a Security Context Token for a Secure Session](../../../../docs/framework/wcf/feature-details/how-to-create-a-security-context-token-for-a-secure-session.md).</span></span>  
  
## <a name="impersonation-in-a-service-method-declarative-model"></a><span data-ttu-id="01acb-148">Zosobnění v metodě služby: deklarativní Model</span><span class="sxs-lookup"><span data-stu-id="01acb-148">Impersonation in a Service Method: Declarative Model</span></span>  
 <span data-ttu-id="01acb-149">Většina scénářů zosobnění zahrnovat spuštění metody služby v kontextu volajícího.</span><span class="sxs-lookup"><span data-stu-id="01acb-149">Most impersonation scenarios involve executing the service method in the caller context.</span></span> [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="01acb-150"> nabízí funkci zosobnění, které usnadňuje to provedete tím, že se uživateli zadat požadavek zosobnění v <xref:System.ServiceModel.OperationBehaviorAttribute> atribut.</span><span class="sxs-lookup"><span data-stu-id="01acb-150"> provides an impersonation feature that makes this easy to do by allowing the user to specify the impersonation requirement in the <xref:System.ServiceModel.OperationBehaviorAttribute> attribute.</span></span> <span data-ttu-id="01acb-151">Například v následujícím kódu [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] infrastruktury zosobňuje volající před provedením `Hello` metoda.</span><span class="sxs-lookup"><span data-stu-id="01acb-151">For example, in the following code, the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] infrastructure impersonates the caller before executing the `Hello` method.</span></span> <span data-ttu-id="01acb-152">Jakýkoli pokus o přístup k prostředkům nativní uvnitř `Hello` metoda úspěšné pouze v případě, že seznam řízení přístupu (ACL) prostředku umožňuje volajícímu přístup oprávnění.</span><span class="sxs-lookup"><span data-stu-id="01acb-152">Any attempt to access native resources inside the `Hello` method succeed only if the access control list (ACL) of the resource allows the caller access privileges.</span></span> <span data-ttu-id="01acb-153">Chcete-li povolit zosobnění, nastavte <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> vlastnost na jednu z <xref:System.ServiceModel.ImpersonationOption> hodnot výčtu, buď <xref:System.ServiceModel.ImpersonationOption.Required?displayProperty=nameWithType> nebo <xref:System.ServiceModel.ImpersonationOption.Allowed?displayProperty=nameWithType>, jak je znázorněno v následujícím příkladu.</span><span class="sxs-lookup"><span data-stu-id="01acb-153">To enable impersonation, set the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property to one of the <xref:System.ServiceModel.ImpersonationOption> enumeration values, either <xref:System.ServiceModel.ImpersonationOption.Required?displayProperty=nameWithType> or <xref:System.ServiceModel.ImpersonationOption.Allowed?displayProperty=nameWithType>, as shown in the following example.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="01acb-154">Když služba má vyšší pověření než vzdáleného klienta, přihlašovací údaje služby se použijí, pokud <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> je nastavena na <xref:System.ServiceModel.ImpersonationOption.Allowed>.</span><span class="sxs-lookup"><span data-stu-id="01acb-154">When a service has higher credentials than the remote client, the credentials of the service are used if the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property is set to <xref:System.ServiceModel.ImpersonationOption.Allowed>.</span></span> <span data-ttu-id="01acb-155">To znamená pokud uživatel nízkými oprávněními poskytuje svoje přihlašovací údaje, vyšší úrovní oprávnění služby provede metodu pomocí přihlašovacích údajů služby a mohou používat prostředky, které uživatel nízkými oprávněními jinak nebude moci používat.</span><span class="sxs-lookup"><span data-stu-id="01acb-155">That is, if a low-privileged user provides its credentials, a higher-privileged service executes the method with the credentials of the service, and can use resources that the low-privileged user would otherwise not be able to use.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#1)]
 [!code-vb[c_ImpersonationAndDelegation#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#1)]  
  
 <span data-ttu-id="01acb-156">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] Infrastruktury může zosobnit volající pouze v případě, že je volající ověření pomocí přihlašovacích údajů, které lze mapovat na uživatelský účet systému Windows.</span><span class="sxs-lookup"><span data-stu-id="01acb-156">The [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] infrastructure can impersonate the caller only if the caller is authenticated with credentials that can be mapped to a Windows user account.</span></span> <span data-ttu-id="01acb-157">Pokud služba je nakonfigurována pro ověřování pomocí přihlašovacích údajů, který nejde mapovat na účet systému Windows, není služba metodu provést.</span><span class="sxs-lookup"><span data-stu-id="01acb-157">If the service is configured to authenticate using a credential that cannot be mapped to a Windows account, the service method is not executed.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="01acb-158">Na [!INCLUDE[wxp](../../../../includes/wxp-md.md)], zosobnění se nezdaří, pokud stateful, SCT je vytvořen, což vede <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="01acb-158">On [!INCLUDE[wxp](../../../../includes/wxp-md.md)], impersonation fails if a stateful SCT is created, resulting in an <xref:System.InvalidOperationException>.</span></span> <span data-ttu-id="01acb-159">Další informace najdete v tématu [nepodporované scénáře](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md).</span><span class="sxs-lookup"><span data-stu-id="01acb-159">For more information, see [Unsupported Scenarios](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md).</span></span>  
  
## <a name="impersonation-in-a-service-method-imperative-model"></a><span data-ttu-id="01acb-160">Zosobnění v metodě služby: imperativní modelu</span><span class="sxs-lookup"><span data-stu-id="01acb-160">Impersonation in a Service Method: Imperative Model</span></span>  
 <span data-ttu-id="01acb-161">Volající někdy nemusí zosobnit metodu celé služby pro funkce, ale pouze část ho.</span><span class="sxs-lookup"><span data-stu-id="01acb-161">Sometimes a caller does not need to impersonate the entire service method to function, but for only a portion of it.</span></span> <span data-ttu-id="01acb-162">V takovém případě získat Windows identitu volajícího uvnitř metody služby a imperativní provést zosobnění.</span><span class="sxs-lookup"><span data-stu-id="01acb-162">In this case, obtain the Windows identity of the caller inside the service method and imperatively perform the impersonation.</span></span> <span data-ttu-id="01acb-163">To provedete pomocí <xref:System.ServiceModel.ServiceSecurityContext.WindowsIdentity%2A> vlastnost <xref:System.ServiceModel.ServiceSecurityContext> vrátit instanci <xref:System.Security.Principal.WindowsIdentity> třídy a volání <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> metoda před použitím instance.</span><span class="sxs-lookup"><span data-stu-id="01acb-163">Do this by using the <xref:System.ServiceModel.ServiceSecurityContext.WindowsIdentity%2A> property of the <xref:System.ServiceModel.ServiceSecurityContext> to return an instance of the <xref:System.Security.Principal.WindowsIdentity> class and calling the <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> method before using the instance.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="01acb-164">Je nutné používat Visual Basicu`Using` příkaz nebo jazyka C# `using` příkaz a automaticky vracet akce zosobnění.</span><span class="sxs-lookup"><span data-stu-id="01acb-164">Be sure to use the Visual Basic`Using` statement or the C# `using` statement to automatically revert the impersonation action.</span></span> <span data-ttu-id="01acb-165">Pokud použijete příkaz nebo pokud používáte programovací jazyk než Visual Basic a C#, je nutné vrátit úroveň zosobnění.</span><span class="sxs-lookup"><span data-stu-id="01acb-165">If you do not use the statement, or if you use a programming language other than Visual Basic or C#, be sure to revert the impersonation level.</span></span> <span data-ttu-id="01acb-166">Selhání k tomu můžete tvoří základ pro odepření služby a zvýšení úrovně oprávnění útoky.</span><span class="sxs-lookup"><span data-stu-id="01acb-166">Failure to do this can form the basis for denial of service and elevation of privilege attacks.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#2)]
 [!code-vb[c_ImpersonationAndDelegation#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#2)]  
  
## <a name="impersonation-for-all-service-methods"></a><span data-ttu-id="01acb-167">Zosobnění pro všechny metody služeb</span><span class="sxs-lookup"><span data-stu-id="01acb-167">Impersonation for All Service Methods</span></span>  
 <span data-ttu-id="01acb-168">V některých případech je nutné provést všechny metody služby v kontextu volajícího.</span><span class="sxs-lookup"><span data-stu-id="01acb-168">In some cases, you must perform all the methods of a service in the caller’s context.</span></span> <span data-ttu-id="01acb-169">Místo explicitně povolení této funkce na základě za metoda, použít <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior>.</span><span class="sxs-lookup"><span data-stu-id="01acb-169">Instead of explicitly enabling this feature on a per-method basis, use the <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior>.</span></span> <span data-ttu-id="01acb-170">Jak je znázorněno v následujícím kódu, nastavit <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.ImpersonateCallerForAllOperations%2A> vlastnost `true`.</span><span class="sxs-lookup"><span data-stu-id="01acb-170">As shown in the following code, set the <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.ImpersonateCallerForAllOperations%2A> property to `true`.</span></span> <span data-ttu-id="01acb-171"><xref:System.ServiceModel.Description.ServiceAuthorizationBehavior> Se načítají z kolekce chování <xref:System.ServiceModel.ServiceHost> třídy.</span><span class="sxs-lookup"><span data-stu-id="01acb-171">The <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior> is retrieved from the collections of behaviors of the <xref:System.ServiceModel.ServiceHost> class.</span></span> <span data-ttu-id="01acb-172">Všimněte si také, že `Impersonation` vlastnost <xref:System.ServiceModel.OperationBehaviorAttribute> použité pro každou metodu musí také být nastaven na hodnotu <xref:System.ServiceModel.ImpersonationOption.Allowed> nebo <xref:System.ServiceModel.ImpersonationOption.Required>.</span><span class="sxs-lookup"><span data-stu-id="01acb-172">Also note that the `Impersonation` property of the <xref:System.ServiceModel.OperationBehaviorAttribute> applied to each method must also be set to either <xref:System.ServiceModel.ImpersonationOption.Allowed> or <xref:System.ServiceModel.ImpersonationOption.Required>.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#3)]
 [!code-vb[c_ImpersonationAndDelegation#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#3)]  
  
 <span data-ttu-id="01acb-173">Následující tabulka popisuje [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] chování pro všechny možné kombinace `ImpersonationOption` a `ImpersonateCallerForAllServiceOperations`.</span><span class="sxs-lookup"><span data-stu-id="01acb-173">The following table describes [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] behavior for all possible combinations of `ImpersonationOption` and `ImpersonateCallerForAllServiceOperations`.</span></span>  
  
|`ImpersonationOption`|`ImpersonateCallerForAllServiceOperations`|<span data-ttu-id="01acb-174">Chování</span><span class="sxs-lookup"><span data-stu-id="01acb-174">Behavior</span></span>|  
|---------------------------|------------------------------------------------|--------------|  
|<span data-ttu-id="01acb-175">Požadováno</span><span class="sxs-lookup"><span data-stu-id="01acb-175">Required</span></span>|<span data-ttu-id="01acb-176">není k dispozici</span><span class="sxs-lookup"><span data-stu-id="01acb-176">n/a</span></span>|[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="01acb-177"> zosobňuje volající</span><span class="sxs-lookup"><span data-stu-id="01acb-177"> impersonates the caller</span></span>|  
|<span data-ttu-id="01acb-178">Povoleno</span><span class="sxs-lookup"><span data-stu-id="01acb-178">Allowed</span></span>|<span data-ttu-id="01acb-179">false</span><span class="sxs-lookup"><span data-stu-id="01acb-179">false</span></span>|[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="01acb-180"> není zosobnit volající</span><span class="sxs-lookup"><span data-stu-id="01acb-180"> does not impersonate the caller</span></span>|  
|<span data-ttu-id="01acb-181">Povoleno</span><span class="sxs-lookup"><span data-stu-id="01acb-181">Allowed</span></span>|<span data-ttu-id="01acb-182">true</span><span class="sxs-lookup"><span data-stu-id="01acb-182">true</span></span>|[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="01acb-183"> zosobňuje volající</span><span class="sxs-lookup"><span data-stu-id="01acb-183"> impersonates the caller</span></span>|  
|<span data-ttu-id="01acb-184">NotAllowed</span><span class="sxs-lookup"><span data-stu-id="01acb-184">NotAllowed</span></span>|<span data-ttu-id="01acb-185">false</span><span class="sxs-lookup"><span data-stu-id="01acb-185">false</span></span>|[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="01acb-186"> není zosobnit volající</span><span class="sxs-lookup"><span data-stu-id="01acb-186"> does not impersonate the caller</span></span>|  
|<span data-ttu-id="01acb-187">NotAllowed</span><span class="sxs-lookup"><span data-stu-id="01acb-187">NotAllowed</span></span>|<span data-ttu-id="01acb-188">true</span><span class="sxs-lookup"><span data-stu-id="01acb-188">true</span></span>|<span data-ttu-id="01acb-189">Povoleny.</span><span class="sxs-lookup"><span data-stu-id="01acb-189">Disallowed.</span></span> <span data-ttu-id="01acb-190">( <xref:System.InvalidOperationException> Je vyvolána výjimka.)</span><span class="sxs-lookup"><span data-stu-id="01acb-190">(An <xref:System.InvalidOperationException> is thrown.)</span></span>|  
  
## <a name="impersonation-level-obtained-from-windows-credentials-and-cached-token-impersonation"></a><span data-ttu-id="01acb-191">Úroveň zosobnění získané z pověření systému Windows a uložili do mezipaměti Token zosobnění</span><span class="sxs-lookup"><span data-stu-id="01acb-191">Impersonation Level Obtained from Windows Credentials and Cached Token Impersonation</span></span>  
 <span data-ttu-id="01acb-192">V některých scénářích má klient částečné řídit úroveň zosobnění, pokud se používá Windows pověření klienta provede služba.</span><span class="sxs-lookup"><span data-stu-id="01acb-192">In some scenarios the client has partial control over the level of impersonation the service performs when a Windows client credential is used.</span></span> <span data-ttu-id="01acb-193">Jeden scénář nastane, když klient určuje úroveň zosobnění anonymní.</span><span class="sxs-lookup"><span data-stu-id="01acb-193">One scenario occurs when the client specifies an Anonymous impersonation level.</span></span> <span data-ttu-id="01acb-194">Druhá nastane při provádění zosobnění s token v mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="01acb-194">The other occurs when performing impersonation with a cached token.</span></span> <span data-ttu-id="01acb-195">To se provádí nastavením <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> vlastnost <xref:System.ServiceModel.Security.WindowsClientCredential> třídy, která je přístupná jako vlastnost obecná <xref:System.ServiceModel.ChannelFactory%601> třídy.</span><span class="sxs-lookup"><span data-stu-id="01acb-195">This is done by setting the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property of the <xref:System.ServiceModel.Security.WindowsClientCredential> class, which is accessed as a property of the generic <xref:System.ServiceModel.ChannelFactory%601> class.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="01acb-196">Určení úroveň zosobnění anonymní způsobí, že klient anonymní přihlášení ke službě.</span><span class="sxs-lookup"><span data-stu-id="01acb-196">Specifying an impersonation level of Anonymous causes the client to log on to the service anonymously.</span></span> <span data-ttu-id="01acb-197">Služba proto musí umožňovat anonymní přihlášení, bez ohledu na to, jestli se provedlo zosobnění.</span><span class="sxs-lookup"><span data-stu-id="01acb-197">The service must therefore allow anonymous logons, regardless of whether impersonation is performed.</span></span>  
  
 <span data-ttu-id="01acb-198">Klienta můžete zadat úroveň zosobnění jako <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, <xref:System.Security.Principal.TokenImpersonationLevel.Identification>, <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>, nebo <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span><span class="sxs-lookup"><span data-stu-id="01acb-198">The client can specify the impersonation level as <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, <xref:System.Security.Principal.TokenImpersonationLevel.Identification>, <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>, or <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span> <span data-ttu-id="01acb-199">Vytváří jenom token na zadané úrovni, jak je znázorněno v následujícím kódu.</span><span class="sxs-lookup"><span data-stu-id="01acb-199">Only a token at the specified level is produced, as shown in the following code.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#4)]
 [!code-vb[c_ImpersonationAndDelegation#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#4)]  
  
 <span data-ttu-id="01acb-200">Následující tabulka určuje úroveň zosobnění, které služba získává při zosobňování z token v mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="01acb-200">The following table specifies the impersonation level the service obtains when impersonating from a cached token.</span></span>  
  
|<span data-ttu-id="01acb-201">`AllowedImpersonationLevel` Hodnota</span><span class="sxs-lookup"><span data-stu-id="01acb-201">`AllowedImpersonationLevel` value</span></span>|<span data-ttu-id="01acb-202">Služba má `SeImpersonatePrivilege`</span><span class="sxs-lookup"><span data-stu-id="01acb-202">Service has `SeImpersonatePrivilege`</span></span>|<span data-ttu-id="01acb-203">Klienta a služby podporují delegování</span><span class="sxs-lookup"><span data-stu-id="01acb-203">Service and client are capable of delegation</span></span>|<span data-ttu-id="01acb-204">Token v mezipaměti `ImpersonationLevel`</span><span class="sxs-lookup"><span data-stu-id="01acb-204">Cached token `ImpersonationLevel`</span></span>|  
|---------------------------------------|------------------------------------------|--------------------------------------------------|---------------------------------------|  
|<span data-ttu-id="01acb-205">Anonymní</span><span class="sxs-lookup"><span data-stu-id="01acb-205">Anonymous</span></span>|<span data-ttu-id="01acb-206">Ano</span><span class="sxs-lookup"><span data-stu-id="01acb-206">Yes</span></span>|<span data-ttu-id="01acb-207">není k dispozici</span><span class="sxs-lookup"><span data-stu-id="01acb-207">n/a</span></span>|<span data-ttu-id="01acb-208">Zosobnění</span><span class="sxs-lookup"><span data-stu-id="01acb-208">Impersonation</span></span>|  
|<span data-ttu-id="01acb-209">Anonymní</span><span class="sxs-lookup"><span data-stu-id="01acb-209">Anonymous</span></span>|<span data-ttu-id="01acb-210">Ne</span><span class="sxs-lookup"><span data-stu-id="01acb-210">No</span></span>|<span data-ttu-id="01acb-211">není k dispozici</span><span class="sxs-lookup"><span data-stu-id="01acb-211">n/a</span></span>|<span data-ttu-id="01acb-212">Identifikace</span><span class="sxs-lookup"><span data-stu-id="01acb-212">Identification</span></span>|  
|<span data-ttu-id="01acb-213">Identifikace</span><span class="sxs-lookup"><span data-stu-id="01acb-213">Identification</span></span>|<span data-ttu-id="01acb-214">není k dispozici</span><span class="sxs-lookup"><span data-stu-id="01acb-214">n/a</span></span>|<span data-ttu-id="01acb-215">není k dispozici</span><span class="sxs-lookup"><span data-stu-id="01acb-215">n/a</span></span>|<span data-ttu-id="01acb-216">Identifikace</span><span class="sxs-lookup"><span data-stu-id="01acb-216">Identification</span></span>|  
|<span data-ttu-id="01acb-217">Zosobnění</span><span class="sxs-lookup"><span data-stu-id="01acb-217">Impersonation</span></span>|<span data-ttu-id="01acb-218">Ano</span><span class="sxs-lookup"><span data-stu-id="01acb-218">Yes</span></span>|<span data-ttu-id="01acb-219">není k dispozici</span><span class="sxs-lookup"><span data-stu-id="01acb-219">n/a</span></span>|<span data-ttu-id="01acb-220">Zosobnění</span><span class="sxs-lookup"><span data-stu-id="01acb-220">Impersonation</span></span>|  
|<span data-ttu-id="01acb-221">Zosobnění</span><span class="sxs-lookup"><span data-stu-id="01acb-221">Impersonation</span></span>|<span data-ttu-id="01acb-222">Ne</span><span class="sxs-lookup"><span data-stu-id="01acb-222">No</span></span>|<span data-ttu-id="01acb-223">není k dispozici</span><span class="sxs-lookup"><span data-stu-id="01acb-223">n/a</span></span>|<span data-ttu-id="01acb-224">Identifikace</span><span class="sxs-lookup"><span data-stu-id="01acb-224">Identification</span></span>|  
|<span data-ttu-id="01acb-225">Delegování</span><span class="sxs-lookup"><span data-stu-id="01acb-225">Delegation</span></span>|<span data-ttu-id="01acb-226">Ano</span><span class="sxs-lookup"><span data-stu-id="01acb-226">Yes</span></span>|<span data-ttu-id="01acb-227">Ano</span><span class="sxs-lookup"><span data-stu-id="01acb-227">Yes</span></span>|<span data-ttu-id="01acb-228">Delegování</span><span class="sxs-lookup"><span data-stu-id="01acb-228">Delegation</span></span>|  
|<span data-ttu-id="01acb-229">Delegování</span><span class="sxs-lookup"><span data-stu-id="01acb-229">Delegation</span></span>|<span data-ttu-id="01acb-230">Ano</span><span class="sxs-lookup"><span data-stu-id="01acb-230">Yes</span></span>|<span data-ttu-id="01acb-231">Ne</span><span class="sxs-lookup"><span data-stu-id="01acb-231">No</span></span>|<span data-ttu-id="01acb-232">Zosobnění</span><span class="sxs-lookup"><span data-stu-id="01acb-232">Impersonation</span></span>|  
|<span data-ttu-id="01acb-233">Delegování</span><span class="sxs-lookup"><span data-stu-id="01acb-233">Delegation</span></span>|<span data-ttu-id="01acb-234">Ne</span><span class="sxs-lookup"><span data-stu-id="01acb-234">No</span></span>|<span data-ttu-id="01acb-235">není k dispozici</span><span class="sxs-lookup"><span data-stu-id="01acb-235">n/a</span></span>|<span data-ttu-id="01acb-236">Identifikace</span><span class="sxs-lookup"><span data-stu-id="01acb-236">Identification</span></span>|  
  
## <a name="impersonation-level-obtained-from-user-name-credentials-and-cached-token-impersonation"></a><span data-ttu-id="01acb-237">Úroveň zosobnění získané z název pověření uživatele a uloží do mezipaměti Token zosobnění</span><span class="sxs-lookup"><span data-stu-id="01acb-237">Impersonation Level Obtained from User Name Credentials and Cached Token Impersonation</span></span>  
 <span data-ttu-id="01acb-238">Předáním službu jeho uživatelské jméno a heslo, klient umožňuje [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] se přihlásit jako tento uživatel, který je ekvivalentní nastavení `AllowedImpersonationLevel` vlastnost <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span><span class="sxs-lookup"><span data-stu-id="01acb-238">By passing the service its user name and password, a client enables [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] to log on as that user, which is equivalent to setting the `AllowedImpersonationLevel` property to <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span> <span data-ttu-id="01acb-239">( `AllowedImpersonationLevel` Je k dispozici na <xref:System.ServiceModel.Security.WindowsClientCredential> a <xref:System.ServiceModel.Security.HttpDigestClientCredential> třídy.) Následující tabulka obsahuje zosobnění úroveň získat přihlašovací údaje uživatele název přijetí služby.</span><span class="sxs-lookup"><span data-stu-id="01acb-239">(The `AllowedImpersonationLevel` is available on the <xref:System.ServiceModel.Security.WindowsClientCredential> and <xref:System.ServiceModel.Security.HttpDigestClientCredential> classes.) The following table provides the impersonation level obtained when the service receives user name credentials.</span></span>  
  
|`AllowedImpersonationLevel`|<span data-ttu-id="01acb-240">Služba má `SeImpersonatePrivilege`</span><span class="sxs-lookup"><span data-stu-id="01acb-240">Service has `SeImpersonatePrivilege`</span></span>|<span data-ttu-id="01acb-241">Klienta a služby podporují delegování</span><span class="sxs-lookup"><span data-stu-id="01acb-241">Service and client are capable of delegation</span></span>|<span data-ttu-id="01acb-242">Token v mezipaměti `ImpersonationLevel`</span><span class="sxs-lookup"><span data-stu-id="01acb-242">Cached token `ImpersonationLevel`</span></span>|  
|---------------------------------|------------------------------------------|--------------------------------------------------|---------------------------------------|  
|<span data-ttu-id="01acb-243">není k dispozici</span><span class="sxs-lookup"><span data-stu-id="01acb-243">n/a</span></span>|<span data-ttu-id="01acb-244">Ano</span><span class="sxs-lookup"><span data-stu-id="01acb-244">Yes</span></span>|<span data-ttu-id="01acb-245">Ano</span><span class="sxs-lookup"><span data-stu-id="01acb-245">Yes</span></span>|<span data-ttu-id="01acb-246">Delegování</span><span class="sxs-lookup"><span data-stu-id="01acb-246">Delegation</span></span>|  
|<span data-ttu-id="01acb-247">není k dispozici</span><span class="sxs-lookup"><span data-stu-id="01acb-247">n/a</span></span>|<span data-ttu-id="01acb-248">Ano</span><span class="sxs-lookup"><span data-stu-id="01acb-248">Yes</span></span>|<span data-ttu-id="01acb-249">Ne</span><span class="sxs-lookup"><span data-stu-id="01acb-249">No</span></span>|<span data-ttu-id="01acb-250">Zosobnění</span><span class="sxs-lookup"><span data-stu-id="01acb-250">Impersonation</span></span>|  
|<span data-ttu-id="01acb-251">není k dispozici</span><span class="sxs-lookup"><span data-stu-id="01acb-251">n/a</span></span>|<span data-ttu-id="01acb-252">Ne</span><span class="sxs-lookup"><span data-stu-id="01acb-252">No</span></span>|<span data-ttu-id="01acb-253">není k dispozici</span><span class="sxs-lookup"><span data-stu-id="01acb-253">n/a</span></span>|<span data-ttu-id="01acb-254">Identifikace</span><span class="sxs-lookup"><span data-stu-id="01acb-254">Identification</span></span>|  
  
## <a name="impersonation-level-obtained-from-s4u-based-impersonation"></a><span data-ttu-id="01acb-255">Úroveň zosobnění získaný na základě S4U zosobnění</span><span class="sxs-lookup"><span data-stu-id="01acb-255">Impersonation Level Obtained from S4U-Based Impersonation</span></span>  
  
|<span data-ttu-id="01acb-256">Služba má `SeTcbPrivilege`</span><span class="sxs-lookup"><span data-stu-id="01acb-256">Service has `SeTcbPrivilege`</span></span>|<span data-ttu-id="01acb-257">Služba má `SeImpersonatePrivilege`</span><span class="sxs-lookup"><span data-stu-id="01acb-257">Service has `SeImpersonatePrivilege`</span></span>|<span data-ttu-id="01acb-258">Klienta a služby podporují delegování</span><span class="sxs-lookup"><span data-stu-id="01acb-258">Service and client are capable of delegation</span></span>|<span data-ttu-id="01acb-259">Token v mezipaměti `ImpersonationLevel`</span><span class="sxs-lookup"><span data-stu-id="01acb-259">Cached token `ImpersonationLevel`</span></span>|  
|----------------------------------|------------------------------------------|--------------------------------------------------|---------------------------------------|  
|<span data-ttu-id="01acb-260">Ano</span><span class="sxs-lookup"><span data-stu-id="01acb-260">Yes</span></span>|<span data-ttu-id="01acb-261">Ano</span><span class="sxs-lookup"><span data-stu-id="01acb-261">Yes</span></span>|<span data-ttu-id="01acb-262">není k dispozici</span><span class="sxs-lookup"><span data-stu-id="01acb-262">n/a</span></span>|<span data-ttu-id="01acb-263">Zosobnění</span><span class="sxs-lookup"><span data-stu-id="01acb-263">Impersonation</span></span>|  
|<span data-ttu-id="01acb-264">Ano</span><span class="sxs-lookup"><span data-stu-id="01acb-264">Yes</span></span>|<span data-ttu-id="01acb-265">Ne</span><span class="sxs-lookup"><span data-stu-id="01acb-265">No</span></span>|<span data-ttu-id="01acb-266">není k dispozici</span><span class="sxs-lookup"><span data-stu-id="01acb-266">n/a</span></span>|<span data-ttu-id="01acb-267">Identifikace</span><span class="sxs-lookup"><span data-stu-id="01acb-267">Identification</span></span>|  
|<span data-ttu-id="01acb-268">Ne</span><span class="sxs-lookup"><span data-stu-id="01acb-268">No</span></span>|<span data-ttu-id="01acb-269">není k dispozici</span><span class="sxs-lookup"><span data-stu-id="01acb-269">n/a</span></span>|<span data-ttu-id="01acb-270">není k dispozici</span><span class="sxs-lookup"><span data-stu-id="01acb-270">n/a</span></span>|<span data-ttu-id="01acb-271">Identifikace</span><span class="sxs-lookup"><span data-stu-id="01acb-271">Identification</span></span>|  
  
## <a name="mapping-a-client-certificate-to-a-windows-account"></a><span data-ttu-id="01acb-272">Mapování certifikátu klienta pro účet systému Windows</span><span class="sxs-lookup"><span data-stu-id="01acb-272">Mapping a Client Certificate to a Windows Account</span></span>  
 <span data-ttu-id="01acb-273">Je možné pro klienta k vlastnímu ověření služby pomocí certifikátu a tak, aby měl mapy služeb klienta pro existující účet prostřednictvím služby Active Directory.</span><span class="sxs-lookup"><span data-stu-id="01acb-273">It is possible for a client to authenticate itself to a service using a certificate, and to have the service map the client to an existing account through Active Directory.</span></span> <span data-ttu-id="01acb-274">Následující kód XML ukazuje, jak nakonfigurovat službu, kterou chcete mapovat certifikát.</span><span class="sxs-lookup"><span data-stu-id="01acb-274">The following XML shows how to configure the service to map the certificate.</span></span>  
  
```xml  
<behaviors>  
  <serviceBehaviors>  
    <behavior name="MapToWindowsAccount">  
      <serviceCredentials>  
        <clientCertificate>  
          <authentication mapClientCertificateToWindowsAccount="true" />  
        </clientCertificate>  
      </serviceCredentials>  
    </behavior>  
  </serviceBehaviors>  
</behaviors>  
```  
  
 <span data-ttu-id="01acb-275">Následující kód ukazuje, jak nakonfigurovat službu.</span><span class="sxs-lookup"><span data-stu-id="01acb-275">The following code shows how to configure the service.</span></span>  
  
```  
// Create a binding that sets a certificate as the client credential type.  
WSHttpBinding b = new WSHttpBinding();  
b.Security.Message.ClientCredentialType = MessageCredentialType.Certificate;  
  
// Create a service host that maps the certificate to a Windows account.  
Uri httpUri = new Uri("http://localhost/Calculator");  
ServiceHost sh = new ServiceHost(typeof(HelloService), httpUri);  
sh.Credentials.ClientCertificate.Authentication.MapClientCertificateToWindowsAccount = true;  
```  
  
## <a name="delegation"></a><span data-ttu-id="01acb-276">Delegování</span><span class="sxs-lookup"><span data-stu-id="01acb-276">Delegation</span></span>  
 <span data-ttu-id="01acb-277">Pokud chcete delegovat na back-end službu, musíte služby provést více větev protokolu Kerberos (SSPI bez záložní NTLM) nebo protokolu Kerberos přímo ověřování ve službě back-end pomocí identity klienta systému Windows.</span><span class="sxs-lookup"><span data-stu-id="01acb-277">To delegate to a back-end service, a service must perform Kerberos multi-leg (SSPI without NTLM fallback) or Kerberos direct authentication to the back-end service using the client’s Windows identity.</span></span> <span data-ttu-id="01acb-278">Pokud chcete delegovat na back-end službu, vytvořte <xref:System.ServiceModel.ChannelFactory%601> a kanál a potom komunikovat prostřednictvím kanálu při zosobňování klienta.</span><span class="sxs-lookup"><span data-stu-id="01acb-278">To delegate to a back-end service, create a <xref:System.ServiceModel.ChannelFactory%601> and a channel, and then communicate through the channel while impersonating the client.</span></span> <span data-ttu-id="01acb-279">Pomocí tohoto formuláře delegování vzdálenost, kdy mohou být umístěny ze služby front-endové službě back-end závisí na úroveň zosobnění dosáhnout ve front-endové služby.</span><span class="sxs-lookup"><span data-stu-id="01acb-279">With this form of delegation, the distance at which the back-end service can be located from the front-end service depends on the impersonation level achieved by the front-end service.</span></span> <span data-ttu-id="01acb-280">Pokud je úroveň zosobnění <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>, služby front-end a back-end musí být spuštěné na stejném počítači.</span><span class="sxs-lookup"><span data-stu-id="01acb-280">When the impersonation level is <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>, the front-end and back-end services must be running on the same machine.</span></span> <span data-ttu-id="01acb-281">Pokud je úroveň zosobnění <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>, front-end a back-end služby může být na samostatných počítačích nebo na stejném počítači.</span><span class="sxs-lookup"><span data-stu-id="01acb-281">When the impersonation level is <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>, the front-end and back-end services can be on separate machines or on the same machine.</span></span> <span data-ttu-id="01acb-282">Povolení delegování úroveň zosobnění vyžaduje, aby zásada domény Windows nakonfigurovaný tak, aby povolovala delegování.</span><span class="sxs-lookup"><span data-stu-id="01acb-282">Enabling delegation-level impersonation requires that Windows domain policy be configured to permit delegation.</span></span> <span data-ttu-id="01acb-283">Další informace o konfiguraci služby Active Directory pro podporu delegování najdete v tématu [povolení delegované ověřování](http://go.microsoft.com/fwlink/?LinkId=99690).</span><span class="sxs-lookup"><span data-stu-id="01acb-283">For more information about configuring Active Directory for delegation support, see [Enabling Delegated Authentication](http://go.microsoft.com/fwlink/?LinkId=99690).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="01acb-284">Když klient ověřuje front-endové služby pomocí uživatelského jména a hesla, které odpovídají na účet systému Windows ve službě back-end, front-endová služba ověřit ve službě back-end pomocí opakovaného použití klienta uživatelské jméno a heslo.</span><span class="sxs-lookup"><span data-stu-id="01acb-284">When a client authenticates to the front-end service using a user name and password that correspond to a Windows account on the back-end service, the front-end service can authenticate to the back-end service by reusing the client’s user name and password.</span></span> <span data-ttu-id="01acb-285">To je zvláště efektivní forma tok identity, protože předávání uživatelské jméno a heslo ke službě back-end umožňuje back endové služby k zosobnění, ale nepředstavuje delegování, protože se nepoužívá protokolu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="01acb-285">This is a particularly powerful form of identity flow, because passing user name and password to the back-end service enables the back-end service to perform impersonation, but it does not constitute delegation because Kerberos is not used.</span></span> <span data-ttu-id="01acb-286">Ovládací prvky Active Directory na delegování se nevztahují na ověřování uživatelským jménem a heslem.</span><span class="sxs-lookup"><span data-stu-id="01acb-286">Active Directory controls on delegation do not apply to user name and password authentication.</span></span>  
  
### <a name="delegation-ability-as-a-function-of-impersonation-level"></a><span data-ttu-id="01acb-287">Možnost delegování jako funkce úroveň zosobnění</span><span class="sxs-lookup"><span data-stu-id="01acb-287">Delegation Ability as a Function of Impersonation Level</span></span>  
  
|<span data-ttu-id="01acb-288">Úroveň zosobnění</span><span class="sxs-lookup"><span data-stu-id="01acb-288">Impersonation level</span></span>|<span data-ttu-id="01acb-289">Služba může provést delegování napříč procesem</span><span class="sxs-lookup"><span data-stu-id="01acb-289">Service can perform cross-process delegation</span></span>|<span data-ttu-id="01acb-290">Služby můžete provádět mezi počítači delegování</span><span class="sxs-lookup"><span data-stu-id="01acb-290">Service can perform cross-machine delegation</span></span>|  
|-------------------------|---------------------------------------------------|---------------------------------------------------|  
|<xref:System.Security.Principal.TokenImpersonationLevel.Identification>|<span data-ttu-id="01acb-291">Ne</span><span class="sxs-lookup"><span data-stu-id="01acb-291">No</span></span>|<span data-ttu-id="01acb-292">Ne</span><span class="sxs-lookup"><span data-stu-id="01acb-292">No</span></span>|  
|<xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>|<span data-ttu-id="01acb-293">Ano</span><span class="sxs-lookup"><span data-stu-id="01acb-293">Yes</span></span>|<span data-ttu-id="01acb-294">Ne</span><span class="sxs-lookup"><span data-stu-id="01acb-294">No</span></span>|  
|<xref:System.Security.Principal.TokenImpersonationLevel.Delegation>|<span data-ttu-id="01acb-295">Ano</span><span class="sxs-lookup"><span data-stu-id="01acb-295">Yes</span></span>|<span data-ttu-id="01acb-296">Ano</span><span class="sxs-lookup"><span data-stu-id="01acb-296">Yes</span></span>|  
  
 <span data-ttu-id="01acb-297">Následující příklad kódu ukazuje, jak použít delegování.</span><span class="sxs-lookup"><span data-stu-id="01acb-297">The following code example demonstrates how to use delegation.</span></span>  
  
 [!code-csharp[c_delegation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_delegation/cs/source.cs#1)]
 [!code-vb[c_delegation#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_delegation/vb/source.vb#1)]  
  
### <a name="how-to-configure-an-application-to-use-constrained-delegation"></a><span data-ttu-id="01acb-298">Postup konfigurace aplikace pro použití omezeného delegování</span><span class="sxs-lookup"><span data-stu-id="01acb-298">How to Configure an Application to Use Constrained Delegation</span></span>  
 <span data-ttu-id="01acb-299">Než budete moci použít omezené delegování, odesílatel, příjemce a řadič domény musí být konfigurován tak.</span><span class="sxs-lookup"><span data-stu-id="01acb-299">Before you can use constrained delegation, the sender, receiver, and the domain controller must be configured to do so.</span></span> <span data-ttu-id="01acb-300">Následující postup obsahuje kroky, které umožňují omezeného delegování.</span><span class="sxs-lookup"><span data-stu-id="01acb-300">The following procedure lists the steps that enable constrained delegation.</span></span> <span data-ttu-id="01acb-301">Podrobnosti o rozdílech mezi omezené delegování a delegování najdete v tématu část [rozšíření systému Windows Server 2003 Kerberos](http://go.microsoft.com/fwlink/?LinkId=100194) diskutuje omezené diskuzi.</span><span class="sxs-lookup"><span data-stu-id="01acb-301">For details about the differences between delegation and constrained delegation, see the portion of [Windows Server 2003 Kerberos Extensions](http://go.microsoft.com/fwlink/?LinkId=100194) that discusses constrained discussion.</span></span>  
  
1.  <span data-ttu-id="01acb-302">Na řadiči domény, zrušte **účet je citlivý a nelze jej delegovat** zaškrtávací políčko pro účet, pod kterým klientská aplikace běží.</span><span class="sxs-lookup"><span data-stu-id="01acb-302">On the domain controller, clear the **Account is sensitive and cannot be delegated** check box for the account under which the client application is running.</span></span>  
  
2.  <span data-ttu-id="01acb-303">Na řadiči domény, vyberte **účet je důvěryhodný pro delegování** zaškrtávací políčko pro účet, pod kterým klientská aplikace běží.</span><span class="sxs-lookup"><span data-stu-id="01acb-303">On the domain controller, select the **Account is trusted for delegation** check box for the account under which the client application is running.</span></span>  
  
3.  <span data-ttu-id="01acb-304">Na řadiči domény, střední vrstvy počítač nakonfigurovat tak, aby byl důvěryhodný pro delegování, kliknutím **Důvěřovat počítači pro delegování** možnost.</span><span class="sxs-lookup"><span data-stu-id="01acb-304">On the domain controller, configure the middle tier computer so that it is trusted for delegation, by clicking the **Trust computer for delegation** option.</span></span>  
  
4.  <span data-ttu-id="01acb-305">Na řadiči domény, konfigurace střední vrstvy počítače použít omezené delegování, kliknutím **důvěřovat tomuto počítači pro delegování pouze určeným službám** možnost.</span><span class="sxs-lookup"><span data-stu-id="01acb-305">On the domain controller, configure the middle tier computer to use constrained delegation, by clicking the **Trust this computer for delegation to specified services only** option.</span></span>  
  
 <span data-ttu-id="01acb-306">Podrobnější pokyny ke konfiguraci omezeného delegování naleznete v následujících tématech na webu MSDN:</span><span class="sxs-lookup"><span data-stu-id="01acb-306">For more detailed instructions about configuring constrained delegation, see the following topics on MSDN:</span></span>  
  
-   [<span data-ttu-id="01acb-307">Řešení potíží s delegováním protokolu Kerberos</span><span class="sxs-lookup"><span data-stu-id="01acb-307">Troubleshooting Kerberos Delegation</span></span>](http://go.microsoft.com/fwlink/?LinkId=36724)  
  
-   [<span data-ttu-id="01acb-308">Přechod protokolu Kerberos a omezeného delegování</span><span class="sxs-lookup"><span data-stu-id="01acb-308">Kerberos Protocol Transition and Constrained Delegation</span></span>](http://go.microsoft.com/fwlink/?LinkId=36725)  
  
## <a name="see-also"></a><span data-ttu-id="01acb-309">Viz také</span><span class="sxs-lookup"><span data-stu-id="01acb-309">See Also</span></span>  
 <xref:System.ServiceModel.OperationBehaviorAttribute>  
 <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A>  
 <xref:System.ServiceModel.ImpersonationOption>  
 <xref:System.ServiceModel.ServiceSecurityContext.WindowsIdentity%2A>  
 <xref:System.ServiceModel.ServiceSecurityContext>  
 <xref:System.Security.Principal.WindowsIdentity>  
 <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior>  
 <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.ImpersonateCallerForAllOperations%2A>  
 <xref:System.ServiceModel.ServiceHost>  
 <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A>  
 <xref:System.ServiceModel.Security.WindowsClientCredential>  
 <xref:System.ServiceModel.ChannelFactory%601>  
 <xref:System.Security.Principal.TokenImpersonationLevel.Identification>  
 [<span data-ttu-id="01acb-310">Použití zosobnění se zabezpečením přenosu</span><span class="sxs-lookup"><span data-stu-id="01acb-310">Using Impersonation with Transport Security</span></span>](../../../../docs/framework/wcf/feature-details/using-impersonation-with-transport-security.md)  
 [<span data-ttu-id="01acb-311">Zosobnění klienta</span><span class="sxs-lookup"><span data-stu-id="01acb-311">Impersonating the Client</span></span>](../../../../docs/framework/wcf/samples/impersonating-the-client.md)  
 [<span data-ttu-id="01acb-312">Postupy: Zosobnění klienta ve službě</span><span class="sxs-lookup"><span data-stu-id="01acb-312">How to: Impersonate a Client on a Service</span></span>](../../../../docs/framework/wcf/how-to-impersonate-a-client-on-a-service.md)  
 [<span data-ttu-id="01acb-313">Nástroj metadat modelu služby (Svcutil.exe)</span><span class="sxs-lookup"><span data-stu-id="01acb-313">ServiceModel Metadata Utility Tool (Svcutil.exe)</span></span>](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)
