---
title: Ladění chyb ověřování systému Windows
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: ''
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
- WCF, Windows authentication
ms.assetid: 181be4bd-79b1-4a66-aee2-931887a6d7cc
caps.latest.revision: 21
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: 39c033d45488b827a4aee7439904db8094795db4
ms.sourcegitcommit: 94d33cadc5ff81d2ac389bf5f26422c227832052
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/30/2018
---
# <a name="debugging-windows-authentication-errors"></a><span data-ttu-id="71c86-102">Ladění chyb ověřování systému Windows</span><span class="sxs-lookup"><span data-stu-id="71c86-102">Debugging Windows Authentication Errors</span></span>
<span data-ttu-id="71c86-103">Pokud používáte ověřování systému Windows jako vhodný mechanismus zabezpečení, rozhraní pro zprostředkovatele podpory zabezpečení (SSPI) zpracovává procesy zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="71c86-103">When using Windows authentication as a security mechanism, the Security Support Provider Interface (SSPI) handles security processes.</span></span> <span data-ttu-id="71c86-104">Při výskytu chyb zabezpečení ve vrstvě rozhraní SSPI, jsou prezentované podle [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].</span><span class="sxs-lookup"><span data-stu-id="71c86-104">When security errors occur at the SSPI layer, they are surfaced by [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].</span></span> <span data-ttu-id="71c86-105">Toto téma obsahuje framework a sadu otázky, které pomohou diagnostikovat chyby.</span><span class="sxs-lookup"><span data-stu-id="71c86-105">This topic provides a framework and set of questions to help diagnose the errors.</span></span>  
  
 <span data-ttu-id="71c86-106">Přehled protokolu Kerberos najdete v tématu [protokolu Kerberos](http://go.microsoft.com/fwlink/?LinkID=86946); najdete v tématu Přehled SSPI, [SSPI](http://go.microsoft.com/fwlink/?LinkId=88941).</span><span class="sxs-lookup"><span data-stu-id="71c86-106">For an overview of the Kerberos protocol, see [Kerberos Explained](http://go.microsoft.com/fwlink/?LinkID=86946); for an overview of SSPI, see [SSPI](http://go.microsoft.com/fwlink/?LinkId=88941).</span></span>  
  
 <span data-ttu-id="71c86-107">Pro ověřování systému Windows [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] se většinou používá *Negotiate* zprostředkovatele podpory zabezpečení (SSP), který provádí vzájemné ověřování protokolem Kerberos mezi klientem a službou.</span><span class="sxs-lookup"><span data-stu-id="71c86-107">For Windows authentication, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] typically uses the *Negotiate* Security Support Provider (SSP), which performs Kerberos mutual authentication between the client and service.</span></span> <span data-ttu-id="71c86-108">Pokud není k dispozici, ve výchozím nastavení protokol Kerberos [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] spadne zpět na NT LAN Manager (NTLM).</span><span class="sxs-lookup"><span data-stu-id="71c86-108">If the Kerberos protocol is not available, by default [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] falls back to NT LAN Manager (NTLM).</span></span> <span data-ttu-id="71c86-109">Ale můžete nakonfigurovat [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] používat pouze protokol Kerberos (a způsobí výjimku, pokud protokolu Kerberos není k dispozici).</span><span class="sxs-lookup"><span data-stu-id="71c86-109">However, you can configure [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] to use only the Kerberos protocol (and to throw an exception if Kerberos is not available).</span></span> <span data-ttu-id="71c86-110">Můžete také nakonfigurovat [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] používat s omezeným přístupem formuláře protokolu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="71c86-110">You can also configure [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] to use restricted forms of the Kerberos protocol.</span></span>  
  
## <a name="debugging-methodology"></a><span data-ttu-id="71c86-111">Ladění metody</span><span class="sxs-lookup"><span data-stu-id="71c86-111">Debugging Methodology</span></span>  
 <span data-ttu-id="71c86-112">Základní metoda vypadá takto:</span><span class="sxs-lookup"><span data-stu-id="71c86-112">The basic method is as follows:</span></span>  
  
1.  <span data-ttu-id="71c86-113">Určí, jestli používáte ověřování systému Windows.</span><span class="sxs-lookup"><span data-stu-id="71c86-113">Determine whether you are using Windows authentication.</span></span> <span data-ttu-id="71c86-114">Pokud používáte jiné schéma, toto téma se nevztahuje.</span><span class="sxs-lookup"><span data-stu-id="71c86-114">If you are using any other scheme, this topic does not apply.</span></span>  
  
2.  <span data-ttu-id="71c86-115">Pokud jste si jistí, používáte ověřování systému Windows, zjistit, jestli vaše [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] konfigurace používá přímo pomocí protokolu Kerberos nebo Negotiate.</span><span class="sxs-lookup"><span data-stu-id="71c86-115">If you are sure you are using Windows authentication, determine whether your [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] configuration uses Kerberos direct or Negotiate.</span></span>  
  
3.  <span data-ttu-id="71c86-116">Jakmile zjistíte, zda je vaše konfigurace pomocí protokolu Kerberos nebo NTLM, rozumíte chybové zprávy v rámci správné.</span><span class="sxs-lookup"><span data-stu-id="71c86-116">Once you have determined whether your configuration is using the Kerberos protocol or NTLM, you can understand error messages in the correct context.</span></span>  
  
### <a name="availability-of-the-kerberos-protocol-and-ntlm"></a><span data-ttu-id="71c86-117">Dostupnost protokolu Kerberos a NTLM</span><span class="sxs-lookup"><span data-stu-id="71c86-117">Availability of the Kerberos Protocol and NTLM</span></span>  
 <span data-ttu-id="71c86-118">Zprostředkovatel zabezpečení protokolu Kerberos vyžaduje řadič domény tak, aby fungoval jako protokolu Kerberos Center KDC (Key Distribution).</span><span class="sxs-lookup"><span data-stu-id="71c86-118">The Kerberos SSP requires a domain controller to act as the Kerberos Key Distribution Center (KDC).</span></span> <span data-ttu-id="71c86-119">Protokol Kerberos je k dispozici pouze v případě, že klient a služba používáte domény identity.</span><span class="sxs-lookup"><span data-stu-id="71c86-119">The Kerberos protocol is available only when both the client and service are using domain identities.</span></span> <span data-ttu-id="71c86-120">V jiné kombinace účet se používá protokol NTLM, dle souhrnu v následující tabulce.</span><span class="sxs-lookup"><span data-stu-id="71c86-120">In other account combinations, NTLM is used, as summarized in the following table.</span></span>  
  
 <span data-ttu-id="71c86-121">Záhlaví tabulky zobrazit typy účet možných používaná na serveru.</span><span class="sxs-lookup"><span data-stu-id="71c86-121">The table headers show possible account types used by the server.</span></span> <span data-ttu-id="71c86-122">V levém sloupci uvádí možné typy účtů používaných klientem.</span><span class="sxs-lookup"><span data-stu-id="71c86-122">The left column shows possible account types used by the client.</span></span>  
  
||<span data-ttu-id="71c86-123">Místní uživatele</span><span class="sxs-lookup"><span data-stu-id="71c86-123">Local User</span></span>|<span data-ttu-id="71c86-124">Místní systém</span><span class="sxs-lookup"><span data-stu-id="71c86-124">Local System</span></span>|<span data-ttu-id="71c86-125">Uživatel domény</span><span class="sxs-lookup"><span data-stu-id="71c86-125">Domain User</span></span>|<span data-ttu-id="71c86-126">Počítače domény</span><span class="sxs-lookup"><span data-stu-id="71c86-126">Domain Machine</span></span>|  
|-|----------------|------------------|-----------------|--------------------|  
|<span data-ttu-id="71c86-127">Místní uživatele</span><span class="sxs-lookup"><span data-stu-id="71c86-127">Local User</span></span>|<span data-ttu-id="71c86-128">NTLM</span><span class="sxs-lookup"><span data-stu-id="71c86-128">NTLM</span></span>|<span data-ttu-id="71c86-129">NTLM</span><span class="sxs-lookup"><span data-stu-id="71c86-129">NTLM</span></span>|<span data-ttu-id="71c86-130">NTLM</span><span class="sxs-lookup"><span data-stu-id="71c86-130">NTLM</span></span>|<span data-ttu-id="71c86-131">NTLM</span><span class="sxs-lookup"><span data-stu-id="71c86-131">NTLM</span></span>|  
|<span data-ttu-id="71c86-132">Místní systém</span><span class="sxs-lookup"><span data-stu-id="71c86-132">Local System</span></span>|<span data-ttu-id="71c86-133">Anonymní ověřování NTLM</span><span class="sxs-lookup"><span data-stu-id="71c86-133">Anonymous NTLM</span></span>|<span data-ttu-id="71c86-134">Anonymní ověřování NTLM</span><span class="sxs-lookup"><span data-stu-id="71c86-134">Anonymous NTLM</span></span>|<span data-ttu-id="71c86-135">Anonymní ověřování NTLM</span><span class="sxs-lookup"><span data-stu-id="71c86-135">Anonymous NTLM</span></span>|<span data-ttu-id="71c86-136">Anonymní ověřování NTLM</span><span class="sxs-lookup"><span data-stu-id="71c86-136">Anonymous NTLM</span></span>|  
|<span data-ttu-id="71c86-137">Uživatel domény</span><span class="sxs-lookup"><span data-stu-id="71c86-137">Domain User</span></span>|<span data-ttu-id="71c86-138">NTLM</span><span class="sxs-lookup"><span data-stu-id="71c86-138">NTLM</span></span>|<span data-ttu-id="71c86-139">NTLM</span><span class="sxs-lookup"><span data-stu-id="71c86-139">NTLM</span></span>|<span data-ttu-id="71c86-140">Pomocí protokolu Kerberos</span><span class="sxs-lookup"><span data-stu-id="71c86-140">Kerberos</span></span>|<span data-ttu-id="71c86-141">Pomocí protokolu Kerberos</span><span class="sxs-lookup"><span data-stu-id="71c86-141">Kerberos</span></span>|  
|<span data-ttu-id="71c86-142">Počítače domény</span><span class="sxs-lookup"><span data-stu-id="71c86-142">Domain Machine</span></span>|<span data-ttu-id="71c86-143">NTLM</span><span class="sxs-lookup"><span data-stu-id="71c86-143">NTLM</span></span>|<span data-ttu-id="71c86-144">NTLM</span><span class="sxs-lookup"><span data-stu-id="71c86-144">NTLM</span></span>|<span data-ttu-id="71c86-145">Pomocí protokolu Kerberos</span><span class="sxs-lookup"><span data-stu-id="71c86-145">Kerberos</span></span>|<span data-ttu-id="71c86-146">Pomocí protokolu Kerberos</span><span class="sxs-lookup"><span data-stu-id="71c86-146">Kerberos</span></span>|  
  
 <span data-ttu-id="71c86-147">Konkrétně čtyři typy účtů patří:</span><span class="sxs-lookup"><span data-stu-id="71c86-147">Specifically, the four account types include:</span></span>  
  
-   <span data-ttu-id="71c86-148">Místní uživatel: Profil uživatele pouze počítače.</span><span class="sxs-lookup"><span data-stu-id="71c86-148">Local User: Machine-only user profile.</span></span> <span data-ttu-id="71c86-149">Příklad: `MachineName\Administrator` nebo `MachineName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="71c86-149">For example: `MachineName\Administrator` or `MachineName\ProfileName`.</span></span>  
  
-   <span data-ttu-id="71c86-150">Místní systém: Předdefinovaný účet systému na počítači, který není připojený k doméně.</span><span class="sxs-lookup"><span data-stu-id="71c86-150">Local System: The built-in account SYSTEM on a machine that is not joined to a domain.</span></span>  
  
-   <span data-ttu-id="71c86-151">Uživatel domény: Uživatelský účet v doméně systému Windows.</span><span class="sxs-lookup"><span data-stu-id="71c86-151">Domain User: A user account on a Windows domain.</span></span> <span data-ttu-id="71c86-152">Příklad: `DomainName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="71c86-152">For example: `DomainName\ProfileName`.</span></span>  
  
-   <span data-ttu-id="71c86-153">Počítač domény: Proces s identitu počítače spuštěný na počítači připojený k doméně systému Windows.</span><span class="sxs-lookup"><span data-stu-id="71c86-153">Domain Machine: A process with machine identity running on a machine joined to a Windows domain.</span></span> <span data-ttu-id="71c86-154">Příklad: `MachineName\Network Service`.</span><span class="sxs-lookup"><span data-stu-id="71c86-154">For example: `MachineName\Network Service`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="71c86-155">Přihlašovací údaje služby pořízen při <xref:System.ServiceModel.ICommunicationObject.Open%2A> metodu <xref:System.ServiceModel.ServiceHost> třídy se nazývá.</span><span class="sxs-lookup"><span data-stu-id="71c86-155">The service credential is captured when the <xref:System.ServiceModel.ICommunicationObject.Open%2A> method of the <xref:System.ServiceModel.ServiceHost> class is called.</span></span> <span data-ttu-id="71c86-156">Pověření klienta je pro čtení vždy, když klient odešle zprávu.</span><span class="sxs-lookup"><span data-stu-id="71c86-156">The client credential is read whenever the client sends a message.</span></span>  
  
## <a name="common-windows-authentication-problems"></a><span data-ttu-id="71c86-157">Běžné problémy ověřování systému Windows</span><span class="sxs-lookup"><span data-stu-id="71c86-157">Common Windows Authentication Problems</span></span>  
 <span data-ttu-id="71c86-158">Tato část popisuje některé běžné problémy ověřování systému Windows a možné způsoby.</span><span class="sxs-lookup"><span data-stu-id="71c86-158">This section discusses some common Windows authentication problems and possible remedies.</span></span>  
  
### <a name="kerberos-protocol"></a><span data-ttu-id="71c86-159">Protokol Kerberos</span><span class="sxs-lookup"><span data-stu-id="71c86-159">Kerberos Protocol</span></span>  
  
#### <a name="spnupn-problems-with-the-kerberos-protocol"></a><span data-ttu-id="71c86-160">Hlavní název služby/UPN problémy s protokolem Kerberos</span><span class="sxs-lookup"><span data-stu-id="71c86-160">SPN/UPN Problems with the Kerberos Protocol</span></span>  
 <span data-ttu-id="71c86-161">Pokud používáte ověřování systému Windows a protokol je použít nebo vyjednaném rozhraní SSPI protokolu Kerberos, musí obsahovat adresu URL koncového bodu klienta používá plně kvalifikovaný název domény hostitele služby uvnitř adresu URL služby.</span><span class="sxs-lookup"><span data-stu-id="71c86-161">When using Windows authentication, and the Kerberos protocol is used or negotiated by SSPI, the URL the client endpoint uses must include the fully qualified domain name of the service's host inside the service URL.</span></span> <span data-ttu-id="71c86-162">Předpokladem je, že účet, pod kterým běží služba má přístup k klíč služby (SPN) pro hlavní název počítače (výchozí), který se vytvoří, když je počítač přidán do domény Active Directory, která se nejčastěji provádí spuštěním služby v rámci Účet služby sítě.</span><span class="sxs-lookup"><span data-stu-id="71c86-162">This assumes that the account under which the service is running has access to the machine (default) service principal name (SPN) key that is created when the computer is added to the Active Directory domain, which is most commonly done by running the service under the Network Service account.</span></span> <span data-ttu-id="71c86-163">Pokud služba nemá přístup ke klíči počítače hlavní název služby, je třeba zadat správný hlavní název služby nebo uživatele hlavní název (UPN) účtu, pod kterým je služba spuštěná v identitu koncového bodu klienta.</span><span class="sxs-lookup"><span data-stu-id="71c86-163">If the service does not have access to the machine SPN key, you must supply the correct SPN or user principal name (UPN) of the account under which the service is running in the client's endpoint identity.</span></span> <span data-ttu-id="71c86-164">Další informace o tom, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] funguje s SPN a UPN, najdete v části [identita a ověřování služby](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="71c86-164">For more information about how [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] works with SPN and UPN, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span></span>  
  
 <span data-ttu-id="71c86-165">Ve službě Vyrovnávání zatížení případech, například webových farem nebo webové zahrada běžnou praxí je definovat jedinečný účet pro každou aplikaci, k tomuto účtu přiřadit název SPN a ujistěte se, že všechny aplikace služby spuštěny v daném účtu.</span><span class="sxs-lookup"><span data-stu-id="71c86-165">In load-balancing scenarios, such as Web farms or Web gardens, a common practice is to define a unique account for each application, assign an SPN to that account, and ensure that all of the application's services run in that account.</span></span>  
  
 <span data-ttu-id="71c86-166">Pokud chcete získat název SPN pro účet služby, musíte být správcem domény služby Active Directory.</span><span class="sxs-lookup"><span data-stu-id="71c86-166">To obtain an SPN for your service's account, you need to be an Active Directory domain administrator.</span></span> <span data-ttu-id="71c86-167">Další informace najdete v tématu [Kerberos technické Supplement pro Windows](http://go.microsoft.com/fwlink/?LinkID=88330).</span><span class="sxs-lookup"><span data-stu-id="71c86-167">For more information, see [Kerberos Technical Supplement for Windows](http://go.microsoft.com/fwlink/?LinkID=88330).</span></span>  
  
#### <a name="kerberos-protocol-direct-requires-the-service-to-run-under-a-domain-machine-account"></a><span data-ttu-id="71c86-168">Protokol Kerberos Direct vyžaduje službu, kterou chcete spustit pod účtem počítače domény</span><span class="sxs-lookup"><span data-stu-id="71c86-168">Kerberos Protocol Direct Requires the Service to Run Under a Domain Machine Account</span></span>  
 <span data-ttu-id="71c86-169">K tomu dojde při `ClientCredentialType` je nastavena na `Windows` a <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> je nastavena na `false`, jak je znázorněno v následujícím kódu.</span><span class="sxs-lookup"><span data-stu-id="71c86-169">This occurs when the `ClientCredentialType` property is set to `Windows` and the <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> property is set to `false`, as shown in the following code.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#1)]
 [!code-vb[C_DebuggingWindowsAuth#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#1)]  
  
 <span data-ttu-id="71c86-170">K nápravě, spusťte službu pomocí účtu domény počítače, například síťové služby v doméně připojené k počítači.</span><span class="sxs-lookup"><span data-stu-id="71c86-170">To remedy, run the service using a Domain Machine account, such as Network Service, on a domain joined machine.</span></span>  
  
### <a name="delegation-requires-credential-negotiation"></a><span data-ttu-id="71c86-171">Delegování vyžaduje vyjednávání pověření</span><span class="sxs-lookup"><span data-stu-id="71c86-171">Delegation Requires Credential Negotiation</span></span>  
 <span data-ttu-id="71c86-172">Pokud chcete používat ověřování protokolu Kerberos s delegováním, musí implementovat protokol Kerberos s vyjednávání pověření (někdy nazývané "služby větev" nebo "vícekrokový" Kerberos).</span><span class="sxs-lookup"><span data-stu-id="71c86-172">To use the Kerberos authentication protocol with delegation, you must implement the Kerberos protocol with credential negotiation (sometimes called "multi-leg" or "multi-step" Kerberos).</span></span> <span data-ttu-id="71c86-173">Pokud budete implementovat ověřování protokolem Kerberos bez vyjednávání pověření (někdy nazývané "jednorázové" nebo "single větev" Kerberos), bude vyvolána výjimka.</span><span class="sxs-lookup"><span data-stu-id="71c86-173">If you implement Kerberos authentication without credential negotiation (sometimes called "one-shot" or "single-leg" Kerberos), an exception will be thrown.</span></span>  
  
 <span data-ttu-id="71c86-174">K implementaci protokolu Kerberos s vyjednávání pověření, proveďte následující kroky:</span><span class="sxs-lookup"><span data-stu-id="71c86-174">To implement Kerberos with credential negotiation, do the following steps:</span></span>  
  
1.  <span data-ttu-id="71c86-175">Implementace delegování nastavením <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> k <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span><span class="sxs-lookup"><span data-stu-id="71c86-175">Implement delegation by setting <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> to <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span>  
  
2.  <span data-ttu-id="71c86-176">Vyžadovat vyjednávání SSPI:</span><span class="sxs-lookup"><span data-stu-id="71c86-176">Require SSPI negotiation:</span></span>  
  
    1.  <span data-ttu-id="71c86-177">Pokud používáte standard vazby, nastavte `NegotiateServiceCredential` vlastnost `true`.</span><span class="sxs-lookup"><span data-stu-id="71c86-177">If you are using standard bindings, set the `NegotiateServiceCredential` property to `true`.</span></span>  
  
    2.  <span data-ttu-id="71c86-178">Pokud používáte vlastní vazby, nastavte `AuthenticationMode` atribut `Security` element `SspiNegotiated`.</span><span class="sxs-lookup"><span data-stu-id="71c86-178">If you are using custom bindings, set the `AuthenticationMode` attribute of the `Security` element to `SspiNegotiated`.</span></span>  
  
3.  <span data-ttu-id="71c86-179">Vyžadovat vyjednávání SSPI pro použití protokolu Kerberos, protože je zakázáno použití protokolu NTLM:</span><span class="sxs-lookup"><span data-stu-id="71c86-179">Require the SSPI negotiation to use Kerberos by disallowing the use of NTLM:</span></span>  
  
    1.  <span data-ttu-id="71c86-180">To lze proveďte v kódu, pomocí následujícího příkazu: `ChannelFactory.Credentials.Windows.AllowNtlm = false`</span><span class="sxs-lookup"><span data-stu-id="71c86-180">Do this in code, with the following statement: `ChannelFactory.Credentials.Windows.AllowNtlm = false`</span></span>  
  
    2.  <span data-ttu-id="71c86-181">Nebo můžete provést v konfiguračním souboru nastavením `allowNtlm` atribut `false`.</span><span class="sxs-lookup"><span data-stu-id="71c86-181">Or you can do this in the configuration file by setting the `allowNtlm` attribute to `false`.</span></span> <span data-ttu-id="71c86-182">Tento atribut je součástí [ \<windows >](../../../../docs/framework/configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span><span class="sxs-lookup"><span data-stu-id="71c86-182">This attribute is contained in the [\<windows>](../../../../docs/framework/configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span></span>  
  
### <a name="ntlm-protocol"></a><span data-ttu-id="71c86-183">Protokol NTLM</span><span class="sxs-lookup"><span data-stu-id="71c86-183">NTLM Protocol</span></span>  
  
#### <a name="negotiate-ssp-falls-back-to-ntlm-but-ntlm-is-disabled"></a><span data-ttu-id="71c86-184">Vyjednávání vrátí zprostředkovatele sdílených služeb k protokolu NTLM, ale je zakázaný protokol NTLM</span><span class="sxs-lookup"><span data-stu-id="71c86-184">Negotiate SSP Falls Back to NTLM, but NTLM Is Disabled</span></span>  
 <span data-ttu-id="71c86-185"><xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> Je nastavena na `false`, který spustí [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] aby best effort vyvolá výjimku, pokud se používá protokol NTLM.</span><span class="sxs-lookup"><span data-stu-id="71c86-185">The <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property is set to `false`, which causes [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] to make a best-effort to throw an exception if NTLM is used.</span></span> <span data-ttu-id="71c86-186">Všimněte si, že nastavení této vlastnosti na `false` nemusí zabránit odesílány prostřednictvím sítě pověření NTLM.</span><span class="sxs-lookup"><span data-stu-id="71c86-186">Note that setting this property to `false` may not prevent NTLM credentials from being sent over the wire.</span></span>  
  
 <span data-ttu-id="71c86-187">Následující ukazuje, jak zakázat nouzového řešení ověření pomocí protokolu NTLM.</span><span class="sxs-lookup"><span data-stu-id="71c86-187">The following shows how to disable fallback to NTLM.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#4)]
 [!code-vb[C_DebuggingWindowsAuth#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#4)]  
  
#### <a name="ntlm-logon-fails"></a><span data-ttu-id="71c86-188">Selhání přihlášení protokolem NTLM</span><span class="sxs-lookup"><span data-stu-id="71c86-188">NTLM Logon Fails</span></span>  
 <span data-ttu-id="71c86-189">Pověření klienta nejsou platné ve službě.</span><span class="sxs-lookup"><span data-stu-id="71c86-189">The client credentials are not valid on the service.</span></span> <span data-ttu-id="71c86-190">Zkontrolujte, zda uživatelské jméno a heslo jsou správně nastavena a odpovídat na účet, který se označuje k počítači, kde je služba spuštěná.</span><span class="sxs-lookup"><span data-stu-id="71c86-190">Check that the user name and password are correctly set and correspond to an account that is known to the computer where the service is running.</span></span> <span data-ttu-id="71c86-191">NTLM používá zadaná pověření pro přihlášení k počítači služby.</span><span class="sxs-lookup"><span data-stu-id="71c86-191">NTLM uses the specified credentials to log on to the service's computer.</span></span> <span data-ttu-id="71c86-192">Přihlašovací údaje mohou být na počítači, na kterém je spuštěný klient platná, toto přihlášení se nezdaří, pokud přihlašovací údaje nejsou platné v počítači služby.</span><span class="sxs-lookup"><span data-stu-id="71c86-192">While the credentials may be valid on the computer where the client is running, this logon will fail if the credentials are not valid on the service's computer.</span></span>  
  
#### <a name="anonymous-ntlm-logon-occurs-but-anonymous-logons-are-disabled-by-default"></a><span data-ttu-id="71c86-193">Dojde k přihlášení anonymní NTLM, ale anonymní přihlášení jsou ve výchozím nastavení zakázaná.</span><span class="sxs-lookup"><span data-stu-id="71c86-193">Anonymous NTLM Logon Occurs, but Anonymous Logons Are Disabled by Default</span></span>  
 <span data-ttu-id="71c86-194">Při vytváření klienta, <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> je nastavena na <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, jak je znázorněno v následujícím příkladu, ale ve výchozím nastavení serveru zakáže anonymní přihlášení.</span><span class="sxs-lookup"><span data-stu-id="71c86-194">When creating a client, the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property is set to <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, as shown in the following example, but by default the server disallows anonymous logons.</span></span> <span data-ttu-id="71c86-195">K tomu dochází, protože výchozí hodnota <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> vlastnost <xref:System.ServiceModel.Security.WindowsServiceCredential> třída je `false`.</span><span class="sxs-lookup"><span data-stu-id="71c86-195">This occurs because the default value of the <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> property of the <xref:System.ServiceModel.Security.WindowsServiceCredential> class is `false`.</span></span>  
  
 <span data-ttu-id="71c86-196">Následující kód klienta se pokusí je povolit (Všimněte si, že je vlastnost výchozí `Identification`).</span><span class="sxs-lookup"><span data-stu-id="71c86-196">The following client code attempts to enable anonymous logons (note that the default property is `Identification`).</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#5)]
 [!code-vb[C_DebuggingWindowsAuth#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#5)]  
  
 <span data-ttu-id="71c86-197">Následující kód služby změní výchozí server povolit anonymní přihlášení.</span><span class="sxs-lookup"><span data-stu-id="71c86-197">The following service code changes the default to enable anonymous logons by the server.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#6)]
 [!code-vb[C_DebuggingWindowsAuth#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#6)]  
  
 <span data-ttu-id="71c86-198">Další informace o zosobnění najdete v tématu [delegace a zosobnění](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="71c86-198">For more information about impersonation, see [Delegation and Impersonation](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span></span>  
  
 <span data-ttu-id="71c86-199">Můžete taky klient používá jako služby systému Windows, pomocí předdefinovaného účtu SYSTEM.</span><span class="sxs-lookup"><span data-stu-id="71c86-199">Alternatively, the client is running as a Windows service, using the built-in account SYSTEM.</span></span>  
  
### <a name="other-problems"></a><span data-ttu-id="71c86-200">Jiné problémy</span><span class="sxs-lookup"><span data-stu-id="71c86-200">Other Problems</span></span>  
  
#### <a name="client-credentials-are-not-set-correctly"></a><span data-ttu-id="71c86-201">Pověření klienta není správného nastavení</span><span class="sxs-lookup"><span data-stu-id="71c86-201">Client Credentials Are Not Set Correctly</span></span>  
 <span data-ttu-id="71c86-202">Ověřování systému Windows používá <xref:System.ServiceModel.Security.WindowsClientCredential> vrácené instance <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> vlastnost <xref:System.ServiceModel.ClientBase%601> třídy, ne <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span><span class="sxs-lookup"><span data-stu-id="71c86-202">Windows authentication uses the <xref:System.ServiceModel.Security.WindowsClientCredential> instance returned by the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the <xref:System.ServiceModel.ClientBase%601> class, not the <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span></span> <span data-ttu-id="71c86-203">Následující ukazuje příklad nesprávné.</span><span class="sxs-lookup"><span data-stu-id="71c86-203">The following shows an incorrect example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#2)]
 [!code-vb[C_DebuggingWindowsAuth#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#2)]  
  
 <span data-ttu-id="71c86-204">Následující obrázek znázorňuje příklad správné.</span><span class="sxs-lookup"><span data-stu-id="71c86-204">The following shows the correct example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#3)]
 [!code-vb[C_DebuggingWindowsAuth#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#3)]  
  
#### <a name="sspi-is-not-available"></a><span data-ttu-id="71c86-205">Rozhraní SSPI není k dispozici</span><span class="sxs-lookup"><span data-stu-id="71c86-205">SSPI Is Not Available</span></span>  
 <span data-ttu-id="71c86-206">Následující operační systémy nepodporují ověřování systému Windows, když se použije jako server: [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Media Center Edition a [!INCLUDE[wv](../../../../includes/wv-md.md)]domácí edice.</span><span class="sxs-lookup"><span data-stu-id="71c86-206">The following operating systems do not support Windows authentication when used as a server: [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition, [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Media Center Edition, and [!INCLUDE[wv](../../../../includes/wv-md.md)]Home editions.</span></span>  
  
#### <a name="developing-and-deploying-with-different-identities"></a><span data-ttu-id="71c86-207">Vývoj a nasazení s různými identitami</span><span class="sxs-lookup"><span data-stu-id="71c86-207">Developing and Deploying with Different Identities</span></span>  
 <span data-ttu-id="71c86-208">Pokud nasazení na jiném vyvíjet aplikaci na jednom počítači a používají různé typy účtu k ověření na každém počítači, můžete se setkat různé chování.</span><span class="sxs-lookup"><span data-stu-id="71c86-208">If you develop your application on one machine, and deploy on another, and use different account types to authenticate on each machine, you may experience different behavior.</span></span> <span data-ttu-id="71c86-209">Předpokládejme například, vývoj aplikace v systému Windows XP Pro počítač pomocí `SSPI Negotiated` režim ověřování.</span><span class="sxs-lookup"><span data-stu-id="71c86-209">For example, suppose you develop your application on a Windows XP Pro machine using the `SSPI Negotiated` authentication mode.</span></span> <span data-ttu-id="71c86-210">Pokud používáte k ověřování pro účet místního uživatele, se používat protokol NTLM.</span><span class="sxs-lookup"><span data-stu-id="71c86-210">If you use a local user account to authenticate with, then NTLM protocol will be used.</span></span> <span data-ttu-id="71c86-211">Jakmile je aplikace, můžete nasadit službu pro počítače s Windows Server 2003, kde běží pod účtem domény.</span><span class="sxs-lookup"><span data-stu-id="71c86-211">Once the application is developed, you deploy the service to a Windows Server 2003 machine where it runs under a domain account.</span></span> <span data-ttu-id="71c86-212">V tomto okamžiku klienta nebude možné k ověření služby, protože pomocí protokolu Kerberos a řadič domény se používá.</span><span class="sxs-lookup"><span data-stu-id="71c86-212">At this point the client will not be able to authenticate the service because it will be using Kerberos and a domain controller.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="71c86-213">Viz také</span><span class="sxs-lookup"><span data-stu-id="71c86-213">See Also</span></span>  
 <xref:System.ServiceModel.Security.WindowsClientCredential>  
 <xref:System.ServiceModel.Security.WindowsServiceCredential>  
 <xref:System.ServiceModel.Security.WindowsClientCredential>  
 <xref:System.ServiceModel.ClientBase%601>  
 [<span data-ttu-id="71c86-214">Delegace a zosobnění</span><span class="sxs-lookup"><span data-stu-id="71c86-214">Delegation and Impersonation</span></span>](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)  
 [<span data-ttu-id="71c86-215">Nepodporované scénáře</span><span class="sxs-lookup"><span data-stu-id="71c86-215">Unsupported Scenarios</span></span>](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md)
