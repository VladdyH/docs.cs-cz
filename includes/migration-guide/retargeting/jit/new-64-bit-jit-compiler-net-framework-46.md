### <a name="new-64-bit-jit-compiler-in-the-net-framework-46"></a><span data-ttu-id="3f40e-101">Nové 64bitový kompilátor JIT v rozhraní .NET Framework 4.6</span><span class="sxs-lookup"><span data-stu-id="3f40e-101">New 64-bit JIT compiler in the .NET Framework 4.6</span></span>

|   |   |
|---|---|
|<span data-ttu-id="3f40e-102">Podrobnosti</span><span class="sxs-lookup"><span data-stu-id="3f40e-102">Details</span></span>|<span data-ttu-id="3f40e-103">Od verze rozhraní .NET Framework 4.6, nové 64bitový kompilátor JIT se používá pro kompilaci za běhu.</span><span class="sxs-lookup"><span data-stu-id="3f40e-103">Starting with the .NET Framework 4.6, a new 64-bit JIT compiler is used for just-in-time compilation.</span></span> <span data-ttu-id="3f40e-104">V některých případech se vyvolala Neočekávaná výjimka nebo různé chování pozorovanou než pokud aplikace běží, pomocí kompilátoru 32-bit nebo starší 64bitový kompilátor JIT.</span><span class="sxs-lookup"><span data-stu-id="3f40e-104">In some cases, an unexpected exception is thrown or a different behavior is observed than if an app is run using the 32-bit compiler or the older 64-bit JIT compiler.</span></span> <span data-ttu-id="3f40e-105">Tato změna nemá vliv na 32-bit kompilátoru za běhu. Známé rozdíly zahrnují následující:</span><span class="sxs-lookup"><span data-stu-id="3f40e-105">This change does not affect the 32-bit JIT compiler.The known differences include the following:</span></span><ul><li><span data-ttu-id="3f40e-106">Za určitých podmínek může vyvolat operace rozbalení <xref:System.NullReferenceException> v sestavení pro vydání s optimalizací zapnutý.</span><span class="sxs-lookup"><span data-stu-id="3f40e-106">Under certain conditions, an unboxing operation may throw a <xref:System.NullReferenceException> in Release builds with optimization turned on.</span></span></li><li><span data-ttu-id="3f40e-107">V některých případech může spuštění produkčním kódu v textu obsáhlou metodu throw <xref:System.StackOverflowException>.</span><span class="sxs-lookup"><span data-stu-id="3f40e-107">In some cases, execution of production code in a large method body may throw a <xref:System.StackOverflowException>.</span></span></li><li><span data-ttu-id="3f40e-108">Za určitých podmínek struktury předána metodě, jsou považovány za odkazové typy spíš než jako hodnota typy v verzi sestavení.</span><span class="sxs-lookup"><span data-stu-id="3f40e-108">Under certain conditions, structures passed to a method are treated as reference types rather than as value types in Release builds.</span></span> <span data-ttu-id="3f40e-109">Jedním z projevů tohoto problému je, že jednotlivé položky v kolekci se objeví v neočekávaném pořadí.</span><span class="sxs-lookup"><span data-stu-id="3f40e-109">One of the manifestations of this issue is that the individual items in a collection appear in an unexpected order.</span></span></li><li><span data-ttu-id="3f40e-110">Za určitých podmínek, při porovnání <xref:System.UInt16> hodnoty sadou jejich rozšířené je nesprávný, pokud je povolená optimalizace.</span><span class="sxs-lookup"><span data-stu-id="3f40e-110">Under certain conditions, the comparison of <xref:System.UInt16> values with their high bit set is incorrect if optimization is enabled.</span></span></li><li><span data-ttu-id="3f40e-111">Za určitých podmínek, zejména při inicializaci pole hodnot, inicializace paměti pomocí <xref:System.Reflection.Emit.OpCodes.Initblk?displayProperty=nameWithType> IL instrukce může inicializovat paměť s nesprávnou hodnotu.</span><span class="sxs-lookup"><span data-stu-id="3f40e-111">Under certain conditions, particularly when initializing array values, memory initialization by the <xref:System.Reflection.Emit.OpCodes.Initblk?displayProperty=nameWithType> IL instruction may initialize memory with an incorrect value.</span></span> <span data-ttu-id="3f40e-112">To může způsobit buď v neošetřené výjimky nebo nesprávné výstup.</span><span class="sxs-lookup"><span data-stu-id="3f40e-112">This can result either in an unhandled exception or incorrect output.</span></span></li><li><span data-ttu-id="3f40e-113">Za určitých výjimečných podmínek, může vrátit testu podmíněného bit nesprávném <xref:System.Boolean> hodnotu nebo vyvolána výjimka, pokud jsou povolené optimalizace kompilátoru.</span><span class="sxs-lookup"><span data-stu-id="3f40e-113">Under certain rare conditions, a conditional bit test can return the incorrect <xref:System.Boolean> value or throw an exception if compiler optimizations are enabled.</span></span></li><li><span data-ttu-id="3f40e-114">Za určitých podmínek Pokud <code>if</code> příkaz se používá k testování pro podmínku před vstupem <code>try</code> bloku a ve výstupu z <code>try</code> bloku a stejné podmínku vyhodnotí v <code>catch</code> nebo <code>finally</code> bloku, nové 64bitový kompilátor JIT odebere <code>if</code> podmínky z <code>catch</code> nebo <code>finally</code> blokovat, když optimalizuje kódu.</span><span class="sxs-lookup"><span data-stu-id="3f40e-114">Under certain conditions, if an <code>if</code> statement is used to test for a condition before entering  a <code>try</code> block and in the exit from the <code>try</code> block, and the same condition is evaluated in the <code>catch</code> or <code>finally</code> block, the new 64-bit JIT compiler removes the <code>if</code> condition from the <code>catch</code> or <code>finally</code> block when it optimizes code.</span></span> <span data-ttu-id="3f40e-115">V důsledku toho code uvnitř <code>if</code> příkaz v <code>catch</code> nebo <code>finally</code> bezpodmínečně vykonání bloku.</span><span class="sxs-lookup"><span data-stu-id="3f40e-115">As a result, code inside the <code>if</code> statement in the <code>catch</code> or <code>finally</code> block is executed unconditionally.</span></span></li></ul>|
|<span data-ttu-id="3f40e-116">Návrh</span><span class="sxs-lookup"><span data-stu-id="3f40e-116">Suggestion</span></span>|<span data-ttu-id="3f40e-117"><strong>Zmírnění dopadů známých problémů</strong></span><span class="sxs-lookup"><span data-stu-id="3f40e-117"><strong>Mitigation of known issues</strong></span></span> <br/> <span data-ttu-id="3f40e-118">Pokud narazíte na problémy uvedené výše, můžete je vyřešit pomocí některého z následujících akcí:</span><span class="sxs-lookup"><span data-stu-id="3f40e-118">If you encounter the issues listed above, you can address them by doing any of the following:</span></span><ul><li><span data-ttu-id="3f40e-119">Upgrade na rozhraní .NET Framework 4.6.2.</span><span class="sxs-lookup"><span data-stu-id="3f40e-119">Upgrade to the .NET Framework 4.6.2.</span></span> <span data-ttu-id="3f40e-120">Nové 64bitový kompilátor součástí rozhraní .NET Framework 4.6.2 řeší každý z těchto známých problémů.</span><span class="sxs-lookup"><span data-stu-id="3f40e-120">The new 64-bit compiler included with the .NET Framework 4.6.2 addresses each of these known issues.</span></span></li><li><span data-ttu-id="3f40e-121">Zajistěte, aby byl vaši verzi systému Windows aktuální spuštěním služby Windows Update.</span><span class="sxs-lookup"><span data-stu-id="3f40e-121">Ensure that your version of Windows is up to date by running Windows Update.</span></span> <span data-ttu-id="3f40e-122">Aktualizace služby rozhraní .NET Framework 4.6 a 4.6.1 se vztahují na všechny tyto problémy s výjimkou <xref:System.NullReferenceException> v rozbalení operace.</span><span class="sxs-lookup"><span data-stu-id="3f40e-122">Service updates to the .NET Framework 4.6 and 4.6.1 address each of these issues except the <xref:System.NullReferenceException> in an unboxing operation.</span></span></li><li><span data-ttu-id="3f40e-123">Kompilace s starší 64bitový kompilátor JIT.</span><span class="sxs-lookup"><span data-stu-id="3f40e-123">Compile with the older 64-bit JIT compiler.</span></span> <span data-ttu-id="3f40e-124">Najdete v článku <strong>zmírnění další problémy</strong> části Další informace o tom, jak to udělat.</span><span class="sxs-lookup"><span data-stu-id="3f40e-124">See the <strong>Mitigation of other issues</strong> section for more information on how to do this.</span></span></li></ul><span data-ttu-id="3f40e-125"><strong>Zmírnění dopadů jiné problémy</strong></span><span class="sxs-lookup"><span data-stu-id="3f40e-125"><strong>Mitigation of other issues</strong></span></span> <br/> <span data-ttu-id="3f40e-126">Pokud narazíte na žádné jiné rozdíl v chování mezi kódem kompilovat s starší 64bitový kompilátor a nové 64bitový kompilátor JIT, nebo mezi ladění a vydání verze aplikace, které jsou kompilovat s novou 64bitový kompilátor JIT, můžete provést následující sestavovat aplikace pomocí starší 64bitový kompilátor JIT:</span><span class="sxs-lookup"><span data-stu-id="3f40e-126">If you encounter any other difference in behavior between code compiled with the older 64-bit compiler and the new 64-bit JIT compiler, or between the debug and release versions of your app that are both compiled with the new 64-bit JIT compiler, you can do the following to compile your app with the older 64-bit JIT compiler:</span></span><ul><li><span data-ttu-id="3f40e-127">Na základě jednotlivých aplikací, můžete přidat [ < ](~/docs/framework/configure-apps/file-schema/runtime/uselegacyjit-element.md) element konfiguračního souboru aplikace.</span><span class="sxs-lookup"><span data-stu-id="3f40e-127">On a per-application basis, you can add the [<](~/docs/framework/configure-apps/file-schema/runtime/uselegacyjit-element.md) element to your application's configuration file.</span></span> <span data-ttu-id="3f40e-128">Následující zakáže kompilaci s novou 64bitový kompilátor JIT a místo toho používá starší verze 64bitový kompilátor JIT.</span><span class="sxs-lookup"><span data-stu-id="3f40e-128">The following disables compilation with the new 64-bit JIT compiler and instead uses the legacy 64-bit JIT compiler.</span></span></li></ul><pre><code class="lang-xml">&lt;?xml version =&quot;1.0&quot;?&gt;&#13;&#10;&lt;configuration&gt;&#13;&#10;&lt;runtime&gt;&#13;&#10;&lt;useLegacyJit enabled=&quot;1&quot; /&gt;&#13;&#10;&lt;/runtime&gt;&#13;&#10;&lt;/configuration&gt;&#13;&#10;</code></pre><ul><li><span data-ttu-id="3f40e-129">U každého uživatele zvlášť, můžete přidat <code>REG_DWORD</code> hodnotu s názvem <code>useLegacyJit</code> k <code>HKEY_CURRENT_USER\SOFTWARE\Microsoft\.NETFramework</code> klíče registru.</span><span class="sxs-lookup"><span data-stu-id="3f40e-129">On a per-user basis, you can add a <code>REG_DWORD</code> value named <code>useLegacyJit</code> to the <code>HKEY_CURRENT_USER\SOFTWARE\Microsoft\.NETFramework</code> key of the registry.</span></span> <span data-ttu-id="3f40e-130">Hodnota 1 povolí starší verze kompilátoru JIT 64-bit; Hodnota 0 zakáže ho a umožňuje nové 64bitový kompilátor JIT.</span><span class="sxs-lookup"><span data-stu-id="3f40e-130">A value of 1 enables the legacy 64-bit JIT compiler; a value of 0 disables it and enables the new 64-bit JIT compiler.</span></span></li><li><span data-ttu-id="3f40e-131">U jednotlivých počítačů, můžete přidat <code>REG_DWORD</code> hodnotu s názvem <code>useLegacyJit</code> k <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework</code> klíče registru.</span><span class="sxs-lookup"><span data-stu-id="3f40e-131">On a per-machine basis, you can add a <code>REG_DWORD</code> value named <code>useLegacyJit</code> to the <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework</code> key of the registry.</span></span> <span data-ttu-id="3f40e-132">Hodnota <code>1</code> kompilátoru JIT umožňuje starší verze 64-bit; hodnota <code>0</code> zakáže ho a umožňuje nové 64bitový kompilátor JIT.</span><span class="sxs-lookup"><span data-stu-id="3f40e-132">A value of <code>1</code> enables the legacy 64-bit JIT compiler; a value of <code>0</code> disables it and enables the new 64-bit JIT compiler.</span></span></li></ul><span data-ttu-id="3f40e-133">Vám může také dejte nám vědět o problému pomocí hlášení chyby na [Microsoft Connect](https://connect.microsoft.com/VisualStudio).</span><span class="sxs-lookup"><span data-stu-id="3f40e-133">You can also let us know about the problem by reporting a bug on [Microsoft Connect](https://connect.microsoft.com/VisualStudio).</span></span>|
|<span data-ttu-id="3f40e-134">Rozsah</span><span class="sxs-lookup"><span data-stu-id="3f40e-134">Scope</span></span>|<span data-ttu-id="3f40e-135">Edge</span><span class="sxs-lookup"><span data-stu-id="3f40e-135">Edge</span></span>|
|<span data-ttu-id="3f40e-136">Version</span><span class="sxs-lookup"><span data-stu-id="3f40e-136">Version</span></span>|<span data-ttu-id="3f40e-137">4.6</span><span class="sxs-lookup"><span data-stu-id="3f40e-137">4.6</span></span>|
|<span data-ttu-id="3f40e-138">Typ</span><span class="sxs-lookup"><span data-stu-id="3f40e-138">Type</span></span>|<span data-ttu-id="3f40e-139">Změna orientace</span><span class="sxs-lookup"><span data-stu-id="3f40e-139">Retargeting</span></span>|

